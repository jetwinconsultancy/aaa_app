<?php defined('BASEPATH') OR exit('No direct script access allowed');

class Masterclient extends MY_Controller
{

    function __construct()
    {
        parent::__construct();

        if (!$this->loggedIn) {
            $this->session->set_userdata('requested_page', $this->uri->uri_string());
            redirect('login');
        }

        $this->load->model('db_model');
        $this->load->model('master_model');
        $this->load->library(array('session', 'form_validation'));
        $this->load->database();
        $this->digital_upload_path = 'files/';
        $this->upload_path = 'assets/uploads/';
        $this->thumbs_path = 'assets/uploads/thumbs/';
        $this->image_types = 'gif|jpg|jpeg|png|tif';
        $this->digital_file_types = 'zip|psd|ai|rar|pdf|doc|docx|xls|xlsx|ppt|pptx|gif|jpg|jpeg|png|tif|txt';
        $this->allowed_file_size = '1024';
    }

    public function index()
    {
        $this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));
		
		//echo json_encode($_POST);
		/*if (isset($_POST['showall']))
		{
			$this->data['client'] = $this->db_model->getClient();
		} else*/
		//echo json_encode($_POST['search']);
		if (isset($_POST['search'])) {
			if (isset($_POST['search']) && isset($_POST['tipe']))
			{

				// if ($_POST['pencarian'] != '')
				// {
					$this->data['client'] = $this->db_model->getClient($_SESSION['group_id'], $_POST['tipe'],$_POST['search']);
				// }
			} 
		}
		else
		{
			$this->data['client'] = $this->db_model->getClient($_SESSION['group_id']);
		}
        // $this->data['quotes'] = $this->db_model->getLastestQuotes();
        // $this->data['purchases'] = $this->db_model->getLatestPurchases();
        // $this->data['transfers'] = $this->db_model->getLatestTransfers();
        // $this->data['customers'] = $this->db_model->getLatestCustomers();
        // $this->data['suppliers'] = $this->db_model->getLatestSuppliers();
        // $this->data['chatData'] = $this->db_model->getChartData();
        // $this->data['stock'] = $this->db_model->getStockValue();
        // $this->data['bs'] = $this->db_model->getBestSeller();
        // $this->data['users'] = $this->db_model->getUserList();
        // $lmsdate = date('Y-m-d', strtotime('first day of last month')) . ' 00:00:00';
        // $lmedate = date('Y-m-d', strtotime('last day of last month')) . ' 23:59:59';
        // $this->data['lmbs'] = $this->db_model->getBestSeller($lmsdate, $lmedate);
		
        $bc = array(array('link' => '#', 'page' => lang('Clients')));
        $meta = array('page_title' => lang('Clients'), 'bc' => $bc, 'page_name' => 'Clients');

        $this->db->select("*")
            ->from("users")
            ->where('id = "'.$this->session->userdata("user_id").'"');

        $user = $this->db->get();
        $user = $user->result_array();

        $this->data["no_of_client"] = $user[0]["no_of_client"];
        $this->data["total_no_of_client"] = $user[0]["total_no_of_client"];
		// $this->data['page_name'] = 'Clients';
        $this->page_construct('client/masterclient.php', $meta, $this->data);

    }
	
	public function add ()
	{
        $bc = array(array('link' => '#', 'page' => lang('Create Client')));
        $meta = array('page_title' => lang('Create Client'), 'bc' => $bc, 'page_name' => 'Create Client');
		$this->data['sharetype'] = $this->master_model->get_all_share_type();
		// $this->data['service'] = $this->master_model->get_all_service();
		// $this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();
		$this->data['citizen'] = $this->master_model->get_all_citizen();
		$this->data['person'] = $this->master_model->get_all_person();
		$this->data['typeofdoc'] = $this->master_model->get_all_typeofdoc();
		$this->data['doccategory'] = $this->master_model->get_all_doccategory();
		$this->data['client_service'] = $this->master_model->get_all_client_service();
		$this->data['client_billing_info'] = $this->master_model->get_all_default_client_service();
		// if ($this->session->userdata('unique_code') && $this->session->userdata('unique_code') != '')
		// {
			
			// $uq = $this->master_model->get_draft_add_company($this->session->userdata('username'));
			// if (isset($uq->unique_code))
			// {
			// $unique_code =$uq->unique_code;
			// } else $unique_code =$this->session->userdata('unique_code');
		// }
		//$this->session->set_userdata('unique_code', $unique_code);
		$this->session->set_userdata(array(
            'company_type'  => null,
        ));
		$this->session->set_userdata(array(
            'company_code'  => null,
        ));
		$this->session->set_userdata(array(
            'acquried_by'  =>  null,
        ));
        $this->session->set_userdata(array(
            'status'  => null,
        ));

        $this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Clients', base_url('masterclient'));
		$this->mybreadcrumb->add('Create Client', base_url());

		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		//$registered_address = $this->db->query("select postal_code,street_name,building_name,unit_no1,unit_no2 from firm");

		$this->db->select('our_service_registration_address.id, our_service_info.service_name, our_service_registration_address.postal_code, our_service_registration_address.street_name, our_service_registration_address.building_name, our_service_registration_address.unit_no1, our_service_registration_address.unit_no2')
                ->from('firm')
                ->join('user_firm', 'user_firm.firm_id = firm.id AND user_firm.user_id = '.$this->session->userdata('user_id'), 'left')
                ->join('our_service_info', 'our_service_info.user_admin_code_id = '.$this->session->userdata('user_admin_code_id').' and service_type = 7', 'left')
                ->join('our_service_registration_address', 'our_service_registration_address.our_service_info_id = our_service_info.id', 'left')
                ->where('user_firm.user_id = '.$this->session->userdata('user_id'))
                ->where('user_firm.in_use = 1');
        $registered_address = $this->db->get();

        $registered_address_info = $registered_address->result_array();

        $this->data['first_time'] = false;
        $this->data['registered_address_info'] = $registered_address_info;
       
		// $this->data['unique_code'] = $unique_code;
		// $q = $this->db->get_where('officer', array('unique_code' => $unique_code));
        // if ($q->num_rows() > 0) {
            // foreach (($q->result()) as $row) {
                // $data[] = $row;
            // }
        // }
		// $officer = 
		$this->data['officer'] =$this->db_model->getOfficerUC($unique_code);
		// $this->sma->print_arrays($this->data);
        $this->page_construct('client/edit_client.php', $meta, $this->data);
		
	}

	public function check_client_data()
	{
		$company_code=$_POST['company_code'];

		$check_address = [];
		$check_company_name = [];
		$check_company_type = [];
		$check_activity1 = [];
		$check_activity2 = [];
		

		$check_address[0]['postal_code']=$_POST['postal_code'];
		$check_address[0]['street_name']=$_POST['street_name'];
		$check_address[0]['building_name']=$_POST['building_name'];
		$check_address[0]['unit_no1']=$_POST['unit_no1'];
		$check_address[0]['unit_no2']=$_POST['unit_no2'];

		$check_company_name[0]['company_name']=$_POST['company_name'];

		$check_company_type[0]['company_type']=$_POST['company_type'];

		$check_activity1[0]["activity1"]=$_POST['activity1'];
		$check_activity2[0]["activity2"]=$_POST['activity2'];

		$query = $this->db->get_where("history_client", array("company_code" => $company_code));

		if (!$query->num_rows())//if don't have anythings
		{
			echo false;
		}
		else
		{
			$query = $query->result_array();

			$old_client_company_name_result = $this->db->query("select company_name from client where company_code='".$company_code."'");

			$old_client_company_name_result = $old_client_company_name_result->result_array();

			if(!($old_client_company_name_result == $check_company_name))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "2"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

			$old_client_address_result = $this->db->query("select postal_code, street_name, building_name, unit_no1, unit_no2 from client where company_code='".$company_code."'");

			$old_client_address_result = $old_client_address_result->result_array();

			if(!($old_client_address_result == $check_address))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "7"));

				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

			$old_client_company_type_result = $this->db->query("select company_type from client where company_code='".$company_code."'");

			$old_client_company_type_result = $old_client_company_type_result->result_array();

			if(!($old_client_company_type_result == $check_company_type))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "3"));

				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

			if($_POST['acquried_by'] == 1)
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "1"));

				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}

			if($_POST['status'] == 2 || $_POST['status'] == 3)
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "4"));

				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}

			$old_client_company_activity1_result = $this->db->query("select activity1 from client where company_code='".$company_code."'");

			$old_client_company_activity1_result = $old_client_company_activity1_result->result_array();

			if(!($old_client_company_activity1_result == $check_activity1))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "5"));

				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

			$old_client_company_activity2_result = $this->db->query("select activity2 from client where company_code='".$company_code."'");

			$old_client_company_activity2_result = $old_client_company_activity2_result->result_array();

			if(!($old_client_company_activity2_result == $check_activity2))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $query[0]["id"], "received_on" => "", "triggered_by" => "6"));

				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}
			
		}

	}

	public function save() //save_client
	{

		// $this->sma->print_arrays($_POST);
		// Data Company Info
		//$document=[];
		// exit();
		/*if ($_POST['Slct_file_setup_for']) $data['Slct_file_setup_for']=$_POST['Slct_file_setup_for'];
            
            if ($_FILES['file_setup_for']['size'] > 0) {
				$config['upload_path'] = './uploads/';
				$config['allowed_types'] = 'gif|jpg|png';
				$config['max_size']     = '100';
				$config['max_width'] = '1024';
				$config['max_height'] = '768';

				$this->load->library('upload', $config);

				// Alternately you can set preferences by calling the ``initialize()`` method. Useful if you auto-load the class:
				$this->upload->initialize($config);
                if ($this->upload->do_upload("file_setup_for"))
				{
				$pho=$this->upload->file_name;
				}
			}*/
		//if ($pho) $data['file_setup_for']=$pho;
		
		//$document['company_client_code'] =$data['clientcode'];
		//$data['unique_code']=$_POST['unique_code'];
		//$unique_code = $_POST['unique_code'];

		if(!isset($_POST['client_code']) && !isset($_POST['registration_no']) && !isset($_POST['acquried_by']) && !isset($_POST['company_name']) && !isset($_POST['incorporation_date']) && !isset($_POST['company_type']) && !isset($_POST['activity1']) && !isset($_POST['postal_code']) && !isset($_POST['street_name']))
		{
			$data['status']=$_POST['status'];

			$this->db->update("client",$data,array("company_code" =>  $_POST['company_code']));

			echo json_encode(array("Status" => 3,'message' => 'Information Updated', 'title' => 'Updated'));

		}
		else
		{
			
			$this->form_validation->set_rules('client_code', 'Client Code', 'required');
	        $this->form_validation->set_rules('registration_no', 'Registration No', 'required');
	        $this->form_validation->set_rules('company_name', 'Company Name', 'required');
	        /*$this->form_validation->set_rules('former_name', 'Former Name', 'required');*/
	        $this->form_validation->set_rules('incorporation_date', 'Incorporation Date', 'required');
	        $this->form_validation->set_rules('company_type', 'Company Type', 'required');
	        $this->form_validation->set_rules('activity1', 'Activity 1', 'required');
	        /*$this->form_validation->set_rules('activity2', 'Activity 2', 'required');*/
	        $this->form_validation->set_rules('postal_code', 'Postal Code', 'required');
	        $this->form_validation->set_rules('street_name', 'Street Name', 'required');

	        //echo($_POST['company_type']);
	        if ($this->form_validation->run() == FALSE || $_POST['company_type'] == "0" || $_POST['status'] == "0" || $_POST['acquried_by'] == "0")
	        {
	        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));
				$bc = array(array('link' => '#', 'page' => lang('Add Clients')));
		        $meta = array('page_title' => lang('Add Clients'), 'bc' => $bc, 'page_name' => 'Add Clients');

	        	if($_POST['company_type'] == "0")
	            {
	            	//echo (validation_errors());
	                $validate_company_type = "*The Company Type field is required.";
	                //form_error('company_type') = $validate_company_type;
	                //$this->form_validation->set_message('company_type', $validate_company_type);
	            }
	            else
	            {
	                $validate_company_type = "";
	            }
	            if($_POST['acquried_by'] == "0")
	            {
	            	//echo (validation_errors());
	                $validate_acquried_by = "The Acquried By field is required.";
	                //form_error('company_type') = $validate_company_type;
	                //$this->form_validation->set_message('company_type', $validate_company_type);
	            }
	            else
	            {
	                $validate_acquried_by = "";
	            }
	            if($_POST['status'] == "0")
	            {
	            	//echo (validation_errors());
	                $validate_status = "The Status field is required.";
	                //form_error('company_type') = $validate_company_type;
	                //$this->form_validation->set_message('company_type', $validate_company_type);
	            }
	            else
	            {
	                $validate_status = "";
	            }
	            //echo json_encode(validation_errors());
	            $error = array(
	                'client_code' => strip_tags(form_error('client_code')),
	                'registration_no' => strip_tags(form_error('registration_no')),
	                'company_name' => strip_tags(form_error('company_name')),
	                'company_type' => $validate_company_type,
	                /*'former_name' => strip_tags(form_error('former_name')),*/
	                'incorporation_date' => strip_tags(form_error('incorporation_date')),
	                'activity1' => strip_tags(form_error('activity1')),
	                /*'activity2' => strip_tags(form_error('activity2')),*/
	                'postal_code' => strip_tags(form_error('postal_code')),
	                'street_name' => strip_tags(form_error('street_name')),
	                'status' => $validate_status,
	                'acquried_by' => $validate_acquried_by,
	            );
	            $this->data["company_type"] = $validate_company_type;    

	            $registered_address = $this->db->query("select postal_code, street_name, building_name, unit_no1, unit_no2 from firm ");
		        $registered_address_info = $registered_address->result_array();
		        $this->data['registered_address_info'] = $registered_address_info;  

		        $this->session->set_userdata(array(
	                    'company_type'  => $_POST['company_type'],
	                ));      
		        $this->session->set_userdata(array(
	                'company_type'  =>  $_POST['acquried_by'],
	            ));
	            $this->session->set_userdata(array(
	                'status'  => $_POST['status'],
	            ));
	            //$this->page_construct('addpersonprofile.php', $meta, $this->data);

	            //$this->page_construct('client/edit_client.php', $meta, $this->data);
	            echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error, $this->data));
	        }
	        else
	        {
	        	$date_of_appointment = $this->db->query("select date_of_appointment from client_officers where company_code = '".$_POST['company_code']."' AND STR_TO_DATE(date_of_appointment,'%d/%m/%Y') < STR_TO_DATE('". $_POST['incorporation_date']. "','%d/%m/%Y') ");
	        	
		        if ($date_of_appointment->num_rows())
				{
					echo json_encode(array("Status" => 2,'message' => 'Appointment date of some officers are dated prior to incorporation date. Please change the date of appointment of all relevant officers first before changing the date of incorporation.', 'title' => 'Error'));
				}
				else
				{
		        	$check_unique_client_code = $this->db->get_where("client", array("client_code" => $_POST['client_code'], "company_code !=" => $_POST['company_code'], "deleted !=" => 1));
		        	//echo json_encode($check_unique_client_code->result_array());
		        	if (!$check_unique_client_code->num_rows())
					{
						$check_unique_registration_no = $this->db->get_where("client", array("registration_no" => $_POST['registration_no'], "company_code !=" => $_POST['company_code'], "deleted !=" => 1));
						if (!$check_unique_registration_no->num_rows())
						{

							$data['created_by']=$this->session->userdata('user_id');
							$data['firm_id']=$this->session->userdata('firm_id');
							//$data['user_id']=$this->session->userdata('user_id');
							//$data['admin_id']=$this->session->userdata('admin_id');
							$data['acquried_by']=$_POST['acquried_by'];
							$data['company_code']=$_POST['company_code'];
							$company_code=$data['company_code'];
							$data['client_code']=strtoupper($_POST['client_code']);
							$data['registration_no']=strtoupper($_POST['registration_no']);
							$registration_no = $data['registration_no'];
							$data['company_name']=strtoupper($_POST['company_name']);
							$data['former_name']=strtoupper($_POST['former_name']);
							//$document['company_uen'] = $data['uen'];
							// $data['file_setup1']=$_POST['file_setup1'];
							// $data['file_setup2']=$_POST['file_setup2'];
							//$data['date_incorporation']=$this->sma->fld($_POST['date_incorporation']);
							$data['incorporation_date']=$_POST['incorporation_date'];
							$data['company_type']=$_POST['company_type'];
							$data['status']=$_POST['status'];
							$data['activity1']=strtoupper($_POST['activity1']);
							// $data['description1']=$_POST['description1'];
							$data['activity2']=strtoupper($_POST['activity2']);
							$data['registered_address']=(isset($_POST['use_registered_address'])) ? 1 : 0;
							$data['our_service_regis_address_id']= $_POST['service_reg_off'];
							//$data['description2']=$_POST['description2'];
							//$document['company_date_incorporation'] = $data['date_incorporation'];
							
							//$document['company_client_name'] = $data['client_name'];
							$data['postal_code']=strtoupper($_POST['postal_code']);
							/*$data['city']=$_POST['city'];*/
							$data['street_name']=strtoupper($_POST['street_name']);
							$data['building_name']=strtoupper($_POST['building_name']);
							$data['unit_no1']=strtoupper($_POST['unit_no1']);
							$data['unit_no2']=strtoupper($_POST['unit_no2']);
							//$data['listed_company']=(isset($_POST['listedcompany'])) ? 1 : 0;
							/*$data['last_AGM']=$_POST['last_AGM'];
							$data['last_AR']=$_POST['last_AR'];
							$data['account_laid_last_AGM']=$_POST['account_laid_last_AGM'];
							$data['next_AGM']=$_POST['next_AGM'];
							$data['next_AR']=$_POST['next_AR'];
							$data['account_laid_next_AGM']=$_POST['account_laid_next_AGM'];*/
							/*$document['company_address'] = $data['buildingname']." ".$data['unitno']." ".$data['unitno1']." ".$data['streetname']." ".$data['city']." ".$data['postal_code'];*/
							
							/*$document['company_activity'] = $data['activity1'].($data['activity2']?' & ':'').$data['activity2'];*/
							
							/*$data['cp']=$_POST['cp'];
							$document['company_contact_person'] = $data['cp'];
							$data['phone']=$_POST['phone'];
							$document['company_phone'] = $data['phone'];
							$data['email']=$_POST['email'];
							$document['company_email'] = $data['company_email'];
							$data['fax']=$_POST['fax'];
							$document['company_fax'] = $data['company_fax'];
							if (isset($_POST['listedcompany']) && $_POST['listedcompany'] == 'on') $data['listedcompany']=1; else $data['listedcompany']=0;
							$data['chairman']=$_POST['chairman'];*/
							
							/*$document['company_former_name'] = $data['formername'];*/
							//echo json_encode($data);
							$q = $this->db->get_where("client", array("company_code" => $_POST['company_code']));

							/*$check_query = "SELECT * FROM `client` WHERE `registration_no`= '".$registration_no."' LIMIT 1";
							$query = $this->db->query($check_query);*/
							//echo (!$q->num_rows());
							if (!$q->num_rows())
							{
								if ($data['registration_no'] && $data['company_name'])
								$this->db->insert("client",$data);

								/*$query_template = $this->master_model->get_all_template_data($_POST['company_code']);

								for($i = 0; $i < count($query_template); $i++ )
								{
									
									//$billing['amount'] += $_POST['amount'][$i];

									$client_billing_info['company_code'] = $_POST['company_code'];
									$client_billing_info['client_billing_info_id'] = $query_template[$i]->client_billing_info_id;
									$client_billing_info['service'] = $query_template[$i]->service;
									$client_billing_info['invoice_description'] = $query_template[$i]->invoice_description;
									//(int)str_replace(',', '', $amount[$p]);
									$client_billing_info['amount'] = (float)str_replace(',', '', $query_template[$i]->amount);
									$client_billing_info['frequency'] = $query_template[$i]->frequency;
									$client_billing_info["from"] = $query_template[$i]->from;
									$client_billing_info["to"] = $query_template[$i]->to;

									$q = $this->db->get_where("client_billing_info", array("company_code" => $_POST['company_code'], "client_billing_info_id" => $query_template[$i]->client_billing_info_id));

									if (!$q->num_rows())
									{				
										$this->db->insert("client_billing_info",$client_billing_info);
										
									} 
									else 
									{	
										$this->db->where(array("company_code" => $_POST['company_code'], "client_billing_info_id" => $query_template[$i]->client_billing_info_id));
										$this->db->update("client_billing_info",$client_billing_info);
									}
								}*/
								if($_POST['acquried_by'] == "1")
								{
									$this->create_invoice("newly_incorporated", $_POST['company_code']);
								}
								
								$this->recalculate();
								
							} 
							else 
							{
								if ($data['registration_no'] && $data['company_name'])
								{
									$old_client_data = $q->result_array();

									if($old_client_data[0]["company_name"] != $_POST['company_name'])
									{
										$data['former_name'] = $old_client_data[0]["company_name"]."\r\n".$data['former_name'];

										$change_company_name['subsidiary_name'] = strtoupper($_POST['company_name']);;

										$this->db->update("corporate_representative",$change_company_name,array("subsidiary_name" => $old_client_data[0]["company_name"]));
										$change_cn = true; 
									}
									else
									{
										$change_cn = false; 
									}

									$check_address = [];
									$check_company_name = [];
									$check_company_type = [];
									$check_activity1 = [];
									$check_activity2 = [];

									$check_address[0]['postal_code']=$_POST['postal_code'];
									$check_address[0]['street_name']=$_POST['street_name'];
									$check_address[0]['building_name']=$_POST['building_name'];
									$check_address[0]['unit_no1']=$_POST['unit_no1'];
									$check_address[0]['unit_no2']=$_POST['unit_no2'];

									$check_company_name[0]['company_name']=$_POST['company_name'];

									$check_company_type[0]['company_type']=$_POST['company_type'];

									$check_acquried_by=$_POST['acquried_by'];

									$check_status=$_POST['status'];

									$check_activity1[0]["activity1"]=$_POST['activity1'];

									$check_activity2[0]["activity2"]=$_POST['activity2'];

									$old_client_address_result = $this->db->query("select postal_code, street_name, building_name, unit_no1, unit_no2 from client where company_code='".$company_code."'");

									$old_client_company_name_result = $this->db->query("select company_name from client where company_code='".$company_code."'");

									$old_client_company_type_result = $this->db->query("select company_type from client where company_code='".$company_code."'");

									$old_client_company_activity1_result = $this->db->query("select activity1 from client where company_code='".$company_code."'");

									$old_client_company_activity2_result = $this->db->query("select activity2 from client where company_code='".$company_code."'");

									$old_client_address_result = $old_client_address_result->result_array();

									$old_client_company_name_result = $old_client_company_name_result->result_array();

									$old_client_company_type_result = $old_client_company_type_result->result_array();

									$old_client_company_activity1_result = $old_client_company_activity1_result->result_array();

									$old_client_company_activity2_result = $old_client_company_activity2_result->result_array();

									/*echo json_encode($check_address);
									echo json_encode($old_client_address_result);
									echo json_encode($old_client_address_result == $check_address);*/
									//echo(!($old_client_address_result == $check_address));

									$this->db->update("client",$data,array("company_code" =>  $_POST['company_code']));



									if($check_acquried_by == 1 || $check_acquried_by == 2)
									{
										$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));

										$query_check_history_client = $check_history_client->result_array();

										
										if (!$check_history_client->num_rows())
										{
											$k = $q->result();

											foreach($k as $r) {
										        $this->db->insert("history_client",$r);
										    }
										} 
										else 
										{
											//$c = $q->result_array();

											$data_history['acquried_by'] = $check_acquried_by;

										    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
											
										}

										if($query_check_history_client[0]["acquried_by"] == 2)
										{
											//$this->create_document("acquried_by", $_POST['company_code']);
										}
									}

									if($check_status == 2 || $check_status == 3)
									{
										$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));
										if (!$check_history_client->num_rows())
										{
											$k = $q->result();

											foreach($k as $r) {
										        $this->db->insert("history_client",$r);
										    }
										} 
										else 
										{
											//$c = $q->result_array();

											$data_history['status'] = $check_status;

										    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
											
										}

										//$this->create_document("status", $_POST['company_code']);
									}

									if(!($old_client_company_activity1_result == $check_activity1))
									{
										$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));
										if (!$check_history_client->num_rows())
										{
											$w = $q->result();

											foreach($w as $r) {
										        $this->db->insert("history_client",$r);
										    }
										} 
										else 
										{
											$x = $q->result_array();

											$data_history['activity1'] = $x[0]["activity1"];

										    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
											
										}

										//$this->create_document("change_activity1", $_POST['company_code']);
									}

									if($old_client_company_activity2_result[0]["activity2"] != '')
									{
										if(!($old_client_company_activity2_result == $check_activity2))
										{
											$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));
											if (!$check_history_client->num_rows())
											{
												$w = $q->result();

												foreach($w as $r) {
											        $this->db->insert("history_client",$r);
											    }
											} 
											else 
											{
												$x = $q->result_array();

												$data_history['activity2'] = $x[0]["activity2"];

											    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
												
											}

											//$this->create_document("change_activity2", $_POST['company_code']);
										}
									}

									if(!($old_client_company_type_result == $check_company_type))
									{
										$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));
										if (!$check_history_client->num_rows())
										{
											$d = $q->result();

											foreach($d as $r) {
										        $this->db->insert("history_client",$r);
										    }
										} 
										else 
										{
											$c = $q->result_array();

											$data_history['company_type'] = $c[0]["company_type"];

										    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
											
										}

										//$this->create_document("change_company_type", $_POST['company_code']);
									}

									if(!($old_client_address_result == $check_address))
									{
										$this->create_invoice("change_address", $_POST['company_code']);
										$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));
										if (!$check_history_client->num_rows())
										{
											$t = $q->result();

											foreach($t as $r) {
										        $this->db->insert("history_client",$r);
										    }
										} 
										else 
										{
											$h = $q->result_array();

											$data_history['registered_address'] = $h[0]["registered_address"];
											$data_history['our_service_regis_address_id'] = $h[0]["our_service_regis_address_id"];
											$data_history['postal_code'] = $h[0]["postal_code"];
											$data_history['street_name'] = $h[0]["street_name"];
											$data_history['building_name'] = $h[0]["building_name"];
											$data_history['unit_no1'] = $h[0]["unit_no1"];
											$data_history['unit_no2'] = $h[0]["unit_no2"];

										    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
											
										}

										//$this->create_document("change_address", $_POST['company_code']);
									}
									if(!($old_client_company_name_result == $check_company_name))
									{
										$this->create_invoice("change_company_name", $_POST['company_code']);
										$check_history_client = $this->db->get_where("history_client", array("company_code" => $_POST['company_code']));
										if (!$check_history_client->num_rows())
										{
											$f = $q->result();

											foreach($f as $r) {
										        $this->db->insert("history_client",$r);
										    }
										} 
										else 
										{
											$d = $q->result_array();

											$data_history['company_name'] = $d[0]["company_name"];

										    $this->db->update("history_client",$data_history,array("company_code" =>  $_POST['company_code']));
											
										}

										//$this->create_document("change_company_name", $_POST['company_code']);
									}
								}
								
							}

							$this->data['client_billing_data'] = $this->master_model->get_all_client_billing_info($_POST['company_code']);

							/*$q = $this->db->query('select client_billing_info.*, billing_info_service.service as service_name, billing_info_frequency.frequency as frequency_name from client_billing_info left join billing_info_service on client_billing_info.service = billing_info_service.id left join billing_info_frequency on client_billing_info.frequency = billing_info_frequency.id where company_code ="'.$_POST['company_code'].'"');

				            if ($q->num_rows() > 0) {
				                $this->data['check_available_in_client_billing_info'] = 1;
				                $this->data['template'] = $this->master_model->get_all_template_data($_POST['company_code']);
				            }
				            else
				            {
				            	$this->data['check_available_in_client_billing_info'] = 0;
				            }*/
							
							// $document['company_client_code'] = 'kode PERUSAHAAN ';
							// $document['company_uen'] = 'UEN Perusahaan';
							// $document['company_uen'] = 'UEN Perusahaan';
							//$this->sma->generate_document($document,$_POST['unique_code']);
							// $this->sma->print_arrays($data,$pho,$_FILES);
					        //redirect("masterclient");


					        echo json_encode(array("Status" => 1,'message' => 'Information Updated', 'title' => 'Updated', 'client_billing' => $this->data, 'change_company_name' => $change_cn));
							// $this->session->set_userdata('unique_code', '');
					    }
					    else
					    {
					    	echo json_encode(array("Status" => 2,'message' => 'The registration no. already in the system.', 'title' => 'Error'));
					    }

				    }
				    else
				    {
				    	echo json_encode(array("Status" => 2,'message' => 'The client code already in the system.', 'title' => 'Error'));
				    }
				}
		    }
		}
	}

	public function recalculate()
    {
        $this->db->select("users.id")
                ->from("users")
                ->join('groups', 'users.group_id = groups.id', 'inner')
                ->join('user_firm as a', 'a.user_id = "'.$this->session->userdata("user_id").'"', 'inner')
                ->join('user_firm as b', 'a.firm_id=b.firm_id', 'inner')
                ->where('b.user_id = users.id')
                ->where('b.user_id != "'.$this->session->userdata("user_id").'"')
                ->group_by('users.id');
        $test = $this->db->get();
        $test = $test->result_array();

        $data_user_id = array();

        foreach ($test as $rr) {
            array_push($data_user_id, $rr["id"]);
        }

        $this->db->select("firm_id")
        ->from("user_firm")
        ->where('user_id = "'.$this->session->userdata("user_id").'"');

        $firm_id = $this->db->get();
        $firm_id = $firm_id->result_array();

        $data_firm_id = array();

        foreach ($firm_id as $rows) {
            array_push($data_firm_id, $rows["firm_id"]);
        }

        $user["no_of_user"] = count($data_user_id);
        $user["no_of_firm"] = count($data_firm_id);
        $this->db->where('id', $this->session->userdata("user_id"));
        $this->db->update('users',$user);

        if(count($data_firm_id) != 0)
        {
            

            $this->db->select('id');
            $this->db->from('client');
            $this->db->where_in('firm_id', $data_firm_id);

            $num_client = $this->db->get();
            $num_client = $num_client->result_array();

            if(count($num_client) != 0)
            {   
                //echo json_encode($row["id"]);
                $users["no_of_client"] = count($num_client);

            }
            else
            {
                $users["no_of_client"] = 0;
            }

            $this->db->where('id', $this->session->userdata("user_id"));
            $this->db->update('users',$users);

            $data_user_id = array();

            foreach ($test as $r) {
                array_push($data_user_id, $r["id"]);
            }

            if(count($data_user_id) != 0)
            {  
	            $this->db->where_in('id', $data_user_id);
	            $this->db->update('users',$users);
	        }
        }
    }
//-------------------------------------------create_document_start------------------------------------------------------//

// 	public function create_document($type, $company_code, $officer_id = null, $controller_id = null, $charge_id = null, $filing_id = null, $guarantee_id = null, $allotment_id = null, $client_member_share_capital_id = null, $buyback_id = null, $transfer_id = null)
// 	{
// 		//echo json_encode($charge_id);
// 		$get_client = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$company_code."'");

// 		$get_client = $get_client->result_array();

// 		//|| ($get_client[0]["acquried_by"] == 1 && $get_client[0]["auto_generate"] == 0)
// 		if($get_client[0]["auto_generate"] == 1 )
// 		{
// 			if($type == "change_company_name")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 2 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_address")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 7 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_company_type")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 3 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "acquried_by")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 1 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "status")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 4 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_activity1")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 5 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_activity2")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 6 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "appointment_of_director")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 8 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

// 				//echo json_encode($officer_id);
// 			}
// 			elseif($type == "cessation_of_director")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 9 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "appointment_of_manager")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 12 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

// 				//echo json_encode($officer_id);
// 			}
// 			elseif($type == "cessation_of_manager")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 13 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "appointment_of_secretary")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 14 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

				
// 			}
// 			elseif($type == "cessation_of_secretary")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 15 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "appointment_of_auditor")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 16 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

// 				//echo json_encode($officer_id);
// 			}
// 			elseif($type == "cessation_of_auditor")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 17 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "appointment_of_ceo")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 10 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

// 				//echo json_encode($officer_id);
// 			}
// 			elseif($type == "cessation_of_ceo")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 11 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "appointment_of_managing_director")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 18 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

// 				//echo json_encode($officer_id);
// 			}
// 			elseif($type == "cessation_of_managing_director")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 19 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "appointment_of_alternate_director")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 20 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();

// 				//echo json_encode($officer_id);
// 			}
// 			elseif($type == "cessation_of_alternate_director")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 21 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_cessation = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_cessation = $date_of_cessation->result_array();
// 			}
// 			elseif($type == "add_allotment_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 23 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$allot_transaction_date = $this->db->get_where("member_shares", array("id" => $allotment_id[0]));

// 				$allot_transaction_date = $allot_transaction_date->result_array();
// 			}
// 			elseif($type == "add_buyback_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 24 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$buyback_transaction_date = $this->db->get_where("member_shares", array("id" => $buyback_id[0]));

// 				$buyback_transaction_date = $buyback_transaction_date->result_array();

// 				//echo json_encode($buyback_id);
// 			}
// 			elseif($type == "add_transfer_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 25 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$transfer_transaction_date = $this->db->get_where("member_shares", array("id" => $transfer_id[0]));

// 				$transfer_transaction_date = $transfer_transaction_date->result_array();

// 				//echo json_encode($buyback_id);
// 			}
// 			elseif($type == "change_registration_of_charge")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 29 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_registration = $this->db->get_where("client_charges", array("id" => $charge_id));

// 				$date_of_registration = $date_of_registration->result_array();

// 				//echo json_encode($charges_id);
// 			}
// 			elseif($type == "change_satisfaction_of_charge")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 30 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_satisfaction = $this->db->get_where("client_charges", array("id" => $charge_id));

// 				$date_of_satisfaction = $date_of_satisfaction->result_array();
// 			}
// 			/*elseif($type == "change_date_of_appointment")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 8 AND firm_id='".$get_client[0]["firm_id"]."'");

// 				$date_of_appointment = $this->db->get_where("client_officers", array("id" => $officer_id));

// 				$date_of_appointment = $date_of_appointment->result_array();
// 			}
// 			elseif($type == "change_date_of_cessation")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 9 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}*/

// 			/*elseif($type == "add_new_class_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 11 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "add_allotment_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 12 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "add_buyback_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 13 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "add_transfer_of_share")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 14 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "add_guarantee")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 15 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_guarantee")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 15 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_registration_of_controller")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 16 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "change_cessation_of_controller")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 17 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}*/
			
// 			elseif($type == "change_of_year_end")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 31 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "agm_held")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 32 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			elseif($type == "dispense_agm")
// 			{
// 				$result = $this->db->query("select * from document_master where triggered_by = 33 AND firm_id='".$get_client[0]["firm_id"]."'");
// 			}
// 			//echo json_encode($result->result_array());
// 			if ($result->num_rows())
// 			{
// 				$result = $result->result_array();

// 				for($r = 0; $r < count($result); $r++)
// 				{
// 					$data['client_id']=$get_client[0]["id"];
// 	                $data['firm_id']=$this->session->userdata('firm_id');
// 	                if($officer_id != null)
// 	                {
// 	                	$data['officer_id']=json_encode(array((int)$officer_id));
// 	                }
// 	                else
// 	                {
// 	                	$data['officer_id']="";
// 	                }
// 	                if($controller_id != null)
// 	                {
// 	                	$data['controller_id']=$controller_id;
// 	                }
// 	                else
// 	                {
// 	                	$data['controller_id']="";
// 	                }
// 	                if($allotment_id != null)
// 	                {
// 	                	$data['allotment_id']=json_encode(array((int)$allotment_id));
// 	                }
// 	                else
// 	                {
// 	                	$data['allotment_id']="";
// 	                }
// 	                if($buyback_id != null)
// 	                {
// 	                	$data['buyback_id']=json_encode(array((int)$buyback_id));
// 	                }
// 	                else
// 	                {
// 	                	$data['buyback_id']="";
// 	                }
// 	                if($transfer_id != null)
// 	                {
// 	                	$data['transfer_id']=json_encode($transfer_id);
// 	                }
// 	                else
// 	                {
// 	                	$data['transfer_id']="";
// 	                }
// 	                if($charge_id != null)
// 	                {
// 	                	$data['charge_id']=json_encode(array((int)$charge_id));
// 	                }
// 	                else
// 	                {
// 	                	$data['charge_id']="";
// 	                }
// 	                if($filing_id != null)
// 	                {
// 	                	$data['filing_id']=$filing_id;
// 	                }
// 	                else
// 	                {
// 	                	$data['filing_id']="";
// 	                }
// 	                if($guarantee_id != null)
// 	                {
// 	                	$data['guarantee_id']=$guarantee_id;
// 	                }
// 	                else
// 	                {
// 	                	$data['guarantee_id']="";
// 	                }
// 	                $data['document_name']=$result[$r]["document_name"]." - ".DATE("Y",now());
// 	                $data['document_date_checkbox']=1;
// 	                if($officer_id != null)
// 	                {
// 	                	if($type == "appointment_of_director")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_director")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                	elseif($type == "appointment_of_secretary")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_secretary")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                	elseif($type == "appointment_of_auditor")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_auditor")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                	elseif($type == "appointment_of_manager")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_manager")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                	elseif($type == "appointment_of_ceo")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_ceo")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                	elseif($type == "appointment_of_managing_director")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_managing_director")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                	elseif($type == "appointment_of_alternate_director")
// 						{
// 	                		$data['transaction_date']=$date_of_appointment[0]["date_of_appointment"];
// 	                	}
// 	                	elseif($type == "cessation_of_alternate_director")
// 	                	{
// 	                		$data['transaction_date']=$date_of_cessation[0]["date_of_cessation"];
// 	                	}
// 	                }
// 	                elseif($charge_id != null)
// 	                {

// 	                	if($type == "change_registration_of_charge")
// 						{
// 	                		$data['transaction_date']=$date_of_registration[0]["date_registration"];
// 	                	}
// 	                	elseif($type == "change_satisfaction_of_charge")
// 	                	{
// 	                		$data['transaction_date']=$date_of_satisfaction[0]["date_satisfied"];


// 	                	}
// 	                	//echo json_encode($data['transaction_date']);
// 	                }
// 	                elseif($allotment_id != null)
// 	                {
// 	                	if($type == "add_allotment_of_share")
// 						{
// 	                		$data['transaction_date'] = $allot_transaction_date[0]["transaction_date"];
// 	                	}
// 	                	//echo json_encode($data['transaction_date']);
// 	                }
// 	                elseif($buyback_id != null)
// 	                {
// 	                	if($type == "add_buyback_of_share")
// 						{
// 	                		$data['transaction_date'] = $buyback_transaction_date[0]["transaction_date"];
// 	                	}
// 	                	//echo json_encode($data['transaction_date']);
// 	                }
// 	                elseif($transfer_id != null)
// 	                {
// 	                	if($type == "add_transfer_of_share")
// 						{
// 	                		$data['transaction_date'] = $transfer_transaction_date[0]["transaction_date"];
// 	                	}
// 	                	//echo json_encode($data['transaction_date']);
// 	                }
// 	                else
// 	                {
// 	                	$data['transaction_date']=DATE("d/m/Y",now());
// 	                }


// 	                $data['received_on']="";
// 	                $data['triggered_by']=$result[$r]["triggered_by"];
// 	                $officer_id_data = array($officer_id);
// 	                $charge_id_data = array($charge_id);
// 	                $allotment_id_data = array($allotment_id);
// 	                $buyback_id_data = array($buyback_id);
// 	                $transfer_id_data = $transfer_id;
// 	                $str = $result[$r]["document_content"];
// 					//$substr = '<span class="myclass mceNonEditable">{{Company old name}}</span>';
					
// 					if($result[$r]["document_name"] == "Form 45B")
// 					{
// 						$secretarys_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 						$previous_secretarys_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");

// 						$previous_secretarys_appointment_result = $previous_secretarys_appointment_result->result_array();

// 						$secretarys_appointment_result = $secretarys_appointment_result->result_array();

// 						$loop_document_content = "";
// 						$latest_officer_id = array();
// 						for($e = 0; $e < count($secretarys_appointment_result); $e++)
// 						{	
// 							$document_content_str = $result[$r]["document_content"];

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
// 							}

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>') !== false)
// 			                {
// 			                	$secretarys_name_appointment = "";

			                	
// 			                	$num_of_director_name_appointment = (int)(count($secretarys_appointment_result)) - 1;

// 			                	$secretarys_name_appointment = $secretarys_name_appointment.'<strong>'.$secretarys_appointment_result[$e]["name"].'</strong>';

// 			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>', $secretarys_name_appointment, $document_content_str);
// 			                }

// 			                if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>') !== false)
// 			                {

// 			                	$secretarys_id_appointment = "";

// 			                	$num_of_secretarys_id_appointment = (int)(count($secretarys_appointment_result)) - 1;

// 			                	$secretarys_id_appointment = $secretarys_id_appointment.'<strong>'.$secretarys_appointment_result[$e]["identification_no"].'</strong>';

// 			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>', $secretarys_id_appointment, $document_content_str);

// 			                }

// 			                array_push($latest_officer_id, (int)$secretarys_appointment_result[$e]["id"]);

// 			                $data['officer_id']=json_encode($latest_officer_id);

// 			                $loop_document_content = $loop_document_content.$document_content_str;
// 						}

// 						$officer_id_data = array();

// 						if(count($previous_secretarys_appointment_result) != 0)
// 	                	{
	                		
// 	                		for($f = 0; $f < count($previous_secretarys_appointment_result); $f++)
// 		                	{
// 		                		array_push($officer_id_data, (int)$previous_secretarys_appointment_result[$f]["id"]);
// 		                	}
// 	                	}

// 						$data['content'] = $loop_document_content;
// 					}
// 					elseif($result[$r]["document_name"] == "Form 45")
// 					{
// 						$director_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 						$previous_director_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");

// 						$previous_director_appointment_result = $previous_director_appointment_result->result_array();

// 						$director_appointment_result = $director_appointment_result->result_array();

// 						$loop_document_content = "";
// 						$latest_officer_id = array();
// 						for($e = 0; $e < count($director_appointment_result); $e++)
// 						{	
// 							$document_content_str = $result[$r]["document_content"];

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
// 							}

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>') !== false)
// 			                {
// 			                	$directors_name_appointment = "";
			                	
// 			                	$num_of_director_name_appointment = (int)(count($director_appointment_result)) - 1;

// 			                	$directors_name_appointment = $directors_name_appointment.'<strong>'.$director_appointment_result[$e]["name"].'</strong>';

// 			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>', $directors_name_appointment, $document_content_str);

// 			                	//echo json_encode($directors_name_appointment);
// 			                }

// 			                if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>') !== false)
// 			                {

// 			                	$directors_id_appointment = "";

// 			                	$num_of_secretarys_id_appointment = (int)(count($director_appointment_result)) - 1;

// 			                	$directors_id_appointment = $directors_id_appointment.'<strong>'.$director_appointment_result[$e]["identification_no"].'</strong>';

// 			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>', $directors_id_appointment, $document_content_str);

// 			                }

// 			                array_push($latest_officer_id, (int)$director_appointment_result[$e]["id"]);

// 			                $data['officer_id']=json_encode($latest_officer_id);

// 			                $loop_document_content = $loop_document_content.$document_content_str;
// 						}

// 						$officer_id_data = array();

// 						if(count($previous_director_appointment_result) != 0)
// 	                	{
	                		
// 	                		for($f = 0; $f < count($previous_director_appointment_result); $f++)
// 		                	{
// 		                		array_push($officer_id_data, (int)$previous_director_appointment_result[$f]["id"]);
// 		                	}
// 	                	}

// 						$data['content'] = $loop_document_content;
// 					}
// 					elseif($result[$r]["document_name"] == "Declaration-Strike Off")
// 					{
// 						$director_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 						$director_result = $director_result->result_array();

// 						$loop_document_content = "";

// 						for($e = 0; $e < count($director_result); $e++)
// 						{
// 							$document_content_str = $result[$r]["document_content"];

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
// 							}

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $document_content_str);
// 							}

// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
// 			                {
// 								$director_name = $director_result[$e]["name"];

// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $document_content_str);
// 			                }

// 			                if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors ID - all}}</span>') !== false)
// 			                {
// 								$director_id = $director_result[$e]["identification_no"];

// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - all}}</span>', $director_id, $document_content_str);
// 			                }

// 			                $loop_document_content = $loop_document_content.$document_content_str;
// 						}

// 						//echo json_encode($director_result);
// 						$data['content'] = $loop_document_content;
						
// 					}
// 					elseif($result[$r]["document_name"] == "Allotment-Share Application Form" || $result[$r]["document_name"] == "F24 - Return of allotment of shares" || $result[$r]["document_name"] == "Allotment-Share Cert")
// 					{
// 						$allotment_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

	                
// 	                	$this->db->select('member_shares.*')
// 	                	         ->order_by('member_shares.id');
// 						$this->db->where("company_code", $company_code);
// 						$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
// 						$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
// 						$this->db->where("member_shares.transaction_type = 'Allotment'");
// 						$this->db->where_not_in('id', $allotment_id);

// 						$previous_allotment_member_result = $this->db->get('member_shares');

// 						$allotment_member_result = $allotment_member_result->result_array();

// 	                	$previous_allotment_member_result = $previous_allotment_member_result->result_array();

// 	                	$loop_document_content = "";
// 	                	$latest_allotment_id = array();
// 						for($g = 0; $g < count($allotment_member_result); $g++)
// 		                {
// 		                	$document_content_str = $result[$r]["document_content"];

// 		                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
// 		                	{
// 		                		if($allotment_member_result[$g]["name"] != '')
// 	                			{
// 	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["name"], $document_content_str);
	                				
// 	                			}
// 	                			elseif($allotment_member_result[$g]["company_name"] != '')
// 	                			{
// 	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["company_name"], $document_content_str);
// 	                			}
// 	                		}

// 	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
// 	                		{
// 	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($allotment_member_result[$g]["number_of_share"], 2), $document_content_str);
// 	                		}

// 	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
// 	                		{
// 	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', number_format($allotment_member_result[$g]["amount_share"], 2), $document_content_str);
// 	                		}

// 	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>') !== false)
// 	                		{
// 	                			$per_shared = $allotment_member_result[$g]["amount_share"] / $allotment_member_result[$g]["number_of_share"];

// 	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>', number_format($per_shared, 2), $document_content_str);
// 	                		}


// 	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
// 	                		{
// 	                			if($allotment_member_result[$g]["sharetype_id"] == '1')
// 	                			{
// 	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["sharetype_name"], $document_content_str);

// 	                			}
// 	                			elseif($allotment_member_result[$g]["sharetype_id"] == '2')
// 	                			{
// 	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["other_class"], $document_content_str);
// 	                			}
// 	                		}

// 	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
// 	                		{
// 	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', $allotment_member_result[$g]["currency_name"], $document_content_str);
// 	                		}

// 	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
// 	                		{
// 	                			if($allotment_member_result[$g]["new_certificate_no"] != '')
// 	                			{
// 	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["new_certificate_no"], $document_content_str);
// 	                			}
// 	                			else
// 	                			{
// 	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["certificate_no"], $document_content_str);
// 	                			}
	                			
// 	                		}

// 		                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company type}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company type}}</span>', $get_client[0]["company_type_name"], $document_content_str);
// 							}
// 		                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
// 							}
// 							if(strpos($str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
// 							{
// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $document_content_str);
// 							}
// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Address - new}}</span>') !== false)
// 							{
// 								if($get_client[0]["unit_no1"] != null || $get_client[0]["unit_no2"] != null)
// 								{
// 									$unit_no = '#'.$get_client[0]["unit_no1"].'-'.$get_client[0]["unit_no2"].'';
// 								}
// 								else
// 								{
// 									$unit_no = '';
// 								}

// 								$new_address = $get_client[0]["street_name"].',</br>'.$unit_no.' '.$get_client[0]["building_name"].', </br>Singapore '.$get_client[0]["postal_code"];

// 								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Address - new}}</span>', $new_address, $document_content_str);
// 							}
// 							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
// 			                {
// 			                	$director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
			                	
// 			                	$director_name_result = $director_name_result->result_array();

// 			                	//echo json_encode($director_name_result);
// 			                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 
			                	

// 			                	if( $result[$r]["document_name"] == "Auditor-Notice of EGM" || $result[$r]["document_name"] == "Company Name-Notice of EGM" || $result[$r]["document_name"] == "Manager-Notice of EGM" || $result[$r]["document_name"] == "Allotment-Authority to Allot")
// 			                	{
// 			                		$director_name = '';

// 			                		$director_name = $director_name.'<p>&nbsp;</p><p>&nbsp;</p><p>_______________________________<br />'.$director_name_result[0]["name"].'<br />Director</p>';

// 			                	}
// 			                	elseif($result[$r]["document_name"] == "Form 11" || $result[$r]["document_name"] == "Strike Off EGM")
// 			                	{

// 			                		$director_name = $director_name_result[0]["name"];

// 			                	}
// 			                	elseif($result[$r]["document_name"] == "Strike Off-Minutes Of EGM")
// 			                	{
// 			                		$director_name = '';
// 			                		for($h = 0; $h < count($director_name_result); $h++)
// 				                	{	
// 				                		if($h == 0)
// 				                		{
// 				                			$director_name = $director_name.'<p><strong>'.$director_name_result[$h]["name"].'<br /></strong>';
// 				                		}
// 				                		elseif($h == (count($director_name_result) - 1))
// 				                		{
// 				                			$director_name = $director_name.'<strong>'.$director_name_result[$h]["name"].'<br /></strong></p>';
// 				                		}
// 				                		else
// 				                		{
// 				                			$director_name = $director_name.'<strong>'.$director_name_result[$h]["name"].'<br /></strong>';
// 				                		}
			                			
// 			                		}
// 			                	}
// 			                	else
// 			                	{
// 			                		$director_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';
// 			                		for($j = 0; $j < count($director_name_result); $j++)
// 				                	{
// 				                		$director_name = $director_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$director_name_result[$j]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
// 				                	}
// 				                	$director_name = $director_name.'</tbody></table>';
// 			                	}
			                	


// 			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $document_content_str);
// 			                }

// 			                if($client_member_share_capital_id != null)
// 			                {
// 			                	$client_member_share_capital_id_info = $this->db->query("select client_member_share_capital.*, member_shares.company_code, sum(member_shares.number_of_share) as number_of_shares, sum(member_shares.amount_share) as amount, sum(member_shares.no_of_share_paid) as number_of_shares_paid, sum(member_shares.amount_paid) as paid_up, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from client_member_share_capital left join member_shares on member_shares.client_member_share_capital_id = client_member_share_capital.id AND member_shares.company_code = client_member_share_capital.company_code left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where client_member_share_capital.company_code = '".$company_code."' group by client_member_share_capital.id");

// 			                	$client_member_share_capital_id_info = $client_member_share_capital_id_info->result_array();

// 			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Class of shares - all}}</span>') !== false)
// 			                	{
// 		                			if($client_member_share_capital_id_info[0]["sharetype_id"] == '1')
// 		                			{
// 		                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["sharetype_name"], $document_content_str);

// 		                			}
// 		                			elseif($client_member_share_capital_id_info[$g]["sharetype_id"] == '2')
// 		                			{
// 		                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["other_class"], $document_content_str);
// 		                			}
// 			                	}

// 			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>') !== false)
// 			                	{
// 			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>', $client_member_share_capital_id_info[0]["currency_name"], $document_content_str);
// 			                	}

// 			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>') !== false)
// 			                	{
// 			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares"], 2), $document_content_str);
// 			                	}

// 			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>') !== false)
// 			                	{
// 			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["amount"], 2), $document_content_str);
// 			                	}

// 			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>') !== false)
// 			                	{
// 			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares_paid"], 2), $document_content_str);
// 			                	}

// 			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>') !== false)
// 			                	{
// 			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["paid_up"], 2), $document_content_str);
// 			                	}
// 			                }
		                	

// 		                	$loop_document_content = $loop_document_content.$document_content_str;
// 		                }
// 						for($h = 0; $h < count($allotment_member_result); $h++)
// 		                {
// 		                	array_push($latest_allotment_id, (int)$allotment_member_result[$h]["id"]);
// 		                }

// 	                	$data['allotment_id']=json_encode($latest_allotment_id);

// 						if(count($previous_allotment_member_result) != 0)
// 	                	{
// 	                		$allotment_id_data = array();
// 	                		for($f = 0; $f < count($previous_allotment_member_result); $f++)
// 		                	{
// 		                		array_push($allotment_id_data, (int)$previous_allotment_member_result[$f]["id"]);
// 		                	}
// 	                	}
// 	                	$data['content'] = $loop_document_content;
// 					}
// 					elseif($result[$r]["document_name"] == "Transfer Form" || $result[$r]["document_name"] == "Transferee-Share Cert")
// 					{
// 						$transfer_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Transfer' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

		                
// 		                	$this->db->select('member_shares.*')
// 		                	         ->order_by('member_shares.id');
// 							$this->db->where("company_code", $company_code);
// 							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
// 							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
// 							$this->db->where("member_shares.transaction_type = 'Transfer'");
// 							$this->db->where_in('id', $transfer_id);
// 							$previous_transfer_member_result = $this->db->get('member_shares');

// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$transfer_member_result = $transfer_member_result->result_array();

// 		                	$previous_transfer_member_result = $previous_transfer_member_result->result_array();
// 					}
// 					else
// 					{
// 						$history_client_info = $this->db->query("select * from history_client where company_code = '".$get_client[0]["company_code"]."'");

// 						$history_client_info = $history_client_info->result_array();

// 						if (strpos($str, '<span class="myclass mceNonEditable">{{Company old name}}</span>') !== false) {
// 						    $str = str_replace('<span class="myclass mceNonEditable">{{Company old name}}</span>', $history_client_info[0]["company_name"], $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Company new name}}</span>') !== false)
// 						{
// 							$str = str_replace('<span class="myclass mceNonEditable">{{Company new name}}</span>', $get_client[0]["company_name"], $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
// 						{
// 							$str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
// 						{
// 							$str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Incorporation date}}</span>') !== false)
// 						{
// 							$str = str_replace('<span class="myclass mceNonEditable">{{Incorporation date}}</span>', $get_client[0]["incorporation_date"], $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Company type}}</span>') !== false)
// 						{
// 							$str = str_replace('<span class="myclass mceNonEditable">{{Company type}}</span>', $get_client[0]["company_type_name"], $str);
// 						}
// 						if($result[$r]["triggered_by"] == 5)
// 						{
// 							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - old}}</span>') !== false)
// 							{
// 								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - old}}</span>', $history_client_info[0]["activity1"], $str);
// 							}

// 							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - new}}</span>') !== false)
// 							{
// 								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - new}}</span>', $get_client[0]["activity1"], $str);
// 							}
// 						}

// 						if($result[$r]["triggered_by"] == 6)
// 						{
// 							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - old}}</span>') !== false)
// 							{
// 								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - old}}</span>', $history_client_info[0]["activity2"], $str);
// 							}

// 							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - new}}</span>') !== false)
// 							{
// 								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - new}}</span>', $get_client[0]["activity2"], $str);
// 							}
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Address - old}}</span>') !== false)
// 						{
// 							if($history_client_info[0]["unit_no1"] != null || $history_client_info[0]["unit_no2"] != null)
// 							{
// 								$unit_no = '#'.$history_client_info[0]["unit_no1"].'-'.$history_client_info[0]["unit_no2"].'';
// 							}
// 							else
// 							{
// 								$unit_no = '';
// 							}

// 							$history_address = $history_client_info[0]["street_name"].', '.$unit_no.' '.$history_client_info[0]["building_name"].', Singapore '.$history_client_info[0]["postal_code"];

// 							$str = str_replace('<span class="myclass mceNonEditable">{{Address - old}}</span>', $history_address, $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Address - new}}</span>') !== false)
// 						{
// 							if($get_client[0]["unit_no1"] != null || $get_client[0]["unit_no2"] != null)
// 							{
// 								$unit_no = '#'.$get_client[0]["unit_no1"].'-'.$get_client[0]["unit_no2"].'';
// 							}
// 							else
// 							{
// 								$unit_no = '';
// 							}

// 							$new_address = $get_client[0]["street_name"].', '.$unit_no.' '.$get_client[0]["building_name"].', Singapore '.$get_client[0]["postal_code"];

// 							$str = str_replace('<span class="myclass mceNonEditable">{{Address - new}}</span>', $new_address, $str);
// 						}
// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
// 		                {
// 		                	$director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
// 		                	$director_name_result = $director_name_result->result_array();

// 		                	//echo json_encode($director_name_result);
// 		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 
		                	

// 		                	if( $result[$r]["document_name"] == "Auditor-Notice of EGM" || $result[$r]["document_name"] ==  "Manager-Notice of EGM" || $result[$r]["document_name"] ==  "CEO-Notice of EGM" || $result[$r]["document_name"] ==  "Charge-Notice of EGM" || $result[$r]["document_name"] == "Company Name-Notice of EGM" || $result[$r]["document_name"] == "Allotment-Authority to Allot")
// 		                	{
// 		                		$director_name = '';

// 		                		$director_name = $director_name.'<p>&nbsp;</p><p>&nbsp;</p><p>_______________________________<br />'.$director_name_result[0]["name"].'<br />Director</p>';

// 		                	}
// 		                	elseif($result[$r]["document_name"] == "Form 11" || $result[$r]["document_name"] == "Strike Off EGM")
// 		                	{

// 		                		$director_name = $director_name_result[0]["name"];

// 		                	}
// 		                	elseif($result[$r]["document_name"] == "Strike Off-Minutes Of EGM")
// 		                	{
// 		                		$director_name = '';
// 		                		for($g = 0; $g < count($director_name_result); $g++)
// 			                	{	
// 			                		if($g == 0)
// 			                		{
// 			                			$director_name = $director_name.'<p><strong>'.$director_name_result[$g]["name"].'<br /></strong>';
// 			                		}
// 			                		elseif($g == (count($director_name_result) - 1))
// 			                		{
// 			                			$director_name = $director_name.'<strong>'.$director_name_result[$g]["name"].'<br /></strong></p>';
// 			                		}
// 			                		else
// 			                		{
// 			                			$director_name = $director_name.'<strong>'.$director_name_result[$g]["name"].'<br /></strong>';
// 			                		}
		                			
// 		                		}
// 		                	}
// 		                	else
// 		                	{
// 		                		$director_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';
// 		                		for($g = 0; $g < count($director_name_result); $g++)
// 			                	{
// 			                		$director_name = $director_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$director_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
// 			                	}
// 			                	$director_name = $director_name.'</tbody></table>';
// 		                	}
		                	


// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - all}}</span>') !== false)
// 		                {
// 		                	$director_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$director_id_result = $director_id_result->result_array();

// 		                	$director_id = "";

// 		                	for($g = 0; $g < count($director_id_result); $g++)
// 		                	{
// 		                		$director_id = $director_id.'<p>&nbsp;</p>'.$director_id_result[$g]["identification_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - all}}</span>', $director_id, $str);
// 		                }
		                
// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - resigning}}</span>') !== false)
// 		                {

// 		                	$director_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_director_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$director_name_resign_result = $director_name_resign_result->result_array();

// 		                	$previous_director_name_resign_result = $previous_director_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$director_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_name_resign = (int)(count($director_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($director_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$director_name_resign = $director_name_resign.'<strong>'.$director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_director_name_resign)
// 		                		{
// 		                			$director_name_resign = $director_name_resign.' and <strong>'.$director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$director_name_resign = $director_name_resign.', <strong>'.$director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$director_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - resigning}}</span>', $director_name_resign, $str);

// 		                	if(count($previous_director_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_director_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_director_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - resigning}}</span>') !== false)
// 		                {
// 		                	$director_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_director_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$director_id_resign_result = $director_id_resign_result->result_array();

// 		                	$previous_director_id_resign_result = $previous_director_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$director_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_id_resign = (int)(count($director_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($director_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$director_id_resign = $director_id_resign.'<strong>'.$director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_director_id_resign)
// 		                		{
// 		                			$director_id_resign = $director_id_resign.' and <strong>'.$director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$director_id_resign = $director_id_resign.', <strong>'.$director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$director_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - resigning}}</span>', $director_id_resign, $str);

// 		                	if(count($previous_director_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_director_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_director_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors - cessation date}}</span>') !== false)
// 		                {
// 		                	$director_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_director_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$director_cessation_resign_result = $director_cessation_resign_result->result_array();

// 		                	$previous_director_cessation_resign_result = $previous_director_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$director_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_cessation_resign = (int)(count($director_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($director_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$director_cessation_resign = $director_cessation_resign.'<strong>'.$director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_director_cessation_resign)
// 		                		{
// 		                			$director_cessation_resign = $director_cessation_resign.' and <strong>'.$director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$director_cessation_resign = $director_cessation_resign.', <strong>'.$director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$director_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors - cessation date}}</span>', $director_cessation_resign, $str);

// 		                	if(count($previous_director_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_director_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_director_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

		                

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>') !== false)
// 		                {
// 		                	$director_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_director_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$director_name_appointment_result = $director_name_appointment_result->result_array();

// 		                	$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
// 		                	//echo json_encode($director_name_appointment_result);

// 		                	$director_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_name_appointment = (int)(count($director_name_appointment_result)) - 1;


// 		                	for($g = 0; $g < count($director_name_appointment_result); $g++)
// 		                	{
// 		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>)') !== false)
// 		                		{
// 		                			if($g == 0)
// 			                		{
// 			                			$director_name_appointment = $director_name_appointment.$director_name_appointment_result[$g]["name"].' (Identification No. '.$director_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		elseif($g == (int)$num_of_director_name_appointment)
// 			                		{
// 			                			$director_name_appointment = $director_name_appointment.' and '.$director_name_appointment_result[$g]["name"].' (Identification No. '.$director_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		else
// 			                		{
// 			                			$director_name_appointment = $director_name_appointment.', '.$director_name_appointment_result[$g]["name"].' (Identification No. '.$director_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 		                		}
// 		                		else
// 		                		{
// 			                		if($g == 0)
// 			                		{
// 			                			$director_name_appointment = $director_name_appointment.'<strong>'.$director_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                		elseif($g == (int)$num_of_director_name_appointment)
// 			                		{
// 			                			$director_name_appointment = $director_name_appointment.' and <strong>'.$director_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                		else
// 			                		{
// 			                			$director_name_appointment = $director_name_appointment.', <strong>'.$director_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                	}
		                		
// 		                		array_push($latest_officer_id, (int)$director_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - appointment}}</span> (Identification No. <span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>)', $director_name_appointment, $str);
// 		                	}
// 		                	else
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>', $director_name_appointment, $str);
// 		                	}

// 		                	if(count($previous_director_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_director_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_director_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>') !== false)
// 		                {
// 		                	$director_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_director_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$director_id_appointment_result = $director_id_appointment_result->result_array();

// 		                	$previous_director_id_appointment_result = $previous_director_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$director_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_id_appointment = (int)(count($director_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($director_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$director_id_appointment = $director_id_appointment.'<strong>'.$director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_director_id_appointment)
// 		                		{
// 		                			$director_id_appointment = $director_id_appointment.' and <strong>'.$director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$director_id_appointment = $director_id_appointment.', <strong>'.$director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$director_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>', $director_id_appointment, $str);

// 		                	if(count($previous_director_id_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_director_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_director_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors - appointment date}}</span>') !== false)
// 		                {
// 		                	$director_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_director_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$director_appointment_date_result = $director_appointment_date_result->result_array();

// 		                	$previous_director_appointment_date_result = $previous_director_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$director_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_appointment_date = (int)(count($director_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($director_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$director_appointment_date = $director_appointment_date.'<strong>'.$director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_director_appointment_date)
// 		                		{
// 		                			$director_appointment_date = $director_appointment_date.' and <strong>'.$director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$director_appointment_date = $director_appointment_date.', <strong>'.$director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$director_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors - appointment date}}</span>', $director_appointment_date, $str);

// 		                	if(count($previous_director_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_director_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_director_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys name - all}}</span>') !== false)
// 		                {
// 		                	$secretarys_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$secretarys_name_result = $secretarys_name_result->result_array();

// 		                	//echo json_encode($director_name_result);


// 		                	$secretarys_name = "";

// 		                	for($g = 0; $g < count($secretarys_name_result); $g++)
// 		                	{
// 		                		$secretarys_name = $secretarys_name.'<p>&nbsp;</p>'.$secretarys_name_result[$g]["name"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - all}}</span>', $secretarys_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - all}}</span>') !== false)
// 		                {
// 		                	$secretarys_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$secretarys_id_result = $secretarys_id_result->result_array();

// 		                	$secretarys_id = "";

// 		                	for($g = 0; $g < count($secretarys_id_result); $g++)
// 		                	{
// 		                		$secretarys_id = $secretarys_id.'<p>&nbsp;</p>'.$secretarys_id_result[$g]["identification_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - all}}</span>', $secretarys_id, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys name - resigning}}</span>') !== false)
// 		                {

// 		                	$secretarys_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_secretarys_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$secretarys_name_resign_result = $secretarys_name_resign_result->result_array();

// 		                	$previous_secretarys_name_resign_result = $previous_secretarys_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$secretarys_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_secretarys_name_resign = (int)(count($secretarys_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($secretarys_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$secretarys_name_resign = $secretarys_name_resign.'<strong>'.$secretarys_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_secretarys_name_resign)
// 		                		{
// 		                			$secretarys_name_resign = $secretarys_name_resign.' and <strong>'.$secretarys_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$secretarys_name_resign = $secretarys_name_resign.', <strong>'.$secretarys_name_resign_result[$g]["name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$secretarys_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - resigning}}</span>', $secretarys_name_resign, $str);

// 		                	if(count($previous_secretarys_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_secretarys_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_secretarys_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - resigning}}</span>') !== false)
// 		                {
// 		                	$secretarys_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_secretarys_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$secretarys_id_resign_result = $secretarys_id_resign_result->result_array();

// 		                	$previous_secretarys_id_resign_result = $previous_secretarys_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$secretarys_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_secretarys_id_resign = (int)(count($secretarys_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($secretarys_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$secretarys_id_resign = $secretarys_id_resign.'<strong>'.$secretarys_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_secretarys_id_resign)
// 		                		{
// 		                			$secretarys_id_resign = $secretarys_id_resign.' and <strong>'.$secretarys_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$secretarys_id_resign = $secretarys_id_resign.', <strong>'.$secretarys_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$secretarys_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - resigning}}</span>', $secretarys_id_resign, $str);

// 		                	if(count($previous_secretarys_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_secretarys_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_secretarys_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys - cessation date}}</span>') !== false)
// 		                {
// 		                	$secretarys_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_secretarys_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$secretarys_cessation_resign_result = $secretarys_cessation_resign_result->result_array();

// 		                	$previous_secretarys_cessation_resign_result = $previous_secretarys_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$secretarys_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_secretarys_cessation_resign = (int)(count($secretarys_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($secretarys_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$secretarys_cessation_resign = $secretarys_cessation_resign.'<strong>'.$secretarys_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_secretarys_cessation_resign)
// 		                		{
// 		                			$secretarys_cessation_resign = $secretarys_cessation_resign.' and <strong>'.$secretarys_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$secretarys_cessation_resign = $secretarys_cessation_resign.', <strong>'.$secretarys_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$secretarys_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys - cessation date}}</span>', $secretarys_cessation_resign, $str);

// 		                	if(count($previous_secretarys_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_secretarys_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_secretarys_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }
// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>') !== false)
// 		                {
// 		                	$secretarys_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_secretarys_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$secretarys_name_appointment_result = $secretarys_name_appointment_result->result_array();

// 		                	$previous_secretarys_name_appointment_result = $previous_secretarys_name_appointment_result->result_array();
// 		                	//echo json_encode($director_name_appointment_result);

// 		                	$secretarys_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_director_name_appointment = (int)(count($secretarys_name_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($secretarys_name_appointment_result); $g++)
// 		                	{

// 		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>)') !== false)
// 		                		{
// 		                			if($g == 0)
// 			                		{
// 			                			$secretarys_name_appointment = $secretarys_name_appointment.$secretarys_name_appointment_result[$g]["name"].' (Identification No. '.$secretarys_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		elseif($g == (int)$num_of_director_name_appointment)
// 			                		{
// 			                			$secretarys_name_appointment = $secretarys_name_appointment.' and '.$secretarys_name_appointment_result[$g]["name"].' (Identification No. '.$secretarys_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		else
// 			                		{
// 			                			$secretarys_name_appointment = $secretarys_name_appointment.', '.$secretarys_name_appointment_result[$g]["name"].' (Identification No. '.$secretarys_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 		                		}
// 		                		else
// 		                		{
// 			                		if($g == 0)
// 			                		{
// 			                			$secretarys_name_appointment = $secretarys_name_appointment.'<strong>'.$secretarys_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                		elseif($g == (int)$num_of_director_name_appointment)
// 			                		{
// 			                			$secretarys_name_appointment = $secretarys_name_appointment.' and <strong>'.$secretarys_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                		else
// 			                		{
// 			                			$secretarys_name_appointment = $secretarys_name_appointment.', <strong>'.$secretarys_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                	}
		                		
// 		                		array_push($latest_officer_id, (int)$secretarys_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span> (Identification No. <span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>)', $secretarys_name_appointment, $str);
// 		                	}
// 		                	else
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>', $secretarys_name_appointment, $str);
// 		                	}

// 		                	$officer_id_data = array();
// 		                	if(count($previous_secretarys_name_appointment_result) != 0)
// 		                	{
		                		
// 		                		for($f = 0; $f < count($previous_secretarys_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_secretarys_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>') !== false)
// 		                {
// 		                	$secretarys_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_secretarys_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$secretarys_id_appointment_result = $secretarys_id_appointment_result->result_array();

// 		                	$previous_secretarys_id_appointment_result = $previous_secretarys_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$secretarys_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_secretarys_id_appointment = (int)(count($secretarys_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($secretarys_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$secretarys_id_appointment = $secretarys_id_appointment.'<strong>'.$secretarys_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_secretarys_id_appointment)
// 		                		{
// 		                			$secretarys_id_appointment = $secretarys_id_appointment.' and <strong>'.$secretarys_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$secretarys_id_appointment = $secretarys_id_appointment.', <strong>'.$secretarys_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$secretarys_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>', $secretarys_id_appointment, $str);

// 		                	$officer_id_data = array();
// 		                	if(count($previous_secretarys_id_appointment_result) != 0)
// 		                	{
// 		                		for($f = 0; $f < count($previous_secretarys_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_secretarys_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys - appointment date}}</span>') !== false)
// 		                {
// 		                	$secretarys_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$secretarys_director_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$secretarys_appointment_date_result = $secretarys_appointment_date_result->result_array();

// 		                	$secretarys_director_appointment_date_result = $secretarys_director_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$secretarys_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_secretarys_appointment_date = (int)(count($secretarys_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($secretarys_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$secretarys_appointment_date = $secretarys_appointment_date.'<strong>'.$secretarys_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_secretarys_appointment_date)
// 		                		{
// 		                			$secretarys_appointment_date = $secretarys_appointment_date.' and <strong>'.$secretarys_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$secretarys_appointment_date = $secretarys_appointment_date.', <strong>'.$secretarys_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$secretarys_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys - appointment date}}</span>', $secretarys_appointment_date, $str);

// 		                	if(count($secretarys_director_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($secretarys_director_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$secretarys_director_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }
// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors name - all}}</span>') !== false)
// 		                {
// 		                	$auditors_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer_company.register_no, officer_company.company_name");

// 		                	$auditors_name_result = $auditors_name_result->result_array();

// 		                	//echo json_encode($director_name_result);

// 		                	$auditors_name = "";

// 		                	for($g = 0; $g < count($auditors_name_result); $g++)
// 		                	{
// 		                		$auditors_name = $auditors_name.'<p>&nbsp;</p>'.$auditors_name_result[$g]["company_name"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors name - all}}</span>', $auditors_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors ID - all}}</span>') !== false)
// 		                {
// 		                	$auditors_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer_company.register_no, officer_company.company_name");

// 		                	$auditors_id_result = $auditors_id_result->result_array();

// 		                	$auditors_id = "";

// 		                	for($g = 0; $g < count($auditors_id_result); $g++)
// 		                	{
// 		                		$auditors_id = $auditors_id.'<p>&nbsp;</p>'.$auditors_id_result[$g]["register_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors ID - all}}</span>', $auditors_id, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors name - resigning}}</span>') !== false)
// 		                {

// 		                	$auditors_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$previous_auditors_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$auditors_name_resign_result = $auditors_name_resign_result->result_array();

// 		                	$previous_auditors_name_resign_result = $previous_auditors_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$auditors_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_auditors_name_resign = (int)(count($auditors_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($auditors_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$auditors_name_resign = $auditors_name_resign.'<strong>'.$auditors_name_resign_result[$g]["company_name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_auditors_name_resign)
// 		                		{
// 		                			$auditors_name_resign = $auditors_name_resign.' and <strong>'.$auditors_name_resign_result[$g]["company_name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$auditors_name_resign = $auditors_name_resign.', <strong>'.$auditors_name_resign_result[$g]["company_name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$auditors_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors name - resigning}}</span>', $auditors_name_resign, $str);

// 		                	if(count($previous_auditors_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_auditors_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_auditors_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors ID - resigning}}</span>') !== false)
// 		                {
// 		                	$auditors_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$previous_auditors_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$auditors_id_resign_result = $auditors_id_resign_result->result_array();

// 		                	$previous_auditors_id_resign_result = $previous_auditors_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$auditors_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_auditors_id_resign = (int)(count($auditors_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($auditors_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$auditors_id_resign = $auditors_id_resign.'<strong>'.$auditors_id_resign_result[$g]["register_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_auditors_id_resign)
// 		                		{
// 		                			$auditors_id_resign = $auditors_id_resign.' and <strong>'.$auditors_id_resign_result[$g]["register_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$auditors_id_resign = $auditors_id_resign.', <strong>'.$auditors_id_resign_result[$g]["register_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$auditors_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors ID - resigning}}</span>', $auditors_id_resign, $str);

// 		                	if(count($previous_auditors_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_auditors_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_auditors_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors - cessation date}}</span>') !== false)
// 		                {
// 		                	$auditors_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$previous_auditors_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$auditors_cessation_resign_result = $auditors_cessation_resign_result->result_array();

// 		                	$previous_auditors_cessation_resign_result = $previous_auditors_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$auditors_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_auditors_cessation_resign = (int)(count($auditors_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($auditors_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$auditors_cessation_resign = $auditors_cessation_resign.'<strong>'.$auditors_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_auditors_cessation_resign)
// 		                		{
// 		                			$auditors_cessation_resign = $auditors_cessation_resign.' and <strong>'.$auditors_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$auditors_cessation_resign = $auditors_cessation_resign.', <strong>'.$auditors_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$auditors_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors - cessation date}}</span>', $auditors_cessation_resign, $str);

// 		                	if(count($previous_auditors_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_auditors_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_auditors_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if($result[$r]["document_name"] == "Auditor-Shorter notice of EGM" || $result[$r]["document_name"] == "Auditor-Attendance List")
// 		                {
// 		                	$auditors_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$previous_auditors_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");

// 		                	$auditors_name_appointment_result = $auditors_name_appointment_result->result_array();

// 		                	$previous_auditors_name_appointment_result = $previous_auditors_name_appointment_result->result_array();

// 		                	$latest_officer_id = array();

// 		                	for($g = 0; $g < count($auditors_name_appointment_result); $g++)
// 		                	{
// 		                		array_push($latest_officer_id, (int)$auditors_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(count($previous_auditors_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_auditors_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_auditors_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors name - appointment}}</span>') !== false)
// 		                {
// 		                	$auditors_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$previous_auditors_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$auditors_name_appointment_result = $auditors_name_appointment_result->result_array();

// 		                	$previous_auditors_name_appointment_result = $previous_auditors_name_appointment_result->result_array();
// 		                	//echo json_encode($auditors_name_appointment_result);

// 		                	$auditors_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_auditors_name_appointment = (int)(count($auditors_name_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($auditors_name_appointment_result); $g++)
// 		                	{
// 		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>)') !== false)
// 		                		{
// 		                			if($g == 0)
// 			                		{
// 			                			$auditors_name_appointment = $auditors_name_appointment.$auditors_name_appointment_result[$g]["company_name"].' (Identification No. '.$auditors_name_appointment_result[$g]["register_no"].')';
// 			                		}
// 			                		elseif($g == (int)$num_of_auditors_name_appointment)
// 			                		{
// 			                			$auditors_name_appointment = $auditors_name_appointment.' and '.$auditors_name_appointment_result[$g]["company_name"].' (Identification No. '.$auditors_name_appointment_result[$g]["register_no"].')';
// 			                		}
// 			                		else
// 			                		{
// 			                			$auditors_name_appointment = $auditors_name_appointment.', '.$auditors_name_appointment_result[$g]["company_name"].' (Identification No. '.$auditors_name_appointment_result[$g]["register_no"].')';
// 			                		}
// 		                		}
// 		                		else
// 		                		{
// 			                		if($g == 0)
// 			                		{
// 			                			$auditors_name_appointment = $auditors_name_appointment.'<strong>'.$auditors_name_appointment_result[$g]["company_name"].'</strong>';
// 			                		}
// 			                		elseif($g == (int)$num_of_auditors_name_appointment)
// 			                		{
// 			                			$auditors_name_appointment = $auditors_name_appointment.' and <strong>'.$auditors_name_appointment_result[$g]["company_name"].'</strong>';
// 			                		}
// 			                		else
// 			                		{
// 			                			$auditors_name_appointment = $auditors_name_appointment.', <strong>'.$auditors_name_appointment_result[$g]["company_name"].'</strong>';
// 			                		}
// 			                	}
		                		
// 		                		array_push($latest_officer_id, (int)$auditors_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Auditors name - appointment}}</span> (Identification No. <span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>)', $auditors_name_appointment, $str);
// 		                	}
// 		                	else
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Auditors name - appointment}}</span>', $auditors_name_appointment, $str);
// 		                	}

// 		                	if(count($previous_auditors_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_auditors_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_auditors_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>') !== false)
// 		                {
// 		                	$auditors_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$previous_auditors_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$auditors_id_appointment_result = $auditors_id_appointment_result->result_array();

// 		                	$previous_auditors_id_appointment_result = $previous_auditors_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$auditors_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_auditors_id_appointment = (int)(count($auditors_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($auditors_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$auditors_id_appointment = $auditors_id_appointment.'<strong>'.$auditors_id_appointment_result[$g]["register_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_auditors_id_appointment)
// 		                		{
// 		                			$auditors_id_appointment = $auditors_id_appointment.' and <strong>'.$auditors_id_appointment_result[$g]["register_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$auditors_id_appointment = $auditors_id_appointment.', <strong>'.$auditors_id_appointment_result[$g]["register_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$auditors_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>', $auditors_id_appointment, $str);

// 		                	if(count($previous_auditors_id_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_auditors_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_auditors_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors - appointment date}}</span>') !== false)
// 		                {
// 		                	$auditors_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

// 		                	$auditors_director_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$auditors_appointment_date_result = $auditors_appointment_date_result->result_array();

// 		                	$auditors_director_appointment_date_result = $auditors_director_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$auditors_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_auditors_appointment_date = (int)(count($auditors_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($auditors_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$auditors_appointment_date = $auditors_appointment_date.'<strong>'.$auditors_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_auditors_appointment_date)
// 		                		{
// 		                			$auditors_appointment_date = $auditors_appointment_date.' and <strong>'.$auditors_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$auditors_appointment_date = $auditors_appointment_date.', <strong>'.$auditors_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$auditors_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors - appointment date}}</span>', $auditors_appointment_date, $str);

// 		                	if(count($auditors_director_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($auditors_director_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$auditors_director_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers name - all}}</span>') !== false)
// 		                {
// 		                	$manager_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
// 		                	$manager_name_result = $manager_name_result->result_array();

// 		                	//echo json_encode($director_name_result);
// 		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

// 		                	$manager_name = "";

// 		                	for($g = 0; $g < count($manager_name_result); $g++)
// 		                	{
// 		                		$manager_name = $manager_name.'<p>&nbsp;</p>'.$manager_name_result[$g]["name"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers name - all}}</span>', $manager_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers ID - all}}</span>') !== false)
// 		                {
// 		                	$manager_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$manager_id_result = $manager_id_result->result_array();

// 		                	$manager_id = "";

// 		                	for($g = 0; $g < count($manager_id_result); $g++)
// 		                	{
// 		                		$manager_id = $manager_id.'<p>&nbsp;</p>'.$manager_id_result[$g]["identification_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers ID - all}}</span>', $manager_id, $str);
// 		                }
		                
// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers name - resigning}}</span>') !== false)
// 		                {

// 		                	$manager_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$manager_name_resign_result = $manager_name_resign_result->result_array();

// 		                	$previous_manager_name_resign_result = $previous_manager_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$manager_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_manager_name_resign = (int)(count($manager_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($manager_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$manager_name_resign = $manager_name_resign.$manager_name_resign_result[$g]["name"];
// 		                		}
// 		                		elseif($g == (int)$num_of_manager_name_resign)
// 		                		{
// 		                			$manager_name_resign = $manager_name_resign.' and '.$manager_name_resign_result[$g]["name"];
// 		                		}
// 		                		else
// 		                		{
// 		                			$manager_name_resign = $manager_name_resign.', '.$manager_name_resign_result[$g]["name"];
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$manager_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers name - resigning}}</span>', $manager_name_resign, $str);

// 		                	if(count($previous_manager_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers ID - resigning}}</span>') !== false)
// 		                {
// 		                	$manager_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$manager_id_resign_result = $manager_id_resign_result->result_array();

// 		                	$previous_manager_id_resign_result = $previous_manager_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$manager_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_manager_id_resign = (int)(count($manager_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($manager_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$manager_id_resign = $manager_id_resign.$manager_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_manager_id_resign)
// 		                		{
// 		                			$manager_id_resign = $manager_id_resign.' and '.$manager_id_resign_result[$g]["identification_no"];
// 		                		}
// 		                		else
// 		                		{
// 		                			$manager_id_resign = $manager_id_resign.', '.$manager_id_resign_result[$g]["identification_no"];
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$manager_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers ID - resigning}}</span>', $manager_id_resign, $str);

// 		                	if(count($previous_manager_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers - cessation date}}</span>') !== false)
// 		                {
// 		                	$manager_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$manager_cessation_resign_result = $manager_cessation_resign_result->result_array();

// 		                	$previous_manager_cessation_resign_result = $previous_manager_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$manager_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_manager_cessation_resign = (int)(count($manager_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($manager_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$manager_cessation_resign = $manager_cessation_resign.'<strong>'.$manager_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_manager_cessation_resign)
// 		                		{
// 		                			$manager_cessation_resign = $manager_cessation_resign.' and <strong>'.$manager_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$manager_cessation_resign = $manager_cessation_resign.', <strong>'.$manager_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$manager_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers - cessation date}}</span>', $manager_cessation_resign, $str);

// 		                	if(count($previous_manager_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if($result[$r]["document_name"] == "Manager-Shorter notice of EGM" || $result[$r]["document_name"] == "Manager-Attendance List")
// 		                {
// 		                	$manager_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");

// 		                	$manager_name_appointment_result = $manager_name_appointment_result->result_array();

// 		                	$previous_manager_name_appointment_result = $previous_manager_name_appointment_result->result_array();

// 		                	$latest_officer_id = array();

// 		                	for($g = 0; $g < count($manager_name_appointment_result); $g++)
// 		                	{
// 		                		array_push($latest_officer_id, (int)$manager_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(count($previous_manager_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers name - appointment}}</span>') !== false)
// 		                {
// 		                	$manager_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$manager_name_appointment_result = $manager_name_appointment_result->result_array();

// 		                	$previous_manager_name_appointment_result = $previous_manager_name_appointment_result->result_array();
// 		                	//echo json_encode($director_name_appointment_result);

// 		                	$manager_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_manager_name_appointment = (int)(count($manager_name_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($manager_name_appointment_result); $g++)
// 		                	{
// 		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>)') !== false)
// 		                		{
// 		                			if($g == 0)
// 			                		{
// 			                			$manager_name_appointment = $manager_name_appointment.$manager_name_appointment_result[$g]["name"].' (Identification No. '.$manager_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		elseif($g == (int)$num_of_manager_name_appointment)
// 			                		{
// 			                			$manager_name_appointment = $manager_name_appointment.' and '.$manager_name_appointment_result[$g]["name"].' (Identification No. '.$manager_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		else
// 			                		{
// 			                			$manager_name_appointment = $manager_name_appointment.', '.$manager_name_appointment_result[$g]["name"].' (Identification No. '.$manager_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 		                		}
// 		                		else
// 		                		{
// 			                		if($g == 0)
// 			                		{
// 			                			$manager_name_appointment = $manager_name_appointment.'<strong>'.$manager_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                		elseif($g == (int)$num_of_manager_name_appointment)
// 			                		{
// 			                			$manager_name_appointment = $manager_name_appointment.' and <strong>'.$manager_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                		else
// 			                		{
// 			                			$manager_name_appointment = $manager_name_appointment.', <strong>'.$manager_name_appointment_result[$g]["name"].'</strong>';
// 			                		}
// 			                	}
		                		
// 		                		array_push($latest_officer_id, (int)$manager_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Managers name - appointment}}</span> (Identification No. <span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>)', $manager_name_appointment, $str);
// 		                	}
// 		                	else
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Managers name - appointment}}</span>', $manager_name_appointment, $str);
// 		                	}


// 		                	if(count($previous_manager_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>') !== false)
// 		                {
// 		                	$manager_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$manager_id_appointment_result = $manager_id_appointment_result->result_array();

// 		                	$previous_manager_id_appointment_result = $previous_manager_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$manager_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_manager_id_appointment = (int)(count($manager_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($manager_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$manager_id_appointment = $manager_id_appointment.'<strong>'.$manager_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_manager_id_appointment)
// 		                		{
// 		                			$manager_id_appointment = $manager_id_appointment.' and <strong>'.$manager_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$manager_id_appointment = $manager_id_appointment.', <strong>'.$manager_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$manager_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>', $manager_id_appointment, $str);

// 		                	if(count($previous_manager_id_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers - appointment date}}</span>') !== false)
// 		                {
// 		                	$manager_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_manager_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$manager_appointment_date_result = $manager_appointment_date_result->result_array();

// 		                	$previous_manager_appointment_date_result = $previous_manager_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$manager_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_manager_appointment_date = (int)(count($manager_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($manager_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$manager_appointment_date = $manager_appointment_date.'<strong>'.$manager_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_manager_appointment_date)
// 		                		{
// 		                			$manager_appointment_date = $manager_appointment_date.' and <strong>'.$manager_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$manager_appointment_date = $manager_appointment_date.', <strong>'.$manager_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$manager_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers - appointment date}}</span>', $manager_appointment_date, $str);

// 		                	if(count($previous_manager_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_manager_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_manager_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO name - old}}</span>') !== false)
// 		                {

// 		                	$ceo_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$ceo_name_resign_result = $ceo_name_resign_result->result_array();

// 		                	$previous_ceo_name_resign_result = $previous_ceo_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$ceo_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_ceo_name_resign = (int)(count($ceo_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($ceo_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$ceo_name_resign = $ceo_name_resign.$ceo_name_resign_result[$g]["name"];
// 		                		}
// 		                		elseif($g == (int)$num_of_ceo_name_resign)
// 		                		{
// 		                			$ceo_name_resign = $ceo_name_resign.' and '.$ceo_name_resign_result[$g]["name"];
// 		                		}
// 		                		else
// 		                		{
// 		                			$ceo_name_resign = $ceo_name_resign.', '.$ceo_name_resign_result[$g]["name"];
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$ceo_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO name - old}}</span>', $ceo_name_resign, $str);

// 		                	if(count($previous_ceo_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO ID - old}}</span>') !== false)
// 		                {
// 		                	$ceo_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$ceo_id_resign_result = $ceo_id_resign_result->result_array();

// 		                	$previous_ceo_id_resign_result = $previous_ceo_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$ceo_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_ceo_id_resign = (int)(count($ceo_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($ceo_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$ceo_id_resign = $ceo_id_resign.$ceo_id_resign_result[$g]["identification_no"];
// 		                		}
// 		                		elseif($g == (int)$num_of_ceo_id_resign)
// 		                		{
// 		                			$ceo_id_resign = $ceo_id_resign.' and '.$ceo_id_resign_result[$g]["identification_no"];
// 		                		}
// 		                		else
// 		                		{
// 		                			$ceo_id_resign = $ceo_id_resign.', '.$ceo_id_resign_result[$g]["identification_no"];
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$ceo_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO ID - old}}</span>', $ceo_id_resign, $str);

// 		                	if(count($previous_ceo_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO date of cessation}}</span>') !== false)
// 		                {
// 		                	$ceo_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$ceo_cessation_resign_result = $ceo_cessation_resign_result->result_array();

// 		                	$previous_ceo_cessation_resign_result = $previous_ceo_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$ceo_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_ceo_cessation_resign = (int)(count($ceo_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($ceo_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$ceo_cessation_resign = $ceo_cessation_resign.'<strong>'.$ceo_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_ceo_cessation_resign)
// 		                		{
// 		                			$ceo_cessation_resign = $ceo_cessation_resign.' and <strong>'.$ceo_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$ceo_cessation_resign = $ceo_cessation_resign.', <strong>'.$ceo_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$ceo_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO date of cessation}}</span>', $ceo_cessation_resign, $str);

// 		                	if(count($previous_ceo_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if($result[$r]["document_name"] == "CEO-Shorter notice of EGM" || $result[$r]["document_name"] == "CEO-Attendance List")
// 		                {
// 		                	$ceo_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");

// 		                	$ceo_name_appointment_result = $ceo_name_appointment_result->result_array();

// 		                	$previous_ceo_name_appointment_result = $previous_ceo_name_appointment_result->result_array();

// 		                	$latest_officer_id = array();

// 		                	for($g = 0; $g < count($ceo_name_appointment_result); $g++)
// 		                	{
// 		                		array_push($latest_officer_id, (int)$ceo_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(count($previous_ceo_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO name - new}}</span>') !== false)
// 		                {
// 		                	$ceo_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$ceo_name_appointment_result = $ceo_name_appointment_result->result_array();

// 		                	$previous_ceo_name_appointment_result = $previous_ceo_name_appointment_result->result_array();
// 		                	//echo json_encode($ceo_name_appointment_result);

// 		                	$ceo_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_ceo_name_appointment = (int)(count($ceo_name_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($ceo_name_appointment_result); $g++)
// 		                	{
// 		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{CEO ID - new}}</span>)') !== false)
// 		                		{
// 		                			if($g == 0)
// 			                		{
// 			                			$ceo_name_appointment = $ceo_name_appointment.$ceo_name_appointment_result[$g]["name"].' (Identification No. '.$ceo_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		elseif($g == (int)$num_of_ceo_name_appointment)
// 			                		{
// 			                			$ceo_name_appointment = $ceo_name_appointment.' and '.$ceo_name_appointment_result[$g]["name"].' (Identification No. '.$ceo_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 			                		else
// 			                		{
// 			                			$ceo_name_appointment = $ceo_name_appointment.', '.$ceo_name_appointment_result[$g]["name"].' (Identification No. '.$ceo_name_appointment_result[$g]["identification_no"].')';
// 			                		}
// 		                		}
// 		                		else
// 		                		{
// 			                		if($g == 0)
// 			                		{
// 			                			$ceo_name_appointment = $ceo_name_appointment.$ceo_name_appointment_result[$g]["name"];
// 			                		}
// 			                		elseif($g == (int)$num_of_ceo_name_appointment)
// 			                		{
// 			                			$ceo_name_appointment = $ceo_name_appointment.' and '.$ceo_name_appointment_result[$g]["name"];
// 			                		}
// 			                		else
// 			                		{
// 			                			$ceo_name_appointment = $ceo_name_appointment.', '.$ceo_name_appointment_result[$g]["name"];
// 			                		}
// 			                	}
		                		
// 		                		array_push($latest_officer_id, (int)$ceo_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{CEO ID - new}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{CEO name - new}}</span> (Identification No. <span class="myclass mceNonEditable">{{CEO ID - new}}</span>)', $ceo_name_appointment, $str);
// 		                	}
// 		                	else
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{CEO name - new}}</span>', $ceo_name_appointment, $str);
// 		                	}

// 		                	if(count($previous_ceo_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO ID - new}}</span>') !== false)
// 		                {
// 		                	$ceo_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$ceo_id_appointment_result = $ceo_id_appointment_result->result_array();

// 		                	$previous_ceo_id_appointment_result = $previous_ceo_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$ceo_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_ceo_id_appointment = (int)(count($ceo_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($ceo_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$ceo_id_appointment = $ceo_id_appointment.$ceo_id_appointment_result[$g]["identification_no"];
// 		                		}
// 		                		elseif($g == (int)$num_of_ceo_id_appointment)
// 		                		{
// 		                			$ceo_id_appointment = $ceo_id_appointment.' and '.$ceo_id_appointment_result[$g]["identification_no"];
// 		                		}
// 		                		else
// 		                		{
// 		                			$ceo_id_appointment = $ceo_id_appointment.', '.$ceo_id_appointment_result[$g]["identification_no"];
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$ceo_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO ID - new}}</span>', $ceo_id_appointment, $str);

// 		                	if(count($previous_ceo_id_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO date of appointment}}</span>') !== false)
// 		                {
// 		                	$ceo_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_ceo_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$ceo_appointment_date_result = $ceo_appointment_date_result->result_array();

// 		                	$previous_ceo_appointment_date_result = $previous_ceo_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$ceo_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_ceo_appointment_date = (int)(count($ceo_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($ceo_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$ceo_appointment_date = $ceo_appointment_date.'<strong>'.$ceo_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_ceo_appointment_date)
// 		                		{
// 		                			$ceo_appointment_date = $ceo_appointment_date.' and <strong>'.$ceo_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$ceo_appointment_date = $ceo_appointment_date.', <strong>'.$ceo_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$ceo_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO date of appointment}}</span>', $ceo_appointment_date, $str);

// 		                	if(count($previous_ceo_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_ceo_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_ceo_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO name (current)}}</span>') !== false)
// 		                {
// 		                	$ceo_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
// 		                	$ceo_name_result = $ceo_name_result->result_array();

// 		                	//echo json_encode($director_name_result);
// 		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

// 		                	$ceo_name = "";

// 		                	for($g = 0; $g < count($ceo_name_result); $g++)
// 		                	{
// 		                		$ceo_name = $ceo_name.'<p>&nbsp;</p>'.$ceo_name_result[$g]["name"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO name (current)}}</span>', $ceo_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO ID (current)}}</span>') !== false)
// 		                {
// 		                	$ceo_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$ceo_id_result = $ceo_id_result->result_array();

// 		                	$ceo_id = "";

// 		                	for($g = 0; $g < count($ceo_id_result); $g++)
// 		                	{
// 		                		$ceo_id = $ceo_id.'<p>&nbsp;</p>'.$ceo_id_result[$g]["identification_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO ID (current)}}</span>', $ceo_id, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director name - old}}</span>') !== false)
// 		                {

// 		                	$managing_director_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_managing_director_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$managing_director_name_resign_result = $managing_director_name_resign_result->result_array();

// 		                	$previous_managing_director_name_resign_result = $previous_managing_director_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$managing_director_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_managing_director_name_resign = (int)(count($managing_director_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($managing_director_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$managing_director_name_resign = $managing_director_name_resign.'<strong>'.$managing_director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_managing_director_name_resign)
// 		                		{
// 		                			$managing_director_name_resign = $managing_director_name_resign.' and <strong>'.$managing_director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$managing_director_name_resign = $managing_director_name_resign.', <strong>'.$managing_director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$managing_director_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director name - old}}</span>', $managing_director_name_resign, $str);

// 		                	if(count($previous_managing_director_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_managing_director_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_managing_director_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director ID - old}}</span>') !== false)
// 		                {
// 		                	$managing_director_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_managing_director_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$managing_director_id_resign_result = $managing_director_id_resign_result->result_array();

// 		                	$previous_managing_director_id_resign_result = $previous_managing_director_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$managing_director_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_managing_director_id_resign = (int)(count($managing_director_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($managing_director_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$managing_director_id_resign = $managing_director_id_resign.'<strong>'.$managing_director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_managing_director_id_resign)
// 		                		{
// 		                			$managing_director_id_resign = $managing_director_id_resign.' and <strong>'.$managing_director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$managing_director_id_resign = $managing_director_id_resign.', <strong>'.$managing_director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$managing_director_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director ID - old}}</span>', $managing_director_id_resign, $str);

// 		                	if(count($previous_managing_director_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_managing_director_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_managing_director_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director date of cessation}}</span>') !== false)
// 		                {
// 		                	$managing_director_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_managing_director_cessation_resign_resultprevious_managing_director_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$managing_director_cessation_resign_result = $managing_director_cessation_resign_result->result_array();

// 		                	$previous_managing_director_cessation_resign_result = $previous_managing_director_cessation_resign_resultprevious_managing_director_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$managing_director_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_managing_director_cessation_resign = (int)(count($managing_director_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($managing_director_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$managing_director_cessation_resign = $managing_director_cessation_resign.'<strong>'.$managing_director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_managing_director_cessation_resign)
// 		                		{
// 		                			$managing_director_cessation_resign = $managing_director_cessation_resign.' and <strong>'.$managing_director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$managing_director_cessation_resign = $managing_director_cessation_resign.', <strong>'.$managing_director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$managing_director_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director date of cessation}}</span>', $managing_director_cessation_resign, $str);

// 		                	if(count($previous_managing_director_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_managing_director_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_managing_director_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director name - new}}</span>') !== false)
// 		                {
// 		                	$managing_director_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_managing_director_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$managing_director_name_appointment_result = $managing_director_name_appointment_result->result_array();

// 		                	$previous_managing_director_name_appointment_result = $previous_managing_director_name_appointment_result->result_array();
// 		                	//echo json_encode($ceo_name_appointment_result);

// 		                	$managing_director_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_managing_director_name_appointment = (int)(count($managing_director_name_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($managing_director_name_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$managing_director_name_appointment = $managing_director_name_appointment.'<strong>'.$managing_director_name_appointment_result[$g]["name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_managing_director_name_appointment)
// 		                		{
// 		                			$managing_director_name_appointment = $managing_director_name_appointment.' and <strong>'.$managing_director_name_appointment_result[$g]["name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$managing_director_name_appointment = $managing_director_name_appointment.', <strong>'.$managing_director_name_appointment_result[$g]["name"].'</strong>';
// 		                		}
// 	                			array_push($latest_officer_id, (int)$managing_director_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director name - new}}</span>', $managing_director_name_appointment, $str);

// 		                	if(count($previous_managing_director_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_managing_director_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_managing_director_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director ID - new}}</span>') !== false)
// 		                {
// 		                	$managing_director_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_managing_director_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$managing_director_id_appointment_result = $managing_director_id_appointment_result->result_array();

// 		                	$previous_managing_director_id_appointment_result = $previous_managing_director_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$managing_director_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_managing_director_id_appointment = (int)(count($managing_director_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($managing_director_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$managing_director_id_appointment = $managing_director_id_appointment.'<strong>'.$managing_director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_managing_director_id_appointment)
// 		                		{
// 		                			$managing_director_id_appointment = $managing_director_id_appointment.' and <strong>'.$managing_director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$managing_director_id_appointment = $managing_director_id_appointment.', <strong>'.$managing_director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$managing_director_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director ID - new}}</span>', $managing_director_id_appointment, $str);

// 		                	if(count($previous_managing_director_id_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_managing_director_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_managing_director_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director date of appointment}}</span>') !== false)
// 		                {
// 		                	$managing_director_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_managing_director_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$managing_director_appointment_date_result = $managing_director_appointment_date_result->result_array();

// 		                	$previous_managing_director_appointment_date_result = $previous_managing_director_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$managing_director_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_managing_director_appointment_date = (int)(count($managing_director_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($managing_director_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$managing_director_appointment_date = $managing_director_appointment_date.'<strong>'.$managing_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_managing_director_appointment_date)
// 		                		{
// 		                			$managing_director_appointment_date = $managing_director_appointment_date.' and <strong>'.$managing_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$managing_director_appointment_date = $managing_director_appointment_date.', <strong>'.$managing_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$managing_director_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director date of appointment}}</span>', $managing_director_appointment_date, $str);

// 		                	if(count($previous_managing_director_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_managing_director_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_managing_director_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director name (current)}}</span>') !== false)
// 		                {
// 		                	$managing_director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
// 		                	$managing_director_name_result = $managing_director_name_result->result_array();

// 		                	//echo json_encode($director_name_result);
// 		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

// 		                	$managing_director_name = "";

// 		                	for($g = 0; $g < count($managing_director_name_result); $g++)
// 		                	{
// 		                		$managing_director_name = $managing_director_name.'<p>&nbsp;</p>'.$managing_director_name_result[$g]["name"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director name (current)}}</span>', $managing_director_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director ID (current)}}</span>') !== false)
// 		                {
// 		                	$managing_director_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$managing_director_id_result = $managing_director_id_result->result_array();

// 		                	$managing_director_id = "";

// 		                	for($g = 0; $g < count($managing_director_id_result); $g++)
// 		                	{
// 		                		$managing_director_id = $managing_director_id.'<p>&nbsp;</p>'.$managing_director_id_result[$g]["identification_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director ID (current)}}</span>', $managing_director_id, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director name - old}}</span>') !== false)
// 		                {

// 		                	$alternate_director_name_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_alternate_director_name_resign_result = $this->db->query("select client_officers.* from client_officers where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$alternate_director_name_resign_result = $alternate_director_name_resign_result->result_array();

// 		                	$previous_alternate_director_name_resign_result = $previous_alternate_director_name_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$alternate_director_name_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_alternate_director_name_resign = (int)(count($alternate_director_name_resign_result)) - 1;

// 		                	for($g = 0; $g < count($alternate_director_name_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$alternate_director_name_resign = $alternate_director_name_resign.'<strong>'.$alternate_director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_alternate_director_name_resign)
// 		                		{
// 		                			$alternate_director_name_resign = $alternate_director_name_resign.' and <strong>'.$alternate_director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$alternate_director_name_resign = $alternate_director_name_resign.', <strong>'.$alternate_director_name_resign_result[$g]["name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$alternate_director_name_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director name - old}}</span>', $alternate_director_name_resign, $str);

// 		                	if(count($previous_alternate_director_name_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_alternate_director_name_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_alternate_director_name_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director ID - old}}</span>') !== false)
// 		                {
// 		                	$alternate_director_id_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_alternate_director_id_resign_result = $this->db->query("select client_officers.* from client_officers where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$alternate_director_id_resign_result = $alternate_director_id_resign_result->result_array();

// 		                	$previous_alternate_director_id_resign_result = $previous_alternate_director_id_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$alternate_director_id_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_alternate_director_id_resign = (int)(count($alternate_director_id_resign_result)) - 1;

// 		                	for($g = 0; $g < count($alternate_director_id_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$alternate_director_id_resign = $alternate_director_id_resign.'<strong>'.$alternate_director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_alternate_director_id_resign)
// 		                		{
// 		                			$alternate_director_id_resign = $alternate_director_id_resign.' and <strong>'.$alternate_director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$alternate_director_id_resign = $alternate_director_id_resign.', <strong>'.$alternate_director_id_resign_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$alternate_director_id_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director ID - old}}</span>', $alternate_director_id_resign, $str);

// 		                	if(count($previous_alternate_director_id_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_alternate_director_id_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_alternate_director_id_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director cessation - old}}</span>') !== false)
// 		                {
// 		                	$alternate_director_cessation_resign_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_alternate_director_cessation_resign_result = $this->db->query("select client_officers.* from client_officers where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$alternate_director_cessation_resign_result = $alternate_director_cessation_resign_result->result_array();

// 		                	$previous_alternate_director_cessation_resign_result = $previous_alternate_director_cessation_resign_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$alternate_director_cessation_resign = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_alternate_director_cessation_resign = (int)(count($alternate_director_cessation_resign_result)) - 1;

// 		                	for($g = 0; $g < count($alternate_director_cessation_resign_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$alternate_director_cessation_resign = $alternate_director_cessation_resign.'<strong>'.$alternate_director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_alternate_director_cessation_resign)
// 		                		{
// 		                			$alternate_director_cessation_resign = $alternate_director_cessation_resign.' and <strong>'.$alternate_director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$alternate_director_cessation_resign = $alternate_director_cessation_resign.', <strong>'.$alternate_director_cessation_resign_result[$g]["date_of_cessation"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$alternate_director_cessation_resign_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director cessation - old}}</span>', $alternate_director_cessation_resign, $str);

// 		                	if(count($previous_alternate_director_cessation_resign_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_alternate_director_cessation_resign_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_alternate_director_cessation_resign_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director name - new}}</span>') !== false)
// 		                {
// 		                	$alternate_director_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_alternate_director_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$alternate_director_name_appointment_result = $alternate_director_name_appointment_result->result_array();

// 		                	$previous_alternate_director_name_appointment_result = $previous_alternate_director_name_appointment_result->result_array();
// 		                	//echo json_encode($ceo_name_appointment_result);

// 		                	$alternate_director_name_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_alternate_director_name_appointment = (int)(count($alternate_director_name_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($alternate_director_name_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$alternate_director_name_appointment = $alternate_director_name_appointment.'<strong>'.$alternate_director_name_appointment_result[$g]["name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_alternate_director_name_appointment)
// 		                		{
// 		                			$alternate_director_name_appointment = $alternate_director_name_appointment.' and <strong>'.$alternate_director_name_appointment_result[$g]["name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$alternate_director_name_appointment = $alternate_director_name_appointment.', <strong>'.$alternate_director_name_appointment_result[$g]["name"].'</strong>';
// 		                		}
// 	                			array_push($latest_officer_id, (int)$alternate_director_name_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director name - new}}</span>', $alternate_director_name_appointment, $str);

// 		                	if(count($previous_alternate_director_name_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_alternate_director_name_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_alternate_director_name_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director ID - new}}</span>') !== false)
// 		                {
// 		                	$alternate_director_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_alternate_director_id_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$alternate_director_id_appointment_result = $alternate_director_id_appointment_result->result_array();

// 		                	$previous_alternate_director_id_appointment_result = $previous_alternate_director_id_appointment_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$alternate_director_id_appointment = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_alternate_director_id_appointment = (int)(count($alternate_director_id_appointment_result)) - 1;

// 		                	for($g = 0; $g < count($alternate_director_id_appointment_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$alternate_director_id_appointment = $alternate_director_id_appointment.'<strong>'.$alternate_director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_alternate_director_id_appointment)
// 		                		{
// 		                			$alternate_director_id_appointment = $alternate_director_id_appointment.' and <strong>'.$alternate_director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$alternate_director_id_appointment = $alternate_director_id_appointment.', <strong>'.$alternate_director_id_appointment_result[$g]["identification_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$alternate_director_id_appointment_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director ID - new}}</span>', $alternate_director_id_appointment, $str);

// 		                	if(count($previous_alternate_director_id_appointment_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_alternate_director_id_appointment_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_alternate_director_id_appointment_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director appointment - new}}</span>') !== false)
// 		                {
// 		                	$alternate_director_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

// 		                	$previous_alternate_director_appointment_date_result = $this->db->query("select client_officers.* from client_officers where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$officer_id."' ORDER BY client_officers.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$alternate_director_appointment_date_result = $alternate_director_appointment_date_result->result_array();

// 		                	$previous_alternate_director_appointment_date_result = $previous_alternate_director_appointment_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$alternate_director_appointment_date = "";

// 		                	$latest_officer_id = array();
// 		                	$num_of_alternate_director_appointment_date = (int)(count($alternate_director_appointment_date_result)) - 1;

// 		                	for($g = 0; $g < count($alternate_director_appointment_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$alternate_director_appointment_date = $alternate_director_appointment_date.'<strong>'.$alternate_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_alternate_director_appointment_date)
// 		                		{
// 		                			$alternate_director_appointment_date = $alternate_director_appointment_date.' and <strong>'.$alternate_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$alternate_director_appointment_date = $alternate_director_appointment_date.', <strong>'.$alternate_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_officer_id, (int)$alternate_director_appointment_date_result[$g]["id"]);
// 		                	}

// 		                	$data['officer_id']=json_encode($latest_officer_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director appointment - new}}</span>', $alternate_director_appointment_date, $str);

// 		                	if(count($previous_alternate_director_appointment_date_result) != 0)
// 		                	{
// 		                		$officer_id_data = array();
// 		                		for($f = 0; $f < count($previous_alternate_director_appointment_date_result); $f++)
// 			                	{
// 			                		array_push($officer_id_data, (int)$previous_alternate_director_appointment_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternated directors name}}</span>') !== false)
// 		                {
// 		                	/*$ceo_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");*/

// 		                	$alternated_directors_name_result = $this->db->query("select r.*, officer.identification_no, officer.name from client_officers as r left join client_officers as t on t.id = r.alternate_of left join officer on t.officer_id = officer.id and t.field_type = officer.field_type where r.position = '7' AND r.company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(r.date_of_appointment,'%d/%m/%Y') AND r.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(r.date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(r.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND r.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
// 		                	$alternated_directors_name_result = $alternated_directors_name_result->result_array();

// 		                	//echo json_encode($director_name_result);
// 		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

// 		                	$alternated_directors_name = "";

// 		                	for($g = 0; $g < count($alternated_directors_name_result); $g++)
// 		                	{
// 		                		$alternated_directors_name = $alternated_directors_name.'<p>&nbsp;</p>'.$alternated_directors_name_result[$g]["name"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternated directors name}}</span>', $alternated_directors_name, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternated directors ID}}</span>') !== false)
// 		                {
// 		                	$alternated_directors_id_result = $this->db->query("select r.*, officer.identification_no, officer.name from client_officers as r left join client_officers as t on t.id = r.alternate_of left join officer on t.officer_id = officer.id and t.field_type = officer.field_type where r.position = '7' AND r.company_code='".$company_code."' AND ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(r.date_of_appointment,'%d/%m/%Y') AND r.date_of_cessation = '') OR ((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(r.date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(r.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')) AND r.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

// 		                	$alternated_directors_id_result = $alternated_directors_id_result->result_array();

// 		                	$alternated_directors_id = "";

// 		                	for($g = 0; $g < count($alternated_directors_id_result); $g++)
// 		                	{
// 		                		$alternated_directors_id = $alternated_directors_id.'<p>&nbsp;</p>'.$alternated_directors_id_result[$g]["identification_no"].' ____________________________<br>';
// 		                	}

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternated directors ID}}</span>', $alternated_directors_id, $str);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Members name - all}}</span>') !== false)
// 		                {
// 		                	$member_name_result = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$company_code.'" GROUP BY member_shares.field_type, member_shares.officer_id,member_shares.client_member_share_capital_id HAVING sum(member_shares.number_of_share) != 0');
		                	
// 		                	$member_name_result = $member_name_result->result_array();


// 		                	$member_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';

// 		                	for($g = 0; $g < count($member_name_result); $g++)
// 		                	{
// 		                		if($member_name_result[$g]["name"] != null)
// 		                		{
// 		                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
// 		                		}
// 		                		elseif($member_name_result[$g]["company_name"] != null)
// 		                		{
// 		                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["company_name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
// 		                		}
// 		                	}

// 		                	$member_name = $member_name.'</tbody></table>';

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Members name - all}}</span>', $member_name, $str);
// 		                }

// 		                if($client_member_share_capital_id != null)
// 		                {
// 		                	$client_member_share_capital_id_info = $this->db->query("select client_member_share_capital.*, member_shares.company_code, sum(member_shares.number_of_share) as number_of_shares, sum(member_shares.amount_share) as amount, sum(member_shares.no_of_share_paid) as number_of_shares_paid, sum(member_shares.amount_paid) as paid_up, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from client_member_share_capital left join member_shares on member_shares.client_member_share_capital_id = client_member_share_capital.id AND member_shares.company_code = client_member_share_capital.company_code left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where client_member_share_capital.company_code = '".$company_code."' group by client_member_share_capital.id");

// 		                	$client_member_share_capital_id_info = $client_member_share_capital_id_info->result_array();

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Class of shares - all}}</span>') !== false)
// 		                	{
// 	                			if($client_member_share_capital_id_info[0]["sharetype_id"] == '1')
// 	                			{
// 	                				$str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["sharetype_name"], $str);

// 	                			}
// 	                			elseif($client_member_share_capital_id_info[$g]["sharetype_id"] == '2')
// 	                			{
// 	                				$str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["other_class"], $str);
// 	                			}
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>', $client_member_share_capital_id_info[0]["currency_name"], $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares"], 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["amount"], 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares_paid"], 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["paid_up"], 2), $str);
// 		                	}
// 		                }

// 		                if($type == "add_allotment_of_share")
// 		                {
// 		                	$allotment_total_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.number_of_share) as total_number_of_share, sum(member_shares.amount_share) as total_amount_of_share, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

// 		                	$allotment_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

		                
// 		                	$this->db->select('member_shares.*')
// 		                	         ->order_by('member_shares.id');
// 							$this->db->where("company_code", $company_code);
// 							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
// 							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
// 							$this->db->where("member_shares.transaction_type = 'Allotment'");
// 							$this->db->where_not_in('id', $allotment_id);

// 							$previous_allotment_member_result = $this->db->get('member_shares');

// 							$allotment_total_of_share_all_result = $allotment_total_of_share_all_result->result_array();
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$allotment_member_result = $allotment_member_result->result_array();

// 		                	$previous_allotment_member_result = $previous_allotment_member_result->result_array();
// 		                	//echo json_encode($director_name_result);
// 		                	//if($transferor_member_result[])
		                	
// 		                	/*if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
// 				            {
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $get_client[0]["company_type_name"], $str);
// 		                	}*/
		                	
// 	    					//$final_message = str_replace($final_name,$html,$final_message);
// 		                	//echo json_encode($m[0][0]);
// 							//echo json_encode('<p><span class="myclass mceNonEditable">{{Allotment - members}}</span>'.$m[1].'</p>');
// 		                	/*$transferor_member = "";
// 		                	$transferee_member = "";*/
// 		                	$allotment_member = "";
// 		                	$allotment_string = "";
// 		                	$latest_allotment_id = array();
// 		                	$num_of_allotment_member = (int)(count($allotment_member_result)) - 1;

// 		                	if(strpos($str, '<tr class="loop"') !== false)
// 		                	{
// 		                		preg_match_all ('/<tr class="loop"(.+?)<\/tr>/s', $str, $m);
		                	
// 			                	for($g = 0; $g < count($allotment_member_result); $g++)
// 			                	{

// 		                			$allotment_string = $m[0][0];
// 		                			//echo json_encode($m);
// 			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
// 				                	{
// 				                		if($allotment_member_result[$g]["name"] != '')
// 			                			{
// 			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["name"], $allotment_string);
			                				
// 			                			}
// 			                			elseif($allotment_member_result[$g]["company_name"] != '')
// 			                			{
// 			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["company_name"], $allotment_string);
// 			                			}
// 			                		}

// 			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
// 			                		{
// 			                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($allotment_member_result[$g]["number_of_share"], 2), $allotment_string);
// 			                		}

// 			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
// 			                		{
// 			                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', number_format($allotment_member_result[$g]["amount_share"], 2), $allotment_string);
// 			                		}

// 			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
// 			                		{
// 			                			if($allotment_member_result[$g]["sharetype_id"] == '1')
// 			                			{
// 			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["sharetype_name"], $allotment_string);

// 			                			}
// 			                			elseif($allotment_member_result[$g]["sharetype_id"] == '2')
// 			                			{
// 			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["other_class"], $allotment_string);
// 			                			}
// 			                		}

// 			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
// 			                		{
// 			                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', $allotment_member_result[$g]["currency_name"], $allotment_string);
// 			                		}

// 			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
// 			                		{
// 			                			if($allotment_member_result[$g]["new_certificate_no"] != '')
// 			                			{
// 			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["new_certificate_no"], $allotment_string);
// 			                			}
// 			                			else
// 			                			{
// 			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["certificate_no"], $allotment_string);
// 			                			}
			                			
// 			                		}

// 			                		$allotment_member = $allotment_member.$allotment_string;
			                		
				            		
// 			                	}


// 		                		$str = str_replace($m[0][0], $allotment_member, $str);
// 			                }
			                
			               	
// 			               	for($g = 0; $g < count($allotment_member_result); $g++)
// 			                {

// 			                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
// 			                	{
// 			                		if($allotment_member_result[$g]["name"] != '')
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["name"], $str);
		                				
// 		                			}
// 		                			elseif($allotment_member_result[$g]["company_name"] != '')
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["company_name"], $str);
// 		                			}
// 		                		}

// 		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
// 		                		{
// 		                			if($result[$r]["document_name"] == "DRIW-Allotment of Shares")
// 		                			{
// 		                				$doc_total_number_of_share = 0;
// 		                				for($y = 0; $y < count($allotment_member_result); $y++)
// 			                			{
// 			                				$doc_total_number_of_share = $doc_total_number_of_share + $allotment_member_result[$y]["number_of_share"];
// 			                			}
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($doc_total_number_of_share, 2), $str);
// 		                			}
// 		                			else
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($allotment_member_result[$g]["number_of_share"], 2), $str);
// 		                			}
// 		                		}

// 		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
// 		                		{
// 		                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', number_format($allotment_member_result[$g]["amount_share"], 2), $str);
// 		                		}

// 		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>') !== false)
// 		                		{
// 		                			if($result[$r]["document_name"] == "DRIW-Allotment of Shares")
// 		                			{
// 		                				$doc_amount_share = 0;
// 		                				$doc_number_of_share = 0;
// 		                				for($y = 0; $y < count($allotment_member_result); $y++)
// 			                			{
// 			                				$doc_amount_share = $doc_amount_share + $allotment_member_result[$y]["amount_share"];
// 			                				$doc_number_of_share = $doc_number_of_share + $allotment_member_result[$y]["number_of_share"];
// 			                			}

// 			                			$per_shared = $doc_amount_share / $doc_number_of_share;

// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>', number_format($per_shared, 2), $str);
// 		                			}
// 		                			else
// 		                			{
// 		                				$per_shared = $allotment_member_result[$g]["amount_share"] / $allotment_member_result[$g]["number_of_share"];

// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>', number_format($per_shared, 2), $str);
// 		                			}
		                			
// 		                		}


// 		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
// 		                		{
// 		                			if($allotment_member_result[$g]["sharetype_id"] == '1')
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["sharetype_name"], $str);

// 		                			}
// 		                			elseif($allotment_member_result[$g]["sharetype_id"] == '2')
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["other_class"], $str);
// 		                			}
// 		                		}

// 		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
// 		                		{
// 		                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', $allotment_member_result[$g]["currency_name"], $str);
// 		                		}

// 		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
// 		                		{
// 		                			if($allotment_member_result[$g]["new_certificate_no"] != '')
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["new_certificate_no"], $str);
// 		                			}
// 		                			else
// 		                			{
// 		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["certificate_no"], $str);
// 		                			}
		                			
// 		                		}

			                		
			                	
// 			                }

// 			                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - number of shares all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares all}}</span>', number_format($allotment_total_of_share_all_result[0]["total_number_of_share"], 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares all}}</span>', number_format($allotment_total_of_share_all_result[0]["total_amount_of_share"], 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>') !== false)
// 		                	{
// 		                		if($allotment_total_of_share_all_result[0]["sharetype_id"] == '1')
// 	                			{
// 	                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>', $allotment_total_of_share_all_result[0]["sharetype_name"], $str);

// 	                			}
// 	                			elseif($allotment_total_of_share_all_result[0]["sharetype_id"] == '2')
// 	                			{
// 	                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>', $allotment_total_of_share_all_result[0]["other_class"], $str);
// 	                			}
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - currency all}}</span>') !== false)
// 	                		{
// 	                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency all}}</span>', $allotment_total_of_share_all_result[0]["currency_name"], $str);
// 	                		}
			                

// 			                for($h = 0; $h < count($allotment_member_result); $h++)
// 			                {
// 			                	array_push($latest_allotment_id, (int)$allotment_member_result[$h]["id"]);
// 			                }

// 		                	$data['allotment_id']=json_encode($latest_allotment_id);

		                	

// 		                	//$str = str_replace($r[0][0], $transferee_member, $str);

// 		                	if(count($previous_allotment_member_result) != 0)
// 		                	{
// 		                		$allotment_id_data = array();
// 		                		for($f = 0; $f < count($previous_allotment_member_result); $f++)
// 			                	{
// 			                		array_push($allotment_id_data, (int)$previous_allotment_member_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

		                
// 		                if($type == "add_buyback_of_share")
// 		                {
// 		                	$buyback_total_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.number_of_share) as total_number_of_share, sum(member_shares.amount_share) as total_amount_of_share, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

// 		                	$buyback_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

		                
// 		                	$this->db->select('member_shares.*')
// 		                	         ->order_by('member_shares.id');
// 							$this->db->where("company_code", $company_code);
// 							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
// 							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
// 							$this->db->where("member_shares.transaction_type = 'Buyback'");
// 							$this->db->where_in('id', $buyback_id);

// 							$previous_buyback_member_result = $this->db->get('member_shares');

// 							$buyback_total_of_share_all_result = $buyback_total_of_share_all_result->result_array();
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$buyback_member_result = $buyback_member_result->result_array();

// 		                	$previous_buyback_member_result = $previous_buyback_member_result->result_array();

// 		                	$buyback_member = "";
// 		                	$buyback_string = "";
// 		                	$latest_buyback_id = array();
// 		                	$num_of_buyback_member = (int)(count($buyback_member_result)) - 1;

// 		                	if(strpos($str, '<tr class="loop"') !== false)
// 		                	{
// 		                		preg_match_all ('/<tr class="loop"(.+?)<\/tr>/s', $str, $m);
		                	
// 			                	for($g = 0; $g < count($buyback_member_result); $g++)
// 			                	{

// 			                			$buyback_string = $m[0][0];
// 			                			//echo json_encode($m);
// 				                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
// 					                	{
// 					                		if($buyback_member_result[$g]["name"] != '')
// 				                			{
// 				                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["name"], $buyback_string);
				                				
// 				                			}
// 				                			elseif($buyback_member_result[$g]["company_name"] != '')
// 				                			{
// 				                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["company_name"], $buyback_string);
// 				                			}
// 				                		}

// 				                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>') !== false)
// 				                		{
// 				                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>', number_format(-($buyback_member_result[$g]["number_of_share"]), 2), $buyback_string);
// 				                		}

// 				                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>') !== false)
// 				                		{
// 				                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>', number_format(-($buyback_member_result[$g]["amount_share"]), 2), $buyback_string);
// 				                		}

// 				                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>') !== false)
// 				                		{
// 				                			if($buyback_member_result[$g]["sharetype_id"] == '1')
// 				                			{
// 				                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["sharetype_name"], $buyback_string);

// 				                			}
// 				                			elseif($buyback_member_result[$g]["sharetype_id"] == '2')
// 				                			{
// 				                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["other_class"], $buyback_string);
// 				                			}
// 				                		}

// 				                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - currency}}</span>') !== false)
// 				                		{
// 				                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency}}</span>', $buyback_member_result[$g]["currency_name"], $buyback_string);
// 				                		}

// 				                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>') !== false)
// 				                		{
// 				                			if($buyback_member_result[$g]["new_certificate_no"] != '')
// 				                			{
// 				                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["new_certificate_no"], $buyback_string);
// 				                			}
// 				                			else
// 				                			{
// 				                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["certificate_no"], $buyback_string);
// 				                			}
				                			
// 				                		}

// 				                		$buyback_member = $buyback_member.$buyback_string;

// 			                	}


// 		                		$str = str_replace($m[0][0], $buyback_member, $str);
// 			                }
			                
			               	
// 			               	for($g = 0; $g < count($buyback_member_result); $g++)
// 			                {

// 				                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
// 				                	{
// 				                		if($buyback_member_result[$g]["name"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["name"], $str);
			                				
// 			                			}
// 			                			elseif($buyback_member_result[$g]["company_name"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["company_name"], $str);
// 			                			}
// 			                		}


// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>', number_format(-($buyback_member_result[$g]["number_of_share"]), 2), $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>', number_format(-($buyback_member_result[$g]["amount_share"]), 2), $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>') !== false)
// 			                		{
// 			                			if($buyback_member_result[$g]["sharetype_id"] == '1')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["sharetype_name"], $str);

// 			                			}
// 			                			elseif($buyback_member_result[$g]["sharetype_id"] == '2')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["other_class"], $str);
// 			                			}
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - currency}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency}}</span>', $buyback_member_result[$g]["currency_name"], $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>') !== false)
// 			                		{
// 			                			if($buyback_member_result[$g]["new_certificate_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["new_certificate_no"], $str);
// 			                			}
// 			                			else
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["certificate_no"], $str);
// 			                			}
			                			
// 			                		}

			                	
// 			                }

// 			                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - number of shares all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares all}}</span>', number_format(-($buyback_total_of_share_all_result[0]["total_number_of_share"]), 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - amount of shares all}}</span>') !== false)
// 		                	{
// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares all}}</span>', number_format(-($buyback_total_of_share_all_result[0]["total_amount_of_share"]), 2), $str);
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>') !== false)
// 		                	{
// 		                		if($buyback_total_of_share_all_result[0]["sharetype_id"] == '1')
// 	                			{
// 	                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>', $buyback_total_of_share_all_result[0]["sharetype_name"], $str);

// 	                			}
// 	                			elseif($buyback_total_of_share_all_result[0]["sharetype_id"] == '2')
// 	                			{
// 	                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>', $buyback_total_of_share_all_result[0]["other_class"], $str);
// 	                			}
// 		                	}

// 		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - currency all}}</span>') !== false)
// 	                		{
// 	                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency all}}</span>', $buyback_total_of_share_all_result[0]["currency_name"], $str);
// 	                		}
			                

// 			                for($h = 0; $h < count($buyback_member_result); $h++)
// 			                {
// 			                	array_push($latest_buyback_id, (int)$buyback_member_result[$h]["id"]);
// 			                }

// 		                	$data['buyback_id']=json_encode($latest_buyback_id);

		                	

// 		                	//$str = str_replace($r[0][0], $transferee_member, $str);

// 		                	if(count($previous_buyback_member_result) != 0)
// 		                	{
// 		                		$transfer_id_data = array();
// 		                		for($f = 0; $f < count($previous_buyback_member_result); $f++)
// 			                	{
// 			                		array_push($transfer_id_data, (int)$previous_buyback_member_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if($type == "add_transfer_of_share")
// 		                {
// 		                	$transfer_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Transfer' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY member_shares.id");

		                

// 		                	$this->db->select('member_shares.*')
// 		                	         ->order_by('member_shares.id');
// 							$this->db->where("company_code", $company_code);
// 							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
// 							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
// 							$this->db->where("member_shares.transaction_type = 'Transfer'");
// 							$this->db->where_in('id', $transfer_id);
// 							$previous_transfer_member_result = $this->db->get('member_shares');

// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$transfer_member_result = $transfer_member_result->result_array();

// 		                	$previous_transfer_member_result = $previous_transfer_member_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$transferor_member = "";
// 		                	$transferor_string = "";
// 		                	$latest_transfer_id = array();
// 		                	$num_of_transferor_member = (int)(count($transfer_member_result)) - 1;

// 		                	if(strpos($str, '<tr class="loop"') !== false)
// 		                	{
// 		                		preg_match_all ('/<tr class="loop"(.+?)<\/tr>/s', $str, $m);
		                	
// 			                	for($g = 0; $g < count($transfer_member_result); $g++)
// 			                	{
// 			                		if($g%2==0)
// 								    {
// 								     	$transferor_string = $transferor_string.$m[0][0];
// 								    }
// 								   	else
// 								   	{
// 								   		$transferor_string = $transferor_string;
// 								   	}

// 				                	if(0 > $transfer_member_result[$g]["number_of_share"])
// 			                		{
// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
// 					                	{
// 					                		if($transfer_member_result[$g]["name"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["name"], $transferor_string);
				                				
// 				                			}
// 				                			elseif($transfer_member_result[$g]["company_name"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["company_name"], $transferor_string);
// 				                			}
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - ID}}</span>') !== false)
// 					                	{
// 					                		if($transfer_member_result[$g]["identification_no"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["identification_no"], $transferor_string);
				                				
// 				                			}
// 				                			elseif($transfer_member_result[$g]["register_no"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["register_no"], $transferor_string);
// 				                			}
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share number}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share number}}</span>', number_format(-($transfer_member_result[$g]["number_of_share"]), 2), $transferor_string);
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>', number_format(-($transfer_member_result[$g]["amount_share"]), 2), $transferor_string);
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share type}}</span>') !== false)
// 				                		{
// 				                			if($transfer_member_result[$g]["sharetype_id"] == '1')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $transferor_string);

// 				                			}
// 				                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["other_class"], $transferor_string);
// 				                			}
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - currency}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - currency}}</span>', $transfer_member_result[$g]["currency_name"], $transferor_string);
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>') !== false)
// 				                		{
// 				                			if($transfer_member_result[$g]["new_certificate_no"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $transferor_string);
// 				                			}
// 				                			else
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $transferor_string);
// 				                			}
				                			
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>', number_format($transfer_member_result[$g]["consideration"], 2), $transferor_string);
// 				                		}
// 				                	}
// 				                	elseif($transfer_member_result[$g]["number_of_share"] > 0)
// 				                	{
// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - name}}</span>') !== false)
// 					                	{
// 					                		if($transfer_member_result[$g]["name"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["name"], $transferor_string);
				                				
// 				                			}
// 				                			elseif($transfer_member_result[$g]["company_name"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["company_name"], $transferor_string);
// 				                			}
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - ID}}</span>') !== false)
// 					                	{
// 					                		if($transfer_member_result[$g]["identification_no"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["identification_no"], $transferor_string);
				                				
// 				                			}
// 				                			elseif($transfer_member_result[$g]["register_no"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["register_no"], $transferor_string);
// 				                			}
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share number}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share number}}</span>', number_format($transfer_member_result[$g]["number_of_share"],2), $transferor_string);
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>', number_format($transfer_member_result[$g]["amount_share"], 2), $transferor_string);
// 				                		}
// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share type}}</span>') !== false)
// 				                		{
// 				                			if($transfer_member_result[$g]["sharetype_id"] == '1')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $transferor_string);

// 				                			}
// 				                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["other_class"], $transferor_string);
// 				                			}
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - currency}}</span>') !== false)
// 				                		{
// 				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - currency}}</span>', $transfer_member_result[$g]["currency_name"], $transferor_string);
// 				                		}

// 				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>') !== false)
// 				                		{
// 				                			if($transfer_member_result[$g]["new_certificate_no"] != '')
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $transferor_string);
// 				                			}
// 				                			else
// 				                			{
// 				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $transferor_string);
// 				                			}
				                			
// 				                		}
// 				                	}
			                		
				            
// 			                	}
			                	

// 			                	if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
// 					            {
// 					            	$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', '', $transferor_string);
// 		                		}

// 	                			if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - ID}}</span>') !== false)
// 			                	{
// 			                		$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share number}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share number}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share type}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - currency}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - currency}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - name}}</span>') !== false)
// 			                	{
// 			                		$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - ID}}</span>') !== false)
// 			                	{
// 			                		$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share number}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share number}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>', '', $transferor_string);
// 		                		}
// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share type}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - currency}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - currency}}</span>', '', $transferor_string);
// 		                		}

// 		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>') !== false)
// 		                		{
// 		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', '', $transferor_string);
// 		                		}

// 		                		$str = str_replace($m[0][0], $transferor_string, $str);
// 			                }
			                
			               	
// 			               	for($g = 0; $g < count($transfer_member_result); $g++)
// 			                {
// 			                	if(0 > $transfer_member_result[$g]["number_of_share"])
// 			                	{
// 				                	if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
// 						            {

// 				                		if($transfer_member_result[$g]["name"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["name"], $str);
			                				
// 			                			}
// 			                			elseif($transfer_member_result[$g]["company_name"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["company_name"], $str);
// 			                			}
// 			                		}

// 		                			if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - ID}}</span>') !== false)
// 				                	{
// 				                		if($transfer_member_result[$g]["identification_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["identification_no"], $str);
			                				
// 			                			}
// 			                			elseif($transfer_member_result[$g]["register_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["register_no"], $str);
// 			                			}
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - share number}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share number}}</span>', number_format(-($transfer_member_result[$g]["number_of_share"]), 2), $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>', number_format(-($transfer_member_result[$g]["amount_share"]), 2), $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - share type}}</span>') !== false)
// 			                		{
// 			                			if($transfer_member_result[$g]["sharetype_id"] == '1')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $str);

// 			                			}
// 			                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["other_class"], $str);
// 			                			}
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - currency}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - currency}}</span>', $transfer_member_result[$g]["currency_name"], $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>') !== false)
// 			                		{
// 			                			if($transfer_member_result[$g]["new_certificate_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $str);
// 			                			}
// 			                			else
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $str);
// 			                			}
			                			
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>', number_format($transfer_member_result[$g]["consideration"], 2), $str);
// 			                		}
// 			                	}
// 			                	elseif($transfer_member_result[$g]["number_of_share"] > 0)
// 			                	{
// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - name}}</span>') !== false)
// 				                	{
// 				                		if($transfer_member_result[$g]["name"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["name"], $str);
			                				
// 			                			}
// 			                			elseif($transfer_member_result[$g]["company_name"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["company_name"], $str);
// 			                			}
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - ID}}</span>') !== false)
// 				                	{
// 				                		if($transfer_member_result[$g]["identification_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["identification_no"], $str);
			                				
// 			                			}
// 			                			elseif($transfer_member_result[$g]["register_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["register_no"], $str);
// 			                			}
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - share number}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share number}}</span>', number_format($transfer_member_result[$g]["number_of_share"], 2), $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>', number_format($transfer_member_result[$g]["amount_share"], 2), $str);
// 			                		}
// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - share type}}</span>') !== false)
// 			                		{
// 			                			if($transfer_member_result[$g]["sharetype_id"] == '1')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $str);

// 			                			}
// 			                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["other_class"], $str);
// 			                			}
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - currency}}</span>') !== false)
// 			                		{
// 			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - currency}}</span>', $transfer_member_result[$g]["currency_name"], $str);
// 			                		}

// 			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>') !== false)
// 			                		{
// 			                			if($transfer_member_result[$g]["new_certificate_no"] != '')
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $str);
// 			                			}
// 			                			else
// 			                			{
// 			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $str);
// 			                			}
			                			
// 			                		}
// 			                	}
			                	
// 			                }
			                

// 			                for($h = 0; $h < count($transfer_member_result); $h++)
// 			                {
// 			                	array_push($latest_transfer_id, (int)$transfer_member_result[$h]["id"]);
// 			                }

// 		                	$data['transfer_id']=json_encode($latest_transfer_id);

		                	

// 		                	//$str = str_replace($r[0][0], $transferee_member, $str);

// 		                	if(count($previous_transfer_member_result) != 0)
// 		                	{
// 		                		$transfer_id_data = array();
// 		                		for($f = 0; $f < count($previous_transfer_member_result); $f++)
// 			                	{
// 			                		array_push($transfer_id_data, (int)$previous_transfer_member_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

		               
// 		                if($result[$r]["document_name"] == "Charge-Shorter notice of EGM" || $result[$r]["document_name"] == "Chargee-Attendance List")
// 		                {
// 		                	$charge_name_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_name_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");

// 		                	$charge_name_registration_result = $charge_name_registration_result->result_array();

// 		                	$previous_charge_name_registration_result = $previous_charge_name_registration_result->result_array();

// 		                	$latest_charge_id = array();

// 		                	for($g = 0; $g < count($charge_name_registration_result); $g++)
// 		                	{
// 		                		array_push($latest_charge_id, (int)$charge_name_registration_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	if(count($previous_charge_name_registration_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_name_registration_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_name_registration_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge name - registration}}</span>') !== false)
// 		                {
// 		                	$charge_name_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_name_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_name_registration_result = $charge_name_registration_result->result_array();

// 		                	$previous_charge_name_registration_result = $previous_charge_name_registration_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_name_registration = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_name_registration = (int)(count($charge_name_registration_result)) - 1;

// 		                	for($g = 0; $g < count($charge_name_registration_result); $g++)
// 		                	{

// 			                		if($g == 0)
// 			                		{
// 			                			$charge_name_registration = $charge_name_registration.$charge_name_registration_result[$g]["charge"];
// 			                		}
// 			                		elseif($g == (int)$num_of_charge_name_registration)
// 			                		{
// 			                			$charge_name_registration = $charge_name_registration.' and '.$charge_name_registration_result[$g]["charge"];
// 			                		}
// 			                		else
// 			                		{
// 			                			$charge_name_registration = $charge_name_registration.', '.$charge_name_registration_result[$g]["charge"];
// 			                		}
// 			                	//}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_name_registration_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                		$str = str_replace('<span class="myclass mceNonEditable">{{Charge name - registration}}</span>', $charge_name_registration, $str);

// */
// 		                	if(count($previous_charge_name_registration_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_name_registration_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_name_registration_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge name - satisfaction}}</span>') !== false)
// 		                {
// 		                	$charge_name_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_name_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_name_satisfaction_result = $charge_name_satisfaction_result->result_array();

// 		                	$previous_charge_name_satisfaction_result = $previous_charge_name_satisfaction_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_name_satisfaction = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_name_satisfaction = (int)(count($charge_name_satisfaction_result)) - 1;

// 		                	for($g = 0; $g < count($charge_name_satisfaction_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_name_satisfaction = $charge_name_satisfaction.$charge_name_satisfaction_result[$g]["charge"];
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_name_satisfaction)
// 		                		{
// 		                			$charge_name_satisfaction = $charge_name_satisfaction.' and '.$charge_name_satisfaction_result[$g]["charge"];
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_name_satisfaction = $charge_name_satisfaction.', '.$charge_name_satisfaction_result[$g]["charge"];
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_name_satisfaction_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge name - satisfaction}}</span>', $charge_name_satisfaction, $str);

// 		                	if(count($previous_charge_name_satisfaction_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_name_satisfaction_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_name_satisfaction_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge nature - registration}}</span>') !== false)
// 		                {
// 		                	$charge_nature_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_nature_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_nature_registration_result = $charge_nature_registration_result->result_array();

// 		                	$previous_charge_nature_registration_result = $previous_charge_nature_registration_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_nature_registration = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_nature_registration = (int)(count($charge_nature_registration_result)) - 1;

// 		                	for($g = 0; $g < count($charge_nature_registration_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_nature_registration = $charge_nature_registration.'<strong>'.$charge_nature_registration_result[$g]["nature_of_charge"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_nature_registration)
// 		                		{
// 		                			$charge_nature_registration = $charge_nature_registration.' and <strong>'.$charge_nature_registration_result[$g]["nature_of_charge"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_nature_registration = $charge_nature_registration.', <strong>'.$charge_nature_registration_result[$g]["nature_of_charge"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_nature_registration_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge nature - registration}}</span>', $charge_nature_registration, $str);

// 		                	if(count($previous_charge_nature_registration_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_nature_registration_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_nature_registration_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge nature - satisfaction}}</span>') !== false)
// 		                {
// 		                	$charge_nature_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_nature_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_nature_satisfaction_result = $charge_nature_satisfaction_result->result_array();

// 		                	$previous_charge_nature_satisfaction_result = $previous_charge_nature_satisfaction_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_nature_satisfaction = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_nature_satisfaction = (int)(count($charge_nature_satisfaction_result)) - 1;

// 		                	for($g = 0; $g < count($charge_nature_satisfaction_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_nature_satisfaction = $charge_nature_satisfaction.'<strong>'.$charge_nature_satisfaction_result[$g]["nature_of_charge"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_nature_satisfaction)
// 		                		{
// 		                			$charge_nature_satisfaction = $charge_nature_satisfaction.' and <strong>'.$charge_nature_satisfaction_result[$g]["nature_of_charge"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_nature_satisfaction = $charge_nature_satisfaction.', <strong>'.$charge_nature_satisfaction_result[$g]["nature_of_charge"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_nature_satisfaction_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge nature - satisfaction}}</span>', $charge_nature_satisfaction, $str);

// 		                	if(count($previous_charge_nature_satisfaction_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_nature_satisfaction_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_nature_satisfaction_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge registration number}}</span>') !== false)
// 		                {
// 		                	$charge_registration_number_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_registration_number_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_registration_number_result = $charge_registration_number_result->result_array();

// 		                	$previous_charge_registration_number_result = $previous_charge_registration_number_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_registration_number = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_registration_number = (int)(count($charge_registration_number_result)) - 1;

// 		                	for($g = 0; $g < count($charge_registration_number_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_registration_number = $charge_registration_number.'<strong>'.$charge_registration_number_result[$g]["charge_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_registration_number)
// 		                		{
// 		                			$charge_registration_number = $charge_registration_number.' and <strong>'.$charge_registration_number_result[$g]["charge_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_registration_number = $charge_registration_number.', <strong>'.$charge_registration_number_result[$g]["charge_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_registration_number_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge registration number}}</span>', $charge_registration_number, $str);

// 		                	if(count($previous_charge_registration_number_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_registration_number_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_registration_number_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge registration date}}</span>') !== false)
// 		                {
// 		                	$charge_registration_date_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_registration_date_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_registration_date_result = $charge_registration_date_result->result_array();

// 		                	$previous_charge_registration_date_result = $previous_charge_registration_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_registration_date = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_registration_date = (int)(count($charge_registration_date_result)) - 1;

// 		                	for($g = 0; $g < count($charge_registration_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_registration_date = $charge_registration_date.'<strong>'.$charge_registration_date_result[$g]["date_registration"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_registration_date)
// 		                		{
// 		                			$charge_registration_date = $charge_registration_date.' and <strong>'.$charge_registration_date_result[$g]["date_registration"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_registration_date = $charge_registration_date.', <strong>'.$charge_registration_date_result[$g]["date_registration"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_registration_date_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge registration date}}</span>', $charge_registration_date, $str);

// 		                	if(count($previous_charge_registration_date_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_registration_date_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_registration_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge satisfaction number}}</span>') !== false)
// 		                {
// 		                	$charge_satisfaction_number_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_satisfaction_number_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_satisfaction_number_result = $charge_satisfaction_number_result->result_array();

// 		                	$previous_charge_satisfaction_number_result = $previous_charge_satisfaction_number_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_satisfaction_number = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_satisfaction_number = (int)(count($charge_satisfaction_number_result)) - 1;

// 		                	for($g = 0; $g < count($charge_satisfaction_number_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_satisfaction_number = $charge_satisfaction_number.'<strong>'.$charge_satisfaction_number_result[$g]["satisfactory_no"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_satisfaction_number)
// 		                		{
// 		                			$charge_satisfaction_number = $charge_satisfaction_number.' and <strong>'.$charge_satisfaction_number_result[$g]["satisfactory_no"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_satisfaction_number = $charge_satisfaction_number.', <strong>'.$charge_satisfaction_number_result[$g]["satisfactory_no"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_satisfaction_number_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge satisfaction number}}</span>', $charge_satisfaction_number, $str);

// 		                	if(count($previous_charge_satisfaction_number_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_satisfaction_number_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_satisfaction_number_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge satisfaction date}}</span>') !== false)
// 		                {
// 		                	$charge_satisfaction_date_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_satisfaction_date_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_satisfaction_date_result = $charge_satisfaction_date_result->result_array();

// 		                	$previous_charge_satisfaction_date_result = $previous_charge_satisfaction_date_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_satisfaction_date = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_satisfaction_date = (int)(count($charge_satisfaction_date_result)) - 1;

// 		                	for($g = 0; $g < count($charge_satisfaction_date_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_satisfaction_date = $charge_satisfaction_date.'<strong>'.$charge_satisfaction_date_result[$g]["date_satisfied"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_satisfaction_date)
// 		                		{
// 		                			$charge_satisfaction_date = $charge_satisfaction_date.' and <strong>'.$charge_satisfaction_date_result[$g]["date_satisfied"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_satisfaction_date = $charge_satisfaction_date.', <strong>'.$charge_satisfaction_date_result[$g]["date_satisfied"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_satisfaction_date_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge satisfaction date}}</span>', $charge_satisfaction_date, $str);

// 		                	if(count($previous_charge_satisfaction_date_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_satisfaction_date_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_satisfaction_date_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge currency - registration}}</span>') !== false)
// 		                {
// 		                	$charge_currency_registration_result = $this->db->query("select client_charges.*, currency.currency as currency_name from client_charges left join currency on currency.id = client_charges.currency where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_currency_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_currency_registration_result = $charge_currency_registration_result->result_array();

// 		                	$previous_charge_currency_registration_result = $previous_charge_currency_registration_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_currency_registration = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_currency_registration = (int)(count($charge_currency_registration_result)) - 1;

// 		                	for($g = 0; $g < count($charge_currency_registration_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_currency_registration = $charge_currency_registration.'<strong>'.$charge_currency_registration_result[$g]["currency_name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_currency_registration)
// 		                		{
// 		                			$charge_currency_registration = $charge_currency_registration.' and <strong>'.$charge_currency_registration_result[$g]["currency_name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_currency_registration = $charge_currency_registration.', <strong>'.$charge_currency_registration_result[$g]["currency_name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_currency_registration_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge currency - registration}}</span>', $charge_currency_registration, $str);

// 		                	if(count($previous_charge_currency_registration_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_currency_registration_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_currency_registration_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge currency - satisfaction}}</span>') !== false)
// 		                {
// 		                	$charge_currency_satisfaction_result = $this->db->query("select client_charges.*, currency.currency as currency_name from client_charges left join currency on currency.id = client_charges.currency where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_currency_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_currency_satisfaction_result = $charge_currency_satisfaction_result->result_array();

// 		                	$previous_charge_currency_satisfaction_result = $previous_charge_currency_satisfaction_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_currency_satisfaction = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_currency_satisfaction = (int)(count($charge_currency_satisfaction_result)) - 1;

// 		                	for($g = 0; $g < count($charge_currency_satisfaction_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_currency_satisfaction = $charge_currency_satisfaction.'<strong>'.$charge_currency_satisfaction_result[$g]["currency_namecurrency_name"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_currency_satisfaction)
// 		                		{
// 		                			$charge_currency_satisfaction = $charge_currency_satisfaction.' and <strong>'.$charge_currency_satisfaction_result[$g]["currency_namecurrency_name"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_currency_satisfaction = $charge_currency_satisfaction.', <strong>'.$charge_currency_satisfaction_result[$g]["currency_namecurrency_name"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_currency_satisfaction_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge currency - satisfaction}}</span>', $charge_currency_satisfaction, $str);

// 		                	if(count($previous_charge_currency_satisfaction_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_currency_satisfaction_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_currency_satisfaction_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge amount - registration}}</span>') !== false)
// 		                {
// 		                	$charge_amount_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_amount_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_amount_registration_result = $charge_amount_registration_result->result_array();

// 		                	$previous_charge_amount_registration_result = $previous_charge_amount_registration_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_amount_registration = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_amount_registration = (int)(count($charge_amount_registration_result)) - 1;

// 		                	for($g = 0; $g < count($charge_amount_registration_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_amount_registration = $charge_amount_registration.'<strong>'.number_format($charge_amount_registration_result[$g]["amount"], 2).'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_amount_registration)
// 		                		{
// 		                			$charge_amount_registration = $charge_amount_registration.' and <strong>'.number_format($charge_amount_registration_result[$g]["amount"], 2).'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_amount_registration = $charge_amount_registration.', <strong>'.number_format($charge_amount_registration_result[$g]["amount"], 2).'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_amount_registration_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge amount - registration}}</span>', $charge_amount_registration, $str);

// 		                	if(count($previous_charge_amount_registration_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_amount_registration_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_amount_registration_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge amount - satisfaction}}</span>') !== false)
// 		                {
// 		                	$charge_amount_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_amount_currency_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_amount_satisfaction_result = $charge_amount_satisfaction_result->result_array();

// 		                	$previous_amount_currency_satisfaction_result = $previous_amount_currency_satisfaction_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_amount_satisfaction = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_amount_satisfaction = (int)(count($charge_amount_satisfaction_result)) - 1;

// 		                	for($g = 0; $g < count($charge_amount_satisfaction_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_amount_satisfaction = $charge_amount_satisfaction.'<strong>'.number_format($charge_amount_satisfaction_result[$g]["amount"], 2).'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_amount_satisfaction)
// 		                		{
// 		                			$charge_amount_satisfaction = $charge_amount_satisfaction.' and <strong>'.number_format($charge_amount_satisfaction_result[$g]["amount"], 2).'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_amount_satisfaction = $charge_amount_satisfaction.', <strong>'.number_format($charge_amount_satisfaction_result[$g]["amount"], 2).'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_amount_satisfaction_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge amount - satisfaction}}</span>', $charge_amount_satisfaction, $str);

// 		                	if(count($previous_amount_currency_satisfaction_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_amount_currency_satisfaction_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_amount_currency_satisfaction_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge security - registration}}</span>') !== false)
// 		                {
// 		                	$charge_security_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_security_registration_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_security_registration_result = $charge_security_registration_result->result_array();

// 		                	$previous_charge_security_registration_result = $previous_charge_security_registration_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_security_registration = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_security_registration = (int)(count($charge_security_registration_result)) - 1;

// 		                	for($g = 0; $g < count($charge_security_registration_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_security_registration = $charge_security_registration.'<strong>'.$charge_security_registration_result[$g]["secured_by"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_security_registration)
// 		                		{
// 		                			$charge_security_registration = $charge_security_registration.' and <strong>'.$charge_security_registration_result[$g]["secured_by"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_security_registration = $charge_security_registration.', <strong>'.$charge_security_registration_result[$g]["secured_by"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_security_registration_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge security - registration}}</span>', $charge_security_registration, $str);

// 		                	if(count($previous_charge_security_registration_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_security_registration_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_security_registration_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge security - satisfaction}}</span>') !== false)
// 		                {
// 		                	$charge_security_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') ORDER BY client_charges.id");

// 		                	$previous_charge_security_satisfaction_result = $this->db->query("select * from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') AND id != '".$charge_id."' ORDER BY client_charges.id");
// 		                	//echo json_encode($previous_director_name_appointment_result);
// 		                	$charge_security_satisfaction_result = $charge_security_satisfaction_result->result_array();

// 		                	$previous_charge_security_satisfaction_result = $previous_charge_security_satisfaction_result->result_array();
// 		                	//echo json_encode($director_name_result);

// 		                	$charge_security_satisfaction = "";

// 		                	$latest_charge_id = array();
// 		                	$num_of_charge_security_satisfaction = (int)(count($charge_security_satisfaction_result)) - 1;

// 		                	for($g = 0; $g < count($charge_security_satisfaction_result); $g++)
// 		                	{
// 		                		if($g == 0)
// 		                		{
// 		                			$charge_security_satisfaction = $charge_security_satisfaction.'<strong>'.$charge_security_satisfaction_result[$g]["secured_by"].'</strong>';
// 		                		}
// 		                		elseif($g == (int)$num_of_charge_security_satisfaction)
// 		                		{
// 		                			$charge_security_satisfaction = $charge_security_satisfaction.' and <strong>'.$charge_security_satisfaction_result[$g]["secured_by"].'</strong>';
// 		                		}
// 		                		else
// 		                		{
// 		                			$charge_security_satisfaction = $charge_security_satisfaction.', <strong>'.$charge_security_satisfaction_result[$g]["secured_by"].'</strong>';
// 		                		}
		                		
// 		                		array_push($latest_charge_id, (int)$charge_security_satisfaction_result[$g]["id"]);
// 		                	}

// 		                	$data['charge_id']=json_encode($latest_charge_id);

// 		                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge security - satisfaction}}</span>', $charge_security_satisfaction, $str);

// 		                	if(count($previous_charge_security_satisfaction_result) != 0)
// 		                	{
// 		                		$charge_id_data = array();
// 		                		for($f = 0; $f < count($previous_charge_security_satisfaction_result); $f++)
// 			                	{
// 			                		array_push($charge_id_data, (int)$previous_charge_security_satisfaction_result[$f]["id"]);
// 			                	}
// 		                	}
// 		                	//echo json_encode($officer_id_data);
// 		                }

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Year end new}}</span>') !== false)
// 						{
// 							$year_end_result = $this->db->query("select year_end from filing where id='".$filing_id."'");
		                	
// 		                	if ($year_end_result->num_rows() > 0) {

// 			                	$year_end_result = $year_end_result->result_array();

// 			                	//$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));

// 								$str = str_replace('<span class="myclass mceNonEditable">{{Year end new}}</span>', $year_end_result[0]["year_end"], $str);
// 							}
// 						}

// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Year end old}}</span>') !== false)
// 						{
// 							$history_year_end_result = $this->db->query("select year_end from history_filing where id='".$filing_id."'");
		                	
// 		                	if ($history_year_end_result->num_rows() > 0) {

// 			                	$history_year_end_result = $history_year_end_result->result_array();

// 			                	//$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));

// 								$str = str_replace('<span class="myclass mceNonEditable">{{Year end old}}</span>', $history_year_end_result[0]["year_end"], $str);
// 							}
// 						}

// 	                	if(strpos($str, '<span class="myclass mceNonEditable">{{AGM date}}</span>') !== false)
// 						{
		                	
// 		                	$agm_date_result = $this->db->query("select year_end, agm, due_date_175, 175_extended_to, due_date_201, 201_extended_to from filing where company_code='".$company_code."'ORDER BY id DESC LIMIT 1,1");
		                	
// 		                	if ($agm_date_result->num_rows() > 0) {

// 			                	$agm_date_result = $agm_date_result->result_array();

// 			                	//echo json_encode($agm_date_result);
// 			                	//$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));

// 								$str = str_replace('<span class="myclass mceNonEditable">{{AGM date}}</span>', $agm_date_result[0]["agm"], $str);
// 							}
// 						}

// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Due date S175}}</span>') !== false)
// 						{
		                	
// 		                	$due_date_S175_result = $this->db->query("select year_end, agm, due_date_175, 175_extended_to, due_date_201, 201_extended_to from filing where agm = '' AND company_code='".$company_code."'");

// 		                	//echo json_encode($due_date_S175_result->result_array());
// 		                	if ($due_date_S175_result->num_rows() > 0) {

// 			                	$due_date_S175_result = $due_date_S175_result->result_array();

// 			                	//$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));
// 			                	if($due_date_S175_result[0]["175_extended_to"] != "" && $due_date_S175_result[0]["175_extended_to"] != '0')
// 			                	{
// 			                		$str = str_replace('<span class="myclass mceNonEditable">{{Due date S175}}</span>', $due_date_S175_result[0]["175_extended_to"], $str);
// 			                	}
// 			                	else 
// 			                	{
// 			                		$str = str_replace('<span class="myclass mceNonEditable">{{Due date S175}}</span>', $due_date_S175_result[0]["due_date_175"], $str);
// 			                	}
								
// 							}
// 						}

// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Due date S201}}</span>') !== false)
// 						{
		                	
// 		                	$due_date_S201_result = $this->db->query("select year_end, agm, due_date_175, 175_extended_to, due_date_201, 201_extended_to from filing where agm = '' AND company_code='".$company_code."'");

// 		                	//echo json_encode($due_date_S175_result->result_array());
// 		                	if ($due_date_S201_result->num_rows() > 0) {

// 			                	$due_date_S201_result = $due_date_S201_result->result_array();

// 			                	//$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));
// 			                	if($due_date_S201_result[0]["201_extended_to"] != "" && $due_date_S201_result[0]["201_extended_to"] != '0')
// 			                	{
// 			                		$str = str_replace('<span class="myclass mceNonEditable">{{Due date S201}}</span>', $due_date_S201_result[0]["201_extended_to"], $str);
// 			                	}
// 			                	else 
// 			                	{
// 			                		$str = str_replace('<span class="myclass mceNonEditable">{{Due date S201}}</span>', $due_date_S201_result[0]["due_date_201"], $str);
// 			                	}
								
// 							}
// 						}

// 		                if(strpos($str, '<span class="myclass mceNonEditable">{{Chairman}}</span>') !== false)
// 						{
// 							$chairman_result = $this->db->query("select chairman from client_signing_info where company_code='".$company_code."'");
		                	
// 		                	if ($chairman_result->num_rows() > 0) {

// 			                	$chairman_result = $chairman_result->result_array();

// 			                	$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));

// 			                	if($chairman_result_info[1] == "individual")
// 			                	{
// 			                		$officer_result = $this->db->query("select * from officer where id='".$chairman_result_info[0]."' AND field_type='".$chairman_result_info[1]."'");

// 			                		$officer_result = $officer_result->result_array();

// 			                		$name = $officer_result[0]["name"];
// 			                	}
// 			                	elseif($chairman_result_info[1] == "company")
// 			                	{
// 			                		$officer_company_result = $this->db->query("select * from officer_company where id='".$chairman_result_info[0]."' AND field_type='".$chairman_result_info[1]."'");

// 			                		$officer_company_result = $officer_company_result->result_array();

// 			                		$name = $officer_company_result[0]["company_name"];
// 			                	}

// 								$str = str_replace('<span class="myclass mceNonEditable">{{Chairman}}</span>', $name, $str);
// 							}
// 						}

// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Signing director}}</span>') !== false)
// 						{
// 							$chairman_result = $this->db->query("select director_signature_1, director_signature_2 from client_signing_info where company_code='".$company_code."'");
		                	
// 		                	if ($chairman_result->num_rows() > 0) 
// 		                	{

// 			                	$chairman_result = $chairman_result->result_array();

// 			                	if($chairman_result[0]["director_signature_1"] != 0)
// 			                	{
// 			                		$client_officers_result = $this->db->query("select client_officers.officer_id, client_officers.field_type, officer.name from client_officers left join officer on officer.id = client_officers.officer_id where client_officers.id='".$chairman_result[0]["director_signature_1"]."'");

// 			                		$client_officers_result = $client_officers_result->result_array();

// 			                		$officer_name = $client_officers_result [0]["name"];
// 			                	}
// 			                	else
// 			                	{
// 			                		$officer_name = "";
// 			                	}

// 			                	if($chairman_result[0]["director_signature_2"] != 0)
// 			                	{
// 			                		$client_officers_result = $this->db->query("select client_officers.officer_id, client_officers.field_type, officer.name from client_officers left join officer on officer.id = client_officers.officer_id where client_officers.id='".$chairman_result[0]["director_signature_2"]."'");

// 			                		$client_officers_result = $client_officers_result->result_array();

// 			                		$officer_name = $officer_name.' and '.$client_officers_result [0]["name"];
// 			                	}
// 			                	else
// 			                	{
// 			                		$officer_name = $officer_name;
// 			                	}

// 			                	$str = str_replace('<span class="myclass mceNonEditable">{{Signing director}}</span>', $officer_name, $str);
// 			                }
// 						}

// 						if(strpos($str, '<span class="myclass mceNonEditable">{{Retiring director}}</span>') !== false)
// 						{
// 							$client_officers_retiring_result = $this->db->query("select client_officers.officer_id, client_officers.field_type, officer.name from client_officers left join officer on officer.id = client_officers.officer_id where client_officers.retiring='1'");

// 							if ($client_officers_retiring_result->num_rows() > 0) 
// 		                	{	
// 		                		$client_officers_retiring_result = $client_officers_retiring_result->result_array();

// 		                		$client_officers_retiring_name = "";

// 		                		$num_of_client_officers_retiring_result = (int)(count($client_officers_retiring_result)) - 1;

// 			                	for($g = 0; $g < count($client_officers_retiring_result); $g++)
// 			                	{
// 			                		if($g == 0)
// 			                		{
// 			                			$client_officers_retiring_name = $client_officers_retiring_name.''.$client_officers_retiring_result[$g]["name"].'';
// 			                		}
// 			                		elseif($g == (int)$num_of_client_officers_retiring_result)
// 			                		{
// 			                			$client_officers_retiring_name = $client_officers_retiring_name.' and '.$client_officers_retiring_result[$g]["name"].'';
// 			                		}
// 			                		else
// 			                		{
// 			                			$client_officers_retiring_name = $client_officers_retiring_name.', '.$client_officers_retiring_result[$g]["name"].'';
// 			                		}

// 			                	}

// 			                	$str = str_replace('<span class="myclass mceNonEditable">{{Retiring director}}</span>', $client_officers_retiring_name, $str);
// 		                	}
// 						}

// 		                $data['content'] = $str;
// 		            }
// 	                $data['created_by']=$this->session->userdata('user_id');
// 	           		//echo json_encode($officer_id_data);
// 	           		if($officer_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "officer_id" => json_encode($officer_id_data), "transaction_date" => $data['transaction_date'], "document_name" => $data['document_name']));
	           			
// 	           		}
// 	           		elseif($controller_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "controller_id" => $controller_id, "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($allotment_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "allotment_id" =>json_encode($allotment_id_data), "transaction_date" => $data['transaction_date'], "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($buyback_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "buyback_id" =>json_encode($buyback_id_data), "transaction_date" => $data['transaction_date'], "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($transfer_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "transfer_id" =>json_encode($transfer_id_data), "transaction_date" => $data['transaction_date'], "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($charge_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "charge_id" =>  json_encode($charge_id_data), "transaction_date" => $data['transaction_date'], "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($filing_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "filing_id" => $filing_id, "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($guarantee_id != null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "guarantee_id" => $guarantee_id, "document_name" => $data['document_name']));
// 	           		}
// 	           		elseif($officer_id == null && $controller_id == null && $allotment_id == null && $buyback_id == null && $transfer_id == null && $charge_id == null && $filing_id == null && $guarantee_id == null)
// 	           		{
// 	           			$q = $this->db->get_where("pending_documents", array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "document_name" => $data['document_name']));
// 	           		}
	           		

// 	                if (!$q->num_rows() || $type == "agm_held" || $type == "add_new_class_of_share" || $type == "add_buyback_of_share" || $type == "add_transfer_of_share" || $type == "add_guarantee" || $type == "dispense_agm")
// 	                {        
// 	                	if($type == "add_allotment_of_share")
// 						{
// 							$check_allot_data = $this->db->get_where("pending_documents", array("allotment_id" => $data['allotment_id'], "document_name" => $data['document_name']));

// 							if (!$check_allot_data->num_rows())
// 							{
// 								$this->db->insert("pending_documents",$data);
// 							}
// 						}  
// 						elseif($type == "add_buyback_of_share")
// 						{
// 							$check_buyback_data = $this->db->get_where("pending_documents", array("buyback_id" => $data['buyback_id'], "document_name" => $data['document_name']));

// 							if (!$check_buyback_data->num_rows())
// 							{
// 								$this->db->insert("pending_documents",$data);
// 							}
// 						}  
// 						elseif($type == "add_transfer_of_share")
// 						{
// 							$check_transfer_data = $this->db->get_where("pending_documents", array("transfer_id" => $data['transfer_id'], "document_name" => $data['document_name']));

// 							if (!$check_transfer_data->num_rows())
// 							{
// 								$this->db->insert("pending_documents",$data);
// 							}
// 						}     
// 						else
// 						{
// 							$this->db->insert("pending_documents",$data);
// 						}  
	                    
// 	                    /*$insert_client_charge_id = $this->db->insert_id();
// 	                    $this->create_invoice("change_charges", $_POST["company_code"]);*/
// 	                } 
// 	                else 
// 	                {   
// 	                	if($officer_id != null)
// 		           		{
// 		           			//echo json_encode($officer_id_data);
// 		           			$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "officer_id" => json_encode($officer_id_data), "document_name" => $data['document_name']));  
// 		           		}
// 		           		elseif($controller_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "controller_id" => $controller_id, "document_name" => $data['document_name'])); 
// 	           			}
// 	           			elseif($allotment_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "allotment_id" => json_encode($allotment_id_data), "document_name" => $data['document_name'])); 
// 	           			}
// 	           			elseif($buyback_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "buyback_id" => json_encode($buyback_id_data), "document_name" => $data['document_name'])); 
// 	           			}
// 	           			elseif($transfer_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "transfer_id" => json_encode($transfer_id_data), "document_name" => $data['document_name'])); 
// 	           			}
// 	           			elseif($charge_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "charge_id" => json_encode($charge_id_data), "document_name" => $data['document_name'])); 
// 	           			}
// 	           			elseif($filing_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "filing_id" => $filing_id)); 
// 	           			}
// 	           			elseif($guarantee_id != null)
// 	           			{
// 	           				$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => "", "guarantee_id" => $guarantee_id)); 
// 	           			}
// 		           		elseif($officer_id == null && $controller_id == null && $allotment_id == null && $buyback_id == null && $transfer_id == null && $charge_id == null && $filing_id == null && $guarantee_id == null)
// 		           		{
// 		           			$this->db->update("pending_documents",$data,array("triggered_by" => $result[$r]["triggered_by"], "client_id" => $get_client[0]["id"], "received_on" => ""));  
// 		           		}
	                       
// 	                }

// 				}
// 			}
// 		}

// 	}
//-------------------------------------------create_document_end------------------------------------------------------//
	public function create_invoice($type, $company_code, $position_id = null)
	{
		//$type = "change_charges";
		if($type == "change_address")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 3 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "change_charges")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 7 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "change_company_name")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 8 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "change_director")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 4 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "change_secretary")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 6 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "change_auditor") 
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 5 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "share_allotment")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 9 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "share_transfer")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 10 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "share_buyback")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 11 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}
		elseif($type == "newly_incorporated")
		{
			$result = $this->db->query("select client_billing_info.* from client_billing_info left join client on client.company_code = client_billing_info.company_code where client_billing_info.service = 12 AND client_billing_info.company_code='".$company_code."' AND client.auto_generate = 1");
		}

		$result = $result->result_array();
		//echo json_encode($result);
		if($result) 
		{
			//echo json_encode($result[0]['service']);
			$now = getDate();

			$current_date = DATE("Y-m-d",now());

			$billing_result = $this->db->query("select * from billing where date_format(created_at, '%Y-%m-%d') = '".$current_date."' AND company_code='".$company_code."' AND outstanding != 0.00 AND status != 1");

			$billing_result = $billing_result->result_array();

			$client = $this->db->query("select * from client where company_code='".$company_code."'");

			$client = $client->result_array();

			$firm = $this->db->query("select * from firm where id = '".$client[0]["firm_id"]."'");

			$firm = $firm->result_array();

			if($firm[0]["gst_checkbox"] == 1)
			{
				if($firm[0]["gst_date"] != null)
				{
					$array = explode('/', $firm[0]["gst_date"]);
					$tmp = $array[0];
					$array[0] = $array[1];
					$array[1] = $tmp;
					unset($tmp);
					$gst_date = implode('/', $array);
					$time = strtotime($gst_date);
					$gst_date = date('Y-m-d',$time);
                	$gst_date = strtotime($gst_date);
				}

				if($firm[0]["previous_gst_date"] != null)
				{
					$array = explode('/', $firm[0]["previous_gst_date"]);
					$tmp = $array[0];
					$array[0] = $array[1];
					$array[1] = $tmp;
					unset($tmp);
					$previous_gst_date = implode('/', $array);
					$time = strtotime($previous_gst_date);
					$previous_gst_date = date('Y-m-d',$time);
                	$previous_gst_date = strtotime($gst_date);
				}

				//echo json_encode($previous_gst_date > $gst_date);
				$invoice_date = DATE("Y-m-d",now());
				$invoice_date = strtotime($invoice_date);

				if($previous_gst_date == null && $gst_date != null)
				{
					if($invoice_date >= $gst_date)
					{
						$billing_service['gst_rate'] = $firm[0]["gst"];
					}
					else
					{
						$billing_service['gst_rate'] = 0;
					}
				}
				else
				{
					if($previous_gst_date == $gst_date)
					{
						$billing_service['gst_rate'] = $firm[0]["gst"];
					}
					else if($previous_gst_date > $gst_date)
					{
						if($previous_gst_date > $invoice_date && $invoice_date >= $gst_date)
						{
							$billing_service['gst_rate'] = $firm[0]["gst"];
						}
						else if($invoice_date >= $previous_gst_date)
						{
							$billing_service['gst_rate'] = $firm[0]["previous_gst"];
						}
						else
						{
							$billing_service['gst_rate'] = 0;
						}
					}
					else if($gst_date > $previous_gst_date)
					{
						if($gst_date > $invoice_date && $invoice_date >= $previous_gst_date)
						{
							$billing_service['gst_rate'] = $firm[0]["previous_gst"];
						}
						else if($invoice_date >= $gst_date)
						{
							$billing_service['gst_rate'] = $firm[0]["gst"];
						}
						else
						{
							$billing_service['gst_rate'] = 0;
						}
					}
				}
				
			}
			else
			{
				$billing_service['gst_rate'] = 0;
			}
			
			if($billing_result)
			{
				$billing['amount'] = $billing_result[0]['amount'] + ((1+($billing_service['gst_rate'] / 100)) * $result[0]['amount']);
				$billing['outstanding'] = $billing_result[0]['outstanding'] + ((1+($billing_service['gst_rate'] / 100)) * $result[0]['amount']);

				$this->db->update("billing",$billing,array("id" => $billing_result[0]['id']));


				$billing_service['billing_id'] = $billing_result[0]['id'];
			}
			else
			{
				//$num_row_billing_table = $this->db->query("select COUNT(*) from billing where company_code='".$company_code."'");
				//echo json_encode($num_row_billing_table->result_array());

				// $query_invoice_no = $this->db->query("SELECT invoice_no FROM billing where id = (SELECT max(id) FROM billing where status = '0' and firm_id = '".$this->session->userdata('firm_id')."')");
		        //$id = $query->row()->id;

		        $query_invoice_no = $this->db->query("select id, invoice_no, MAX(CAST(SUBSTRING(invoice_no, -4) AS UNSIGNED)) as latest_invoice_no from billing where status = '0' and firm_id = '".$this->session->userdata('firm_id')."' GROUP BY invoice_no ORDER BY latest_invoice_no DESC LIMIT 1");

		        if ($query_invoice_no->num_rows() > 0) 
		        {
		            $query_invoice_no = $query_invoice_no->result_array();

		            // $last_section_invoice_no = (int)$query_invoice_no[0]["invoice_no"] + 1;
		            // $number = "AB-".date("Y")."-".str_pad($last_section_invoice_no,4,"0",STR_PAD_LEFT);

		            $last_section_invoice_no = (string)$query_invoice_no[0]["invoice_no"];
		            //echo (substr_replace($last_section_invoice_no, "", -1));
		            //$number = substr_replace($last_section_invoice_no, "", -1).((int)($last_section_invoice_no[strlen($last_section_invoice_no)-1]) + 1);
		            $number = substr_replace($last_section_invoice_no, "", -4).(str_pad((int)(substr($last_section_invoice_no, -4)) + 1, 4, '0', STR_PAD_LEFT));

		        }
		        else
                {
                    $number = "AB-".date("Y")."-".str_pad(1,4,"0",STR_PAD_LEFT);
                }

				// $query_invoice_no = $this->db->query("select MAX(CAST(SUBSTRING(invoice_no,10, length(invoice_no)-9) AS UNSIGNED)) as invoice_no from billing");

    //             //echo json_encode($query_test);

    //             if ($query_invoice_no->num_rows() > 0) 
    //             {
    //                 $query_invoice_no = $query_invoice_no->result_array();
    //                 //$array_invoice_no = explode('-', $query_invoice_no[0]["invoice_no"]);
    //         		$last_section_invoice_no = (int)$query_invoice_no[0]["invoice_no"] + 1;
    //                 $number = date("Y")."-ABC-".$last_section_invoice_no;

    //             }
    //             else
    //             {
    //                 $number = date("Y")."-ABC-1";
    //             }
				/*$number = sprintf('%02d', $now[0]);
				$number = 'INV - '.$number;*/
				$billing['firm_id'] = $client[0]["firm_id"];
				$billing['invoice_no'] = $number;
				$billing['currency_id'] = 1;
				$billing['company_code'] = $company_code;
				$billing['invoice_date'] = DATE("d/m/Y",now());
				$billing['rate'] = 1.0000;
				$billing['amount'] = ((1+($billing_service['gst_rate'] / 100)) * $result[0]['amount']);
				$billing['outstanding'] = ((1+($billing_service['gst_rate'] / 100)) * $result[0]['amount']);

				//$billing_service['client_billing_info_id'] = $result[0]['client_billing_info_id'];

				$this->db->insert("billing",$billing);
				$billing_service['billing_id'] = $this->db->insert_id();

				

			}
			$billing_service['service'] = $result[0]['service'];
			$billing_service['invoice_date'] = DATE("d/m/Y",now());
			//$billing_service['client_billing_info_id'] = $result[0]['client_billing_info_id'];
			$billing_service['invoice_description'] = $result[0]['invoice_description'];
			$billing_service['amount'] = $result[0]['amount'];

			$this->db->insert("billing_service",$billing_service);
			

			//echo true;

		}
	}

	public function save_capital(){
		$unique_code = $_POST['unique_code'];
		$issued_amount_member = $_POST['issued_amount_member'];
		$no_of_share_member = $_POST['no_of_share_member'];
		$issued_currency_member = $_POST['issued_currency_member'];
		$issued_sharetype_member = $_POST['issued_sharetype_member'];
		// echo count($issued_amount_member);
		
				$this->db->delete("issued_sharetype",array("unique_code" => $unique_code));
		for ($i=0;$i<count($issued_amount_member);$i++)
		{
			$issued_sharetype = [];
			$issued_sharetype['unique_code'] = $unique_code;
			$issued_sharetype['issued_amount_member'] = $this->sma->remove_comma($issued_amount_member[$i]);
			$issued_sharetype['no_of_share_member'] = $this->sma->remove_comma($no_of_share_member[$i]);
			$issued_sharetype['issued_currency_member'] = $issued_currency_member[$i];
			$issued_sharetype['issued_sharetype_member'] = $issued_sharetype_member[$i];
			// print_r($issued_sharetype);
			// $q = $this->db->get_where("issued_sharetype", array("unique_code" => $unique_code, "issued_amount_member" => $issued_amount_member[$i],"no_of_share_member" => $no_of_share_member[$i],"issued_currency_member" => $issued_currency_member[$i]));
			// if (!$q->num_rows())
			// {
				$this->db->insert("issued_sharetype",$issued_sharetype);
			// } else {
				// $this->db->update("issued_sharetype",$issued_sharetype,array("unique_code" => $unique_code, "issued_amount_member" => $issued_sharetype['issued_amount_member'],"no_of_share_member" => $issued_sharetype['no_of_share_member'],"issued_currency_member" => $issued_currency_member[$i]));
			// }
		}
		$paid_share= '';
		$paid_amount_member = $_POST['paid_amount_member'];
		$paid_no_of_share_member = $_POST['paid_no_of_share_member'];
		$paid_currency_member = $_POST['paid_currency_member'];
		$paid_sharetype_member = $_POST['paid_sharetype_member'];
				$this->db->delete("paid_share",array("unique_code" => $unique_code));
		for ($i=0;$i<count($paid_amount_member);$i++)
		{
			$paid_share = [];
			$paid_share['unique_code'] = $unique_code;
			$paid_share['paid_amount_member'] = $this->sma->remove_comma($paid_amount_member[$i]);
			$paid_share['paid_no_of_share_member'] = $this->sma->remove_comma($paid_no_of_share_member[$i]);
			$paid_share['paid_currency_member'] = $paid_currency_member[$i];
			$paid_share['paid_sharetype_member'] = $paid_sharetype_member[$i];
			// $q = $this->db->get_where("paid_share", array("unique_code" => $unique_code, "paid_amount_member" => $paid_share['paid_amount_member'],"paid_no_of_share_member" => $paid_share['paid_no_of_share_member'],"paid_currency_member" => $paid_currency_member[$i]));
			// if (!$q->num_rows())
			// {
				$this->db->insert("paid_share",$paid_share);
			// } else {
				// $this->db->update("paid_share",$paid_share,array("unique_code" => $unique_code, "paid_amount_member" => $paid_share['paid_amount_member'],"paid_no_of_share_member" => $paid_share['paid_no_of_share_member'],"paid_currency_member" => $paid_currency_member[$i]));
			// }
		}
		$member_capital= '';
		$nama_member_capital = $_POST['nama_member_capital'];
		$sharetype_member = $_POST['sharetype_member'];
		$shares_member_capital = $_POST['shares_member_capital'];
		$no_share_paid_member_capital = $_POST['no_share_paid_member_capital'];
		$gid_member_capital = $_POST['gid_member_capital'];
		$currency_member_capital = $_POST['currency_member_capital'];
		$amount_share_member_capital = $_POST['amount_share_member_capital'];
		$amount_share_paid_member_capital = $_POST['amount_share_paid_member_capital'];
				$this->db->delete("member_capital",array("unique_code" => $unique_code));
		for ($i=0;$i<count($nama_member_capital);$i++)
		{
			$member_capital = [];
			$member_capital['unique_code'] = $unique_code;
			$member_capital['nama_member_capital'] = $nama_member_capital[$i];
			$member_capital['sharetype_member'] = $sharetype_member[$i];
			$member_capital['shares_member_capital'] = $this->sma->remove_comma($shares_member_capital[$i]);
			$member_capital['no_share_paid_member_capital'] = $this->sma->remove_comma($no_share_paid_member_capital[$i]);
			$member_capital['gid_member_capital'] = $gid_member_capital[$i];
			$member_capital['currency_member_capital'] = $currency_member_capital[$i];
			$member_capital['amount_share_member_capital'] = $this->sma->remove_comma($amount_share_member_capital[$i]);
			$member_capital['amount_share_paid_member_capital'] = $this->sma->remove_comma($amount_share_paid_member_capital[$i]);
			// $q = $this->db->get_where("member_capital", array("unique_code" => $unique_code, "nama_member_capital" => $nama_member_capital[$i]));
			// if (!$q->num_rows())
			$pho = '';
            if ($_FILES['upload_certificate'.($i+1)]['size'] > 0) {
				$config['upload_path'] = './uploads/';
				$config['allowed_types'] = 'gif|jpg|png|pdf';
				// $config['max_size']     = '100000';
				// $config['max_width'] = '1024';
				// $config['max_height'] = '768';

				$this->load->library('upload', $config);

				// Alternately you can set preferences by calling the ``initialize()`` method. Useful if you auto-load the class:
				$this->upload->initialize($config);
				// print_r($this->upload->do_upload('upload_certificate'.($i+1)));
                if ($this->upload->do_upload("upload_certificate".($i+1)))
				{
					$pho=$this->upload->file_name;
				}
				$error = $this->upload->display_errors();
			}
				// print_r($pho);
				// print_r($error);
				// print_r($_FILES);
			if ($pho != '') $member_capital['certificate']=$pho;
			// {
				$this->db->insert("member_capital",$member_capital);
			// } else {
				// $this->db->update("member_capital",$member_capital,array("unique_code" => $unique_code, "nama_member_capital" => $nama_member_capital[$i]));
			// }
		}
		// $this->sma->print_arrays($member_capital);
        redirect("masterclient");
	}
	public function save_charges(){
		// $chargee= '';
		$unique_code = $_POST['unique_code'];
		$chargee_name = $_POST['chargee_name'];
		$chargee_nature_of = $_POST['chargee_nature_of'];
		$chargee_date_reg = $_POST['chargee_date_reg'];
		$chargee_no = $_POST['chargee_no'];
		$chargee_currency = $_POST['chargee_currency'];
		$chargee_amount = $_POST['chargee_amount'];
		$chargee_date_satisfied = $_POST['chargee_date_satisfied'];
		$chargee_satisfied_no = $_POST['chargee_satisfied_no'];
		$amount_share_paid_member_capital = $_POST['amount_share_paid_member_capital'];	
		$this->db->delete("chargee",array("unique_code" => $unique_code));
			
		for ($i=0;$i<count($chargee_name);$i++)
		{
			$chargee = [];
			$chargee['unique_code'] = $unique_code;
			$chargee['chargee_name'] = $chargee_name[$i];
			$chargee['chargee_nature_of'] = $chargee_nature_of[$i];
			$chargee['chargee_date_reg'] = $chargee_date_reg[$i];
			$chargee['chargee_no'] = $chargee_no[$i];
			$chargee['chargee_currency'] = $chargee_currency[$i];
			$chargee['chargee_amount'] = $chargee_amount[$i];
			$chargee['chargee_date_satisfied'] = $chargee_date_satisfied[$i];
			$chargee['chargee_satisfied_no'] = $chargee_satisfied_no[$i];
			// $q = $this->db->get_where("chargee", array("unique_code" => $unique_code, "chargee_name" => $chargee_name[$i]));
			// if (!$q->num_rows())
			// {
				$this->db->insert("chargee",$chargee);
			// } else {
				// $this->db->update("chargee",$chargee,array("unique_code" => $unique_code, "chargee_name" => $chargee_name[$i]));
			// }
		}
		// echo "<pre>";
		// print_r($chargee);
		// echo "</pre>";
		$this->session->set_userdata('open_unique_code',$unique_code);
        redirect("masterclient/edit");
	}
	public function save_other(){
		$unique_code = $_POST['unique_code'];
		// print_r($_POST);
		$client_others = [];
		$client_others['unique_code'] = $unique_code;
		$client_others['type_of_doc'] = $_POST['typeofdoc'];
		$client_others['others_category'] = $_POST['doccategory'];
		$client_others['others_remarks'] = $_POST['others_remarks'];
		
			$pho = '';
            if ($_FILES['upload_file_others']['size'] > 0) {
				$config['upload_path'] = './uploads/';
				$config['allowed_types'] = 'gif|jpg|png|pdf';
				// $config['max_size']     = '100000';
				// $config['max_width'] = '1024';
				// $config['max_height'] = '768';

				$this->load->library('upload', $config);

				// Alternately you can set preferences by calling the ``initialize()`` method. Useful if you auto-load the class:
				$this->upload->initialize($config);
				// print_r($this->upload->do_upload('upload_certificate'.($i+1)));
                if ($this->upload->do_upload("upload_file_others"))
				{
					$pho=$this->upload->file_name;
				}
				$error = $this->upload->display_errors();
			}
				// print_r($pho);
				// print_r($error);
				// print_r($_FILES);
			if ($pho != '') $client_others['files']=$pho;
				
		$this->db->delete("client_others",array("unique_code" => $unique_code));
			$this->db->insert("client_others",$client_others);
		// print_r($client_others);
		$this->session->set_userdata('open_unique_code',$unique_code);
        redirect("masterclient/edit/");
	}
	public function save_setup()
	{
		$unique_code = $_POST['unique_code'];
		// print_r($_POST);
		$client_setup = [];
		$client_setup['unique_code'] = $unique_code;
		$client_setup['setup_chairman'] = $_POST['setup_chairman']?$_POST['setup_chairman']:'-';
		$client_setup['setup_director_signature1'] = $_POST['setup_director_signature1']?$_POST['setup_director_signature1']:'-';
		$client_setup['setup_director_signature2'] = $_POST['setup_director_signature2']?$_POST['setup_director_signature2']:'-';
		$this->db->delete("client_setup",array("unique_code" => $unique_code));
			$this->db->insert("client_setup",$client_setup);
		$this->db->delete("client_service",array("unique_code" => $unique_code));
		for($i=0;$i<count($_POST['service_name']);$i++)
		{
			if ($_POST['service_amount'][$i])
			{
		$client_service = [];
		$client_service['unique_code'] = $unique_code;
		$client_service['service_name'] = $_POST['service_name'][$i];
		$client_service['service_start_recurring'] = $this->sma->fsd($_POST['service_start_recurring'][$i]);
		$client_service['service_end_recurring'] = $this->sma->fsd($_POST['service_end_recurring'][$i]);
		$client_service['service_frequency'] = $_POST['service_frequency'][$i];
		$client_service['service_amount'] = $_POST['service_amount'][$i]?str_replace(',','',$_POST['service_amount'][$i]):0;
		// print_r($client_service);
			$this->db->insert("client_service",$client_service);
			}
			
		}
		$this->session->set_userdata('open_unique_code',$unique_code);
        redirect("masterclient/edit");
		// print_r($client_others);
		// $this->sma->print_arrays($client_setup,$client_service);
	}

	public function check_officer_data()
	{
		/*if (!$this->loggedIn) {
            $this->session->set_userdata('requested_page', $this->uri->uri_string());
            redirect('login');
        }
        else
        {*/
			$check_date_of_appointment = [];
			$check_date_of_appointment[0]['date_of_appointment']=$_POST['date_of_appointment'][0];

			$check_date_of_cessation = [];
			$check_date_of_cessation[0]['date_of_cessation']=$_POST['date_of_cessation'][$i];

			$query = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][0]));

			if (!$query->num_rows())//if don't have anythings
			{
				echo false;
			}
			else
			{
				$query = $query->result_array();

				$old_office_date_of_appointment_result = $this->db->query("select date_of_appointment from client_officers where id='".$_POST['client_officer_id'][0]."'");

				$old_office_date_of_appointment_result = $old_office_date_of_appointment_result->result_array();

				$get_client_info = $this->db->query("select * from client where company_code='".$_POST['company_code']."'");

				$get_client_info = $get_client_info->result_array();

				if(!($old_office_date_of_appointment_result == $check_date_of_appointment))
				{
					$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "officer_id" => json_encode(array($_POST['client_officer_id'][0])), "received_on" => "", "triggered_by" => "8"));
					if($pending_documents_query->num_rows())
					{
						echo true;
					}
					else
					{
						echo false;
					}
				}
				else
				{
					echo false;
				}

				$old_office_date_of_cessation_result = $this->db->query("select date_of_cessation from client_officers where id='".$_POST['client_officer_id'][0]."'");

				$old_office_date_of_cessation_result = $old_office_date_of_cessation_result->result_array();

				if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
				{
					$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "officer_id" => json_encode(array($_POST['client_officer_id'][0])), "received_on" => "", "triggered_by" => "9"));
					if($pending_documents_query->num_rows())
					{
						echo true;
					}
					else
					{
						echo false;
					}
				}
				else
				{
					echo false;
				}
			}
		//}
	}

	public function add_officer ()
	{
		// $this->load->library('form_validation');
		// $this->load->helper('form');
		//$data['unique_code']=$_POST['unique_code'];
		//$data['nama']=$_POST['nama'];
		//$data['gid']=$_POST['id'];
		// $q = $this->db->
		//$d =$this->db_model->getOfficerGID($_POST['id']);
		// print_r($d);
		/*if ($d > 0)
		{
			echo "Duplicate Goverment ID";
		} else {*/
			/*$data['address']=$_POST['address'];
			$data['zipcode']=$_POST['zipcode'];
			$data['street']=$_POST['street'];
			$data['buildingname']=$_POST['buildingname'];
			$data['unit_no1']=$_POST['unit_no1'];
			$data['unit_no2']=$_POST['unit_no2'];
			$data['nationality']=$_POST['nationality'];
			$data['citizen']=$_POST['citizen'];
			$data['date_of_birth']=$this->sma->fsd($_POST['date_of_birth']);
			$dofficer = $data;
			$dofficer['type']='Company';
			$this->db->insert("person",$dofficer);
			$data['position']=$_POST['position'];
			$data['date_of_appointment']=$this->sma->fsd($_POST['date_of_appointment']);
			$data['date_of_cessation']=$this->sma->fsd($_POST['date_of_cessation']);
			$this->db->insert("officer",$data);
			// echo $this->db->insert_id();
			echo "Success Add";*/

			//echo json_encode($_POST['name']);
			//$data['company_code']=$_POST['company_code'];
			$identification_register_no = $_POST['identification_register_no'];
			$name = $_POST['name'];
/*			$data['position']=$_POST['position'];
			$data['identification_register_no']=$_POST['identification_register_no'];
			$data['name']=$_POST['name'];
			$data['date_of_appointment']=$_POST['date_of_appointment'];
			$data['date_of_cessation']=$_POST['date_of_cessation'];*/
			for($i = 0; $i < count($_POST['identification_register_no']); $i++ )
			{
				 $this->form_validation->set_rules('identification_register_no['.$i.']', 'Id', 'required');
				 $this->form_validation->set_rules('name['.$i.']', 'Name', 'required');
				 $this->form_validation->set_rules('date_of_appointment['.$i.']', 'Date of appointment', 'required');

				 $date_of_appointment = strtotime(str_replace('/', '-',$_POST['date_of_appointment'][$i]));
				 $date_of_cessation = strtotime(str_replace('/', '-',$_POST['date_of_cessation'][$i]));

				 /*$check_member_ = $this->db->get_where("client_officers", array("id" => $_POST['client_officer_id'][$i]));*/

		        //echo($this->form_validation->run());
		        //echo($date_of_cessation < $date_of_appointment);
		        if ($this->form_validation->run() == FALSE || $date_of_cessation < $date_of_appointment && $date_of_cessation != "" || $_POST['alternate_of'][$i] == "0" || $_POST['position'][$i] == "0")
		        {
		        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

		        	if($date_of_cessation < $date_of_appointment && $date_of_cessation != "")
		        	{
		        		 $validate_date_of_cessation = "Date of cessation should be on or after date appointment of this officer.";
		        	}
		        	else
		        	{
		        		$validate_date_of_cessation = "";
		        	}

		        	if($_POST['alternate_of'][$i] == "0")
		        	{
		        		 $validate_alternate_of = "*The Alternate of field is required.";
		        	}
		        	else
		        	{
		        		$validate_alternate_of = "";
		        	}

		        	if($_POST['position'][$i] == "0")
		        	{
		        		 $validate_position = "The Position field is required.";
		        	}
		        	else
		        	{
		        		 $validate_position = "";
		        	}


		        	$error = array(
		        					'alternate_of' => $validate_alternate_of,
					                'identification_register_no' => strip_tags(form_error('identification_register_no['.$i.']')),
					                'name' => strip_tags(form_error('name['.$i.']')),
					                'date_of_appointment' => strip_tags(form_error('date_of_appointment['.$i.']')),
					                'date_of_cessation' => $validate_date_of_cessation,
					                'position' => $validate_position,
					            );

		        	if($date_of_cessation < $date_of_appointment && $date_of_cessation != "")
		        	{
		        		echo json_encode(array("Status" => 0, 'message' => 'Date of cessation should be on or after date appointment of this officer.', 'title' => 'Error', "error" => $error));
		        	}
		        	else
		        	{
		        		echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field.', 'title' => 'Error', "error" => $error));
		        	}

		        }
		        else
		        {

		        	if ($_POST['position'][$i] == "5")
					{
						$q = $this->db->query("select * from officer_company where register_no='".$_POST['identification_register_no'][$i]."'");
						//echo json_encode($q);
						if ($q->num_rows() > 0) {
							$have_this_member = 1;
				            // foreach (($q->result()) as $row) {
				                // $data[] = $row;
				            // }
				            // return $data;
				        } 
				        else 
				       	{
				       		$have_this_member = 0;
				       	}
					}
					else
					{
						//$q = $this->db->query("select * from officer where identification_no='".$identification_register_no."'");

						$q = $this->db->query("select * from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$_POST['identification_register_no'][$i]."'");

						//echo json_encode($q->result()[0]);
						if ($q->num_rows() > 0) {
							
				            $q = $q->result_array();

							list($day, $month, $year) = explode('/', $_POST['date_of_appointment'][$i]);
							$get_date_of_appointment = mktime(0, 0, 0, $month, $day, $year);

							$date_of_birth =  strtotime($q[0]["date_of_birth"]);
								
							if($date_of_birth > $get_date_of_appointment)
							{
								$have_this_member = 2;
							}
							else
							{
								$have_this_member = 1;
							}
							//echo json_encode($have_this_member);
				        } 
				        else 
				        {
				        	$have_this_member = 0;
				        }
					}

					if($have_this_member == 1)
					{
						$data['company_code']=$_POST['company_code'];
						$data['officer_id']=$_POST['officer_id'];
						$data['field_type']=$_POST['officer_field_type'];
						$data['position']=$_POST['position'][$i];
						if($_POST['alternate_of'][$i] == null)
						{
							$data['alternate_of']=' ';
							$check_alternate_of = ' ';
						}
						else
						{
							$data['alternate_of']=$_POST['alternate_of'][$i];
							$check_alternate_of = $_POST['alternate_of'][$i];;
						}
						
						$data['date_of_appointment']=$_POST['date_of_appointment'][$i];
						$data['date_of_cessation']=$_POST['date_of_cessation'][$i];

						/*if($_POST['date_of_cessation'][$i] != "" && $_POST['position'][$i] == "1")
						{
							$data['retiring'] = 1;
						}
						else
						{*/
							$data['retiring'] = 0;
						//}

						/*$check_date = $this->db->query("select * from client_officers where position='".$data['position']."' AND alternate_of = '".$data['alternate_of']."' AND officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."'");

						$check_date = $check_date->result_array();

						if($check_date[0]["date_of_cessation"] == null && count($check_date) != 0)
						{
							echo json_encode(array("Status" => 2, 'message' => 'This person have not resign.', 'title' => 'Error', 'data' => $check_date));
						}
						elseif($check_date[0]["date_of_cessation"] != null && count($check_date) != 0)
						{
							$array = explode('/', $check_date[0]["date_of_cessation"]);
							$tmp = $array[0];
							$array[0] = $array[1];
							$array[1] = $tmp;
							unset($tmp);
							$new_date = implode('/', $array);
							$time = strtotime($new_date);
							$new_date = date('d-m-Y',$time);

							if($data['date_of_appointment'] > $new_date)
							{
								echo json_encode(array("Status" => 2, 'message' => 'Date of appointment cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
							}
							else
							{

							}
		                	
						}
						else
						{*/
							$q = $this->db->get_where("client_officers", array("id" => $_POST['client_officer_id'][$i]));

							if (!$q->num_rows())
							{
								$date_of_appointment_array = explode('/', $data['date_of_appointment']);
								$date_of_appointment_tmp = $date_of_appointment_array[0];
								$date_of_appointment_array[0] = $date_of_appointment_array[1];
								$date_of_appointment_array[1] = $date_of_appointment_tmp;
								unset($date_of_appointment_tmp);
								$post_date_of_appointment = implode('/', $date_of_appointment_array);

								if ($_POST['position'][$i] == "7")
								{
									$check_alternate_of_date = $this->db->query("select * from client_officers where id='".$data['alternate_of']."' ORDER BY STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') DESC");

									$check_alternate_of_date = $check_alternate_of_date->result_array();
									//echo json_encode($check_alternate_of_date);
									$array = explode('/', $check_alternate_of_date[0]["date_of_appointment"]);
									$tmp = $array[0];
									$array[0] = $array[1];
									$array[1] = $tmp;
									unset($tmp);
									$alternate_of_date_of_appointment = implode('/', $array);

									if($check_alternate_of_date[0]["date_of_cessation"] != "")
									{
										$array = explode('/', $check_alternate_of_date[0]["date_of_cessation"]);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$alternate_of_date_of_cessation = implode('/', $array);

										//if(strtotime($alternate_of_date_of_appointment) >= )
									}

									if(strtotime($alternate_of_date_of_appointment) > strtotime($post_date_of_appointment))
									{
										$overlapped = true;
									}
									else
									{
										$overlapped = false;
									}
									//$new_date_of_appointment = strtotime($new_date_of_appointment);

								}
								else
								{
									$overlapped = false;
								}

								if(!$overlapped)
								{
									$check_date = $this->db->query("select * from client_officers where position='".$data['position']."' AND alternate_of = '".$data['alternate_of']."' AND officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' ORDER BY STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') DESC LIMIT 2");

									$check_date = $check_date->result_array();

									if(count($check_date) == 1)
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_appointment = $check_date[0]["date_of_appointment"];
									}
									else
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_appointment = $check_date[0]["date_of_appointment"];
									}

									/*if($date_of_cessation == null && count($check_date) != 0)
									{
										echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
									}
									elseif($date_of_cessation != null && count($check_date) != 0)
									{*/

									if($date_of_cessation == null && count($check_date) != 0)
									{
										$array = explode('/', $date_of_appointment);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date = implode('/', $array);
										$new_date_of_appointment = strtotime($new_date);
										//$new_date_of_registration = date('d/m/Y',$time);

										$date_of_cessation_array = explode('/', $data['date_of_cessation']);
										$date_of_cessation_tmp = $date_of_cessation_array[0];
										$date_of_cessation_array[0] = $date_of_cessation_array[1];
										$date_of_cessation_array[1] = $date_of_cessation_tmp;
										unset($date_of_cessation_tmp);
										$post_date_of_cessation = implode('/', $date_of_cessation_array);

										if($data['date_of_cessation'] != "")
										{
											if( strtotime($post_date_of_cessation) >= $new_date_of_appointment)
											{
												echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
											}
											else
											{
												$this->db->insert("client_officers",$data);
												$insert_client_officers_id = $this->db->insert_id();

												if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
												{
													$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
													
												}
												elseif ($_POST['position'][$i] == 4)
												{
													$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
												}
												elseif($_POST['position'][$i] == 5)
												{
													$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
												}

												if($_POST['position'][$i] == 1 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_director", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 1 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_director", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 4 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_secretary", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 4 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_secretary", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 5 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_auditor", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 5 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_auditor", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 3 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_manager", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 3 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_manager", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 2 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_ceo", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 2 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_ceo", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 6 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_managing_director", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 6 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_managing_director", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 7 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
												{
													//$this->create_document("appointment_of_alternate_director", $_POST['company_code'], $insert_client_officers_id);
												}
												elseif($_POST['position'][$i] == 7 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
												{
													//$this->create_document("cessation_of_alternate_director", $_POST['company_code'], $insert_client_officers_id);
												}
												/*$this->create_document("change_date_of_appointment", $_POST['company_code'], $_POST['client_officer_id'][$i]);*/

												echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
											}
										}
										else
										{
											echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
										}
										
										
									}
									elseif($date_of_cessation != null && count($check_date) != 0)
									{

										$array = explode('/', $check_date[0]["date_of_cessation"]);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date = implode('/', $array);
										/*$time = strtotime($new_date);
										$new_date = date('d/m/Y',$time);*/

										

										if(strtotime($new_date) > strtotime($post_date_of_appointment))
										{
											echo json_encode(array("Status" => 2, 'message' => 'Date of appointment cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
										}
										else
										{
											$this->db->insert("client_officers",$data);
											$insert_client_officers_id = $this->db->insert_id();

											if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
											{
												$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
												
											}
											elseif ($_POST['position'][$i] == 4)
											{
												$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
											}
											elseif($_POST['position'][$i] == 5)
											{
													$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
											}

											if($_POST['position'][$i] == 1 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_director", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 1 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_director", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 4 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_secretary", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 4 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_secretary", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 5 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_auditor", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 5 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_auditor", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 3 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_manager", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 3 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_manager", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 2 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_ceo", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 2 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_ceo", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 6 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_managing_director", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 6 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_managing_director", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 7 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
											{
												//$this->create_document("appointment_of_alternate_director", $_POST['company_code'], $insert_client_officers_id);
											}
											elseif($_POST['position'][$i] == 7 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
											{
												//$this->create_document("cessation_of_alternate_director", $_POST['company_code'], $insert_client_officers_id);
											}
											echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
										}
					                	
									}
									else
									{
										$this->db->insert("client_officers",$data);
										$insert_client_officers_id = $this->db->insert_id();

										if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
										{
											$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
											
										}
										elseif ($_POST['position'][$i] == 4)
										{
											$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
										}
										elseif($_POST['position'][$i] == 5)
										{
											$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
										}

										if($_POST['position'][$i] == 1 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_director", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 1 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_director", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 4 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_secretary", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 4 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_secretary", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 5 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_auditor", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 5 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_auditor", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 3 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_manager", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 3 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_manager", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 2 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_ceo", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 2 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_ceo", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 6 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_managing_director", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 6 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_managing_director", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 7 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] == "")
										{
											//$this->create_document("appointment_of_alternate_director", $_POST['company_code'], $insert_client_officers_id);
										}
										elseif($_POST['position'][$i] == 7 && $data['date_of_appointment'] != "" && $data['date_of_cessation'] != "")
										{
											//$this->create_document("cessation_of_alternate_director", $_POST['company_code'], $insert_client_officers_id);
										}
										echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
									}
								}
								else
								{
									echo json_encode(array("Status" => 2, 'message' => 'The director has not been appointed on the appointment date of this alternate director.', 'title' => 'Error', 'data' => ""));
								}
							} 
							else 
							{
								$date_of_appointment_array = explode('/', $data['date_of_appointment']);
								$date_of_appointment_tmp = $date_of_appointment_array[0];
								$date_of_appointment_array[0] = $date_of_appointment_array[1];
								$date_of_appointment_array[1] = $date_of_appointment_tmp;
								unset($date_of_appointment_tmp);
								$post_date_of_appointment = implode('/', $date_of_appointment_array);

								if ($_POST['position'][$i] == "7")
								{
									$check_alternate_of_date = $this->db->query("select * from client_officers where id='".$data['alternate_of']."' ORDER BY id DESC");

									$check_alternate_of_date = $check_alternate_of_date->result_array();

									$array = explode('/', $check_alternate_of_date[0]["date_of_appointment"]);
									$tmp = $array[0];
									$array[0] = $array[1];
									$array[1] = $tmp;
									unset($tmp);
									$alternate_of_date_of_appointment = implode('/', $array);

									if($check_alternate_of_date[0]["date_of_cessation"] != "")
									{
										$array = explode('/', $check_alternate_of_date[0]["date_of_cessation"]);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$alternate_of_date_of_cessation = implode('/', $array);

										//if(strtotime($alternate_of_date_of_appointment) >= )
									}

									if(strtotime($alternate_of_date_of_appointment) > strtotime($post_date_of_appointment))
									{
										$overlapped = true;
									}
									else
									{
										$overlapped = false;
									}
									//$new_date_of_appointment = strtotime($new_date_of_appointment);

								}
								else
								{
									$overlapped = false;
								}

								if(!$overlapped)
								{
									$check_officer = [];
									$check_date_of_appointment = [];
									$check_date_of_cessation = [];
									//$check_officer[0]['position']=$_POST['position'][$i];
									$check_officer[0]['alternate_of']=$check_alternate_of;
									$check_officer[0]['officer_id']=$_POST['officer_id'];
									$check_officer[0]['field_type']=$_POST['officer_field_type'];
									$check_officer[0]['date_of_appointment']=$_POST['date_of_appointment'][$i];
									$check_officer[0]['date_of_cessation']=$_POST['date_of_cessation'][$i];

									$check_date_of_appointment[0]['date_of_appointment']=$_POST['date_of_appointment'][$i];

									$check_date_of_cessation[0]['date_of_cessation']=$_POST['date_of_cessation'][$i];

									$old_client_officer_result = $this->db->query("select alternate_of, officer_id, field_type, date_of_appointment, date_of_cessation from client_officers where id='".$_POST['client_officer_id'][$i]."'");

									$old_client_officer_result = $old_client_officer_result->result_array();

									$old_office_date_of_appointment_result = $this->db->query("select date_of_appointment from client_officers where id='".$_POST['client_officer_id'][$i]."'");

									$old_office_date_of_appointment_result = $old_office_date_of_appointment_result->result_array();

									$old_office_date_of_cessation_result = $this->db->query("select date_of_cessation from client_officers where id='".$_POST['client_officer_id'][$i]."'");

									$old_office_date_of_cessation_result = $old_office_date_of_cessation_result->result_array();


									$check_date = $this->db->query("select * from client_officers where position='".$data['position']."' AND alternate_of = '".$data['alternate_of']."' AND officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' AND id != '".$_POST['client_officer_id'][$i]."' ORDER BY STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') DESC LIMIT 2");

									$check_date = $check_date->result_array();

									$get_client_information = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$data['company_code']."' order by id");

									$get_client_information = $get_client_information->result_array();

									$previous_director_name_appointment_result = $this->db->query("select client_officers.* from client_officers where position = '".$_POST['position'][$i]."' AND company_code='".$data['company_code']."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_of_appointment_result[0]["date_of_appointment"]."','%d/%m/%Y') order by id");
									//echo json_encode($check_date);
									$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();

									$previous_director_name_cessation_result = $this->db->query("select client_officers.* from client_officers where position = '".$_POST['position'][$i]."' AND company_code='".$data['company_code']."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_of_cessation_result[0]["date_of_cessation"]."','%d/%m/%Y')  order by id");
									//echo json_encode($check_date);
									$previous_director_name_cessation_result = $previous_director_name_cessation_result->result_array();
									

									if(count($check_date) == 1)
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_appointment = $check_date[0]["date_of_appointment"];
									}
									else
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_appointment = $check_date[0]["date_of_appointment"];
									}

									/*if($date_of_cessation == null && count($check_date) != 0)
									{
										echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
									}
									elseif($date_of_cessation != null && count($check_date) != 0)
									{*/

									if($date_of_cessation == null && count($check_date) != 0)
									{
										$array = explode('/', $date_of_appointment);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date = implode('/', $array);
										$new_date_of_appointment = strtotime($new_date);
										//$new_date_of_registration = date('d/m/Y',$time);

										$date_of_cessation_array = explode('/', $data['date_of_cessation']);
										$date_of_cessation_tmp = $date_of_cessation_array[0];
										$date_of_cessation_array[0] = $date_of_cessation_array[1];
										$date_of_cessation_array[1] = $date_of_cessation_tmp;
										unset($date_of_cessation_tmp);
										$post_date_of_cessation = implode('/', $date_of_cessation_array);

										if($data['date_of_cessation'] != "")
										{
											if( strtotime($post_date_of_cessation) >= $new_date_of_appointment)
											{
												echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
											}
											else
											{
												

												$this->db->update("client_officers",$data,array("id" => $_POST['client_officer_id'][$i]));

												if(!($old_office_date_of_appointment_result == $check_date_of_appointment))
												{
													$check_history_client_office = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][$i]));
													if (!$check_history_client_office->num_rows())
													{
														$w = $q->result();

														foreach($w as $r) {
													        $this->db->insert("history_client_officers",$r);
													    }
													} 
													else 
													{
														$x = $q->result_array();

														$data_history['date_of_appointment'] = $x[0]["date_of_appointment"];

													    $this->db->update("history_client_officers",$data_history,array("id" => $_POST['client_officer_id'][$i]));
														
													}
													$old_office_date_result = $old_office_date_of_appointment_result[0]["date_of_appointment"];
													if($_POST['position'][$i] == 1)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 4)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_secretary", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_secretary", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 5)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 3)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_manager", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_manager", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 2)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_ceo", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_ceo", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 6)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_managing_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_managing_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 7)
													{

	                									$this->change_officer_date_of_appointment_document_info("appointment_of_alternate_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);

														//$this->create_document("appointment_of_alternate_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													
												}

												if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
												{
													$check_history_client_office = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][$i]));
													if (!$check_history_client_office->num_rows())
													{
														$g = $q->result();

														foreach($g as $r) {
													        $this->db->insert("history_client_officers",$r);
													    }
													} 
													else 
													{
														$z = $q->result_array();

														$data_history['date_of_cessation'] = $z[0]["date_of_cessation"];

													    $this->db->update("history_client_officers",$data_history,array("id" => $_POST['client_officer_id'][$i]));
														
													}
													$old_office_date_result = $old_office_date_of_cessation_result[0]["date_of_cessation"];
													if($_POST['position'][$i] == 1)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 4)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_secretary", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_secretary", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 5)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 3)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 2)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_ceo", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_ceo", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 6)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_managing_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_managing_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
													elseif($_POST['position'][$i] == 7)
													{
														$this->change_officer_date_of_appointment_document_info("cessation_of_alternate_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
														//$this->create_document("cessation_of_alternate_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
													}
												}

												if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
												{
													if(!($old_client_officer_result == $check_officer))
													{
														$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
													}
												}
												elseif ($_POST['position'][$i] == 4)
												{
													if(!($old_client_officer_result == $check_officer))
													{
														$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
													}
												}
												elseif($_POST['position'][$i] == 5)
												{
													if(!($old_client_officer_result == $check_officer))
													{
														$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
													}
												}
												
												echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
											}
										}
										else
										{
											echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
										}
										
										
									}
									elseif($date_of_cessation != null && count($check_date) != 0)
									{

										$array = explode('/', $check_date[0]["date_of_cessation"]);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date = implode('/', $array);
										/*$time = strtotime($new_date);
										$new_date = date('d/m/Y',$time);*/

										

										if(strtotime($new_date) > strtotime($post_date_of_appointment))
										{
											echo json_encode(array("Status" => 2, 'message' => 'Date of appointment cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
										}
										else
										{
											$this->db->update("client_officers",$data,array("id" => $_POST['client_officer_id'][$i]));

											if(!($old_office_date_of_appointment_result == $check_date_of_appointment))
											{
												$check_history_client_office = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][$i]));
												if (!$check_history_client_office->num_rows())
												{
													$w = $q->result();

													foreach($w as $r) {
												        $this->db->insert("history_client_officers",$r);
												    }
												} 
												else 
												{
													$x = $q->result_array();

													$data_history['date_of_appointment'] = $x[0]["date_of_appointment"];

												    $this->db->update("history_client_officers",$data_history,array("id" => $_POST['client_officer_id'][$i]));
													
												}
												$old_office_date_result = $old_office_date_of_appointment_result[0]["date_of_appointment"];
												if($_POST['position'][$i] == 1)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 4)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_secretary", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_secretary", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 5)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 3)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_manager", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_manager", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 2)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_ceo", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_ceo", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 6)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_managing_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_managing_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 7)
												{
													$this->change_officer_date_of_appointment_document_info("appointment_of_alternate_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
													//$this->create_document("appointment_of_alternate_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
											}

											if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
											{
												$check_history_client_office = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][$i]));
												if (!$check_history_client_office->num_rows())
												{
													$g = $q->result();

													foreach($g as $r) {
												        $this->db->insert("history_client_officers",$r);
												    }
												} 
												else 
												{
													$z = $q->result_array();

													$data_history['date_of_cessation'] = $z[0]["date_of_cessation"];

												    $this->db->update("history_client_officers",$data_history,array("id" => $_POST['client_officer_id'][$i]));
													
												}
												$old_office_date_result = $old_office_date_of_cessation_result[0]["date_of_cessation"];
												if($_POST['position'][$i] == 1)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 4)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_secretary", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_secretary", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 5)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 3)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_manager", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_manager", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 2)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_ceo", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_ceo", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 6)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_managing_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_managing_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
												elseif($_POST['position'][$i] == 7)
												{
													$this->change_officer_date_of_appointment_document_info("cessation_of_alternate_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
													//$this->create_document("cessation_of_alternate_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
												}
											}

											if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
											{
												if(!($old_client_officer_result == $check_officer))
												{
													$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
												}
											}
											elseif ($_POST['position'][$i] == 4)
											{
												if(!($old_client_officer_result == $check_officer))
												{
													$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
												}
											}
											elseif($_POST['position'][$i] == 5)
											{
												if(!($old_client_officer_result == $check_officer))
												{
													$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
												}
											}
											
											echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
										}
					                	
									}
									else
									{
										$this->db->update("client_officers",$data,array("id" => $_POST['client_officer_id'][$i]));

										if(!($old_office_date_of_appointment_result == $check_date_of_appointment))
										{
											$check_history_client_office = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][$i]));
											if (!$check_history_client_office->num_rows())
											{
												$w = $q->result();

												foreach($w as $r) {
											        $this->db->insert("history_client_officers",$r);
											    }
											} 
											else 
											{
												$x = $q->result_array();

												$data_history['date_of_appointment'] = $x[0]["date_of_appointment"];

											    $this->db->update("history_client_officers",$data_history,array("id" => $_POST['client_officer_id'][$i]));
												
											}
											$old_office_date_result = $old_office_date_of_appointment_result[0]["date_of_appointment"];
											if($_POST['position'][$i] == 1)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 4)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_secretary", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_secretary", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 5)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 3)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_manager", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_manager", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 2)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_ceo", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_ceo", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 6)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_managing_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_managing_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 7)
											{
												$this->change_officer_date_of_appointment_document_info("appointment_of_alternate_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_appointment_result,$get_client_information[0]["id"]);
												//$this->create_document("appointment_of_alternate_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
										}

										if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
										{
											$check_history_client_office = $this->db->get_where("history_client_officers", array("id" => $_POST['client_officer_id'][$i]));
											if (!$check_history_client_office->num_rows())
											{
												$g = $q->result();

												foreach($g as $r) {
											        $this->db->insert("history_client_officers",$r);
											    }
											} 
											else 
											{
												$z = $q->result_array();

												$data_history['date_of_cessation'] = $z[0]["date_of_cessation"];

											    $this->db->update("history_client_officers",$data_history,array("id" => $_POST['client_officer_id'][$i]));
												
											}
											$old_office_date_result = $old_office_date_of_cessation_result[0]["date_of_cessation"];
											if($_POST['position'][$i] == 1)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 4)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_secretary", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_secretary", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 5)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_auditor", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_auditor", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 3)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_manager", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_manager", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 2)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_ceo", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_ceo", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 6)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_managing_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_managing_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
											elseif($_POST['position'][$i] == 7)
											{
												$this->change_officer_date_of_appointment_document_info("cessation_of_alternate_director", $old_office_date_result, $get_client_information[0]["firm_id"],$data['company_code'],$previous_director_name_cessation_result,$get_client_information[0]["id"]);
												//$this->create_document("cessation_of_alternate_director", $_POST['company_code'], $_POST['client_officer_id'][$i]);
											}
										}

										if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
										{
											if(!($old_client_officer_result == $check_officer))
											{
												$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
											}
										}
										elseif ($_POST['position'][$i] == 4)
										{
											if(!($old_client_officer_result == $check_officer))
											{
												$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
											}
										}
										elseif($_POST['position'][$i] == 5)
										{
											if(!($old_client_officer_result == $check_officer))
											{
												$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
											}
										}
										
										echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
									}
								}
								else
								{
									echo json_encode(array("Status" => 2, 'message' => 'The director has not been appointed on the appointment date of this alternate director.', 'title' => 'Error', 'data' => ""));
								}
							}
							
						//The person is already holding similar position on the date}
						
					}
					else if($have_this_member == 2)
					{
						echo json_encode(array("Status" => 2, 'message' => 'The appointment date cannot smaller than date of birth.', 'title' => 'Error'));
					}
					else
					{
						//echo ($have_this_member);
						if ($_POST['position'][$i] == "5")
						{
							echo json_encode(array("Status" => 2, 'message' => 'This person cannot under this position.', 'title' => 'Error'));
						}
						else
						{
							echo json_encode(array("Status" => 2, 'message' => 'This company cannot under this position.', 'title' => 'Error'));
						}
					}


					
				}
			}


			//echo json_encode($_POST['position']);

/*			$bc = array(array('link' => '#', 'page' => lang('Edit Clients')));
	        $meta = array('page_title' => lang('Edit Clients'), 'bc' => $bc, 'page_name' => 'Edit Clients');
			// $this->data['page_name'] = 'Clients';
	        $this->page_construct('client/edit_client.php', $meta, $this->data);*/
		//}
		// $this->sma->print_arrays($data);		
		
	}

	public function change_officer_date_of_appointment_document_info($type, $old_office_date_result, $firm_id, $company_code, $previous_director_name_result = null, $client_id, $delete_officer_id = null)
	{
		/*if(!($old_office_date_of_appointment_result == $new_date_of_appointment))
		{*/

			if($type == "appointment_of_director")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 8 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_director")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 9 AND firm_id='".$firm_id."'");
			}
			elseif($type == "appointment_of_secretary")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 14 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_secretary")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 15 AND firm_id='".$firm_id."'");
			}
			elseif($type == "appointment_of_auditor")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 16 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_auditor")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 17 AND firm_id='".$firm_id."'");
			}
			elseif($type == "appointment_of_manager")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 12 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_manager")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 13 AND firm_id='".$firm_id."'");
			}
			elseif($type == "appointment_of_ceo")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 10 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_ceo")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 11 AND firm_id='".$firm_id."'");
			}
			elseif($type == "appointment_of_managing_director")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 18 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_managing_director")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 19 AND firm_id='".$firm_id."'");
			}
			elseif($type == "appointment_of_alternate_director")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 20 AND firm_id='".$firm_id."'");
			}
			elseif($type == "cessation_of_alternate_director")
			{
				$document_master_result = $this->db->query("select * from document_master where triggered_by = 21 AND firm_id='".$firm_id."'");
			}
			if (count($document_master_result)!=0)
			{
				$get_client = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$company_code."'");

				$get_client = $get_client->result_array();

				$document_master_result = $document_master_result->result_array();
				for($r = 0; $r < count($document_master_result); $r++)
				{
					$str = $document_master_result[$r]["document_content"];

					$document_name=$document_master_result[$r]["document_name"]." - ".DATE("Y",now());

					if($document_master_result[$r]["document_name"] == "Form 45B")
					{
						$secretarys_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");


						$secretarys_appointment_result = $secretarys_appointment_result->result_array();

						$loop_document_content = "";
						$latest_officer_id = array();
						for($e = 0; $e < count($secretarys_appointment_result); $e++)
						{	
							$document_content_str = $document_master_result[$r]["document_content"];

							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
							{
								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
							}

							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>') !== false)
			                {


			                	$secretarys_name_appointment = "";

			                	
			                	$num_of_director_name_appointment = (int)(count($secretarys_appointment_result)) - 1;

			                	$secretarys_name_appointment = $secretarys_name_appointment.'<strong>'.$secretarys_appointment_result[$e]["name"].'</strong>';

			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>', $secretarys_name_appointment, $document_content_str);

			                }

			                if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>') !== false)
			                {

			                	$secretarys_id_appointment = "";

			                	$num_of_secretarys_id_appointment = (int)(count($secretarys_appointment_result)) - 1;

			                	$secretarys_id_appointment = $secretarys_id_appointment.'<strong>'.$secretarys_appointment_result[$e]["identification_no"].'</strong>';

			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>', $secretarys_id_appointment, $document_content_str);

			                }

			                array_push($latest_officer_id, (int)$secretarys_appointment_result[$e]["id"]);

			                $data_pending_document['officer_id']=json_encode($latest_officer_id);

			                $loop_document_content = $loop_document_content.$document_content_str;
						}

						$data_pending_document['content'] = $loop_document_content;
						
					}
					elseif($document_master_result[$r]["document_name"] == "Form 45")
					{
						$directors_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");


						$directors_appointment_result = $directors_appointment_result->result_array();

						$loop_document_content = "";
						$latest_officer_id = array();
						for($e = 0; $e < count($directors_appointment_result); $e++)
						{	
							$document_content_str = $document_master_result[$r]["document_content"];

							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
							{
								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
							}

							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>') !== false)
			                {


			                	$directors_name_appointment = "";

			                	
			                	$num_of_director_name_appointment = (int)(count($directors_appointment_result)) - 1;

			                	$directors_name_appointment = $directors_name_appointment.'<strong>'.$directors_appointment_result[$e]["name"].'</strong>';

			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>', $directors_name_appointment, $document_content_str);

			                }

			                if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>') !== false)
			                {

			                	$directors_id_appointment = "";

			                	$num_of_director_id_appointment = (int)(count($directors_appointment_result)) - 1;

			                	$directors_id_appointment = $directors_id_appointment.'<strong>'.$directors_appointment_result[$e]["identification_no"].'</strong>';

			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>', $directors_id_appointment, $document_content_str);

			                }

			                array_push($latest_officer_id, (int)$directors_appointment_result[$e]["id"]);

			                $data_pending_document['officer_id']=json_encode($latest_officer_id);

			                $loop_document_content = $loop_document_content.$document_content_str;
						}

						$data_pending_document['content'] = $loop_document_content;
						
					}
					else
					{
						if(strpos($str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $str);
						}

						if(strpos($str, '<span class="myclass mceNonEditable">{{Address - new}}</span>') !== false)
						{
							if($get_client[0]["unit_no1"] != null || $get_client[0]["unit_no2"] != null)
							{
								$unit_no = '#'.$get_client[0]["unit_no1"].'-'.$get_client[0]["unit_no2"].'';
							}
							else
							{
								$unit_no = '';
							}

							$new_address = $get_client[0]["street_name"].', '.$unit_no.' '.$get_client[0]["building_name"].', Singapore '.$get_client[0]["postal_code"];

							$str = str_replace('<span class="myclass mceNonEditable">{{Address - new}}</span>', $new_address, $str);
						}

						if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
		                {
		                	$director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
		                	$director_name_result = $director_name_result->result_array();

		                	//echo json_encode($director_name_result);
		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

		                	if( $document_master_result[$r]["document_name"] == "Auditor-Notice of EGM" || $document_master_result[$r]["document_name"] == "Manager-Notice of EGM"|| $document_master_result[$r]["document_name"] == "CEO-Notice of EGM" || $document_master_result[$r]["document_name"] == "Charge-Notice of EGM" || $document_master_result[$r]["document_name"] == "Company Name-Notice of EGM" || $document_master_result[$r]["document_name"] == "Allotment-Authority to Allot")
		                	{
		                		$director_name = '';

		                		$director_name = $director_name.'<p>&nbsp;</p><p>&nbsp;</p><p>_______________________________<br />'.$director_name_result[0]["name"].'<br />Director</p>';

		                	}
		                	elseif($document_master_result[$r]["document_name"] == "Form 11" || $document_master_result[$r]["document_name"] == "Strike Off EGM")
		                	{

		                		$director_name = $director_name_result[0]["name"];

		                	}
		                	elseif($document_master_result[$r]["document_name"] == "Strike Off-Minutes Of EGM")
		                	{
		                		$director_name = '';
		                		for($g = 0; $g < count($director_name_result); $g++)
			                	{	
			                		if($g == 0)
			                		{
			                			$director_name = $director_name.'<p><strong>'.$director_name_result[$g]["name"].'<br /></strong>';
			                		}
			                		elseif($g == (count($director_name_result) - 1))
			                		{
			                			$director_name = $director_name.'<strong>'.$director_name_result[$g]["name"].'<br /></strong></p>';
			                		}
			                		else
			                		{
			                			$director_name = $director_name.'<strong>'.$director_name_result[$g]["name"].'<br /></strong>';
			                		}
		                			
		                		}
		                	}
		                	else
		                	{
		                		$director_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';
		                		for($g = 0; $g < count($director_name_result); $g++)
			                	{
			                		$director_name = $director_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$director_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
			                	}
			                	$director_name = $director_name.'</tbody></table>';
		                	}


		                	

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $str);
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - all}}</span>') !== false)
		                {
		                	$director_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

		                	$director_id_result = $director_id_result->result_array();

		                	$director_id = "";

		                	for($g = 0; $g < count($director_id_result); $g++)
		                	{
		                		$director_id = $director_id.'<p>&nbsp;</p>'.$director_id_result[$g]["identification_no"].' ____________________________<br>';
		                	}

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - all}}</span>', $director_id, $str);
		                }

						if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - resigning}}</span>') !== false)
		                {
		                	$director_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$director_name_resigning_result = $director_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$director_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_director_name_resigning = (int)(count($director_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($director_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$director_name_resigning = $director_name_resigning.'<strong>'.$director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_director_name_resigning)
		                		{
		                			$director_name_resigning = $director_name_resigning.' and <strong>'.$director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$director_name_resigning = $director_name_resigning.', <strong>'.$director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$director_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - resigning}}</span>', $director_name_resigning, $str);

		                	
		                	//echo json_encode($officer_id_data);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - resigning}}</span>') !== false)
		                {
		                	$director_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$director_id_resigning_result = $director_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$director_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_director_id_resigning = (int)(count($director_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($director_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$director_id_resigning = $director_id_resigning.'<strong>'.$director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_director_id_resigning)
		                		{
		                			$director_id_resigning = $director_id_resigning.' and <strong>'.$director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$director_id_resigning = $director_id_resigning.', <strong>'.$director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$director_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - resigning}}</span>', $director_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors - cessation date}}</span>') !== false)
		                {
		                	$director_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$director_cessation_date_result = $director_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$director_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_director_cessation_date = (int)(count($director_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($director_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$director_cessation_date = $director_cessation_date.'<strong>'.$director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_director_cessation_date)
		                		{
		                			$director_cessation_date = $director_cessation_date.' and <strong>'.$director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$director_cessation_date = $director_cessation_date.', <strong>'.$director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$director_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors - cessation date}}</span>', $director_cessation_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>') !== false)
		                {
		                	$director_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$director_name_appointment_result = $director_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($director_name_appointment_result);

		                	$director_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_director_name_appointment = (int)(count($director_name_appointment_result)) - 1;

		                	for($g = 0; $g < count($director_name_appointment_result); $g++)
		                	{
		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>)') !== false)
		                		{
		                			if($g == 0)
			                		{
			                			$director_name_appointment = $director_name_appointment.$director_name_appointment_result[$g]["name"].' (Identification No. '.$director_name_appointment_result[$g]["identification_no"].')';
			                		}
			                		elseif($g == (int)$num_of_director_name_appointment)
			                		{
			                			$director_name_appointment = $director_name_appointment.' and '.$director_name_appointment_result[$g]["name"].' (Identification No. '.$director_name_appointment_result[$g]["identification_no"].')';
			                		}
			                		else
			                		{
			                			$director_name_appointment = $director_name_appointment.', '.$director_name_appointment_result[$g]["name"].' (Identification No. '.$director_name_appointment_result[$g]["identification_no"].')';
			                		}
		                		}
		                		else
		                		{
			                		if($g == 0)
			                		{
			                			$director_name_appointment = $director_name_appointment.'<strong>'.$director_name_appointment_result[$g]["name"].'</strong>';
			                		}
			                		elseif($g == (int)$num_of_director_name_appointment)
			                		{
			                			$director_name_appointment = $director_name_appointment.' and <strong>'.$director_name_appointment_result[$g]["name"].'</strong>';
			                		}
			                		else
			                		{
			                			$director_name_appointment = $director_name_appointment.', <strong>'.$director_name_appointment_result[$g]["name"].'</strong>';
			                		}
			                	}
		                		
		                		array_push($latest_officer_id, (int)$director_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	/*$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>', $secretarys_name_appointment, $str);*/
		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - appointment}}</span> (Identification No. <span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>)', $director_name_appointment, $str);
		                	}
		                	else
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - appointment}}</span>', $director_name_appointment, $str);
		                	}

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>') !== false)
		                {
		                	$director_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$director_id_appointment_result = $director_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$director_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_director_id_appointment = (int)(count($director_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($director_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$director_id_appointment = $director_id_appointment.'<strong>'.$director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_director_id_appointment)
		                		{
		                			$director_id_appointment = $director_id_appointment.' and <strong>'.$director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$director_id_appointment = $director_id_appointment.', <strong>'.$director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$director_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - appointment}}</span>', $director_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors - appointment date}}</span>') !== false)
		                {
		                	$director_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$director_appointment_date_result = $director_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$director_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_director_appointment_date = (int)(count($director_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($director_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$director_appointment_date = $director_appointment_date.'<strong>'.$director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_director_appointment_date)
		                		{
		                			$director_appointment_date = $director_appointment_date.' and <strong>'.$director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$director_appointment_date = $director_appointment_date.', <strong>'.$director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$director_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors - appointment date}}</span>', $director_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys name - resigning}}</span>') !== false)
		                {
		                	$secretarys_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$secretarys_name_resigning_result = $secretarys_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$secretarys_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_name_resigning = (int)(count($secretarys_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($secretarys_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$secretarys_name_resigning = $secretarys_name_resigning.'<strong>'.$secretarys_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_secretarys_name_resigning)
		                		{
		                			$secretarys_name_resigning = $secretarys_name_resigning.' and <strong>'.$secretarys_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$secretarys_name_resigning = $secretarys_name_resigning.', <strong>'.$secretarys_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$secretarys_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - resigning}}</span>', $secretarys_name_resigning, $str);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - resigning}}</span>') !== false)
		                {
		                	$secretarys_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$secretarys_id_resigning_result = $secretarys_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$secretarys_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_id_resigning = (int)(count($secretarys_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($secretarys_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$secretarys_id_resigning = $secretarys_id_resigning.'<strong>'.$secretarys_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_secretarys_id_resigning)
		                		{
		                			$secretarys_id_resigning = $secretarys_id_resigning.' and <strong>'.$secretarys_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$secretarys_id_resigning = $secretarys_id_resigning.', <strong>'.$secretarys_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$secretarys_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - resigning}}</span>', $secretarys_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys - cessation date}}</span>') !== false)
		                {
		                	$secretarys_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$secretarys_cessation_date_result = $secretarys_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$secretarys_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_cessation_date = (int)(count($secretarys_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($secretarys_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$secretarys_cessation_date = $secretarys_cessation_date.'<strong>'.$secretarys_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_secretarys_cessation_date)
		                		{
		                			$secretarys_cessation_date = $secretarys_cessation_date.' and <strong>'.$secretarys_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$secretarys_cessation_date = $secretarys_cessation_date.', <strong>'.$secretarys_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$secretarys_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys - cessation date}}</span>', $secretarys_cessation_date, $str);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>') !== false)
		                {
		                	$secretarys_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$secretarys_name_appointment_result = $secretarys_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($director_name_appointment_result);

		                	$secretarys_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_name_appointment = (int)(count($secretarys_name_appointment_result)) - 1;
		                	for($g = 0; $g < count($secretarys_name_appointment_result); $g++)
		                	{
		                		if(strpos($str, '(Identification No. <span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>)') !== false)
		                		{
		                			if($g == 0)
			                		{
			                			$secretarys_name_appointment = $secretarys_name_appointment.$secretarys_name_appointment_result[$g]["name"].' (Identification No. '.$secretarys_name_appointment_result[$g]["identification_no"].')';
			                		}
			                		elseif($g == (int)$num_of_director_name_appointment)
			                		{
			                			$secretarys_name_appointment = $secretarys_name_appointment.' and '.$secretarys_name_appointment_result[$g]["name"].' (Identification No. '.$secretarys_name_appointment_result[$g]["identification_no"].')';
			                		}
			                		else
			                		{
			                			$secretarys_name_appointment = $secretarys_name_appointment.', '.$secretarys_name_appointment_result[$g]["name"].' (Identification No. '.$secretarys_name_appointment_result[$g]["identification_no"].')';
			                		}
		                		}
		                		else
		                		{
			                		if($g == 0)
			                		{
			                			$secretarys_name_appointment = $secretarys_name_appointment.'<strong>'.$secretarys_name_appointment_result[$g]["name"].'</strong>';
			                		}
			                		elseif($g == (int)$num_of_director_name_appointment)
			                		{
			                			$secretarys_name_appointment = $secretarys_name_appointment.' and <strong>'.$secretarys_name_appointment_result[$g]["name"].'</strong>';
			                		}
			                		else
			                		{
			                			$secretarys_name_appointment = $secretarys_name_appointment.', <strong>'.$secretarys_name_appointment_result[$g]["name"].'</strong>';
			                		}
			                	}
		                		
		                		array_push($latest_officer_id, (int)$secretarys_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	/*$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>', $secretarys_name_appointment, $str);*/
		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span> (Identification No. <span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>)', $secretarys_name_appointment, $str);
		                	}
		                	else
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys name - appointment}}</span>', $secretarys_name_appointment, $str);
		                	}

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>') !== false)
		                {
		                	$secretarys_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$secretarys_id_appointment_result = $secretarys_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$secretarys_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_id_appointment = (int)(count($secretarys_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($secretarys_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$secretarys_id_appointment = $secretarys_id_appointment.'<strong>'.$secretarys_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_secretarys_id_appointment)
		                		{
		                			$secretarys_id_appointment = $secretarys_id_appointment.' and <strong>'.$secretarys_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$secretarys_id_appointment = $secretarys_id_appointment.', <strong>'.$secretarys_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$secretarys_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys ID - appointment}}</span>', $secretarys_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Secretarys - appointment date}}</span>') !== false)
		                {
		                	$secretarys_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '4' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$secretarys_appointment_date_result = $secretarys_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$secretarys_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_appointment_date = (int)(count($secretarys_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($secretarys_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$secretarys_appointment_date = $secretarys_appointment_date.'<strong>'.$secretarys_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_secretarys_appointment_date)
		                		{
		                			$secretarys_appointment_date = $secretarys_appointment_date.' and <strong>'.$secretarys_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$secretarys_appointment_date = $secretarys_appointment_date.', <strong>'.$secretarys_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$secretarys_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Secretarys - appointment date}}</span>', $secretarys_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors name - resigning}}</span>') !== false)
		                {
		                	$auditors_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

		                	$auditors_name_resigning_result = $auditors_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$auditors_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_auditors_name_resigning = (int)(count($auditors_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($auditors_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$auditors_name_resigning = $auditors_name_resigning.'<strong>'.$auditors_name_resigning_result[$g]["company_name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_auditors_name_resigning)
		                		{
		                			$auditors_name_resigning = $auditors_name_resigning.' and <strong>'.$auditors_name_resigning_result[$g]["company_name"].'</strong>';
		                		}
		                		else
		                		{
		                			$auditors_name_resigning = $auditors_name_resigning.', <strong>'.$auditors_name_resigning_result[$g]["company_name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$auditors_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors name - resigning}}</span>', $auditors_name_resigning, $str);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors ID - resigning}}</span>') !== false)
		                {
		                	$auditors_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

		                	

		                	$auditors_id_resigning_result = $auditors_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$auditors_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_auditors_id_resigning = (int)(count($auditors_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($auditors_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$auditors_id_resigning = $auditors_id_resigning.'<strong>'.$auditors_id_resigning_result[$g]["register_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_auditors_id_resigning)
		                		{
		                			$auditors_id_resigning = $auditors_id_resigning.' and <strong>'.$auditors_id_resigning_result[$g]["register_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$auditors_id_resigning = $auditors_id_resigning.', <strong>'.$auditors_id_resigning_result[$g]["register_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$auditors_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors ID - resigning}}</span>', $auditors_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors - cessation date}}</span>') !== false)
		                {
		                	$auditors_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

		                	$auditors_cessation_date_result = $auditors_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$auditors_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_auditors_cessation_date = (int)(count($auditors_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($auditors_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$auditors_cessation_date = $auditors_cessation_date.'<strong>'.$auditors_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_auditors_cessation_date)
		                		{
		                			$auditors_cessation_date = $auditors_cessation_date.' and <strong>'.$auditors_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$auditors_cessation_date = $auditors_cessation_date.', <strong>'.$auditors_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$auditors_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors - cessation date}}</span>', $auditors_cessation_date, $str);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors name - appointment}}</span>') !== false)
		                {
		                	$auditors_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

		                	

		                	$auditors_name_appointment_result = $auditors_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($director_name_appointment_result);

		                	$auditors_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_auditors_name_appointment = (int)(count($auditors_name_appointment_result)) - 1;
		                	for($g = 0; $g < count($auditors_name_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$auditors_name_appointment = $auditors_name_appointment.$auditors_name_appointment_result[$g]["company_name"];
		                		}
		                		elseif($g == (int)$num_of_auditors_name_appointment)
		                		{
		                			$auditors_name_appointment = $auditors_name_appointment.' and '.$auditors_name_appointment_result[$g]["company_name"];
		                		}
		                		else
		                		{
		                			$auditors_name_appointment = $auditors_name_appointment.', '.$auditors_name_appointment_result[$g]["company_name"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$auditors_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);
		                	//echo json_encode($latest_officer_id);
		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors name - appointment}}</span>', $auditors_name_appointment, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>') !== false)
		                {
		                	$auditors_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

		                	//echo json_encode($old_office_date_result);

		                	$auditors_id_appointment_result = $auditors_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$auditors_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_secretarys_id_appointment = (int)(count($auditors_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($auditors_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$auditors_id_appointment = $auditors_id_appointment.$auditors_id_appointment_result[$g]["register_no"];
		                		}
		                		elseif($g == (int)$num_of_secretarys_id_appointment)
		                		{
		                			$auditors_id_appointment = $auditors_id_appointment.' and '.$auditors_id_appointment_result[$g]["register_no"];
		                		}
		                		else
		                		{
		                			$auditors_id_appointment = $auditors_id_appointment.', '.$auditors_id_appointment_result[$g]["register_no"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$auditors_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors ID - appointment}}</span>', $auditors_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Auditors - appointment date}}</span>') !== false)
		                {
		                	$auditors_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '5' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer_company.register_no, officer_company.company_name ORDER BY client_officers.id");

		                	

		                	$auditors_appointment_date_result = $auditors_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$auditors_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_auditors_appointment_date = (int)(count($auditors_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($auditors_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$auditors_appointment_date = $auditors_appointment_date.'<strong>'.$auditors_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_auditors_appointment_date)
		                		{
		                			$auditors_appointment_date = $auditors_appointment_date.' and <strong>'.$auditors_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$auditors_appointment_date = $auditors_appointment_date.', <strong>'.$auditors_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$auditors_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Auditors - appointment date}}</span>', $auditors_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers name - resigning}}</span>') !== false)
		                {
		                	$manager_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$manager_name_resigning_result = $manager_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$manager_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_manager_name_resigning = (int)(count($manager_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($manager_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$manager_name_resigning = $manager_name_resigning.$manager_name_resigning_result[$g]["name"];
		                		}
		                		elseif($g == (int)$num_of_manager_name_resigning)
		                		{
		                			$manager_name_resigning = $manager_name_resigning.' and '.$manager_name_resigning_result[$g]["name"];
		                		}
		                		else
		                		{
		                			$manager_name_resigning = $manager_name_resigning.', '.$manager_name_resigning_result[$g]["name"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$manager_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers name - resigning}}</span>', $manager_name_resigning, $str);

		                	
		                	//echo json_encode($officer_id_data);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers ID - resigning}}</span>') !== false)
		                {
		                	$manager_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$manager_id_resigning_result = $manager_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$manager_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_manager_id_resigning = (int)(count($manager_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($manager_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$manager_id_resigning = $manager_id_resigning.$manager_id_resigning_result[$g]["identification_no"];
		                		}
		                		elseif($g == (int)$num_of_manager_id_resigning)
		                		{
		                			$manager_id_resigning = $manager_id_resigning.' and '.$manager_id_resigning_result[$g]["identification_no"];
		                		}
		                		else
		                		{
		                			$manager_id_resigning = $manager_id_resigning.', '.$manager_id_resigning_result[$g]["identification_no"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$manager_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers ID - resigning}}</span>', $manager_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers - cessation date}}</span>') !== false)
		                {
		                	$manager_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$manager_cessation_date_result = $manager_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$manager_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_manager_cessation_date = (int)(count($manager_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($manager_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$manager_cessation_date = $manager_cessation_date.'<strong>'.$manager_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_manager_cessation_date)
		                		{
		                			$manager_cessation_date = $manager_cessation_date.' and <strong>'.$manager_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$manager_cessation_date = $manager_cessation_date.', <strong>'.$manager_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$manager_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers - cessation date}}</span>', $manager_cessation_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers name - appointment}}</span>') !== false)
		                {
		                	$manager_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$manager_name_appointment_result = $manager_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($director_name_appointment_result);

		                	$manager_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_manager_name_appointment = (int)(count($manager_name_appointment_result)) - 1;
		                	for($g = 0; $g < count($manager_name_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$manager_name_appointment = $manager_name_appointment.$manager_name_appointment_result[$g]["name"];
		                		}
		                		elseif($g == (int)$num_of_manager_name_appointment)
		                		{
		                			$manager_name_appointment = $manager_name_appointment.' and '.$manager_name_appointment_result[$g]["name"];
		                		}
		                		else
		                		{
		                			$manager_name_appointment = $manager_name_appointment.', '.$manager_name_appointment_result[$g]["name"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$manager_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers name - appointment}}</span>', $manager_name_appointment, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>') !== false)
		                {
		                	$manager_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$manager_id_appointment_result = $manager_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$manager_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_manager_id_appointment = (int)(count($manager_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($manager_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$manager_id_appointment = $manager_id_appointment.$manager_id_appointment_result[$g]["identification_no"];
		                		}
		                		elseif($g == (int)$num_of_manager_id_appointment)
		                		{
		                			$manager_id_appointment = $manager_id_appointment.' and '.$manager_id_appointment_result[$g]["identification_no"];
		                		}
		                		else
		                		{
		                			$manager_id_appointment = $manager_id_appointment.', '.$manager_id_appointment_result[$g]["identification_no"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$manager_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers ID - appointment}}</span>', $manager_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managers - appointment date}}</span>') !== false)
		                {
		                	$manager_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '3' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$manager_appointment_date_result = $manager_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$manager_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_manager_appointment_date = (int)(count($manager_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($manager_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$manager_appointment_date = $manager_appointment_date.'<strong>'.$manager_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_manager_appointment_date)
		                		{
		                			$manager_appointment_date = $manager_appointment_date.' and <strong>'.$manager_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$manager_appointment_date = $manager_appointment_date.', <strong>'.$manager_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$manager_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managers - appointment date}}</span>', $manager_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO name - old}}</span>') !== false)
		                {
		                	$ceo_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$ceo_name_resigning_result = $ceo_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$ceo_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_name_resigning = (int)(count($ceo_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($ceo_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$ceo_name_resigning = $ceo_name_resigning.'<strong>'.$ceo_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_ceo_name_resigning)
		                		{
		                			$ceo_name_resigning = $ceo_name_resigning.' and <strong>'.$ceo_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$ceo_name_resigning = $ceo_name_resigning.', <strong>'.$ceo_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$ceo_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO name - old}}</span>', $ceo_name_resigning, $str);

		                	
		                	//echo json_encode($officer_id_data);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO ID - old}}</span>') !== false)
		                {
		                	$ceo_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$ceo_id_resigning_result = $ceo_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$ceo_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_id_resigning = (int)(count($ceo_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($ceo_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$ceo_id_resigning = $ceo_id_resigning.'<strong>'.$ceo_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_ceo_id_resigning)
		                		{
		                			$ceo_id_resigning = $ceo_id_resigning.' and <strong>'.$ceo_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$ceo_id_resigning = $ceo_id_resigning.', <strong>'.$ceo_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$ceo_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO ID - old}}</span>', $ceo_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO date of cessation}}</span>') !== false)
		                {
		                	$ceo_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$ceo_cessation_date_result = $ceo_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$ceo_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_cessation_date = (int)(count($ceo_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($ceo_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$ceo_cessation_date = $ceo_cessation_date.'<strong>'.$ceo_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_ceo_cessation_date)
		                		{
		                			$ceo_cessation_date = $ceo_cessation_date.' and <strong>'.$ceo_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$ceo_cessation_date = $ceo_cessation_date.', <strong>'.$ceo_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$ceo_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO date of cessation}}</span>', $ceo_cessation_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO name - new}}</span>') !== false)
		                {
		                	$ceo_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$ceo_name_appointment_result = $ceo_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($director_name_appointment_result);

		                	$ceo_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_name_appointment = (int)(count($ceo_name_appointment_result)) - 1;
		                	for($g = 0; $g < count($ceo_name_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$ceo_name_appointment = $ceo_name_appointment.$ceo_name_appointment_result[$g]["name"];
		                		}
		                		elseif($g == (int)$num_of_ceo_name_appointment)
		                		{
		                			$ceo_name_appointment = $ceo_name_appointment.' and '.$ceo_name_appointment_result[$g]["name"];
		                		}
		                		else
		                		{
		                			$ceo_name_appointment = $ceo_name_appointment.', '.$ceo_name_appointment_result[$g]["name"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$ceo_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO name - new}}</span>', $ceo_name_appointment, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO ID - new}}</span>') !== false)
		                {
		                	$ceo_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$ceo_id_appointment_result = $ceo_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$ceo_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_id_appointment = (int)(count($ceo_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($ceo_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$ceo_id_appointment = $ceo_id_appointment.$ceo_id_appointment_result[$g]["identification_no"];
		                		}
		                		elseif($g == (int)$num_of_ceo_id_appointment)
		                		{
		                			$ceo_id_appointment = $ceo_id_appointment.' and '.$ceo_id_appointment_result[$g]["identification_no"];
		                		}
		                		else
		                		{
		                			$ceo_id_appointment = $ceo_id_appointment.', '.$ceo_id_appointment_result[$g]["identification_no"];
		                		}
		                		
		                		array_push($latest_officer_id, (int)$ceo_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO ID - new}}</span>', $ceo_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{CEO date of appointment}}</span>') !== false)
		                {
		                	$ceo_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '2' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$ceo_appointment_date_result = $ceo_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$ceo_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_appointment_date = (int)(count($ceo_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($ceo_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$ceo_appointment_date = $ceo_appointment_date.'<strong>'.$ceo_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_ceo_appointment_date)
		                		{
		                			$ceo_appointment_date = $ceo_appointment_date.' and <strong>'.$ceo_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$ceo_appointment_date = $ceo_appointment_date.', <strong>'.$ceo_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$ceo_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{CEO date of appointment}}</span>', $ceo_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director name - old}}</span>') !== false)
		                {
		                	$managing_director_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$managing_director_name_resigning_result = $managing_director_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$managing_director_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_managing_director_name_resigning = (int)(count($managing_director_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($managing_director_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$managing_director_name_resigning = $managing_director_name_resigning.'<strong>'.$managing_director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_managing_director_name_resigning)
		                		{
		                			$managing_director_name_resigning = $managing_director_name_resigning.' and <strong>'.$managing_director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$managing_director_name_resigning = $managing_director_name_resigning.', <strong>'.$managing_director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$managing_director_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director name - old}}</span>', $managing_director_name_resigning, $str);

		                	
		                	//echo json_encode($officer_id_data);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director ID - old}}</span>') !== false)
		                {
		                	$managing_director_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$managing_director_id_resigning_result = $managing_director_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$managing_director_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_managing_director_id_resigning = (int)(count($managing_director_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($managing_director_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$managing_director_id_resigning = $managing_director_id_resigning.'<strong>'.$managing_director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_managing_director_id_resigning)
		                		{
		                			$managing_director_id_resigning = $managing_director_id_resigning.' and <strong>'.$managing_director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$managing_director_id_resigning = $managing_director_id_resigning.', <strong>'.$managing_director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$managing_director_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director ID - old}}</span>', $managing_director_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director date of cessation}}</span>') !== false)
		                {
		                	$managing_director_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$managing_director_cessation_date_result = $managing_director_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$managing_director_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_ceo_cessation_date = (int)(count($managing_director_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($managing_director_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$managing_director_cessation_date = $managing_director_cessation_date.'<strong>'.$managing_director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_ceo_cessation_date)
		                		{
		                			$managing_director_cessation_date = $managing_director_cessation_date.' and <strong>'.$managing_director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$managing_director_cessation_date = $managing_director_cessation_date.', <strong>'.$managing_director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$managing_director_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director date of cessation}}</span>', $managing_director_cessation_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director name - new}}</span>') !== false)
		                {
		                	$managing_director_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$managing_director_name_appointment_result = $managing_director_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($director_name_appointment_result);

		                	$managing_director_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_managing_director_name_appointment = (int)(count($managing_director_name_appointment_result)) - 1;
		                	for($g = 0; $g < count($managing_director_name_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$managing_director_name_appointment = $managing_director_name_appointment.'<strong>'.$managing_director_name_appointment_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_managing_director_name_appointment)
		                		{
		                			$managing_director_name_appointment = $managing_director_name_appointment.' and <strong>'.$managing_director_name_appointment_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$managing_director_name_appointment = $managing_director_name_appointment.', <strong>'.$managing_director_name_appointment_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$managing_director_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director name - new}}</span>', $managing_director_name_appointment, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director ID - new}}</span>') !== false)
		                {
		                	$managing_director_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$managing_director_id_appointment_result = $managing_director_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$managing_director_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_managing_director_id_appointment = (int)(count($managing_director_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($managing_director_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$managing_director_id_appointment = $managing_director_id_appointment.'<strong>'.$managing_director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_managing_director_id_appointment)
		                		{
		                			$managing_director_id_appointment = $managing_director_id_appointment.' and <strong>'.$managing_director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$managing_director_id_appointment = $managing_director_id_appointment.', <strong>'.$managing_director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$managing_director_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director ID - new}}</span>', $managing_director_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Managing Director date of appointment}}</span>') !== false)
		                {
		                	$managing_director_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '6' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$managing_director_appointment_date_result = $managing_director_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$managing_director_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_managing_director_appointment_date = (int)(count($managing_director_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($managing_director_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$managing_director_appointment_date = $managing_director_appointment_date.'<strong>'.$managing_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_managing_director_appointment_date)
		                		{
		                			$managing_director_appointment_date = $managing_director_appointment_date.' and <strong>'.$managing_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$managing_director_appointment_date = $managing_director_appointment_date.', <strong>'.$managing_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$managing_director_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Managing Director date of appointment}}</span>', $managing_director_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director name - old}}</span>') !== false)
		                {
		                	$alternate_director_name_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	$alternate_director_name_resigning_result = $alternate_director_name_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$alternate_director_name_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_alternate_director_name_resigning = (int)(count($alternate_director_name_resigning_result)) - 1;
		                	for($g = 0; $g < count($alternate_director_name_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$alternate_director_name_resigning = $alternate_director_name_resigning.'<strong>'.$alternate_director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_alternate_director_name_resigning)
		                		{
		                			$alternate_director_name_resigning = $alternate_director_name_resigning.' and <strong>'.$alternate_director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$alternate_director_name_resigning = $alternate_director_name_resigning.', <strong>'.$alternate_director_name_resigning_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$alternate_director_name_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director name - old}}</span>', $alternate_director_name_resigning, $str);

		                	
		                	//echo json_encode($officer_id_data);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director ID - old}}</span>') !== false)
		                {
		                	$alternate_director_id_resigning_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$alternate_director_id_resigning_result = $alternate_director_id_resigning_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$alternate_director_id_resigning = "";

		                	$latest_officer_id = array();
		                	$num_of_alternate_director_id_resigning = (int)(count($alternate_director_id_resigning_result)) - 1;
		                	for($g = 0; $g < count($alternate_director_id_resigning_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$alternate_director_id_resigning = $alternate_director_id_resigning.'<strong>'.$alternate_director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_alternate_director_id_resigning)
		                		{
		                			$alternate_director_id_resigning = $alternate_director_id_resigning.' and <strong>'.$alternate_director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$alternate_director_id_resigning = $alternate_director_id_resigning.', <strong>'.$alternate_director_id_resigning_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$alternate_director_id_resigning_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director ID - old}}</span>', $alternate_director_id_resigning, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director cessation - old}}</span>') !== false)
		                {
		                	$alternate_director_cessation_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$alternate_director_cessation_date_result = $alternate_director_cessation_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$alternate_director_cessation_date = "";

		                	$latest_officer_id = array();
		                	$num_of_alternate_director_cessation_date = (int)(count($alternate_director_cessation_date_result)) - 1;
		                	for($g = 0; $g < count($alternate_director_cessation_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$alternate_director_cessation_date = $alternate_director_cessation_date.'<strong>'.$alternate_director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_alternate_director_cessation_date)
		                		{
		                			$alternate_director_cessation_date = $alternate_director_cessation_date.' and <strong>'.$alternate_director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		else
		                		{
		                			$alternate_director_cessation_date = $alternate_director_cessation_date.', <strong>'.$alternate_director_cessation_date_result[$g]["date_of_cessation"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$alternate_director_cessation_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director cessation - old}}</span>', $alternate_director_cessation_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director name - new}}</span>') !== false)
		                {
		                	$alternate_director_name_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$alternate_director_name_appointment_result = $alternate_director_name_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	/*echo json_encode($alternate_director_name_appointment_result);*/

		                	$alternate_director_name_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_alternate_director_name_appointment = (int)(count($alternate_director_name_appointment_result)) - 1;
		                	for($g = 0; $g < count($alternate_director_name_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$alternate_director_name_appointment = $alternate_director_name_appointment.'<strong>'.$alternate_director_name_appointment_result[$g]["name"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_alternate_director_name_appointment)
		                		{
		                			$alternate_director_name_appointment = $alternate_director_name_appointment.' and <strong>'.$alternate_director_name_appointment_result[$g]["name"].'</strong>';
		                		}
		                		else
		                		{
		                			$alternate_director_name_appointment = $alternate_director_name_appointment.', <strong>'.$alternate_director_name_appointment_result[$g]["name"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$alternate_director_name_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director name - new}}</span>', $alternate_director_name_appointment, $str);
		                	//echo json_encode($alternate_director_name_appointment_result);
		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director ID - new}}</span>') !== false)
		                {
		                	$alternate_director_id_appointment_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$alternate_director_id_appointment_result = $alternate_director_id_appointment_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$alternate_director_id_appointment = "";

		                	$latest_officer_id = array();
		                	$num_of_alternate_director_id_appointment = (int)(count($alternate_director_id_appointment_result)) - 1;
		                	for($g = 0; $g < count($alternate_director_id_appointment_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$alternate_director_id_appointment = $alternate_director_id_appointment.'<strong>'.$alternate_director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_alternate_director_id_appointment)
		                		{
		                			$alternate_director_id_appointment = $alternate_director_id_appointment.' and <strong>'.$alternate_director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		else
		                		{
		                			$alternate_director_id_appointment = $alternate_director_id_appointment.', <strong>'.$alternate_director_id_appointment_result[$g]["identification_no"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$alternate_director_id_appointment_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director ID - new}}</span>', $alternate_director_id_appointment, $str);

		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Alternate director appointment - new}}</span>') !== false)
		                {
		                	$alternate_director_appointment_date_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '7' AND company_code='".$company_code."' AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_result."','%d/%m/%Y') GROUP BY officer.identification_no, officer.name ORDER BY client_officers.id");

		                	

		                	$alternate_director_appointment_date_result = $alternate_director_appointment_date_result->result_array();

		                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
		                	//echo json_encode($company_code);

		                	$alternate_director_appointment_date = "";

		                	$latest_officer_id = array();
		                	$num_of_alternate_director_appointment_date = (int)(count($alternate_director_appointment_date_result)) - 1;
		                	for($g = 0; $g < count($alternate_director_appointment_date_result); $g++)
		                	{
		                		if($g == 0)
		                		{
		                			$alternate_director_appointment_date = $alternate_director_appointment_date.'<strong>'.$alternate_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		elseif($g == (int)$num_of_alternate_director_appointment_date)
		                		{
		                			$alternate_director_appointment_date = $alternate_director_appointment_date.' and <strong>'.$alternate_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		else
		                		{
		                			$alternate_director_appointment_date = $alternate_director_appointment_date.', <strong>'.$alternate_director_appointment_date_result[$g]["date_of_appointment"].'</strong>';
		                		}
		                		
		                		array_push($latest_officer_id, (int)$alternate_director_appointment_date_result[$g]["id"]);
		                	}
		                	$data_pending_document['officer_id']=json_encode($latest_officer_id);

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Alternate director appointment - new}}</span>', $alternate_director_appointment_date, $str);

		                	
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Members name - all}}</span>') !== false)
		                {
		                	$member_name_result = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$company_code.'" GROUP BY member_shares.field_type, member_shares.officer_id,member_shares.client_member_share_capital_id HAVING sum(member_shares.number_of_share) != 0');
		                	
		                	$member_name_result = $member_name_result->result_array();


		                	$member_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';

		                	for($g = 0; $g < count($member_name_result); $g++)
		                	{
		                		if($member_name_result[$g]["name"] != null)
		                		{
		                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
		                		}
		                		elseif($member_name_result[$g]["company_name"] != null)
		                		{
		                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["company_name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
		                		}
		                	}

		                	$member_name = $member_name.'</tbody></table>';

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Members name - all}}</span>', $member_name, $str);
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Chairman}}</span>') !== false)
						{
							$chairman_result = $this->db->query("select chairman from client_signing_info where company_code='".$company_code."'");
		                	
		                	if ($chairman_result->num_rows() > 0) 
		                	{

			                	$chairman_result = $chairman_result->result_array();

			                	$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));

			                	if($chairman_result_info[1] == "individual")
			                	{
			                		$officer_result = $this->db->query("select * from officer where id='".$chairman_result_info[0]."' AND field_type='".$chairman_result_info[1]."'");

			                		$officer_result = $officer_result->result_array();

			                		$name = $officer_result[0]["name"];
			                	}
			                	elseif($chairman_result_info[1] == "company")
			                	{
			                		$officer_company_result = $this->db->query("select * from officer_company where id='".$chairman_result_info[0]."' AND field_type='".$chairman_result_info[1]."'");

			                		$officer_company_result = $officer_company_result->result_array();

			                		$name = $officer_company_result[0]["company_name"];
			                	}

								$str = str_replace('<span class="myclass mceNonEditable">{{Chairman}}</span>', $name, $str);
							}
						}

		                $data_pending_document['content'] = $str;
		            }

	                //echo json_encode($officer_id_data);
	                if(count($previous_director_name_result) != 0 && $previous_director_name_result != null)
	            	{
	            		$officer_id_data = array();
	            		for($f = 0; $f < count($previous_director_name_result); $f++)
	                	{
	                		array_push($officer_id_data, (int)$previous_director_name_result[$f]["id"]);
	                	}
	            	}
	            	elseif($delete_officer_id != null)
	            	{
	            		$officer_id_data = json_decode($delete_officer_id);
	            	}

	                

	                
	                //echo json_encode($officer_id_data);
	            	if(count($latest_officer_id) == 0)
	            	{
	            		/*echo json_encode($officer_id_data);
	            		echo json_encode($document_name);
	            		echo json_encode($old_office_date_result);*/
	            		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
	            		$this->db->where('client_id', $client_id);
	            		$this->db->where('received_on', "");
	            		$this->db->where('officer_id', json_encode($officer_id_data));
	            		$this->db->where('transaction_date', $old_office_date_result);
	            		$this->db->where('document_name', $document_name);
						$this->db->delete('pending_documents');
	            	}
	            	else
	            	{
	            		/*echo json_encode($data_pending_document);
	            		echo json_encode($document_master_result[$r]["triggered_by"]);
		                echo json_encode($client_id);
		                echo json_encode($officer_id_data);
		            	echo json_encode($old_office_date_result);*/
	            		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "officer_id" => json_encode($officer_id_data), 'transaction_date' => $old_office_date_result, 'document_name' => $document_name));  
	            	}
	            }
	        }
		//}
	}

	public function delete_officer ()
	{
		$id = $_POST["client_officer_id"];

		if($id != "")
		{
			$query = $this->db->get_where("client_officers", array("alternate_of" => $_POST['client_officer_id']));

			if ($query->num_rows())//if don't have anythings
			{
				echo json_encode(array("Status" => 2));
			}
			else
			{
			
				$this->db->where('officer_id', json_encode(array((int)$id)));
				$this->db->delete('pending_documents');

				$this->db->delete("history_client_officers",array('id'=>$id));

				$this->db->delete("client_officers",array('id'=>$id));

				$pending_documents = $this->db->query("select pending_documents.*, client.company_code from pending_documents left join client on client.id = pending_documents.client_id where triggered_by = 8 OR triggered_by = 9 OR triggered_by = 10 OR triggered_by = 11 OR triggered_by = 12 OR triggered_by = 13 OR triggered_by = 14 OR triggered_by = 15 OR triggered_by = 16 OR triggered_by = 17 OR triggered_by = 18 OR triggered_by = 19 OR triggered_by = 20 OR triggered_by = 21");

				if ($pending_documents->num_rows() > 0) 
				{
					$pending_documents = $pending_documents->result_array();

					for($k = 0; $k < count($pending_documents); $k++)
					{
						//echo json_encode(in_array((int)$id, json_decode($pending_documents[$k]["charge_id"])));
						if (in_array((int)$id, json_decode($pending_documents[$k]["officer_id"])))
			  			{
							if($pending_documents[$k]["triggered_by"] == '8')
							{

								$this->change_officer_date_of_appointment_document_info("appointment_of_director", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);

							}
							elseif($pending_documents[$k]["triggered_by"] == '9')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_director", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '10')
							{
								$this->change_officer_date_of_appointment_document_info("appointment_of_ceo", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '11')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_ceo", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '12')
							{
								$this->change_officer_date_of_appointment_document_info("appointment_of_manager", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '13')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_manager", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '14')
							{
								$this->change_officer_date_of_appointment_document_info("appointment_of_secretary", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '15')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_secretary", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '16')
							{
								$this->change_officer_date_of_appointment_document_info("appointment_of_auditor", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '17')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_auditor", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '18')
							{
								$this->change_officer_date_of_appointment_document_info("appointment_of_managing_director", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '19')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_managing_director", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '20')
							{
								$this->change_officer_date_of_appointment_document_info("appointment_of_alternate_director", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							elseif($pending_documents[$k]["triggered_by"] == '21')
							{
								$this->change_officer_date_of_appointment_document_info("cessation_of_alternate_director", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["officer_id"]);
							}
							
						}
					}
				}
				echo json_encode(array("Status" => 1));
				
			}
		}
		else
		{
			echo json_encode(array("Status" => 1));
		}
	}

	public function check_controller_data()
	{
		$check_date_of_registration = [];
		$check_date_of_registration[0]['date_of_registration']=$_POST['date_of_registration'][0];

		$check_date_of_cessation = [];
		$check_date_of_cessation[0]['date_of_cessation']=$_POST['date_of_cessation'][0];

		$query = $this->db->get_where("history_client_controller", array("id" => $_POST['client_controller_id'][0]));

		if (!$query->num_rows())//if don't have anythings
		{
			echo false;
		}
		else
		{
			$query = $query->result_array();

			$old_office_date_of_registration_result = $this->db->query("select date_of_registration from client_controller where id='".$_POST['client_controller_id'][0]."'");

			$old_office_date_of_registration_result = $old_office_date_of_registration_result->result_array();

			$get_client_info = $this->db->query("select * from client where company_code='".$_POST['company_code']."'");

			$get_client_info = $get_client_info->result_array();

			if(!($old_office_date_of_registration_result == $check_date_of_registration))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "controller_id" => $_POST['client_controller_id'][0], "received_on" => "", "triggered_by" => "15"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

			$old_office_date_of_cessation_result = $this->db->query("select date_of_cessation from client_controller where id='".$_POST['client_controller_id'][0]."'");

			$old_office_date_of_cessation_result = $old_office_date_of_cessation_result->result_array();

			if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "controller_id" => $_POST['client_controller_id'][0], "received_on" => "", "triggered_by" => "16"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}
		}
	}

	public function add_controller ()
	{
		
			$identification_register_no = $_POST['identification_register_no'];
			$name = $_POST['name'];

			for($i = 0; $i < count($_POST['identification_register_no']); $i++ )
			{
				 $this->form_validation->set_rules('identification_register_no['.$i.']', 'Id', 'required');
				 $this->form_validation->set_rules('name['.$i.']', 'Name', 'required');
				 //$this->form_validation->set_rules('date_of_birth['.$i.']', 'Date of birth', 'required');
				 $this->form_validation->set_rules('address['.$i.']', 'Address', 'required');
				 $this->form_validation->set_rules('date_of_registration['.$i.']', 'Date of registration', 'required');
				 $this->form_validation->set_rules('date_of_notice['.$i.']', 'Date of notice', 'required');
				 $this->form_validation->set_rules('confirmation_received_date['.$i.']', 'Confirmation received date', 'required');
				 $this->form_validation->set_rules('date_of_entry['.$i.']', 'Date of entry', 'required');
				 //$this->form_validation->set_rules('date_of_cessation['.$i.']', 'Date of cessation', 'required');

				 $date_of_registration = strtotime(str_replace('/', '-',$_POST['date_of_registration'][$i]));
				 $date_of_cessation = strtotime(str_replace('/', '-',$_POST['date_of_cessation'][$i]));

				 
		        if ($this->form_validation->run() == FALSE || $date_of_cessation < $date_of_registration && $date_of_cessation != "")
		        {
		        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

		        	if($date_of_cessation < $date_of_registration && $date_of_cessation != "")
		        	{
		        		 $validate_date_of_cessation = "The Date of cessation field must larger than Date of appointment.";
		        	}
		        	else
		        	{
		        		$validate_date_of_cessation = "";
		        	}

		        	/*if($_POST['nationality'][$i] == "0")
		        	{
		        		 $validate_nationality = "*The Nationality field is required.";
		        	}
		        	else
		        	{
		        		$validate_nationality = "";
		        	}*/


		        	$error = array(
		        					
					                'identification_register_no' => strip_tags(form_error('identification_register_no['.$i.']')),
					                'name' => strip_tags(form_error('name['.$i.']')),
					                /*'date_of_birth' => strip_tags(form_error('date_of_birth['.$i.']')),
					                'nationality' => $validate_nationality,*/
					                'address' => strip_tags(form_error('address['.$i.']')),
					                'date_of_registration' => strip_tags(form_error('date_of_registration['.$i.']')),
					                'date_of_notice' => strip_tags(form_error('date_of_notice['.$i.']')),
					                'confirmation_received_date' => strip_tags(form_error('confirmation_received_date['.$i.']')),
					                'date_of_entry' => strip_tags(form_error('date_of_entry['.$i.']')),
					                'date_of_cessation' => $validate_date_of_cessation,
					                // /'compare_date_of_cessation' => $validate_date_of_cessation,
					                
					            );

		        	if($date_of_cessation < $date_of_registration && $date_of_cessation != "")
		        	{
		        		echo json_encode(array("Status" => 0, 'message' => 'The Date of cessation field must larger than Date of appointment.', 'title' => 'Error', "error" => $error));
		        	}
		        	else
		        	{
		        		echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field.', 'title' => 'Error', "error" => $error));
		        	}
		        	

		        }
		        else
		        {

		        	/*if ($_POST['position'][$i] == "5")
					{
						$q = $this->db->query("select * from officer_company where register_no='".$_POST['identification_register_no'][$i]."'");
						//echo json_encode($q);
						if ($q->num_rows() > 0) {
							$have_this_member = 1;
				            // foreach (($q->result()) as $row) {
				                // $data[] = $row;
				            // }
				            // return $data;
				        } 
				        else 
				       	{
				       		$have_this_member = 0;
				       	}
					}
					else
					{
						//$q = $this->db->query("select * from officer where identification_no='".$identification_register_no."'");

						$q = $this->db->query("select * from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$_POST['identification_register_no'][$i]."'");

						//echo json_encode($q->result()[0]);
						if ($q->num_rows() > 0) {
							$have_this_member = 1;
				            // foreach (($q->result()) as $row) {
				                // $data[] = $row;
				            // }
				            // return $data;
				        } 
				        else 
				        {
				        	$have_this_member = 0;
				        }
					}*/

					/*if($have_this_member)
					{*/
						$data['company_code']=$_POST['company_code'];
						$data['officer_id']=$_POST['officer_id'];
						$data['field_type']=$_POST['officer_field_type'];
						$data['date_of_birth']=$_POST['date_of_birth'][$i];
						$data['nationality_name']=strtoupper($_POST['nationality'][$i]);
						$data['address']=strtoupper($_POST['address'][$i]);
						$data['date_of_registration']=$_POST['date_of_registration'][$i];
						$data['date_of_notice']=$_POST['date_of_notice'][$i];
						$data['confirmation_received_date']=$_POST['confirmation_received_date'][$i];
						$data['date_of_entry']=$_POST['date_of_entry'][$i];
						$data['date_of_cessation']=$_POST['date_of_cessation'][$i];

						/*$check_date = $this->db->query("select * from client_officers where position='".$data['position']."' AND alternate_of = '".$data['alternate_of']."' AND officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."'");

						$check_date = $check_date->result_array();

						if($check_date[0]["date_of_cessation"] == null && count($check_date) != 0)
						{
							echo json_encode(array("Status" => 2, 'message' => 'This person have not resign.', 'title' => 'Error', 'data' => $check_date));
						}
						elseif($check_date[0]["date_of_cessation"] != null && count($check_date) != 0)
						{
							$array = explode('/', $check_date[0]["date_of_cessation"]);
							$tmp = $array[0];
							$array[0] = $array[1];
							$array[1] = $tmp;
							unset($tmp);
							$new_date = implode('/', $array);
							$time = strtotime($new_date);
							$new_date = date('d-m-Y',$time);

							if($data['date_of_appointment'] > $new_date)
							{
								echo json_encode(array("Status" => 2, 'message' => 'Date of appointment cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
							}
							else
							{

							}
		                	
						}
						else
						{*/
							$q = $this->db->get_where("client_controller", array("id" => $_POST['client_controller_id'][$i]));

							if (!$q->num_rows())
							{
								$arrays = explode('/', $data['date_of_registration']);
								$tmps = $arrays[0];
								$arrays[0] = $arrays[1];
								$arrays[1] = $tmps;
								unset($tmps);
								$new_date_of_registrations = implode('/', $arrays);

								if($data['date_of_cessation'] != "")
								{
									$date_of_cessation_arrays = explode('/', $data['date_of_cessation']);
									$date_of_cessation_tmps = $date_of_cessation_arrays[0];
									$date_of_cessation_arrays[0] = $date_of_cessation_arrays[1];
									$date_of_cessation_arrays[1] = $date_of_cessation_tmps;
									unset($date_of_cessation_tmps);
									$new_date_of_cessations = implode('/', $date_of_cessation_arrays);
								}

								$check_previous_date_appointment = $this->db->query("select * from client_controller where officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' ORDER BY  STR_TO_DATE(client_controller.date_of_registration,'%d/%m/%Y') DESC");

								if(!$check_previous_date_appointment->num_rows())
								{
									$not_overlapped = true;
								}
								else
								{
									$check_previous_date_appointment = $check_previous_date_appointment->result_array();

									$arrays = explode('/', $check_previous_date_appointment[0]["date_of_registration"]);
									$tmps = $arrays[0];
									$arrays[0] = $arrays[1];
									$arrays[1] = $tmps;
									unset($tmps);
									$new_previous_date_registration = implode('/', $arrays);

									if(strtotime($new_previous_date_registration) > strtotime($new_date_of_registrations) && $data['date_of_cessation'] == "")
									{
										$not_overlapped = false;
									}
									elseif (strtotime($new_date_of_cessations) > strtotime($new_previous_date_registration) && $data['date_of_cessation'] != "")
									{
										//echo json_encode($new_date_of_cessations);
										$not_overlapped = false;
									}
									else
									{
										$not_overlapped = true;
									}
								}
								

								if($not_overlapped)
								{
									$check_date = $this->db->query("select * from client_controller where officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' ORDER BY STR_TO_DATE(client_controller.date_of_registration,'%d/%m/%Y') DESC LIMIT 2");

									//from_unixtime(UNIX_TIMESTAMP(STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y')),'%Y-%m-%d')

									$check_date = $check_date->result_array();
									//echo json_encode($check_date);
									if(count($check_date) == 1)
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_registration = $check_date[0]["date_of_registration"];
									}
									else
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_registration = $check_date[0]["date_of_registration"];
									}

									if($date_of_cessation == null && count($check_date) != 0)
									{
										$array = explode('/', $date_of_registration);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date = implode('/', $array);
										$new_date_of_registration = strtotime($new_date_of_registration);
										//$new_date_of_registration = date('d/m/Y',$time);

										if($new_date_of_cessations != "")
										{
											if( strtotime($new_date_of_cessations) >= $new_date_of_registration)
											{
												echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
											}
											else
											{
												$this->db->insert("client_controller",$data);
												$insert_client_controller_id = $this->db->insert_id();

												echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_controller_id" => $insert_client_controller_id));
											}
										}
										else
										{
											echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
										}
										
										
									}
									elseif($date_of_cessation != null && count($check_date) != 0)
									{
										$array = explode('/', $date_of_cessation);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date_cess = implode('/', $array);
										// $time = strtotime($new_date);
										// $new_date = date('d/m/Y',$time);

										$old_date_registration_array = explode('/', $date_of_registration);
										$old_date_registration_tmp = $old_date_registration_array[0];
										$old_date_registration_array[0] = $old_date_registration_array[1];
										$old_date_registration_array[1] = $old_date_registration_tmp;
										unset($old_date_registration_tmp);
										$old_date_registration = implode('/', $old_date_registration_array);
										


										/*echo json_encode($new_date_cess);
										echo json_encode($new_date_of_registrations);*/
										if(strtotime($new_date_cess) > strtotime($new_date_of_registrations) && strtotime($new_date_of_registrations) > strtotime($old_date_registration))
										{	
											//echo json_encode($new_date);
											echo json_encode(array("Status" => 2, 'message' => 'Date of register cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
										}
										else
										{
											$this->db->insert("client_controller",$data);
											$insert_client_controller_id = $this->db->insert_id();

											
											echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_controller_id" => $insert_client_controller_id));
										}
					                	
									}
									else
									{
										$this->db->insert("client_controller",$data);
										$insert_client_controller_id = $this->db->insert_id();

										
										echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_controller_id" => $insert_client_controller_id));
									}
								}
								else
								{
									echo json_encode(array("Status" => 2, 'message' => 'The person is already registered on controller on the date.', 'title' => 'Error', 'data' => ""));
								}
							} 
							else 
							{
								$arrays = explode('/', $data['date_of_registration']);
								$tmps = $arrays[0];
								$arrays[0] = $arrays[1];
								$arrays[1] = $tmps;
								unset($tmps);
								$new_date_of_registrations = implode('/', $arrays);

								if($data['date_of_cessation'] != "")
								{
									$date_of_cessation_arrays = explode('/', $data['date_of_cessation']);
									$date_of_cessation_tmps = $date_of_cessation_arrays[0];
									$date_of_cessation_arrays[0] = $date_of_cessation_arrays[1];
									$date_of_cessation_arrays[1] = $date_of_cessation_tmps;
									unset($date_of_cessation_tmps);
									$new_date_of_cessations = implode('/', $date_of_cessation_arrays);
								}

								$check_previous_date_appointment = $this->db->query("select * from client_controller where officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' AND id != '".$_POST['client_controller_id'][$i]."' ORDER BY STR_TO_DATE(client_controller.date_of_registration,'%d/%m/%Y') DESC");

								if(!$check_previous_date_appointment->num_rows())
								{
									$not_overlapped = true;
								}
								else
								{
									$check_previous_date_appointment = $check_previous_date_appointment->result_array();

									$arrays = explode('/', $check_previous_date_appointment[0]["date_of_registration"]);
									$tmps = $arrays[0];
									$arrays[0] = $arrays[1];
									$arrays[1] = $tmps;
									unset($tmps);
									$new_previous_date_registration = implode('/', $arrays);

									if(strtotime($new_previous_date_registration) > strtotime($new_date_of_registrations) && $data['date_of_cessation'] == "")
									{
										$not_overlapped = false;
									}
									elseif (strtotime($new_date_of_cessations) > strtotime($new_previous_date_registration) && strtotime($new_previous_date_registration) > strtotime($new_date_of_registrations) && $data['date_of_cessation'] != "")
									{
										//echo json_encode($new_date_of_cessations);
										$not_overlapped = false;
									}
									else
									{
										$not_overlapped = true;
									}
								}
								

								if($not_overlapped)
								{

									$check_date = $this->db->query("select * from client_controller where officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' AND id != '".$_POST['client_controller_id'][$i]."' ORDER BY STR_TO_DATE(client_controller.date_of_registration,'%d/%m/%Y') DESC LIMIT 2");
									//AND id < '".$_POST['client_controller_id'][$i]."'
									//from_unixtime(UNIX_TIMESTAMP(STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y')),'%Y-%m-%d')

									$check_date = $check_date->result_array();
									//echo json_encode($check_date);
									if(count($check_date) == 1)
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_registration = $check_date[0]["date_of_registration"];
									}
									else
									{
										$date_of_cessation = $check_date[0]["date_of_cessation"];
										$date_of_registration = $check_date[0]["date_of_registration"];
									}

									if($date_of_cessation == null && count($check_date) != 0)
									{
										$array = explode('/', $date_of_registration);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date = implode('/', $array);
										$new_date_of_registration = strtotime($new_date_of_registration);
										//$new_date_of_registration = date('d/m/Y',$time);

										if($new_date_of_cessations != "")
										{
											if( strtotime($new_date_of_cessations) >= $new_date_of_registration)
											{
												echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
											}
											else
											{
												$this->db->insert("client_controller",$data);
												$insert_client_controller_id = $this->db->insert_id();

												echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_controller_id" => $insert_client_controller_id));
											}
										}
										else
										{
											echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
										}
										
										
									}
									elseif($date_of_cessation != null && count($check_date) != 0)
									{
										$array = explode('/', $date_of_cessation);
										$tmp = $array[0];
										$array[0] = $array[1];
										$array[1] = $tmp;
										unset($tmp);
										$new_date_cess = implode('/', $array);
										// $time = strtotime($new_date);
										// $new_date = date('d/m/Y',$time);

										$old_date_registration_array = explode('/', $date_of_registration);
										$old_date_registration_tmp = $old_date_registration_array[0];
										$old_date_registration_array[0] = $old_date_registration_array[1];
										$old_date_registration_array[1] = $old_date_registration_tmp;
										unset($old_date_registration_tmp);
										$old_date_registration = implode('/', $old_date_registration_array);
										


										/*echo json_encode($new_date_cess);
										echo json_encode($new_date_of_registrations);*/
										if(strtotime($new_date_cess) > strtotime($new_date_of_registrations) && strtotime($new_date_of_registrations) > strtotime($old_date_registration))
										{	
											//echo json_encode($new_date);
											echo json_encode(array("Status" => 2, 'message' => 'Date of register cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
										}
										else
										{
											$check_date_of_registration = [];
											$check_date_of_cessation = [];
											$check_date_of_registration[0]['date_of_registration']=$_POST['date_of_registration'][$i];

											$check_date_of_cessation[0]['date_of_cessation']=$_POST['date_of_cessation'][$i];

											$old_office_date_of_registration_result = $this->db->query("select date_of_registration from client_controller where id='".$_POST['client_controller_id'][$i]."'");

											$old_office_date_of_registration_result = $old_office_date_of_registration_result->result_array();

											$old_office_date_of_cessation_result = $this->db->query("select date_of_cessation from client_controller where id='".$_POST['client_controller_id'][$i]."'");

											$old_office_date_of_cessation_result = $old_office_date_of_cessation_result->result_array();

											$this->db->update("client_controller",$data,array("id" => $_POST['client_controller_id'][$i]));

											

											if(!($old_office_date_of_registration_result == $check_date_of_registration))
											{
												$check_history_client_controller = $this->db->get_where("history_client_controller", array("id" => $_POST['client_controller_id'][$i]));
												if (!$check_history_client_controller->num_rows())
												{
													$w = $q->result();

													foreach($w as $r) {
												        $this->db->insert("history_client_controller",$r);
												    }
												} 
												else 
												{
													$x = $q->result_array();

													$data_history['date_of_registration'] = $x[0]["date_of_registration"];

												    $this->db->update("history_client_controller",$data_history,array("id" => $_POST['client_controller_id'][$i]));
													
												}

												//$this->create_document("change_registration_of_controller", $_POST['company_code'], null, $_POST['client_controller_id'][$i]);
											}

											if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
											{
												$check_history_client_controller = $this->db->get_where("history_client_controller", array("id" => $_POST['client_controller_id'][$i]));
												if (!$check_history_client_controller->num_rows())
												{
													$g = $q->result();

													foreach($g as $r) {
												        $this->db->insert("history_client_controller",$r);
												    }
												} 
												else 
												{
													$z = $q->result_array();

													$data_history['date_of_cessation'] = $z[0]["date_of_cessation"];

												    $this->db->update("history_client_controller",$data_history,array("id" => $_POST['client_controller_id'][$i]));
													
												}

												//$this->create_document("change_cessation_of_controller", $_POST['company_code'], null, $_POST['client_controller_id'][$i]);
											}

											echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_controller_id" => $insert_client_controller_id));
										}
									}
									else
									{
										$check_date_of_registration = [];
										$check_date_of_cessation = [];
										$check_date_of_registration[0]['date_of_registration']=$_POST['date_of_registration'][$i];

										$check_date_of_cessation[0]['date_of_cessation']=$_POST['date_of_cessation'][$i];

										$old_office_date_of_registration_result = $this->db->query("select date_of_registration from client_controller where id='".$_POST['client_controller_id'][$i]."'");

										$old_office_date_of_registration_result = $old_office_date_of_registration_result->result_array();

										$old_office_date_of_cessation_result = $this->db->query("select date_of_cessation from client_controller where id='".$_POST['client_controller_id'][$i]."'");

										$old_office_date_of_cessation_result = $old_office_date_of_cessation_result->result_array();

										$this->db->update("client_controller",$data,array("id" => $_POST['client_controller_id'][$i]));

										

										if(!($old_office_date_of_registration_result == $check_date_of_registration))
										{
											$check_history_client_controller = $this->db->get_where("history_client_controller", array("id" => $_POST['client_controller_id'][$i]));
											if (!$check_history_client_controller->num_rows())
											{
												$w = $q->result();

												foreach($w as $r) {
											        $this->db->insert("history_client_controller",$r);
											    }
											} 
											else 
											{
												$x = $q->result_array();

												$data_history['date_of_registration'] = $x[0]["date_of_registration"];

											    $this->db->update("history_client_controller",$data_history,array("id" => $_POST['client_controller_id'][$i]));
												
											}

											//$this->create_document("change_registration_of_controller", $_POST['company_code'], null, $_POST['client_controller_id'][$i]);
										}

										if(!($old_office_date_of_cessation_result == $check_date_of_cessation))
										{
											$check_history_client_controller = $this->db->get_where("history_client_controller", array("id" => $_POST['client_controller_id'][$i]));
											if (!$check_history_client_controller->num_rows())
											{
												$g = $q->result();

												foreach($g as $r) {
											        $this->db->insert("history_client_controller",$r);
											    }
											} 
											else 
											{
												$z = $q->result_array();

												$data_history['date_of_cessation'] = $z[0]["date_of_cessation"];

											    $this->db->update("history_client_controller",$data_history,array("id" => $_POST['client_controller_id'][$i]));
												
											}

											//$this->create_document("change_cessation_of_controller", $_POST['company_code'], null, $_POST['client_controller_id'][$i]);
										}

										
										
										echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_controller_id" => $insert_client_controller_id));
									}
								}
								else
								{
									echo json_encode(array("Status" => 2, 'message' => 'The person is already registered on controller on the date.', 'title' => 'Error', 'data' => ""));
								}
								
							}
							
						


					
				}
			}


			//echo json_encode($_POST['position']);

/*			$bc = array(array('link' => '#', 'page' => lang('Edit Clients')));
	        $meta = array('page_title' => lang('Edit Clients'), 'bc' => $bc, 'page_name' => 'Edit Clients');
			// $this->data['page_name'] = 'Clients';
	        $this->page_construct('client/edit_client.php', $meta, $this->data);*/
		//}
		// $this->sma->print_arrays($data);		
		
	}

	public function check_guarantee_data()
	{
		$check_guarantee = [];
							
		$check_guarantee[0]['company_code']=$_POST['company_code'];
		$check_guarantee[0]['officer_id']=$_POST['field_type'];
		$check_guarantee[0]['field_type']=$_POST['field_type'];
		$check_guarantee[0]['currency_id']=$_POST['currency_id'];
		$check_guarantee[0]['guarantee']=(float)str_replace(',', '', $_POST['guarantee'][0]);
		$check_guarantee[0]['guarantee_start_date']=$_POST['guarantee_start_date'][0];

		$query = $this->db->get_where("history_client_guarantee", array("id" => $_POST['client_guarantee_id'][0]));

		if (!$query->num_rows())//if don't have anythings
		{
			echo false;
		}
		else
		{
			$query = $query->result_array();

			$old_client_guarantee_result = $this->db->query("select * from client_guarantee where id='".$_POST['client_guarantee_id'][$i]."'");

			$old_client_guarantee_result = $old_client_guarantee_result->result_array();

			$get_client_info = $this->db->query("select * from client where company_code='".$_POST['company_code']."'");

			$get_client_info = $get_client_info->result_array();

			if(!($old_client_guarantee_result == $check_guarantee))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "guarantee_id" => $_POST['client_guarantee_id'][0], "received_on" => "", "triggered_by" => "14"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}
		}
	}

	public function add_guarantee()
	{
		
		$identification_register_no = $_POST['identification_register_no'];
		$name = $_POST['name'];

		for($i = 0; $i < count($_POST['identification_register_no']); $i++ )
		{
			 $this->form_validation->set_rules('identification_register_no['.$i.']', 'Id', 'required');
			 $this->form_validation->set_rules('name['.$i.']', 'Name', 'required');
			 //$this->form_validation->set_rules('currency['.$i.']', 'Currency', 'required');
			 $this->form_validation->set_rules('guarantee['.$i.']', 'Limit Of Guarantee', 'required');
			 $this->form_validation->set_rules('guarantee_start_date['.$i.']', 'Start', 'required');

			 //$date_of_appointment = strtotime(str_replace('/', '-',$_POST['date_of_appointment'][$i]));
			 //$date_of_cessation = strtotime(str_replace('/', '-',$_POST['date_of_cessation'][$i]));

			 
	        if ($this->form_validation->run() == FALSE || $_POST['currency'][$i] == "0" || $_POST['guarantee'][$i] == "0")
	        {
	        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

	        	if($_POST['currency'][$i] == "0")
	        	{
	        		$currency = "The Currency field is required.";
	        	}
	        	else
	        	{
	        		$currency = "";
	        	}

	        	if($_POST['guarantee'][$i] == "0")
	        	{
	        		$guarantee = "The Limit Of Guarantee field cannot be zero.";
	        	}
	        	else if($_POST['guarantee'][$i] == "")
	        	{
	        		$guarantee = strip_tags(form_error('guarantee['.$i.']'));
	        	}

	        	
	        	$error = array(
			                'identification_register_no' => strip_tags(form_error('identification_register_no['.$i.']')),
			                'name' => strip_tags(form_error('name['.$i.']')),
			                'currency' => $currency,
			                'guarantee' => $guarantee,
			                'guarantee_start_date' => strip_tags(form_error('guarantee_start_date['.$i.']')),
			            );

	        	echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error));

	        }
	        else
	        {

	        	/*if ($_POST['position'][$i] == "5")
				{
					$q = $this->db->query("select * from officer_company where register_no='".$_POST['identification_register_no'][$i]."'");
					//echo json_encode($q);
					if ($q->num_rows() > 0) {
						$have_this_member = 1;
			            // foreach (($q->result()) as $row) {
			                // $data[] = $row;
			            // }
			            // return $data;
			        } 
			        else 
			       	{
			       		$have_this_member = 0;
			       	}
				}
				else
				{*/
					//$q = $this->db->query("select * from officer where identification_no='".$identification_register_no."'");

					/*$q = $this->db->query("select * from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$_POST['identification_register_no'][$i]."'");

					//echo json_encode($q->result()[0]);
					if ($q->num_rows() > 0) {
						$have_this_member = 1;
			            
			        } 
			        else 
			        {
			        	$have_this_member = 0;
			        }*/
				//}
			    

			    if($_POST['client_guarantee_id'][$i] != null)
			    {
			    	$check_guarantee = $this->db->query("select sum(guarantee) as total_guarantee from client_guarantee where company_code='".$_POST['company_code']."' AND officer_id = '".$_POST['officer_id']."' AND field_type = '".$_POST['officer_field_type']."' AND id !='".$_POST['client_guarantee_id'][$i]."'");
			    }
			    else
			    {
			    	$check_guarantee = $this->db->query("select sum(guarantee) as total_guarantee from client_guarantee where company_code='".$_POST['company_code']."' AND officer_id = '".$_POST['officer_id']."' AND field_type = '".$_POST['officer_field_type']."'");
			    }
			    
			    //echo json_encode($check_guarantee->result_array());
			    if ($check_guarantee->num_rows() > 0) 
			    {
					$check_guarantee = $check_guarantee->result_array();

					$guarantee_number = (float)$check_guarantee[0]["total_guarantee"] + (float)str_replace(',', '', $_POST['guarantee'][$i]);
					if($guarantee_number >= 0)
					{
						$not_exceed = 1;
					}
					else if(0 > $guarantee_number)
					{
						$not_exceed = 0;
					}
		            
		        } 
		        else 
		        {
		        	$not_exceed = 1;
		        }
		        //echo json_encode($guarantee_number);
				if($not_exceed)
				{
					$data['company_code']=$_POST['company_code'];
					$data['officer_id']=$_POST['officer_id'];
					$data['field_type']=$_POST['officer_field_type'];
					$data['currency_id']=$_POST['currency'][$i];
					$data['guarantee']=(float)str_replace(',', '', $_POST['guarantee'][$i]);
					//$data['guarantee']=(float)str_replace(',', '', $_POST['guarantee'][$i]);

					/*if($_POST['alternate_of'][$i] == null)
					{
						$data['alternate_of']=' ';
						$check_alternate_of = ' ';
					}
					else
					{
						$data['alternate_of']=$_POST['alternate_of'][$i];
						$check_alternate_of = $_POST['alternate_of'][$i];;
					}*/
					
					$data['guarantee_start_date']=$_POST['guarantee_start_date'][$i];
					//$data['guarantee_end_date']=$_POST['guarantee_end_date'][$i];

					
						$q = $this->db->get_where("client_guarantee", array("id" => $_POST['client_guarantee_id'][$i]));

						if (!$q->num_rows())
						{
							$this->db->insert("client_guarantee",$data);
							$insert_client_guarantee_id = $this->db->insert_id();


							echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_guarantee_id" => $insert_client_guarantee_id));
							/*$check_date = $this->db->query("select * from client_officers where position='".$data['position']."' AND alternate_of = '".$data['alternate_of']."' AND officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' ORDER BY id DESC LIMIT 2");

							$check_date = $check_date->result_array();

							if(count($check_date) == 1)
							{
								$date_of_cessation = $check_date[0]["date_of_cessation"];
							}
							else
							{
								$date_of_cessation = $check_date[1]["date_of_cessation"];
							}

							if($date_of_cessation == null && count($check_date) != 0)
							{
								echo json_encode(array("Status" => 2, 'message' => 'This person has not ceased to hold the position in the company.', 'title' => 'Error', 'data' => $check_date));
							}
							elseif($date_of_cessation != null && count($check_date) != 0)
							{
								$array = explode('/', $check_date[0]["date_of_cessation"]);
								$tmp = $array[0];
								$array[0] = $array[1];
								$array[1] = $tmp;
								unset($tmp);
								$new_date = implode('/', $array);
								$time = strtotime($new_date);
								$new_date = date('d/m/Y',$time);

								if($new_date > $data['date_of_appointment'])
								{
									echo json_encode(array("Status" => 2, 'message' => 'Date of appointment cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
								}
								else
								{
									$this->db->insert("client_officers",$data);
									$insert_client_officers_id = $this->db->insert_id();

									if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
									{
										$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
										
									}
									elseif ($_POST['position'][$i] == 4)
									{
										$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
									}
									elseif($_POST['position'][$i] == 5)
									{
											$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
									}
									echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
								}
			                	
							}
							else
							{
								$this->db->insert("client_officers",$data);
								$insert_client_officers_id = $this->db->insert_id();

								if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
								{
									$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
									
								}
								elseif ($_POST['position'][$i] == 4)
								{
									$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
								}
								elseif($_POST['position'][$i] == 5)
								{
										$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
								}
								echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
							}*/
						} 
						else 
						{	
							$check_guarantee = [];
							
							$check_guarantee[0]['company_code']=$_POST['company_code'];
							$check_guarantee[0]['officer_id']=$_POST['field_type'];
							$check_guarantee[0]['field_type']=$_POST['field_type'];
							$check_guarantee[0]['currency_id']=$_POST['currency_id'];
							$check_guarantee[0]['guarantee']=(float)str_replace(',', '', $_POST['guarantee'][$i]);
							$check_guarantee[0]['guarantee_start_date']=$_POST['guarantee_start_date'][$i];

							$old_client_guarantee_result = $this->db->query("select * from client_guarantee where id='".$_POST['client_guarantee_id'][$i]."'");

							$old_client_guarantee_result = $old_client_guarantee_result->result_array();

							$this->db->update("client_guarantee",$data,array("id" => $_POST['client_guarantee_id'][$i]));

							

							if(!($old_client_guarantee_result == $check_guarantee))
							{
								$check_history_client_guarantee = $this->db->get_where("history_client_guarantee", array("id" => $_POST['client_guarantee_id'][$i]));
								if (!$check_history_client_guarantee->num_rows())
								{
									$w = $q->result();

									foreach($w as $r) {
								        $this->db->insert("history_client_guarantee",$r);
								    }
								} 
								else 
								{
									$x = $q->result_array();

									$data_history['field_type'] = $x[0]["field_type"];
									$data_history['field_type'] = $x[0]["field_type"];
									$data_history['currency_id'] = $x[0]["currency_id"];
									$data_history['guarantee'] = $x[0]["guarantee"];
									$data_history['guarantee_start_date'] = $x[0]["guarantee_start_date"];

								    $this->db->update("history_client_guarantee",$data_history,array("id" => $_POST['client_guarantee_id'][$i]));
									
								}
							}

							echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_guarantee_id));
							/*$check_officer = [];
							//$check_officer[0]['position']=$_POST['position'][$i];
							$check_officer[0]['alternate_of']=$check_alternate_of;
							$check_officer[0]['officer_id']=$_POST['officer_id'];
							$check_officer[0]['field_type']=$_POST['officer_field_type'];
							$check_officer[0]['date_of_appointment']=$_POST['date_of_appointment'][$i];
							$check_officer[0]['date_of_cessation']=$_POST['date_of_cessation'][$i];

							$old_client_officer_result = $this->db->query("select alternate_of, officer_id, field_type, date_of_appointment, date_of_cessation from client_officers where id='".$_POST['client_officer_id'][$i]."'");

							$old_client_officer_result = $old_client_officer_result->result_array();

							

							$check_date = $this->db->query("select * from client_officers where position='".$data['position']."' AND alternate_of = '".$data['alternate_of']."' AND officer_id = '".$data['officer_id']."' AND field_type = '".$data['field_type']."' AND company_code = '".$data['company_code']."' ORDER BY id DESC LIMIT 2");


							$check_date = $check_date->result_array();

							//echo json_encode($check_date);
							
							if($check_date[1]["date_of_cessation"] != null && count($check_date) != 0)
							{
								$array = explode('/', $check_date[1]["date_of_cessation"]);
								$tmp = $array[0];
								$array[0] = $array[1];
								$array[1] = $tmp;
								unset($tmp);
								$new_date = implode('/', $array);
								$new_date = strtotime($new_date);
								//$new_date = date('d/m/Y',$time);

								$array = explode('/', $data['date_of_appointment']);
								$tmp = $array[0];
								$array[0] = $array[1];
								$array[1] = $tmp;
								unset($tmp);
								$date_of_appointment = implode('/', $array);
								$date_of_appointment = strtotime($date_of_appointment);
								//$date_of_appointment = date('d/m/Y',$time);

								//echo json_encode($date_of_appointment > $new_date);

								if($new_date > $date_of_appointment)
								{
									echo json_encode(array("Status" => 2, 'message' => 'Date of appointment cannot early than old date of cessation.', 'title' => 'Error', 'data' => $check_date));
								}
								else
								{
									$this->db->update("client_officers",$data,array("id" => $_POST['client_officer_id'][$i]));

									if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
									{
										if(!($old_client_officer_result == $check_officer))
										{
											$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
										}
									}
									elseif ($_POST['position'][$i] == 4)
									{
										if(!($old_client_officer_result == $check_officer))
										{
											$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
										}
									}
									elseif($_POST['position'][$i] == 5)
									{
										if(!($old_client_officer_result == $check_officer))
										{
											$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
										}
									}
									
									echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
								}
							}
							else
							{
								$this->db->update("client_officers",$data,array("id" => $_POST['client_officer_id'][$i]));

								if($_POST['position'][$i] == 1 | $_POST['position'][$i] == 7)
								{
									if(!($old_client_officer_result == $check_officer))
									{
										$this->create_invoice("change_director", $_POST["company_code"], $_POST['position'][$i]);
									}
								}
								elseif ($_POST['position'][$i] == 4)
								{
									if(!($old_client_officer_result == $check_officer))
									{
										$this->create_invoice("change_secretary", $_POST["company_code"], $_POST['position'][$i]);
									}
								}
								elseif($_POST['position'][$i] == 5)
								{
									if(!($old_client_officer_result == $check_officer))
									{
										$this->create_invoice("change_auditor", $_POST["company_code"], $_POST['position'][$i]);
									}
								}
								
								echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_officers_id" => $insert_client_officers_id));
							}*/
						}
						
					//}
					
				}
				else
				{
					//echo ($have_this_member);
					/*if ($_POST['position'][$i] == "5")
					{
						echo json_encode(array("Status" => 2, 'message' => 'This person not in the system.', 'title' => 'Error'));
					}
					else
					{*/
						echo json_encode(array("Status" => 2, 'message' => 'Guarantee amount cannot be negative.', 'title' => 'Error'));
					//}
				}


				
			}
		}
	}

	public function delete_guarantee ()
	{
		$id = $_POST["client_guarantee_id"];
		echo $this->db->delete("client_guarantee",array('id'=>$id));
	}

	public function delete_controller ()
	{
		$id = $_POST["client_controller_id"];
		echo $this->db->delete("client_controller",array('id'=>$id));
	}

	public function check_charge_data()
	{
		$check_date_registration = [];
		$check_date_satisfied = [];
		$check_date_registration[0]['date_registration']=$_POST['date_registration'][0];

		$check_date_satisfied[0]['date_satisfied']=$_POST['date_satisfied'][0];

		$query = $this->db->get_where("history_client_charges", array("id" => $_POST['client_charge_id'][0]));

		if (!$query->num_rows())//if don't have anythings
		{
			echo false;
		}
		else
		{
			$query = $query->result_array();

			$old_office_date_registration_result = $this->db->query("select date_registration from client_charges where id='".$_POST['client_charge_id'][0]."'");

			$old_office_date_registration_result = $old_office_date_registration_result->result_array();

			$get_client_info = $this->db->query("select * from client where company_code='".$_POST['company_code']."'");

			$get_client_info = $get_client_info->result_array();

			if(!($old_office_date_registration_result == $check_date_registration))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "charge_id" => $_POST['client_charge_id'][0], "received_on" => "", "triggered_by" => "17"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

			$old_office_date_satisfied_result = $this->db->query("select date_satisfied from client_charges where id='".$_POST['client_charges_id'][$i]."'");

			$old_office_date_satisfied_result = $old_office_date_satisfied_result->result_array();

			if(!($old_office_date_satisfied_result == $check_date_satisfied))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "charge_id" => $_POST['client_charge_id'][0], "received_on" => "", "triggered_by" => "18"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}
		}
	}

	// callback function
	public function customAlpha($str) 
	{
	    if ( !preg_match('/^[0-9.,\-]+$/i',$str) )
	    {
	    	
	        return false;
	    }

	}

	public function add_charge ()
	{
		
		$charge = $_POST['charge'];
		//$name = $_POST['name'];

		for($i = 0; $i < count($_POST['charge']); $i++ )
		{
			 $this->form_validation->set_rules('charge['.$i.']', 'Charge', 'required');
			 $this->form_validation->set_rules('nature_of_charge['.$i.']', 'Nature of Charge', 'required');
			 $this->form_validation->set_rules('date_registration['.$i.']', 'Date Registration', 'required');
			 if($_POST['satisfactory_no'][$i] != "")
			 {
			 	$this->form_validation->set_rules('date_satisfied['.$i.']', 'Date Satisfied', 'required');
			 }
			 $this->form_validation->set_rules('charge_no['.$i.']', 'Charge No', 'required');

			 if($_POST['date_satisfied'][$i] != "")
			 {
			 	$this->form_validation->set_rules('satisfactory_no['.$i.']', 'Satisfactory No', 'required');
			 }
			 
			 //$this->form_validation->set_rules('currency['.$i.']', 'Currency', 'required');
			 $this->form_validation->set_rules('amount['.$i.']', 'Amount', 'required');
			 /*$this->form_validation->set_rules('secured_by['.$i.']', 'Secured by', 'required');*/
			 // custom error message
	         //$this->form_validation->set_message('customAlpha', 'error message');

			 $date_registration = strtotime(str_replace('/', '-',$_POST['date_registration'][$i]));
			 $date_satisfied = strtotime(str_replace('/', '-',$_POST['date_satisfied'][$i]));

			 $amount_validation = true;
			if ( !preg_match('/^[0-9.,\-]+$/i',$_POST['amount'][$i]) && $_POST['amount'][$i] != null)
		    {
		    	//echo json_encode(false);
		        $amount_validation = false;
		    }
		    

	       
	        //echo($date_satisfied);
	        if ($this->form_validation->run() == FALSE || $date_satisfied < $date_registration && $date_satisfied != "" || $_POST['currency'][$i] == "0" || $amount_validation == false)
	        {
	        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

	        	 

	        	/*if($date_satisfied == "")
	        	{
	        		$validate_date_satisfied = "*The Date Satisfied field is required.";
	        	}*/
	        	if($date_satisfied < $date_registration && $date_satisfied != "")
	        	{
	        		$validate_date_satisfied = "The Date Satisfied field must larger than Date Registration.";
	        	}
	        	else
	        	{
	        		$validate_date_satisfied = strip_tags(form_error('date_satisfied['.$i.']'));
	        	}

	        	if($_POST['currency'][$i] == "0")
	        	{
	        		 $validate_currency = "The Currency of field is required.";
	        	}
	        	else
	        	{
	        		$validate_currency = "";
	        	}

	        	if($amount_validation == false)
	        	{
	        		$validate_amount = "The Amount field must contain only numbers.";
	        	}
	        	else
	        	{
	        		$validate_amount = strip_tags(form_error('amount['.$i.']'));
	        	}

	        	$error = array(
	        					'currency' => $validate_currency,
				                'charge' => strip_tags(form_error('charge['.$i.']')),
				                'nature_of_charge' => strip_tags(form_error('nature_of_charge['.$i.']')),
				                'date_registration' => strip_tags(form_error('date_registration['.$i.']')),
				                'date_satisfied' => $validate_date_satisfied,
				                'charge_no' => strip_tags(form_error('charge_no['.$i.']')),
				                'satisfactory_no' => strip_tags(form_error('satisfactory_no['.$i.']')),
				                'amount' => $validate_amount,
				                /*'secured_by' => strip_tags(form_error('secured_by['.$i.']')),*/
				            );

	        	echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error));

	        }
	        else
	        {
	        	$data['company_code']=$_POST['company_code'];
				$data['charge']=$_POST['charge'][$i];
				$data['nature_of_charge']=$_POST['nature_of_charge'][$i];
				$data['date_registration']=$_POST['date_registration'][$i];
				$data['date_satisfied']=$_POST['date_satisfied'][$i];
				$data['charge_no']=$_POST['charge_no'][$i];
				$data['satisfactory_no']=$_POST['satisfactory_no'][$i];
				$data['currency']=$_POST['currency'][$i];
				$data['amount']=str_replace(',', '', $_POST['amount'][$i]);
				$data['secured_by']=$_POST['secured_by'][$i];


				$q = $this->db->get_where("client_charges", array("id" => $_POST['client_charge_id'][$i]));

				if (!$q->num_rows())
				{				
					$this->db->insert("client_charges",$data);
					$insert_client_charge_id = $this->db->insert_id();

					//echo json_encode($insert_client_charge_id);
					$this->create_invoice("change_charges", $_POST["company_code"]);

					//$this->create_document("change_registration_of_charge", $_POST['company_code'], null, null, $insert_client_charge_id);
				} 
				else 
				{	
					//track the fields is update or not
					$check_charge = [];
					$check_charge[0]['charge']=$_POST['charge'][$i];
					$check_charge[0]['nature_of_charge']=$_POST['nature_of_charge'][$i];
					$check_charge[0]['date_registration']=$_POST['date_registration'][$i];
					$check_charge[0]['date_satisfied']=$_POST['date_satisfied'][$i];
					$check_charge[0]['charge_no']=$_POST['charge_no'][$i];
					$check_charge[0]['satisfactory_no']=$_POST['satisfactory_no'][$i];
					$check_charge[0]['currency']=$_POST['currency'][$i];
					$check_charge[0]['amount']=str_replace(',', '', $_POST['amount'][$i]);
					$check_charge[0]['secured_by']=$_POST['secured_by'][$i];

					$old_client_charges_result = $this->db->query("select charge, nature_of_charge, date_registration, date_satisfied, charge_no, satisfactory_no, currency, amount, secured_by from client_charges where id='".$_POST['client_charge_id'][$i]."'");

					$old_client_charges_result = $old_client_charges_result->result_array();

					/*echo json_encode($check_address);
					echo json_encode($old_client_address_result);
					echo json_encode($old_client_address_result == $check_address);*/
					//echo(!($old_client_address_result == $check_address));

					$check_date_registration = [];
					$check_date_satisfied = [];
					$check_date_registration[0]['date_registration']=$_POST['date_registration'][$i];

					$check_date_satisfied[0]['date_satisfied']=$_POST['date_satisfied'][$i];

					$old_office_date_registration_result = $this->db->query("select date_registration from client_charges where id='".$_POST['client_charge_id'][$i]."'");

					$old_office_date_registration_result = $old_office_date_registration_result->result_array();

					$old_office_date_satisfied_result = $this->db->query("select date_satisfied from client_charges where id='".$_POST['client_charge_id'][$i]."'");

					$old_office_date_satisfied_result = $old_office_date_satisfied_result->result_array();

					$get_client_information = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$data['company_code']."'");

					$get_client_information = $get_client_information->result_array();

					$previous_charge_registration_result = $this->db->query("select client_charges.* from client_charges where  company_code='".$data['company_code']."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_registration_result[0]["date_registration"]."','%d/%m/%Y')");
					//echo json_encode($check_date);
					$previous_charge_registration_result = $previous_charge_registration_result->result_array();

					$previous_charge_satisfied_result = $this->db->query("select client_charges.* from client_charges where company_code='".$data['company_code']."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_office_date_satisfied_result[0]["date_satisfied"]."','%d/%m/%Y')");
					//echo json_encode($check_date);
					$previous_charge_satisfied_result = $previous_charge_satisfied_result->result_array();


					$this->db->update("client_charges",$data,array("id" => $_POST['client_charge_id'][$i]));

					

					if(!($old_office_date_registration_result == $check_date_registration))
					{
						$check_history_client_charges = $this->db->get_where("history_client_charges", array("id" => $_POST['client_charge_id'][$i]));
						if (!$check_history_client_charges->num_rows())
						{
							$w = $q->result();

							foreach($w as $r) {
						        $this->db->insert("history_client_charges",$r);
						    }
						} 
						else 
						{
							$x = $q->result_array();

							$data_history['date_registration'] = $x[0]["date_registration"];

						    $this->db->update("history_client_charges",$data_history,array("id" => $_POST['client_charge_id'][$i]));
							
						}
						$this->change_charge_info("change_registration_of_charge", $old_office_date_registration_result[0]["date_registration"], $get_client_information[0]['firm_id'], $data['company_code'], $previous_charge_registration_result, $get_client_information[0]["id"]);

						//$this->create_document("change_registration_of_charge", $_POST['company_code'], null, null, $_POST['client_charge_id'][$i]);
					}

					if(!($old_office_date_satisfied_result == $check_date_satisfied))
					{
						$check_history_client_charges = $this->db->get_where("history_client_charges", array("id" => $_POST['client_charge_id'][$i]));
						if (!$check_history_client_charges->num_rows())
						{
							$g = $q->result();

							foreach($g as $r) {
						        $this->db->insert("history_client_charges",$r);
						    }
						} 
						else 
						{
							$z = $q->result_array();

							$data_history['date_satisfied'] = $z[0]["date_satisfied"];

						    $this->db->update("history_client_charges",$data_history,array("id" => $_POST['client_charge_id'][$i]));
							
						}
						$this->change_charge_info("change_satisfaction_of_charge", $old_office_date_satisfied_result[0]["date_satisfied"], $get_client_information[0]['firm_id'], $data['company_code'], $previous_charge_satisfied_result, $get_client_information[0]["id"]);

						//$this->create_document("change_satisfaction_of_charge", $_POST['company_code'], null, null, $_POST['client_charge_id'][$i]);
					}

					if(!($old_client_charges_result == $check_charge))
					{
						$this->create_invoice("change_charges", $_POST["company_code"]);
						//echo("inininin");
					}		
				}
				echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_client_charge_id" => $insert_client_charge_id));
			}
		}	
	}

	public function change_charge_info($type, $old_charge_date_result, $firm_id, $company_code, $previous_charge_result = null, $client_id, $delete_charge_id = null)
	{
		if($type == "change_registration_of_charge")
		{
			$document_master_result = $this->db->query("select * from document_master where triggered_by = 29 AND firm_id='".$firm_id."'");
		}
		elseif($type == "change_satisfaction_of_charge")
		{
			$document_master_result = $this->db->query("select * from document_master where triggered_by = 30 AND firm_id='".$firm_id."'");
		}

		if ($document_master_result->num_rows() > 0) 
		{
			$get_client = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$company_code."'");

			$get_client = $get_client->result_array();

			$document_master_result = $document_master_result->result_array();

			for($r = 0; $r < count($document_master_result); $r++)
			{
				$str = $document_master_result[$r]["document_content"];

				$document_name = $document_master_result[$r]["document_name"]." - ".DATE("Y",now());

				if(strpos($str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
				{
					$str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $str);
				}
				if(strpos($str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
				{
					$str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $str);
				}

				if(strpos($str, '<span class="myclass mceNonEditable">{{Address - new}}</span>') !== false)
				{
					if($get_client[0]["unit_no1"] != null || $get_client[0]["unit_no2"] != null)
					{
						$unit_no = '#'.$get_client[0]["unit_no1"].'-'.$get_client[0]["unit_no2"].'';
					}
					else
					{
						$unit_no = '';
					}

					$new_address = $get_client[0]["street_name"].', '.$unit_no.' '.$get_client[0]["building_name"].', Singapore '.$get_client[0]["postal_code"];

					$str = str_replace('<span class="myclass mceNonEditable">{{Address - new}}</span>', $new_address, $str);
				}

				if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
                {
                	$director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
                	
                	$director_name_result = $director_name_result->result_array();

                	//echo json_encode($director_name_result);
                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

                	if( $document_master_result[$r]["document_name"] == "Auditor-Notice of EGM" || $document_master_result[$r]["document_name"] == "Manager-Notice of EGM"|| $document_master_result[$r]["document_name"] == "CEO-Notice of EGM" || $document_master_result[$r]["document_name"] == "Charge-Notice of EGM" || $document_master_result[$r]["document_name"] == "Company Name-Notice of EGM" || $document_master_result[$r]["document_name"] == "Allotment-Authority to Allot")
                	{
                		$director_name = '';

                		$director_name = $director_name.'<p>&nbsp;</p><p>&nbsp;</p><p>_______________________________<br />'.$director_name_result[0]["name"].'<br />Director</p>';

                	}
                	elseif($document_master_result[$r]["document_name"] == "Form 11" || $document_master_result[$r]["document_name"] == "Strike Off EGM")
                	{

                		$director_name = $director_name_result[0]["name"];

                	}
                	elseif($document_master_result[$r]["document_name"] == "Strike Off-Minutes Of EGM")
                	{
                		$director_name = '';
                		for($g = 0; $g < count($director_name_result); $g++)
	                	{	
	                		if($g == 0)
	                		{
	                			$director_name = $director_name.'<p><strong>'.$director_name_result[$g]["name"].'<br /></strong>';
	                		}
	                		elseif($g == (count($director_name_result) - 1))
	                		{
	                			$director_name = $director_name.'<strong>'.$director_name_result[$g]["name"].'<br /></strong></p>';
	                		}
	                		else
	                		{
	                			$director_name = $director_name.'<strong>'.$director_name_result[$g]["name"].'<br /></strong>';
	                		}
                			
                		}
                	}
                	else
                	{
                		$director_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';
                		for($g = 0; $g < count($director_name_result); $g++)
	                	{
	                		$director_name = $director_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$director_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
	                	}
	                	$director_name = $director_name.'</tbody></table>';
                	}


                	

                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $str);
                }

				if(strpos($str, '<span class="myclass mceNonEditable">{{Charge name - registration}}</span>') !== false)
                {
                	$charge_name_registration_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_name_registration_result = $charge_name_registration_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_name_registration = "";

                	$latest_charge_id = array();
                	$num_of_charge_name_registration = (int)(count($charge_name_registration_result)) - 1;
                	for($g = 0; $g < count($charge_name_registration_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_name_registration = $charge_name_registration.$charge_name_registration_result[$g]["charge"];
                		}
                		elseif($g == (int)$num_of_charge_name_registration)
                		{
                			$charge_name_registration = $charge_name_registration.' and '.$charge_name_registration_result[$g]["charge"];
                		}
                		else
                		{
                			$charge_name_registration = $charge_name_registration.', '.$charge_name_registration_result[$g]["charge"];
                		}
                		
                		array_push($latest_charge_id, (int)$charge_name_registration_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge name - registration}}</span>', $charge_name_registration, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge name - satisfaction}}</span>') !== false)
                {
                	$charge_name_satisfaction_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_name_satisfaction_result = $charge_name_satisfaction_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_name_satisfaction = "";

                	$latest_charge_id = array();
                	$num_of_charge_name_satisfaction = (int)(count($charge_name_satisfaction_result)) - 1;
                	for($g = 0; $g < count($charge_name_satisfaction_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_name_satisfaction = $charge_name_satisfaction.$charge_name_satisfaction_result[$g]["charge"];
                		}
                		elseif($g == (int)$num_of_charge_name_satisfaction)
                		{
                			$charge_name_satisfaction = $charge_name_satisfaction.' and '.$charge_name_satisfaction_result[$g]["charge"];
                		}
                		else
                		{
                			$charge_name_satisfaction = $charge_name_satisfaction.', '.$charge_name_satisfaction_result[$g]["charge"];
                		}
                		
                		array_push($latest_charge_id, (int)$charge_name_satisfaction_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge name - satisfaction}}</span>', $charge_name_satisfaction, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge nature - registration}}</span>') !== false)
                {
                	$charge_nature_registration_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_nature_registration_result = $charge_nature_registration_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_nature_registration = "";

                	$latest_charge_id = array();
                	$num_of_charge_nature_registration = (int)(count($charge_nature_registration_result)) - 1;
                	for($g = 0; $g < count($charge_nature_registration_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_nature_registration = $charge_nature_registration.'<strong>'.$charge_nature_registration_result[$g]["nature_of_charge"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_nature_registration)
                		{
                			$charge_nature_registration = $charge_nature_registration.' and <strong>'.$charge_nature_registration_result[$g]["nature_of_charge"].'</strong>';
                		}
                		else
                		{
                			$charge_nature_registration = $charge_nature_registration.', <strong>'.$charge_nature_registration_result[$g]["nature_of_charge"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_nature_registration_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge nature - registration}}</span>', $charge_nature_registration, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge nature - satisfaction}}</span>') !== false)
                {
                	$charge_nature_satisfaction_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_nature_satisfaction_result = $charge_nature_satisfaction_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_nature_satisfaction = "";

                	$latest_charge_id = array();
                	$num_of_charge_nature_satisfaction = (int)(count($charge_nature_satisfaction_result)) - 1;
                	for($g = 0; $g < count($charge_nature_satisfaction_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_nature_satisfaction = $charge_nature_satisfaction.'<strong>'.$charge_nature_satisfaction_result[$g]["nature_of_charge"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_nature_satisfaction)
                		{
                			$charge_nature_satisfaction = $charge_nature_satisfaction.' and <strong>'.$charge_nature_satisfaction_result[$g]["nature_of_charge"].'</strong>';
                		}
                		else
                		{
                			$charge_nature_satisfaction = $charge_nature_satisfaction.', <strong>'.$charge_nature_satisfaction_result[$g]["nature_of_charge"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_nature_satisfaction_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge nature - satisfaction}}</span>', $charge_nature_satisfaction, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge registration number}}</span>') !== false)
                {
                	$charge_registration_number_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_registration_number_result = $charge_registration_number_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_registration_number = "";

                	$latest_charge_id = array();
                	$num_of_charge_registration_number = (int)(count($charge_registration_number_result)) - 1;
                	for($g = 0; $g < count($charge_registration_number_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_registration_number = $charge_registration_number.'<strong>'.$charge_registration_number_result[$g]["charge_no"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_registration_number)
                		{
                			$charge_registration_number = $charge_registration_number.' and <strong>'.$charge_registration_number_result[$g]["charge_no"].'</strong>';
                		}
                		else
                		{
                			$charge_registration_number = $charge_registration_number.', <strong>'.$charge_registration_number_result[$g]["charge_no"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_registration_number_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge registration number}}</span>', $charge_registration_number, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge registration date}}</span>') !== false)
                {
                	$charge_registration_date_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_registration_date_result = $charge_registration_date_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_registration_date = "";

                	$latest_charge_id = array();
                	$num_of_charge_registration_date = (int)(count($charge_registration_date_result)) - 1;
                	for($g = 0; $g < count($charge_registration_date_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_registration_date = $charge_registration_date.'<strong>'.$charge_registration_date_result[$g]["date_registration"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_registration_date)
                		{
                			$charge_registration_date = $charge_registration_date.' and <strong>'.$charge_registration_date_result[$g]["date_registration"].'</strong>';
                		}
                		else
                		{
                			$charge_registration_date = $charge_registration_date.', <strong>'.$charge_registration_date_result[$g]["date_registration"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_registration_date_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge registration date}}</span>', $charge_registration_date, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge satisfaction number}}</span>') !== false)
                {
                	$charge_satisfaction_number_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_satisfaction_number_result = $charge_satisfaction_number_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_satisfaction_number = "";

                	$latest_charge_id = array();
                	$num_of_charge_satisfaction_number = (int)(count($charge_satisfaction_number_result)) - 1;
                	for($g = 0; $g < count($charge_satisfaction_number_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_satisfaction_number = $charge_satisfaction_number.'<strong>'.$charge_satisfaction_number_result[$g]["satisfactory_no"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_satisfaction_number)
                		{
                			$charge_satisfaction_number = $charge_satisfaction_number.' and <strong>'.$charge_satisfaction_number_result[$g]["satisfactory_no"].'</strong>';
                		}
                		else
                		{
                			$charge_satisfaction_number = $charge_satisfaction_number.', <strong>'.$charge_satisfaction_number_result[$g]["satisfactory_no"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_satisfaction_number_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge satisfaction number}}</span>', $charge_satisfaction_number, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge satisfaction date}}</span>') !== false)
                {
                	$charge_satisfaction_date_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_satisfaction_date_result = $charge_satisfaction_date_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_satisfaction_date = "";

                	$latest_charge_id = array();
                	$num_of_charge_satisfaction_date = (int)(count($charge_satisfaction_date_result)) - 1;
                	for($g = 0; $g < count($charge_satisfaction_date_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_satisfaction_date = $charge_satisfaction_date.'<strong>'.$charge_satisfaction_date_result[$g]["date_satisfied"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_satisfaction_date)
                		{
                			$charge_satisfaction_date = $charge_satisfaction_date.' and <strong>'.$charge_satisfaction_date_result[$g]["date_satisfied"].'</strong>';
                		}
                		else
                		{
                			$charge_satisfaction_date = $charge_satisfaction_date.', <strong>'.$charge_satisfaction_date_result[$g]["date_satisfied"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_satisfaction_date_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge satisfaction date}}</span>', $charge_satisfaction_date, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge currency - registration}}</span>') !== false)
                {
                	$charge_currency_registration_result = $this->db->query("select client_charges.*, currency.currency as currency_name from client_charges left join currency on currency.id = client_charges.currency where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_currency_registration_result = $charge_currency_registration_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_currency_registration = "";

                	$latest_charge_id = array();
                	$num_of_charge_currency_registration = (int)(count($charge_currency_registration_result)) - 1;
                	for($g = 0; $g < count($charge_currency_registration_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_currency_registration = $charge_currency_registration.'<strong>'.$charge_currency_registration_result[$g]["currency_name"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_currency_registration)
                		{
                			$charge_currency_registration = $charge_currency_registration.' and <strong>'.$charge_currency_registration_result[$g]["currency_name"].'</strong>';
                		}
                		else
                		{
                			$charge_currency_registration = $charge_currency_registration.', <strong>'.$charge_currency_registration_result[$g]["currency_name"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_currency_registration_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge currency - registration}}</span>', $charge_currency_registration, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge currency - satisfaction}}</span>') !== false)
                {
                	$charge_currency_satisfaction_result = $this->db->query("select client_charges.*, currency.currency as currency_name from client_charges left join currency on currency.id = client_charges.currency where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_currency_satisfaction_result = $charge_currency_satisfaction_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_currency_satisfaction = "";

                	$latest_charge_id = array();
                	$num_of_charge_currency_satisfaction = (int)(count($charge_currency_satisfaction_result)) - 1;
                	for($g = 0; $g < count($charge_currency_satisfaction_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_currency_satisfaction = $charge_currency_satisfaction.'<strong>'.$charge_currency_satisfaction_result[$g]["currency_name"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_currency_satisfaction)
                		{
                			$charge_currency_satisfaction = $charge_currency_satisfaction.' and <strong>'.$charge_currency_satisfaction_result[$g]["currency_name"].'</strong>';
                		}
                		else
                		{
                			$charge_currency_satisfaction = $charge_currency_satisfaction.', <strong>'.$charge_currency_satisfaction_result[$g]["currency_name"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_currency_satisfaction_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge currency - satisfaction}}</span>', $charge_currency_satisfaction, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge amount - registration}}</span>') !== false)
                {
                	$charge_amount_registration_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_amount_registration_result = $charge_amount_registration_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_amount_registration = "";

                	$latest_charge_id = array();
                	$num_of_charge_amount_registration = (int)(count($charge_amount_registration_result)) - 1;
                	for($g = 0; $g < count($charge_amount_registration_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_amount_registration = $charge_amount_registration.'<strong>'.number_format($charge_amount_registration_result[$g]["amount"], 2).'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_amount_registration)
                		{
                			$charge_amount_registration = $charge_amount_registration.' and <strong>'.number_format($charge_amount_registration_result[$g]["amount"], 2).'</strong>';
                		}
                		else
                		{
                			$charge_amount_registration = $charge_amount_registration.', <strong>'.number_format($charge_amount_registration_result[$g]["amount"], 2).'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_amount_registration_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge amount - registration}}</span>', $charge_amount_registration, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge amount - satisfaction}}</span>') !== false)
                {
                	$charge_amount_satisfaction_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_amount_satisfaction_result = $charge_amount_satisfaction_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_amount_satisfaction = "";

                	$latest_charge_id = array();
                	$num_of_charge_amount_satisfaction = (int)(count($charge_amount_satisfaction_result)) - 1;
                	for($g = 0; $g < count($charge_amount_satisfaction_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_amount_satisfaction = $charge_amount_satisfaction.'<strong>'.number_format($charge_amount_satisfaction_result[$g]["amount"], 2).'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_amount_satisfaction)
                		{
                			$charge_amount_satisfaction = $charge_amount_satisfaction.' and <strong>'.number_format($charge_amount_satisfaction_result[$g]["amount"], 2).'</strong>';
                		}
                		else
                		{
                			$charge_amount_satisfaction = $charge_amount_satisfaction.', <strong>'.number_format($charge_amount_satisfaction_result[$g]["amount"], 2).'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_amount_satisfaction_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge amount - satisfaction}}</span>', $charge_amount_satisfaction, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge security - registration}}</span>') !== false)
                {
                	$charge_security_registration_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_registration,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_security_registration_result = $charge_security_registration_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_security_registration = "";

                	$latest_charge_id = array();
                	$num_of_charge_security_registration = (int)(count($charge_security_registration_result)) - 1;
                	for($g = 0; $g < count($charge_security_registration_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_security_registration = $charge_security_registration.'<strong>'.$charge_security_registration_result[$g]["secured_by"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_security_registration)
                		{
                			$charge_security_registration = $charge_security_registration.' and <strong>'.$charge_security_registration_result[$g]["secured_by"].'</strong>';
                		}
                		else
                		{
                			$charge_security_registration = $charge_security_registration.', <strong>'.$charge_security_registration_result[$g]["secured_by"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_security_registration_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge security - registration}}</span>', $charge_security_registration, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Charge security - satisfaction}}</span>') !== false)
                {
                	$charge_security_satisfaction_result = $this->db->query("select client_charges.* from client_charges where company_code='".$company_code."' AND STR_TO_DATE(client_charges.date_satisfied,'%d/%m/%Y') = STR_TO_DATE('".$old_charge_date_result."','%d/%m/%Y') ORDER BY client_charges.id");

                	$charge_security_satisfaction_result = $charge_security_satisfaction_result->result_array();

                	//$previous_director_name_appointment_result = $previous_director_name_appointment_result->result_array();
                	//echo json_encode($previous_charge_result);

                	$charge_security_satisfaction = "";

                	$latest_charge_id = array();
                	$num_of_charge_security_satisfaction = (int)(count($charge_security_satisfaction_result)) - 1;
                	for($g = 0; $g < count($charge_security_satisfaction_result); $g++)
                	{
                		if($g == 0)
                		{
                			$charge_security_satisfaction = $charge_security_satisfaction.'<strong>'.$charge_security_satisfaction_result[$g]["secured_by"].'</strong>';
                		}
                		elseif($g == (int)$num_of_charge_security_satisfaction)
                		{
                			$charge_security_satisfaction = $charge_security_satisfaction.' and <strong>'.$charge_security_satisfaction_result[$g]["secured_by"].'</strong>';
                		}
                		else
                		{
                			$charge_security_satisfaction = $charge_security_satisfaction.', <strong>'.$charge_security_satisfaction_result[$g]["secured_by"].'</strong>';
                		}
                		
                		array_push($latest_charge_id, (int)$charge_security_satisfaction_result[$g]["id"]);
                	}
                	$data_pending_document['charge_id']=json_encode($latest_charge_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Charge security - satisfaction}}</span>', $charge_security_satisfaction, $str);

                	
                	//echo json_encode($officer_id_data);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Members name - all}}</span>') !== false)
                {
                	$member_name_result = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$company_code.'" GROUP BY member_shares.field_type, member_shares.officer_id,member_shares.client_member_share_capital_id HAVING sum(member_shares.number_of_share) != 0');
                	
                	$member_name_result = $member_name_result->result_array();


                	$member_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';

                	for($g = 0; $g < count($member_name_result); $g++)
                	{
                		if($member_name_result[$g]["name"] != null)
                		{
                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
                		}
                		elseif($member_name_result[$g]["company_name"] != null)
                		{
                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["company_name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
                		}
                	}

                	$member_name = $member_name.'</tbody></table>';

                	$str = str_replace('<span class="myclass mceNonEditable">{{Members name - all}}</span>', $member_name, $str);
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Chairman}}</span>') !== false)
				{
					$chairman_result = $this->db->query("select chairman from client_signing_info where company_code='".$company_code."'");
                	
                	if ($chairman_result->num_rows() > 0) 
                	{

	                	$chairman_result = $chairman_result->result_array();

	                	$chairman_result_info = (explode("-",$chairman_result[0]["chairman"]));

	                	if($chairman_result_info[1] == "individual")
	                	{
	                		$officer_result = $this->db->query("select * from officer where id='".$chairman_result_info[0]."' AND field_type='".$chairman_result_info[1]."'");

	                		$officer_result = $officer_result->result_array();

	                		$name = $officer_result[0]["name"];
	                	}
	                	elseif($chairman_result_info[1] == "company")
	                	{
	                		$officer_company_result = $this->db->query("select * from officer_company where id='".$chairman_result_info[0]."' AND field_type='".$chairman_result_info[1]."'");

	                		$officer_company_result = $officer_company_result->result_array();

	                		$name = $officer_company_result[0]["company_name"];
	                	}

						$str = str_replace('<span class="myclass mceNonEditable">{{Chairman}}</span>', $name, $str);
					}
				}

                if(count($previous_charge_result) != 0 && $previous_charge_result != null)
            	{
            		$charge_id_data = array();
            		for($f = 0; $f < count($previous_charge_result); $f++)
                	{
                		array_push($charge_id_data, (int)$previous_charge_result[$f]["id"]);
                	}
            	}
            	elseif($delete_charge_id != null)
            	{
            		$charge_id_data = json_decode($delete_charge_id);
            	}

                $data_pending_document['content'] = $str;

            	if(count($latest_charge_id) == 0)
            	{
            		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
            		$this->db->where('client_id', $client_id);
            		$this->db->where('received_on', "");
            		$this->db->where('charge_id', json_encode($charge_id_data));
            		$this->db->where('transaction_date', $old_charge_date_result);
            		$this->db->where('document_name', $document_name);
					$this->db->delete('pending_documents');
            	}
            	else
            	{
            		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "charge_id" => json_encode($charge_id_data), "transaction_date" => $old_charge_date_result, "document_name" => $document_name));  
            	}
            }
        }
	}

	public function delete_charge ()
	{
		$id = $_POST["client_charge_id"];

		//echo json_encode(array((int)$id));
		$this->db->where('charge_id', json_encode(array((int)$id)));
		$this->db->delete('pending_documents');

		$this->db->delete("history_client_charges",array('id'=>$id));

		$this->db->delete("client_charges",array('id'=>$id));

		$pending_documents = $this->db->query("select pending_documents.*, client.company_code from pending_documents left join client on client.id = pending_documents.client_id where triggered_by = 29 OR triggered_by = 30");

		if ($pending_documents->num_rows() > 0) 
		{
			$pending_documents = $pending_documents->result_array();


			for($k = 0; $k < count($pending_documents); $k++)
			{
				//echo json_encode(in_array((int)$id, json_decode($pending_documents[$k]["charge_id"])));
				if (in_array((int)$id, json_decode($pending_documents[$k]["charge_id"])))
	  			{
					if($pending_documents[$k]["triggered_by"] == '29')
					{

						$this->change_charge_info("change_registration_of_charge", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["charge_id"]);

					}
					elseif($pending_documents[$k]["triggered_by"] == '30')
					{
						$this->change_charge_info("change_satisfaction_of_charge", $pending_documents[$k]["transaction_date"], $pending_documents[$k]["firm_id"], $pending_documents[$k]["company_code"], null, $pending_documents[$k]["client_id"], $pending_documents[$k]["charge_id"]);
					}
					
				}
			}
		}


		echo json_encode(array("Status" => 1));
	}

	public function add_share_capital ()
	{
		
		$class = $_POST['class'];
		
		//$name = $_POST['name'];

		for($i = 0; $i < count($_POST['class']); $i++ )
		{
			if(!empty($_POST['other_class']))
			{
				//echo("1");
				$this->form_validation->set_rules('other_class['.$i.']', 'Others', 'required');

				$valid = $this->form_validation->run();
			}
			else
			{
				$valid = true;
			}

			//echo(!empty($_POST['other_class'][$i]));
			 /*$this->form_validation->set_rules('nature_of_charge['.$i.']', 'Nature of Charge', 'required');
			 $this->form_validation->set_rules('date_registration['.$i.']', 'Date Registration', 'required');
			 //$this->form_validation->set_rules('date_satisfied['.$i.']', 'Date Satisfied', 'required');
			 $this->form_validation->set_rules('charge_no['.$i.']', 'Charge No', 'required');
			 $this->form_validation->set_rules('satisfactory_no['.$i.']', 'Satisfactory No', 'required');
			 //$this->form_validation->set_rules('currency['.$i.']', 'Currency', 'required');
			 $this->form_validation->set_rules('amount['.$i.']', 'Amount', 'required');
			 $this->form_validation->set_rules('secured_by['.$i.']', 'Secured by', 'required');

			 $date_registration = strtotime(str_replace('/', '-',$_POST['date_registration'][$i]));
			 $date_satisfied = strtotime(str_replace('/', '-',$_POST['date_satisfied'][$i]));*/

	        //echo($this->form_validation->run() == true);
	        //echo($date_satisfied);
	        if ($valid == FALSE || $_POST['class'][$i] == "0" || $_POST['currency'][$i] == "0")
	        {
	        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

	        	/*if($date_satisfied == "")
	        	{
	        		$validate_date_satisfied = "*The Date Satisfied field is required.";
	        	}
	        	else if($date_satisfied < $date_registration && $date_satisfied != "")
	        	{
	        		$validate_date_satisfied = "*The Date Satisfied field must larger than Date Registration.";
	        	}
	        	else
	        	{
	        		$validate_date_satisfied = "";
	        	}*/

	        	if($_POST['class'][$i] == "0")
	        	{
	        		 $validate_class = "The Class of field is required.";
	        	}
	        	else
	        	{
	        		$validate_class = "";
	        	}

	        	if($_POST['currency'][$i] == "0")
	        	{
	        		 $validate_currency = "*The Currency of field is required.";
	        	}
	        	else
	        	{
	        		$validate_currency = "";
	        	}

	        	$error = array(
	        					'class' => $validate_class,
	        					'currency' => $validate_currency,
				                'other_class' => strip_tags(form_error('other_class['.$i.']')),
				            );

	        	echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error));

	        }
	        else
	        {
	        	$data['company_code']=$_POST['company_code'];
				$data['class_id']=$_POST['class'][$i];
				if($_POST['other_class'][$i] == null)
				{
					$data['other_class']='';
				}
				else
					$data['other_class']=$_POST['other_class'][$i];
				//$data['number_of_shares']=$_POST['number_of_shares'][$i];
				$data['currency_id']=$_POST['currency'][$i];
				//$data['amount']=$_POST['amount'][$i];
				//$data['paid_up']=$_POST['paid_up'][$i];
				/*$data['currency']=$_POST['currency'][$i];
				$data['amount']=$_POST['amount'][$i];
				$data['secured_by']=$_POST['secured_by'][$i];*/


				$q = $this->db->get_where("client_member_share_capital", array("id" => $_POST['share_capital_id'][$i]));

				if (!$q->num_rows())
				{				
					$this->db->insert("client_member_share_capital",$data);
					$insert_share_capital_id = $this->db->insert_id();
				} 
				else 
				{	
					/*for($i = 0; $i < count($_POST['charge']); $i++ )
					{*/

						$this->db->update("client_member_share_capital",$data,array("id" => $_POST['share_capital_id'][$i]));
					//}
				}
				echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "insert_share_capital_id" => $insert_share_capital_id));
			}
		}	
	}

	public function delete_share_capital ()
	{
		$id = $_POST["share_capital_id"];
		$this->db->delete("member_shares",array('client_member_share_capital_id'=>$id));
		$this->db->delete("certificate_merge",array('client_member_share_capital_id'=>$id));
		$this->db->delete("certificate",array('client_member_share_capital_id'=>$id));
		$this->db->delete("client_member_share_capital",array('id'=>$id));

		echo json_encode(array("Status" => 1, 'message' => 'Information Deleted', 'title' => 'Deleted'));
	}
	
	public function delete($id)
	{
		/*$this->db->update("client",array('row_status'=>'1'),array('id'=>$id));*/
		$this->db->delete("client",array('id'=>$id));
        redirect("masterclient");
	}

	public function check_next_recurring_date()
	{
		// $type_of_day = $_POST["type_of_day"];
		// $days = $_POST["days"];
		$frequency = $_POST["frequency"];
		$to_billing_cycle_date = $_POST["period_end_date"];
		$recurring_issue_date = $_POST["recurring_issue_date"];
		// $from_date = $_POST["from"];
		// $to_date = $_POST["to"];

		$current_date = DATE("Y-m-d",now());

		// if($from_date != null)
		// {
		// 	$date_from = str_replace('/', '-', $from_date);
		// 	$from = strtotime($date_from);
		// 	$new_from = date('Y-m-d',$from);
		// 	//echo ($new_to);
		// }
		// else
		// {
		// 	$new_from = null;
		// }

		// if($to_date != null)
		// {
		// 	$date_to = str_replace('/', '-', $to_date);
		// 	$to = strtotime($date_to);
		// 	$new_to = date('Y-m-d',$to);
		// 	//echo ($new_to);
		// }
		// else
		// {
		// 	$new_to = null;
		// }

		$date_to_billing_cycle = str_replace('/', '-', $to_billing_cycle_date);
		$date_for_issue = str_replace('/', '-', $recurring_issue_date);
		// $to_billing_cycle = strtotime($date_for_issue);
		// //echo ($new_to);
		// if($type_of_day == 1)
		// {
		// 	$new_to_billing_cycle = date('Y-m-d', strtotime('-'.$days.' days', $to_billing_cycle));
		// }
		// elseif($type_of_day == 2)
		// {
		// 	$new_to_billing_cycle = date('Y-m-d', strtotime('+'.$days.' days', $to_billing_cycle));
		// }
		// else
		// {
		// 	$new_to_billing_cycle = date('Y-m-d',$to_billing_cycle);
		// }
		
		$next_billing_cycle = new DateTime(date('Y-m-d', strtotime($date_to_billing_cycle)));
		$latest_date_for_issue = new DateTime(date('Y-m-d', strtotime($date_for_issue)));
		//echo json_encode($next_billing_cycle);
		// We extract the day of the month as $start_day

		if($frequency == 2)
		{
			//$last_recurring_date = date("Y-m-d", strtotime("+1 month", $new_from));
			$next_from_billing_cycle = date('Y-m-d', strtotime('+ 1 days', strtotime($date_to_billing_cycle)));
			$next_to_billing_cycle = $this->MonthShifter($next_billing_cycle,1)->format(('Y-m-d'));
			$latest_date_for_issue = $this->MonthShifter($latest_date_for_issue,1)->format(('Y-m-d'));
		}
		elseif($frequency == 3)
		{
			//$last_recurring_date = date("Y-m-d", strtotime("+3 months", $new_from));
			// $next_from_billing_cycle = $this->MonthShifter($next_from_billing_cycle,3)->format(('Y-m-d'));
			// $next_billing_cycle = new DateTime($next_from_billing_cycle);
			$next_from_billing_cycle = date('Y-m-d', strtotime('+ 1 days', strtotime($date_to_billing_cycle)));
			$next_to_billing_cycle = $this->MonthShifter($next_billing_cycle,3)->format(('Y-m-d'));
			$latest_date_for_issue = $this->MonthShifter($latest_date_for_issue,3)->format(('Y-m-d'));
		}
		elseif($frequency == 4)
		{
			//$last_recurring_date = date("Y-m-d", strtotime("+6 months", $new_from));
			// $next_from_billing_cycle = $this->MonthShifter($next_from_billing_cycle,6)->format(('Y-m-d'));
			// $next_billing_cycle = new DateTime($next_from_billing_cycle);
			$next_from_billing_cycle = date('Y-m-d', strtotime('+ 1 days', strtotime($date_to_billing_cycle)));
			$next_to_billing_cycle = $this->MonthShifter($next_billing_cycle,6)->format(('Y-m-d'));
			$latest_date_for_issue = $this->MonthShifter($latest_date_for_issue,6)->format(('Y-m-d'));
		}
		elseif($frequency == 5)
		{
			//$last_recurring_date = date("Y-m-d", strtotime("+1 year", $new_from));
			// $next_from_billing_cycle = $this->MonthShifter($next_from_billing_cycle,12)->format(('Y-m-d'));
			// $next_billing_cycle = new DateTime($next_from_billing_cycle);
			$next_from_billing_cycle = date('Y-m-d', strtotime('+ 1 days', strtotime($date_to_billing_cycle)));
			$next_to_billing_cycle = $this->MonthShifter($next_billing_cycle,12)->format(('Y-m-d'));
			$latest_date_for_issue = $this->MonthShifter($latest_date_for_issue,12)->format(('Y-m-d'));
		}

		// if(($new_from == null || ($next_from_billing_cycle != null && $next_from_billing_cycle >= $new_from)) && ($new_to == null || ($next_to_billing_cycle != null && $next_to_billing_cycle <= $new_to)))
		// {
			echo json_encode(array("status" => 1, "issue_date" => date('d/m/Y', strtotime($latest_date_for_issue)), "next_from_billing_cycle" => date('d/m/Y', strtotime($next_from_billing_cycle)), 'next_to_billing_cycle' => date('d/m/Y', strtotime($next_to_billing_cycle))));
		// }
		// else
		// {
		// 	echo json_encode(array("status" => 2));
		// }
	}
	
	public function add_client_billing_info()
	{
		$_POST['client_billing_info_id'] = array_values($_POST['client_billing_info_id']);
		$_POST['service'] = array_values($_POST['service']);
		$_POST['invoice_description'] = array_values($_POST['invoice_description']);
		$_POST['amount'] = array_values($_POST['amount']);
		$_POST['currency'] = array_values($_POST['currency']);
		$_POST['unit_pricing'] = array_values($_POST['unit_pricing']);
		// $_POST['frequency'] = array_values($_POST['frequency']);
		// $_POST['from'] = array_values($_POST['from']);
		// $_POST['to'] = array_values($_POST['to']);
		// $_POST['type_of_day'] = array_values($_POST['type_of_day']);
		// $_POST['days'] = array_values($_POST['days']);
		// $_POST['from_billing_cycle'] = array_values($_POST['from_billing_cycle']);
		// $_POST['to_billing_cycle'] = array_values($_POST['to_billing_cycle']);

		//$this->db->delete('client_billing_info', array("company_code" => $_POST['company_code']));
		//echo json_encode(json_decode($_POST['array_client_billing_info_id']));
		if(count(json_decode($_POST['array_client_billing_info_id'])) != 0)
		{
			for($g = 0; $g < count(json_decode($_POST['array_client_billing_info_id'])); $g++ )
			{

				$deleted_client_billing_info['deleted'] = 1;

				$this->db->where(array("company_code" => $_POST['company_code'], "client_billing_info_id" => json_decode($_POST['array_client_billing_info_id'])[$g]));
				$this->db->update("client_billing_info",$deleted_client_billing_info);
			}
		}

		for($i = 0; $i < count($_POST['client_billing_info_id']); $i++ )
		{

			// $this->form_validation->set_rules('service['.$i.']', 'Service', 'required');
   //          $this->form_validation->set_rules('invoice_description['.$i.']', 'Invoice Description', 'required');
   //          $this->form_validation->set_rules('amount['.$i.']', 'Amount', 'required');

   //          if ($this->form_validation->run() == FALSE || $_POST['service'][$i] == 0)
   //          {
   //              $this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

   //              if($_POST['service'][$i] == 0)
   //              {
   //                  $service_error = "The Service field is required.";
   //              }
   //              else
   //              {
   //                  $service_error = "";
   //              }

   //              $error = array(
   //                  'service' => $service_error,
   //                  'invoice_description' => strip_tags(form_error('invoice_description['.$i.']')),
   //                  'amount' => strip_tags(form_error('amount['.$i.']')),
   //              );

   //              echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field.', 'title' => 'Error', "error" => $error));
   //          }
   //          else
   //          {
            	// if($i == 0)
            	// {
            		//$this->db->delete('client_billing_info', array("company_code" => $_POST['company_code']));
            	//}

				$client_billing_info['company_code'] = $_POST['company_code'];
				$client_billing_info['client_billing_info_id'] = $_POST['client_billing_info_id'][$i];
				$client_billing_info['service'] = $_POST['service'][$i];
				$client_billing_info['invoice_description'] = $_POST['invoice_description'][$i];
				//(int)str_replace(',', '', $amount[$p]);
				$client_billing_info['amount'] = (float)str_replace(',', '', $_POST['amount'][$i]);
				$client_billing_info['currency'] = $_POST['currency'][$i];
				$client_billing_info['unit_pricing'] = $_POST['unit_pricing'][$i];
				// $client_billing_info['frequency'] = $_POST['frequency'][$i];
				// $client_billing_info["from"] = $_POST['from'][$i];
				// $client_billing_info["to"] = $_POST['to'][$i];

				// $client_billing_info["type_of_day"] = $_POST['type_of_day'][$i];
				// $client_billing_info["days"] = $_POST['days'][$i];
				// $client_billing_info["from_billing_cycle"] = $_POST['from_billing_cycle'][$i];
				// $client_billing_info["to_billing_cycle"] = $_POST['to_billing_cycle'][$i];

				//$this->db->insert("client_billing_info",$client_billing_info);
			//}

			$q = $this->db->get_where("client_billing_info", array("company_code" => $_POST['company_code'], "client_billing_info_id" => $_POST['client_billing_info_id'][$i], "deleted =" => 0));

			if (!$q->num_rows())
			{				
				$this->db->insert("client_billing_info",$client_billing_info);
				//$insert_share_capital_id = $this->db->insert_id();
			} 
			else 
			{	
				
				$this->db->where(array("company_code" => $_POST['company_code'], "client_billing_info_id" => $_POST['client_billing_info_id'][$i], "deleted =" => 0));
				$this->db->update("client_billing_info",$client_billing_info);
			}
			


		}

		$client_info = $this->db->query("select * from client where company_code = '".$_POST['company_code']."'");

		$client_info = $client_info->result_array();

		echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', 'client_id' => $client_info[0]['id']));

	}

	function get_reminder()
    {

        //$currency = $_POST['currency'];
        $this->db->select('document_reminder.*, reminder_tag.reminder_tag_name')
                ->from('document_reminder')
                ->join('reminder_tag', 'reminder_tag.id = document_reminder.reminder_tag_id', 'left')
                ->where('document_reminder.firm_id = '.$this->session->userdata('firm_id'));

        //$get_all_firm = $this->db->get_where('firm',array('user_id'=>$this->session->userdata('user_id')));
        $get_all_reminder = $this->db->get();
        $result = $get_all_reminder->result_array();
        //echo json_encode($result);
        if(!$get_all_reminder) {
            throw new exception("Reminder not found.");
        }
        $res = array();

        for($j = 0; $j < count($result); $j++)
        {
            $res[$result[$j]['id']] = $result[$j]['reminder_name'];
        }    

        $data = array('status'=>'success', 'tp'=>1, 'msg'=>"Reminder fetched successfully.", 'result'=>$res);

        echo json_encode($data);

    }

	public function add_setup_info()
	{
		$this->form_validation->set_rules('contact_email[]', 'Email', 'valid_email');
        $this->form_validation->set_rules('contact_phone[]', 'Phone Number', 'numeric');

        if(count($_POST['hidden_contact_phone']) > 1 && $_POST['contact_phone_primary'] == null)
        {
            $validate_contact_phone_primary = FALSE;
        }
        else
        {
            $validate_contact_phone_primary = TRUE;
        }

        if(count($_POST['contact_email']) > 1 && $_POST['contact_email_primary'] == null)
        {
            $validate_contact_email_primary = FALSE;
        }
        else
        {
            $validate_contact_email_primary = TRUE;
        }

        if ($this->form_validation->run() == FALSE || $validate_contact_phone_primary == FALSE || $validate_contact_email_primary == FALSE)
        {
        	if($validate_contact_phone_primary == FALSE)
            {
                $validate_contact_phone = "Please set the primary field.";
            }
            else
            {
                $validate_contact_phone = strip_tags(form_error('contact_phone[]'));
            }

            if($validate_contact_email_primary == FALSE)
            {
                $validate_contact_email = "Please set the primary field.";
            }
            else
            {
                $validate_contact_email = strip_tags(form_error('contact_email[]'));
            }

            $arr = array(

                'contact_phone' => $validate_contact_phone,
                'contact_email' => $validate_contact_email,
            );

            echo json_encode(array("Status" => 0, "error" => $arr, 'message' => 'Please complete all required field', 'title' => 'Error'));
        }
        else
        {

			//echo json_encode($_POST['select_reminder']);

			$client_signing_info['company_code'] = $_POST['company_code'];
			//$client_signing_info['show_all'] = 1;
			$client_signing_info['chairman'] = $_POST['chairman'];
			$client_signing_info['director_signature_1'] = $_POST['director_signature_1'];

			if(isset($_POST['director_signature_2']))
	        {
	            $client_signing_info['director_signature_2'] = $_POST['director_signature_2'];
	        }
	        else
	        {
	        	$client_signing_info['director_signature_2'] = 0;
	        }
			

			$client_contact_info['company_code'] = $_POST['company_code'];
			$client_contact_info['name'] = strtoupper($_POST['contact_name']);
			// $client_contact_info['phone'] = $_POST['contact_phone'];
			// $client_contact_info['email'] = $_POST['contact_email'];

			//$billing['amount'] = 0;
			for($i = 0; $i < count($_POST['director_retiring_client_officer_id']); $i++ )
			{
				$director_retiring['retiring'] = $_POST['hidden_director_retiring_checkbox'][$i];
				$this->db->where(array("id" => $_POST['director_retiring_client_officer_id'][$i]));
				$this->db->update("client_officers",$director_retiring);
			}

			

			$p = $this->db->get_where("client_signing_info", array("company_code" => $_POST['company_code']));

			if (!$p->num_rows())
			{				
				$this->db->insert("client_signing_info",$client_signing_info);
				//$insert_share_capital_id = $this->db->insert_id();
			} 
			else 
			{	
				$this->db->where(array("company_code" => $_POST['company_code']));
				$this->db->update("client_signing_info",$client_signing_info);
			}

			$query = $this->db->get_where("client_contact_info", array("company_code" => $_POST['company_code']));

			if (!$query->num_rows())
			{				
				$this->db->insert("client_contact_info",$client_contact_info);
				$client_contact_info_id = $this->db->insert_id();
				for($g = 0; $g < count($_POST['hidden_contact_phone']); $g++)
                {
                    if($_POST['hidden_contact_phone'][$g] != "")
                    {
                        $contactPhone['client_contact_info_id'] = $client_contact_info_id;
                        $contactPhone['phone'] = strtoupper($_POST['hidden_contact_phone'][$g]);
                        if($_POST['contact_phone_primary'] == $_POST['hidden_contact_phone'][$g])
                        {
                            $contactPhone['primary_phone'] = 1;
                        }
                        else
                        {
                            $contactPhone['primary_phone'] = 0;
                        }
                        $this->db->insert('client_contact_info_phone', $contactPhone);
                    }
                }

                for($g = 0; $g < count($_POST['contact_email']); $g++)
                {
                    if($_POST['contact_email'][$g] != "")
                    {
                        $contactEmail['client_contact_info_id'] = $client_contact_info_id;
                        $contactEmail['email'] = strtoupper($_POST['contact_email'][$g]);
                        if($_POST['contact_email_primary'] == $_POST['contact_email'][$g])
                        {
                            $contactEmail['primary_email'] = 1;
                        }
                        else
                        {
                            $contactEmail['primary_email'] = 0;
                        }
                        $this->db->insert('client_contact_info_email', $contactEmail);
                    }
                }
			} 
			else 
			{	
				$this->db->where(array("company_code" => $_POST['company_code']));
				$this->db->update("client_contact_info",$client_contact_info);
				$client_contact_information = $query->result_array(); 
				$client_contact_info_id = $client_contact_information[0]["id"];

				$this->db->delete("client_contact_info_phone",array('client_contact_info_id'=>$client_contact_info_id));

				for($g = 0; $g < count($_POST['hidden_contact_phone']); $g++)
                {
                    if($_POST['hidden_contact_phone'][$g] != "")
                    {
                        $contactPhone['client_contact_info_id'] = $client_contact_info_id;
                        $contactPhone['phone'] = strtoupper($_POST['hidden_contact_phone'][$g]);
                        if($_POST['contact_phone_primary'] == $_POST['hidden_contact_phone'][$g])
                        {
                            $contactPhone['primary_phone'] = 1;
                        }
                        else
                        {
                            $contactPhone['primary_phone'] = 0;
                        }
                        $this->db->insert('client_contact_info_phone', $contactPhone);
                    }
                }

                $this->db->delete("client_contact_info_email",array('client_contact_info_id'=>$client_contact_info_id));

                for($g = 0; $g < count($_POST['contact_email']); $g++)
                {
                    if($_POST['contact_email'][$g] != "")
                    {
                        $contactEmail['client_contact_info_id'] = $client_contact_info_id;
                        $contactEmail['email'] = strtoupper($_POST['contact_email'][$g]);
                        if($_POST['contact_email_primary'] == $_POST['contact_email'][$g])
                        {
                            $contactEmail['primary_email'] = 1;
                        }
                        else
                        {
                            $contactEmail['primary_email'] = 0;
                        }
                        $this->db->insert('client_contact_info_email', $contactEmail);
                    }
                }
			}

			$this->db->delete("client_setup_reminder",array('company_code'=>$_POST['company_code']));

			if($_POST['select_reminder'] != null)
			{
				for($g = 0; $g < count($_POST['select_reminder']); $g++)
                {
                	$reminder['company_code'] = $_POST['company_code'];
                	$reminder['selected_reminder'] = $_POST['select_reminder'][$g];

                	$this->db->insert('client_setup_reminder', $reminder);
                }
			}

			$client_info = $this->db->query("select * from client where company_code = '".$_POST['company_code']."'");

			$client_info = $client_info->result_array();

			$this->db->delete("corporate_representative",array('registration_no'=>$client_info[0]["registration_no"]));

			for($g = 0; $g < count($_POST['subsidiary_name']); $g++)
            {
                if($_POST['subsidiary_name'][$g] != "")
                {
                    $corp_rep['registration_no'] = $client_info[0]["registration_no"];
                    $corp_rep['subsidiary_name'] = strtoupper($_POST['subsidiary_name'][$g]);
                    $corp_rep['name_of_corp_rep'] = strtoupper($_POST['corp_rep_name'][$g]);
                    $corp_rep['identity_number'] = strtoupper($_POST['corp_rep_identity_number'][$g]);
                    $corp_rep['effective_date'] = $_POST['date_of_appointment'][$g];
                    $corp_rep['cessation_date'] = $_POST['date_of_cessation'][$g];

                    $this->db->insert('corporate_representative', $corp_rep);
                }
            }

			echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', 'client_id' => $client_info[0]['id']));
			//redirect("masterclient/edit/".$this->session->userdata('client_id')."");	
		}
	}
	public function check_incorporation_date()
	{
		$company_code = $_POST["company_code"];

		$q = $this->db->query("select incorporation_date from client where company_code = '".$company_code."'");

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        echo FALSE;

	}
	public function change_auto_generate() 
	{
		$company_code = $_POST['company_code'];

		$this->db->set("auto_generate", 1);
		$this->db->where(array("company_code" => $company_code));
		$this->db->update("client");

		$this->db->where(array("company_code" => $company_code));
		$id = $this->db->get('client')->row()->id;


		echo json_encode(array('message' => 'Information Updated', 'title' => 'Updated', 'client_id' => $id));
	}
	public function edit ($id = null, $tab = null) //edit_client
	{

		if(isset($_SESSION['open_unique_code']) && $_SESSION['open_unique_code'] !='')
		{
			$unique_code =$_SESSION['open_unique_code'];
			$this->data['client'] = $this->db_model->getClientbyUcode($unique_code);
			// exit();
			$this->session->set_userdata('open_unique_code','');
		}else{
			$this->data['client'] = $this->db_model->getClientbyID($id);
			//echo json_encode($this->data['client']->company_code);
			$company_code =$this->data['client']->company_code;
			$registration_no =$this->data['client']->registration_no;
			$unique_code =$this->data['client']->unique_code;
		}
			// echo $unique_code;
		// print_r($_SESSION['open_unique_code']);
		if($tab == "filing")
		{
			$this->data['tab'] = "filing";
		}
		else if($tab == "setup")
		{
			$this->data['tab'] = "setup";
		}
		else if($tab == "billing")
		{
			$this->data['tab'] = "billing";
		}
		//destroy session for setup tab
		$this->session->unset_userdata('chairman');
		$this->session->unset_userdata('director_signature_1');
		$this->session->unset_userdata('director_signature_2');

		$this->data['sharetype'] = $this->master_model->get_all_share_type();
		//$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();
		$this->data['citizen'] = $this->master_model->get_all_citizen();
		$this->data['citizen'] = $this->master_model->get_all_citizen();
		$this->data['typeofdoc'] = $this->master_model->get_all_typeofdoc();
		//$this->data['doccategory'] = $this->master_model->get_all_doccategory();
		$this->session->set_userdata('unique_code', $unique_code);
		$this->session->set_userdata('company_code', $company_code);
		$this->session->set_userdata('client_id', $id);

		$this->data['client_officers'] =$this->db_model->getClientOfficer($company_code);
		$this->data['client_guarantee'] =$this->db_model->getClientGuarantee($company_code);
		$this->data['client_controller'] =$this->db_model->getClientController($company_code);
		$this->data['client_charges'] = $this->master_model->get_all_chargee($company_code);
		$this->data['client_share_capital'] = $this->master_model->get_all_client_share_capital($company_code);
		//$this->data['allotment'] = $this->master_model->get_all_allotment_group($company_code);
		$this->data['member'] = $this->master_model->get_all_member($company_code);
		$this->data['member_certificate'] = $this->master_model->get_all_member_certificate($company_code);
		$this->data['client_signing_info'] = $this->master_model->get_all_client_signing_info($company_code);
		$this->data['client_contact_info'] = $this->master_model->get_all_client_contact_info($company_code);
		$this->data['client_reminder_info'] = $this->master_model->get_all_client_reminder_info($company_code);
		$this->data['client_billing_info'] = $this->master_model->get_all_client_billing_info($company_code);
		if($this->data['client_billing_info'] == false)
		{
			$this->data['client_billing_info'] = $this->master_model->get_all_default_client_service();
		}
		$this->data['filing_data'] = $this->master_model->get_all_filing_data($company_code);
		$this->data['eci_filing_data'] = $this->master_model->get_all_eci_filing_data($company_code);
		$this->data['tax_filing_data'] = $this->master_model->get_all_tax_filing_data($company_code);
		$this->data['template'] = $this->master_model->get_all_template_data($company_code);
		$this->data['director_retiring'] = $this->db_model->get_all_director_retiring($company_code);
		$this->data['corp_rep_data'] = $this->db_model->get_all_corp_rep($registration_no);

		
		$this->data['officer'] =$this->db_model->getOfficerUC($unique_code);
		// $this->data['issued_sharetype'] = $this->master_model->get_all_issued_sharetype($unique_code);
		//$this->data['paid_share'] = $this->master_model->get_all_paid_share($unique_code);
		$this->data['member_capital'] = $this->master_model->get_all_member_capital($unique_code);
		$this->data['person'] = $this->master_model->get_all_person();
		//$this->data['chargee'] = $this->master_model->get_all_chargee($unique_code);
		$this->data['client_others'] = $this->master_model->get_typeofdoc($unique_code);
		//$this->data['allotment_member'] = $this->master_model->get_all_alotment_member($unique_code);
		
		$this->data['client_service'] = $this->master_model->get_all_client_service($unique_code);
		$this->data['client_setup'] = $this->master_model->get_all_client_setup($unique_code);

		//$registered_address = $this->db->query("select postal_code, street_name, building_name, unit_no1, unit_no2 from firm ");

		$this->db->select('our_service_registration_address.id, our_service_info.service_name, our_service_registration_address.postal_code, our_service_registration_address.street_name, our_service_registration_address.building_name, our_service_registration_address.unit_no1, our_service_registration_address.unit_no2')
                ->from('firm')
                ->join('user_firm', 'user_firm.firm_id = firm.id AND user_firm.user_id = '.$this->session->userdata('user_id'), 'left')
                ->join('our_service_info', 'our_service_info.user_admin_code_id = '.$this->session->userdata('user_admin_code_id').' and service_type = 7', 'left')
                ->join('our_service_registration_address', 'our_service_registration_address.our_service_info_id = our_service_info.id', 'left')
                ->where('user_firm.user_id = '.$this->session->userdata('user_id'))
                ->where('user_firm.in_use = 1');
        $registered_address = $this->db->get();

        $registered_address_info = $registered_address->result_array();
        $this->data['registered_address_info'] = $registered_address_info;

        $this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Clients', base_url('masterclient'));
		$this->mybreadcrumb->add('Edit Client - '.$this->data['client']->company_name.'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data['first_time'] = true;
        //echo json_encode($this->data);
			// $this->sma->print_arrays($this->data['member_capital']);
        $bc = array(array('link' => '#', 'page' => lang('Edit Client')));
        $meta = array('page_title' => lang('Edit Client'), 'bc' => $bc, 'page_name' => 'Edit Client');
		// $this->data['page_name'] = 'Clients';
        $this->page_construct('client/edit_client.php', $meta, $this->data);
		
	}
	
	public function get_latest_retire_director()
	{
		$company_code = $_POST["company_code"];
		$this->data['director_retiring'] = $this->db_model->get_all_director_retiring($company_code);
		echo json_encode($this->data);
	}
	public function filter_position()
	{
		$position = $_POST["search_position"];
		$company_code = $_POST["company_code"];

		$this->data['client_officers'] =$this->db_model->getSearchClientOfficer($position, $company_code);

		echo json_encode($this->data);
	}
	public function refresh_member()
	{
		$company_code = $_POST["company_code"];

		$this->data['client_share_capital'] = $this->master_model->get_all_client_share_capital($company_code);
		$this->data['member'] = $this->master_model->get_all_member($company_code);
		$this->data['member_certificate'] = $this->master_model->get_all_member_certificate($company_code);

		echo json_encode(array("Status" => 1, 'info' => $this->data));

	}

	public function buyback ($company_code)
	{
        $bc = array(array('link' => '#', 'page' => lang('Create BuyBack')));
        $meta = array('page_title' => lang('Create BuyBack'), 'bc' => $bc, 'page_name' => 'Create BuyBack');
		// $this->data['page_name'] = 'Clients';
		/*$this->data['unique_code'] = $unique_code;
		$this->data['sharetype'] = $this->master_model->get_all_share_type();
		$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_exist_company_share_type($company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();

		$this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Buyback', base_url('masterclient/view_buyback/'.$company_code.''));
		$this->mybreadcrumb->add('Create Buyback - '.$r[0]["company_name"].'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data["client_status"] = $r[0]["status"];

        $this->page_construct('client/buyback.php', $meta, $this->data);
		
	}

	public function view_buyback ($company_code)
	{
        $bc = array(array('link' => '#', 'page' => lang('Buyback')));
        $meta = array('page_title' => lang('Buyback'), 'bc' => $bc, 'page_name' => 'Buyback');
		
		if (isset($_POST['type'])) $type = $_POST['type'];
		if (isset($_POST['search'])) $search = $_POST['search'];

		if($type == null)
        {
            $type = "all";
        }
        else 
        {
            $type = $_POST['type'];
        }
        $this->data['type'] = $type;

		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_exist_company_share_type($company_code);
		//$this->data['client_share_capital'] = $this->master_model->get_all_client_share_capital($company_code);
		$this->data['buyback'] = $this->master_model->get_all_buyback_to_view($search,$type,$company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();
		$this->data["client_status"] = $r[0]["status"];
		/*$allotment_id = array();
        $this->session->set_userdata(array(
            'allotment_id'  =>  $allotment_id,
        ));*/
		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
        $this->page_construct('client/buyback_edit.php', $meta, $this->data);

		
	}

	public function edit_buyback ($transaction_id, $client_member_share_capital_id, $company_code) 
	{
		$bc = array(array('link' => '#', 'page' => lang('Edit Buyback')));
        $meta = array('page_title' => lang('Edit Buyback'), 'bc' => $bc, 'page_name' => 'Edit Buyback');
		// $this->data['page_name'] = 'Clients';
		//$this->data['unique_code'] = $unique_code;
		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_non_exist_company_share_type($client_member_share_capital_id,$company_code);
		$this->data['buyback'] = $this->master_model->get_edit_buyback_group($transaction_id, $company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();

		$this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Buyback', base_url('masterclient/view_buyback/'.$company_code.''));
		$this->mybreadcrumb->add('Edit Buyback - '.$r[0]["company_name"].'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data["client_status"] = $r[0]["status"];
		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
        $this->page_construct('client/buyback.php', $meta, $this->data);
	}

	public function get_amount_share()
	{
		$id = $_POST["id"];
		$officer_id = $_POST["officer_id"];
		$field_type = $_POST["field_type"];

		$q = $this->db->query('select sum(amount_share) as amount_share from member_shares where id < "'.$id.'" AND officer_id="'.$officer_id.'" AND field_type = "'.$field_type.'"');

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        echo (FALSE);

	}
	public function view_transfer ($company_code)
	{
        $bc = array(array('link' => '#', 'page' => lang('Transfer')));
        $meta = array('page_title' => lang('Transfer'), 'bc' => $bc, 'page_name' => 'Transfer');
		
		if (isset($_POST['type'])) $type = $_POST['type'];
		if (isset($_POST['search'])) $search = $_POST['search'];

		if($type == null)
        {
            $type = "all";
        }
        else 
        {
            $type = $_POST['type'];
        }
        $this->data['type'] = $type;

		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_exist_company_share_type($company_code);
		//$this->data['client_share_capital'] = $this->master_model->get_all_client_share_capital($company_code);
		$this->data['transfer'] = $this->master_model->get_all_transfer_to_view($search,$type,$company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();
		$this->data["client_status"] = $r[0]["status"];

		$transfer_id = array();
        $this->session->set_userdata(array(
            'transfer_id'  =>  $transfer_id,
        ));

        $to_id = array();
        $this->session->set_userdata(array(
            'to_id'  =>  $to_id,
        ));
		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
        $this->page_construct('client/transfer_edit.php', $meta, $this->data);
		
	}

	public function transfer ($company_code)
	{
        $bc = array(array('link' => '#', 'page' => lang('Create Transfer')));
        $meta = array('page_title' => lang('Create Transfer'), 'bc' => $bc, 'page_name' => 'Create Transfer');
		// $this->data['page_name'] = 'Clients';
		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_exist_company_share_type($company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();

		$this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Transfer', base_url('masterclient/view_transfer/'.$company_code.''));
		$this->mybreadcrumb->add('Create Transfer - '.$r[0]["company_name"].'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data["client_status"] = $r[0]["status"];

        $this->page_construct('client/transfer.php', $meta, $this->data);
		
	}

	public function edit_transfer ($transaction_id, $client_member_share_capital_id, $company_code) 
	{
		$bc = array(array('link' => '#', 'page' => lang('Edit Transfer')));
        $meta = array('page_title' => lang('Edit Transfer'), 'bc' => $bc, 'page_name' => 'Edit Transfer');
		// $this->data['page_name'] = 'Clients';
		//$this->data['unique_code'] = $unique_code;
		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_non_exist_company_share_type($client_member_share_capital_id,$company_code);
		$this->data['transfer'] = $this->master_model->get_edit_transfer_group($transaction_id, $company_code);
		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();


		$this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Transfer', base_url('masterclient/view_transfer/'.$company_code.''));
		$this->mybreadcrumb->add('Edit Transfer - '.$r[0]["company_name"].'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data["client_status"] = $r[0]["status"];
		$this->data["transaction_id"] = $transaction_id;

		$transfer_id = array();
        $this->session->set_userdata(array(
            'transfer_id'  =>  $transfer_id,
        ));

        $to_id = array();
        $this->session->set_userdata(array(
            'to_id'  =>  $to_id,
        ));

        $this->page_construct('client/transfer.php', $meta, $this->data);
	}


	public function get_allotment_people()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];

		//echo json_encode($client_member_share_capital_id);
		
		$q = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client.registration_no, client.company_name as client_company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id left join client on client.id = member_shares.officer_id and member_shares.field_type = "client" where member_shares.company_code="'.$company_code.'" AND member_shares.client_member_share_capital_id = "'.$client_member_share_capital_id.'" GROUP BY member_shares.field_type, member_shares.officer_id HAVING sum(member_shares.number_of_share) != 0');

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        echo (FALSE);
	}

	public function get_buyback_people()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$transaction_date = $_POST["transaction_date"];

		//echo json_encode($client_member_share_capital_id);
		
		$q = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client.registration_no, client.company_name as client_company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id left join certificate on certificate.officer_id = member_shares.officer_id AND certificate.field_type = member_shares.field_type AND certificate.transaction_id = member_shares.transaction_id left join client on client.id = member_shares.officer_id and member_shares.field_type = "client" where member_shares.company_code="'.$company_code.'" AND member_shares.client_member_share_capital_id = "'.$client_member_share_capital_id.'" AND UNIX_TIMESTAMP(STR_TO_DATE("'.$transaction_date.'","%d/%m/%Y")) >= UNIX_TIMESTAMP(STR_TO_DATE(member_shares.transaction_date,"%d/%m/%Y")) GROUP BY member_shares.field_type, member_shares.officer_id HAVING sum(member_shares.number_of_share) != 0');
		//from_unixtime(UNIX_TIMESTAMP(STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y')),'%Y-%m-%d')
        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        echo (FALSE);
	}

	public function get_transfer_people()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$transaction_id = $_POST["transaction_id"];
		$transaction_date = $_POST["transaction_date"];

		//echo json_encode($client_member_share_capital_id);
		
		$q = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client.registration_no, client.company_name as client_company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id left join client on client.id = member_shares.officer_id and member_shares.field_type = "client" where member_shares.company_code="'.$company_code.'" AND member_shares.client_member_share_capital_id = "'.$client_member_share_capital_id.'" AND STR_TO_DATE("'.$transaction_date.'", "%d/%m/%Y") > STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y") GROUP BY member_shares.field_type, member_shares.officer_id HAVING sum(member_shares.number_of_share) != 0');

		 /*left join member_shares on member_shares.transaction_id = certificate.transaction_id and member_shares.officer_id = certificate.officer_id and member_shares.field_type = certificate.field_type*/
		  /*AND 0 > member_shares.number_of_share*/

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        echo (FALSE);
	}

	public function save_transfer()
	{

		$class = $_POST["class"];
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$currency = $_POST["currency"];
		$date = $_POST["date"];
		//$allotment["transaction_id"] = "TRAN-".mt_rand(100000000, 999999999);

		//From(buyback)
		$_POST['transfer_id'] = array_values($_POST['transfer_id']); //buyback_id
		$_POST['officer_id'] = array_values($_POST['officer_id']);//officer_id
		$_POST['field_type'] = array_values($_POST['field_type']);//field_type
		$_POST['person_name'] = array_values($_POST['person_name']);//member_name
		$_POST['share_transfer'] = array_values($_POST['share_transfer']);//share_buyback
		

		$_POST['current_share'] = array_values($_POST['current_share']);//current_number_of_share
		$_POST['amount_share'] = array_values($_POST['amount_share']);//current_amount_share
		$_POST['no_of_share_paid'] = array_values($_POST['no_of_share_paid']);
		$_POST['amount_paid'] = array_values($_POST['amount_paid']);
		$_POST['consideration'] = array_values($_POST['consideration']);
		$_POST['merge_from_certificate_no'] = array_values($_POST['merge_from_certificate_no']);//hidden_certificate_no

		//To(Allotment)
		
		$_POST['to_officer_id'] = array_values($_POST['to_officer_id']);//officer_id
		$_POST['number_of_share_to'] = array_values($_POST['number_of_share_to']); //number_of_share
		$_POST['to_field_type'] = array_values($_POST['to_field_type']);//field_type
		$_POST['to_certificate_no'] = array_values($_POST['to_certificate_no']);//new_certificate_no
		$_POST['merge_to_certificate_no'] = array_values($_POST['merge_to_certificate_no']);//merge_certificate_no
		$_POST['merge_to_number_of_share'] = array_values($_POST['merge_to_number_of_share']);//merge_number_of_share
		$_POST['to_id'] = array_values($_POST['to_id']); //member_share_id
		$_POST['to_person_name'] = array_values($_POST['to_person_name']);
		$_POST['id_to'] = array_values($_POST['id_to']);
		$_POST['merge_status'] = array_values($_POST['merge_status']);
		$_POST['previous_merge_cert_num'] = array_values($_POST['previous_merge_cert_num']);
		$_POST['latest_merge_cert_no'] = array_values($_POST['latest_merge_cert_no']);
		
		//echo json_encode($_POST);
		$total_no_of_share = 0;
		$total_amount_share = 0;
		$per_share = 0;

		for($p = 0; $p < count($_POST['current_share']); $p++ )
		{
			$total_no_of_share += (int)str_replace(',', '',$_POST['current_share'][$p]);
		}

		for($q = 0; $q < count($_POST['amount_share']); $q++ )
		{
			$total_amount_share += (int)str_replace(',', '',$_POST['amount_share'][$q]);
		}

		$per_share = $total_amount_share/$total_no_of_share;

		/*echo json_encode($_POST['current_share']);
		echo json_encode($_POST['amount_share']);
		echo json_encode($total_amount_share);
		echo json_encode($total_no_of_share);*/

		$transaction_id = "TR-".mt_rand(100000000, 999999999);

		$previous_member_shares_query = $this->db->get_where("member_shares", array("id" => $_POST['transfer_id'][0]));

		$previous_member_shares_query_data = $previous_member_shares_query->result_array();

		if ($previous_member_shares_query->num_rows())
		{
			$previous_member_share_result = $this->db->query("select member_shares.* from member_shares where company_code='".$_POST['company_code']."' AND member_shares.transaction_type = 'Transfer' AND member_shares.client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$previous_member_shares_query_data[0]["transaction_date"]."','%d/%m/%Y') ORDER BY member_shares.id");
						//echo json_encode($check_date);
			$previous_member_share_result = $previous_member_share_result->result_array();
		}

		if(count($this->session->userdata('transfer_id')) > 0)
		{
			$this->delete_transfer_from();
		}

		if(count($this->session->userdata('to_id')) > 0)
		{
			$this->delete_transfer_to();
		}

		/*echo json_encode($this->session->userdata('transfer_id'));
		echo json_encode($this->session->userdata('to_id'));*/

		

		

		
		$new_transfer_id = array();
		for($i = 0; $i < count($_POST['officer_id']); $i++ )
		{


			$new_number_of_share_from = (int)str_replace(',', '', $_POST['current_share'][$i]) - (int)str_replace(',', '', $_POST['share_transfer'][$i]);//new_number_of_share

			//$transaction_id = "TR-".mt_rand(100000000, 999999999);

			$temperary_cert = "TEMPORARY".mt_rand(100000000, 999999999);
			$create_new_cert = "NC".mt_rand(100000000, 999999999);

			//$per_share = (int)$_POST['current_number_of_share'][$i]/(float)$_POST['current_amount_share'][$i];
			//echo json_encode($per_share);
			$buyback["company_code"] = $company_code;
			$buyback["transaction_date"] = $date;
			$buyback["client_member_share_capital_id"] = $client_member_share_capital_id;
			$buyback["officer_id"] = $_POST['officer_id'][$i];
			$buyback["field_type"] = $_POST['field_type'][$i];
			$buyback["transaction_type"] = $_POST['transaction_type'];
			$buyback["number_of_share"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
			$buyback["amount_share"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
			$buyback["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
			$buyback["amount_paid"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
			$buyback["consideration"] = ((float)str_replace(',', '', $_POST['consideration'][$i]));

			$q = $this->db->get_where("member_shares", array("id" => $_POST['transfer_id'][$i]));

			$previous_member_share_info = $q->result_array();

			if (!$q->num_rows())
			{				
				$buyback["transaction_id"] = $transaction_id;
				$buyback["cert_status"] = 1;
				$this->db->insert("member_shares",$buyback);
				$insert_transfer_id = $this->db->insert_id();
				array_push($new_transfer_id, $insert_transfer_id);

				//echo json_encode($_POST['consideration'][$i]);
			} 
			else 
			{	
				
				$this->db->delete('member_shares', array("id" => $_POST['transfer_id'][$i]));

				$buyback["transaction_id"] = $previous_member_share_info[0]["transaction_id"];
				$buyback["cert_status"] = $previous_member_share_info[0]["cert_status"];
				$this->db->insert("member_shares",$buyback);
				$insert_transfer_id = $this->db->insert_id();
				array_push($new_transfer_id, $insert_transfer_id);
				
			}

			$certificate["company_code"] = $_POST['company_code'];
			//$certificate["transaction_date"] = $_POST['date'];
			$certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
			$certificate["officer_id"] = $_POST['officer_id'][$i];
			$certificate["field_type"] = $_POST['field_type'][$i];

			if($_POST['transfer_id'][$i] == null)
			{
				$certificate["transaction_id"] = $transaction_id;
				
				$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['officer_id'][$i]."' AND certificate.field_type='".$_POST['field_type'][$i]."' AND status = 1");

				$query = $query->result_array();

				for($k = 0; $k < count($query); $k++)
				{
					$this->db->set("status", 2);
					$this->db->where(array("id" => $query[$k]["id"]));
					$this->db->update("certificate");

					$merge_certificate["company_code"] = $query[$k]['company_code'];
					$merge_certificate["merge_date"] = date('d-m-Y',now());
					//$certificate["transaction_date"] = $_POST['date'];
					$merge_certificate["client_member_share_capital_id"] = $query[$k]['client_member_share_capital_id'];
					$merge_certificate["officer_id"] = $query[$k]['officer_id'];
					$merge_certificate["field_type"] = $query[$k]['field_type'];
					$merge_certificate["transaction_id"] = $transaction_id;
					$merge_certificate["number_of_share"] = $query[$k]["number_of_share"];
					$merge_certificate["amount_share"] = $query[$k]["amount_share"];
					$merge_certificate["no_of_share_paid"] = $query[$k]["no_of_share_paid"];
					$merge_certificate["amount_paid"] = $query[$k]["amount_paid"];
					$merge_certificate["certificate_no"] = $query[$k]["certificate_no"];

					if($_POST['merge_from_certificate_no'][$i] != " ")
					{
						$merge_certificate["new_certificate_no"] = $_POST['merge_from_certificate_no'][$i];
					}
					elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
					{
						$merge_certificate["new_certificate_no"] = $create_new_cert;
					}
					else
					{
						$merge_certificate["new_certificate_no"] = $temperary_cert;
					}

					$this->db->insert("certificate_merge",$merge_certificate);
				}

				$merge_certificate["company_code"] = $_POST['company_code'];
				$merge_certificate["merge_date"] = date('d-m-Y',now());
				//$certificate["transaction_date"] = $_POST['date'];
				$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
				$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
				$merge_certificate["field_type"] = $_POST['field_type'][$i];
				$merge_certificate["transaction_id"] = $transaction_id;
				$merge_certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
				$merge_certificate["amount_share"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
				$merge_certificate["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
				$merge_certificate["amount_paid"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
				$merge_certificate["certificate_no"] = "";

				if($_POST['merge_from_certificate_no'][$i] != " ")
				{
					$merge_certificate["new_certificate_no"] = $_POST['merge_from_certificate_no'][$i];
				}
				elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
				{
					$merge_certificate["new_certificate_no"] = $create_new_cert;
				}
				else
				{
					$merge_certificate["new_certificate_no"] = $temperary_cert;
				}
				

				$this->db->insert("certificate_merge",$merge_certificate);

				$certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
				if($_POST['merge_from_certificate_no'][$i] != " ")
				{
					$certificate["certificate_no"] = $_POST['merge_from_certificate_no'][$i];
				}
				elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
				{
					$certificate["certificate_no"] = $create_new_cert;
				}
				else
				{
					$certificate["certificate_no"] = $temperary_cert;
				}
				$certificate["status"] = 1;	

				$this->db->insert("certificate",$certificate);

				if($_POST['merge_from_certificate_no'][$i] != " ")
				{
					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND company_code='".$_POST['company_code']."' AND officer_id='".$_POST['officer_id'][$i]."' AND field_type='".$_POST['field_type'][$i]."' AND new_certificate_no = '".$_POST['merge_from_certificate_no'][$i]."'");

					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "company_code" => $_POST['company_code'], "officer_id" =>$_POST['officer_id'][$i], "field_type" => $_POST['field_type'][$i], "certificate_no" => $_POST['merge_from_certificate_no'][$i]));
				}
				elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
				{
					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND company_code='".$_POST['company_code']."' AND officer_id='".$_POST['officer_id'][$i]."' AND field_type='".$_POST['field_type'][$i]."' AND new_certificate_no = '".$create_new_cert."'");

					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "company_code" => $_POST['company_code'], "officer_id" =>$_POST['officer_id'][$i], "field_type" => $_POST['field_type'][$i], "certificate_no" => $create_new_cert));
				}
				else
				{
					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND company_code='".$_POST['company_code']."' AND officer_id='".$_POST['officer_id'][$i]."' AND field_type='".$_POST['field_type'][$i]."' AND new_certificate_no = '".$temperary_cert."'");

					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "company_code" => $_POST['company_code'], "officer_id" =>$_POST['officer_id'][$i], "field_type" => $_POST['field_type'][$i], "certificate_no" => $temperary_cert));
				}

				$query_recalculate_num_of_share = $query_recalculate_num_of_share->result_array();

				$new_number_of_share["number_of_share"] = $query_recalculate_num_of_share[0]["number_of_share"];
				$new_number_of_share["amount_share"] = $query_recalculate_num_of_share[0]["amount_share"];
				$new_number_of_share["no_of_share_paid"] = $query_recalculate_num_of_share[0]["no_of_share_paid"];
				$new_number_of_share["amount_paid"] = $query_recalculate_num_of_share[0]["amount_paid"];
				
				$this->db->update("certificate",$new_number_of_share);

			}
			elseif($_POST['transfer_id'][$i] != null)
			{
				$company_code = $previous_member_share_info[0]["company_code"];
				$transaction_id = $previous_member_share_info[0]["transaction_id"];
				$officer_id = $previous_member_share_info[0]["officer_id"];
				$field_type = $previous_member_share_info[0]["field_type"];
				$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

				$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

				$query_certificate = $query_certificate->result_array();

				$certificate["transaction_id"] = $query_certificate[0]["transaction_id"];
				$certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
				$certificate["amount_share"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
				$certificate["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
				$certificate["amount_paid"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
				//$certificate["certificate_no"] = $_POST['new_certificate_no'][$i];

				if($_POST['merge_from_certificate_no'][$i] != " ")
				{
					$certificate["certificate_no"] = $_POST['merge_from_certificate_no'][$i];
				}
				elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
				{
					$certificate["certificate_no"] = $create_new_cert;
				}
				else
				{
					$certificate["certificate_no"] = $temperary_cert;
				}

				$certificate["status"] = $query_certificate[0]["status"];
			
				$this->db->insert("certificate",$certificate);

				$this->db->delete('certificate', array("id" => $query_certificate[0]["id"]));

				$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND certificate_no = ''");

				
				if ($query_certificate_merge->num_rows() > 0) 
				{
					
					$query_certificate_merge = $query_certificate_merge->result_array();
					//echo json_encode($query_certificate_merge);

					if($officer_id == $_POST['officer_id'][$i] && $field_type == $_POST['field_type'][$i])
					{
						$merge_certificate["company_code"] = $_POST['company_code'];
						$merge_certificate["merge_date"] = $query_certificate_merge[0]["merge_date"];
						//$certificate["transaction_date"] = $_POST['date'];
						$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
						$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
						$merge_certificate["field_type"] = $_POST['field_type'][$i];
						$merge_certificate["transaction_id"] = $query_certificate_merge[0]["transaction_id"];
						$merge_certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
						$merge_certificate["amount_share"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
						$merge_certificate["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_transfer'][$i]));
						$merge_certificate["amount_paid"] = -((float)str_replace(',', '', $_POST['share_transfer'][$i]) * $per_share);
						$merge_certificate["certificate_no"] = $query_certificate_merge[0]["certificate_no"];



						$query_check_new_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, sum(number_of_share) as total_number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_certificate[0]["certificate_no"]."' AND certificate_no = ''");

						if ($query_check_new_certificate_merge->num_rows() > 0) 
						{
							$query_check_new_certificate_merge = $query_check_new_certificate_merge->result_array();

							if($query_check_new_certificate_merge[0]["certificate_no"] == null)
							{
								if($_POST['merge_from_certificate_no'][$i] != " ")
								{
									$new_certificate_number = $_POST['merge_from_certificate_no'][$i];
									//$certificate["certificate_no"] = $_POST['hidden_certificate_no'][$i];
									$new_cert_num["new_certificate_no"] =  $_POST['merge_from_certificate_no'][$i];
								}
								elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
								{
									$new_certificate_number = $create_new_cert;
									//$certificate["certificate_no"] = $create_new_cert;
									$new_cert_num["new_certificate_no"] =  $create_new_cert;
								}
								else
								{
									$new_certificate_number = $temperary_cert;
									//$certificate["certificate_no"] = $temperary_cert;
									$new_cert_num["new_certificate_no"] =  $temperary_cert;
								}
								$this->db->where(array("new_certificate_no" => $query_check_new_certificate_merge[0]["new_certificate_no"]));
								$this->db->update("certificate_merge",$new_cert_num);

								if($_POST['merge_from_certificate_no'][$i] != " ")
								{
									$merge_certificate["new_certificate_no"] =  $_POST['merge_from_certificate_no'][$i];
								}
								elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
								{
									$merge_certificate["new_certificate_no"] =  $create_new_cert;
								}
								else
								{
									$merge_certificate["new_certificate_no"] =  $temperary_cert;
								}

								$this->db->insert("certificate_merge",$merge_certificate);
								$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));

								$total_sum_number_of_share = $this->db->query("select sum(number_of_share) as total_number_of_share, sum(amount_share) as total_amount_share, sum(no_of_share_paid) as total_no_of_share_paid, sum(amount_paid) as total_amount_paid from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND transaction_id = '".$transaction_id."' AND new_certificate_no = '".$query_certificate[0]["certificate_no"]."'");

								if($total_sum_number_of_share->num_rows() > 0)
								{
									$total_sum_number_of_share = $total_sum_number_of_share->result_array();
									

									$total_number_of_share = $total_sum_number_of_share[0]["total_number_of_share"];
									$total_amount_share = $total_sum_number_of_share[0]["total_amount_share"];
									$total_no_of_share_paid = $total_sum_number_of_share[0]["total_no_of_share_paid"];
									$total_amount_paid = $total_sum_number_of_share[0]["total_amount_paid"];
								}
							
								

								$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."'  AND field_type = '".$field_type."' AND certificate_no = '".$query_certificate[0]["certificate_no"]."'");

								if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
								{
									$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();
									//echo json_encode((int)$total_number_of_share);
									$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];

									if((int)$total_number_of_share != (int)$query_check_cert_num_with_cert_num[0]["number_of_share"])
									{
										/*$query_new_number_of_share_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["number_of_share"] - (int)str_replace(',', '', $_POST['share_transfer'][$i]);*/
										$query_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
										$query_new_amount_share_in_cert_merge = (int)$total_amount_share;
										$query_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
										$query_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
									}
									else
									{
										$query_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
										$query_new_amount_share_in_cert_merge = (int)$total_amount_share;
										$query_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
										$query_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
									}
									
								
									if($_POST['merge_from_certificate_no'][$i] != " ")
									{
										$cert["certificate_no"] = $_POST['merge_from_certificate_no'][$i];
									}
									elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
									{
										$cert["certificate_no"] = $create_new_cert;
									}
									else
									{
										$cert["certificate_no"] = $temperary_cert;
									}

									$cert["number_of_share"] = $query_new_number_of_share_in_cert_merge;
									$cert["amount_share"] = $query_new_amount_share_in_cert_merge;
									$cert["no_of_share_paid"] = $query_new_no_of_share_paid_in_cert_merge;
									$cert["amount_paid"] = $query_new_amount_paid_in_cert_merge;

									$this->db->where(array("id" => $query_check_cert_num_with_cert_num[0]["id"]));
									$this->db->update("certificate_merge",$cert);

									$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");

									if ($query_change_first_certificate->num_rows() > 0) 
									{
										$query_change_first_certificate = $query_change_first_certificate->result_array();


										$total_cert_sum_number_of_share = $this->db->query("select sum(number_of_share) as total_number_of_share, sum(amount_share) as total_amount_share, sum(no_of_share_paid) as total_no_of_share_paid, sum(amount_paid) as total_amount_paid from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");

										if($total_cert_sum_number_of_share->num_rows() > 0)
										{
											$total_cert_sum_number_of_share = $total_cert_sum_number_of_share->result_array();
											

											$new_cert_number_of_share = $total_cert_sum_number_of_share[0]["total_number_of_share"];
											$new_cert_amount_share = $total_cert_sum_number_of_share[0]["total_amount_share"];
											$new_cert_no_of_share_paid = $total_cert_sum_number_of_share[0]["total_no_of_share_paid"];
											$new_cert_amount_paid = $total_cert_sum_number_of_share[0]["total_amount_paid"];
										}

										$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
										$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
										$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
										$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

										$this->db->where(array("id" => $query_change_first_certificate[0]["id"]));
										$this->db->update("certificate",$new_certs_number_of_share);
									}

									while($new_cert_no != null)
									{
										$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

										if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
										{
											$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

											if((int)$total_number_of_share != (int)$query_another_new_number_of_share_in_cert_merge[0]["number_of_share"])
											{
												/*$query_another_new_number_of_share_in_cert_merge = (int)$query_another_new_number_of_share_in_cert_merge[0]["number_of_share"] - (int)str_replace(',', '', $_POST['share_transfer'][$i]);*/
												$query_another_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
												$query_another_new_amount_share_in_cert_merge = (int)$total_amount_share;
												$query_another_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
												$query_another_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
											}
											else
											{
												$query_another_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
												$query_another_new_amount_share_in_cert_merge = (int)$total_amount_share;
												$query_another_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
												$query_another_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
											}


											//$certs["certificate_no"] = $_POST['new_certificate_no'][$i];
											$certs["number_of_share"] = $query_another_new_number_of_share_in_cert_merge;
											$certs["amount_share"] = $query_another_new_amount_share_in_cert_merge;
											$certs["no_of_share_paid"] = $query_another_new_no_of_share_paid_in_cert_merge;
											$certs["amount_paid"] = $query_another_new_amount_paid_in_cert_merge;

											$this->db->where(array("id" => $query_check_another_cert_num_with_cert_num[0]["id"]));
											$this->db->update("certificate_merge",$certs);

											

											$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

											//echo json_encode($query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]);

											if ($query_change_certificate->num_rows() > 0) 
											{
												$query_change_certificate = $query_change_certificate->result_array();

												$total_cert_sum_number_of_share = $this->db->query("select sum(number_of_share) as total_number_of_share, sum(amount_share) as total_amount_share, sum(no_of_share_paid) as total_no_of_share_paid, sum(amount_paid) as total_amount_paid from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

												if($total_cert_sum_number_of_share->num_rows() > 0)
												{
													$total_cert_sum_number_of_share = $total_cert_sum_number_of_share->result_array();
													

													$new_cert_number_of_share = $total_cert_sum_number_of_share[0]["total_number_of_share"];
													$new_cert_amount_share = $total_cert_sum_number_of_share[0]["total_amount_share"];
													$new_cert_no_of_share_paid = $total_cert_sum_number_of_share[0]["total_no_of_share_paid"];
													$new_cert_amount_paid = $total_cert_sum_number_of_share[0]["total_amount_paid"];
												}

												$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
												$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
												$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
												$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

												$this->db->where(array("id" => $query_change_certificate[0]["id"]));
												$this->db->update("certificate",$new_certs_number_of_share);
											}

											$new_cert_no = $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"];
										}
										else
										{
											$new_cert_no = null;
										}

									}

									
								}

							}
							else
							{

								if($_POST['merge_from_certificate_no'][$i] != " ")
								{
									$merge_certificate["new_certificate_no"] =  $_POST['merge_from_certificate_no'][$i];
								}
								elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
								{
									$merge_certificate["new_certificate_no"] =  $create_new_cert;
								}
								else
								{
									$merge_certificate["new_certificate_no"] =  $temperary_cert;
								}

								$this->db->insert("certificate_merge",$merge_certificate);
								$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));
								
							}
						}
						else
						{
							if($_POST['merge_from_certificate_no'][$i] != " ")
							{
								$merge_certificate["new_certificate_no"] =  $_POST['merge_from_certificate_no'][$i];
							}
							elseif((int)str_replace(',', '', $_POST['share_transfer'][$i]) == 0)
							{
								$merge_certificate["new_certificate_no"] =  $create_new_cert;
							}
							else
							{
								$merge_certificate["new_certificate_no"] =  $temperary_cert;
							}

							$this->db->insert("certificate_merge",$merge_certificate);
							$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));
						}

						
					}
				}

				$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where new_certificate_no = '".$new_certificate_number."' AND client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."'");

				$query_recalculate_num_of_share = $query_recalculate_num_of_share->result_array();

				$new_number_of_share["number_of_share"] = $query_recalculate_num_of_share[0]["number_of_share"];
				$new_number_of_share["amount_share"] = $query_recalculate_num_of_share[0]["amount_share"];
				$new_number_of_share["no_of_share_paid"] = $query_recalculate_num_of_share[0]["no_of_share_paid"];
				$new_number_of_share["amount_paid"] = $query_recalculate_num_of_share[0]["amount_paid"];
				$this->db->where(array("certificate_no" => $new_certificate_number));
				$this->db->update("certificate",$new_number_of_share);

			}

		}

		for($i = 0; $i < count($_POST['to_officer_id']); $i++ )
		{
			//$client_member_share_capital['number_of_shares'] += $_POST['number_of_share'][$i];
			//$client_member_share_capital['amount'] += $_POST['amount_share'][$i];
			//$client_member_share_capital['no_of_share_paid'] += $_POST['no_of_share_paid'][$i];
			//$client_member_share_capital['paid_up'] += $_POST['amount_paid'][$i];

			$new_certificate_number = null;

				$allotment["company_code"] = $company_code;
				$allotment["transaction_date"] = $date;
				$allotment["client_member_share_capital_id"] = $client_member_share_capital_id;
				$allotment["officer_id"] = $_POST['to_officer_id'][$i];
				$allotment["field_type"] = $_POST['to_field_type'][$i];
				$allotment["transaction_type"] = $_POST['transaction_type'];

				$allotment["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
				$allotment["amount_share"] = $allotment["number_of_share"] * $per_share;
				$allotment["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
				$allotment["amount_paid"] = $allotment["no_of_share_paid"] * $per_share;
				

				$q = $this->db->get_where("member_shares", array("id" => $_POST['to_id'][$i]));

				$previous_member_share_info = $q->result_array();

				if (!$q->num_rows())
				{				
					$allotment["transaction_id"] = $transaction_id;
					$allotment["cert_status"] = 1;
					$this->db->insert("member_shares",$allotment);
					$insert_transfer_id = $this->db->insert_id();
					array_push($new_transfer_id, $insert_transfer_id);
					//$member_shares_with_certificate["member_shares_id"] = $this->db->insert_id();
					//$this->create_invoice("share_allotment", $_POST["company_code"]);
				} 
				else 
				{	
					
					$this->db->delete('member_shares', array("id" => $_POST['to_id'][$i]));
					$allotment["cert_status"] = $previous_member_share_info[0]["cert_status"];
					$allotment["transaction_id"] = $previous_member_share_info[0]["transaction_id"];
					$allotment["merge"] = $previous_member_share_info[0]["merge"];
					$this->db->insert("member_shares",$allotment);
					$insert_transfer_id = $this->db->insert_id();
					array_push($new_transfer_id, $insert_transfer_id);
					//$member_shares_with_certificate["member_shares_id"] = $this->db->insert_id();
				}

				$certificate["company_code"] = $company_code;
				//$certificate["transaction_date"] = $_POST['date'];
				$certificate["client_member_share_capital_id"] = $client_member_share_capital_id;
				$certificate["officer_id"] = $_POST['to_officer_id'][$i];
				$certificate["field_type"] = $_POST['to_field_type'][$i];


				if($_POST['to_id'][$i] == null)
				{
					$certificate["transaction_id"] = $transaction_id;

					if($_POST['merge_to_certificate_no'][$i] != null && $_POST['to_certificate_no'][$i] == null)
					{
						$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['to_officer_id'][$i]."' AND certificate.field_type='".$_POST['to_field_type'][$i]."' AND status = 1");

						$query = $query->result_array();

						//echo json_encode($_POST);
						for($k = 0; $k < count($query); $k++)
						{
							$this->db->set("status", 2);
							$this->db->set("new_certificate_no", $_POST['merge_to_certificate_no'][$i]);
							$this->db->where(array("id" => $query[$k]["id"]));
							$this->db->update("certificate");

							$this->db->set("merge", 1);
							$this->db->set("cert_status", 2);
							$this->db->where(array("transaction_id" => $query[$k]["transaction_id"]));
							$this->db->update("member_shares");

							$this->db->set("merge", 1);
							$this->db->set("cert_status", 1);
							$this->db->where(array("transaction_id" => $transaction_id));
							$this->db->update("member_shares");


							$merge_certificate["company_code"] = $query[$k]['company_code'];
							$merge_certificate["merge_date"] = date('d-m-Y',now());
							//$certificate["transaction_date"] = $_POST['date'];
							$merge_certificate["client_member_share_capital_id"] = $query[$k]['client_member_share_capital_id'];
							$merge_certificate["officer_id"] = $query[$k]['officer_id'];
							$merge_certificate["field_type"] = $query[$k]['field_type'];
							$merge_certificate["transaction_id"] = $transaction_id;
							$merge_certificate["number_of_share"] = $query[$k]["number_of_share"];
							$merge_certificate["amount_share"] = $query[$k]["amount_share"];
							$merge_certificate["no_of_share_paid"] = $query[$k]["no_of_share_paid"];
							$merge_certificate["amount_paid"] = $query[$k]["amount_paid"];

							$merge_certificate["certificate_no"] = $query[$k]["certificate_no"];
							$merge_certificate["new_certificate_no"] = $_POST['merge_to_certificate_no'][$i];

							$this->db->insert("certificate_merge",$merge_certificate);
						}

						$merge_certificate["company_code"] = $_POST['company_code'];
						$merge_certificate["merge_date"] = date('d-m-Y',now());
						//$certificate["transaction_date"] = $_POST['date'];
						$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
						$merge_certificate["officer_id"] = $_POST['to_officer_id'][$i];
						$merge_certificate["field_type"] = $_POST['to_field_type'][$i];
						$merge_certificate["transaction_id"] = $transaction_id;

						$merge_certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$merge_certificate["amount_share"] = $merge_certificate["number_of_share"] * $per_share;
						$merge_certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$merge_certificate["amount_paid"] = $merge_certificate["no_of_share_paid"] * $per_share;
						$merge_certificate["certificate_no"] = "";
						$merge_certificate["new_certificate_no"] = $_POST['merge_to_certificate_no'][$i];

						$this->db->insert("certificate_merge",$merge_certificate);

						$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['merge_to_number_of_share'][$i]);
						$certificate["amount_share"] = $certificate["number_of_share"] * $per_share;
						$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['merge_to_number_of_share'][$i]);
						$certificate["amount_paid"] = $certificate["no_of_share_paid"] * $per_share;

						$certificate["certificate_no"] = $_POST['merge_to_certificate_no'][$i];
						$certificate["new_certificate_no"] = $_POST['merge_to_certificate_no'][$i];
						$certificate["status"] = 1;	
						//echo json_encode($_POST);

					}
					elseif($_POST['merge_to_certificate_no'][$i] == null && $_POST['to_certificate_no'][$i] != null)
					{
						$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$certificate["amount_share"] = $certificate["number_of_share"] * $per_share;
						$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$certificate["amount_paid"] = $certificate["no_of_share_paid"] * $per_share;
						$certificate["certificate_no"] = $_POST['to_certificate_no'][$i];	
						$certificate["new_certificate_no"] = $_POST['to_certificate_no'][$i];	
						$certificate["status"] = 1;	
					}
					
					$this->db->insert("certificate",$certificate);
				}
				else if($_POST['to_id'][$i] != null)
				{
					if($_POST['merge_to_certificate_no'][$i] != null && $_POST['to_certificate_no'][$i] == null)
					{
						if($_POST['previous_merge_cert_num'][$i] != "")
						{
							$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['to_officer_id'][$i]."' AND certificate.field_type='".$_POST['to_field_type'][$i]."' AND member_shares.cert_status = 2 AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') < STR_TO_DATE('".$_POST['date']. "','%d/%m/%Y')");

							$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $_POST["client_member_share_capital_id"], "new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));
						}
						else
						{
							$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['to_officer_id'][$i]."' AND certificate.field_type='".$_POST['to_field_type'][$i]."' AND member_shares.cert_status = 1 AND certificate.status = 1 AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') < STR_TO_DATE('".$_POST['date']. "','%d/%m/%Y')");
						}

						$query = $query->result_array();

						for($k = 0; $k < count($query); $k++)
						{
							$this->db->set("status", 2);
							$this->db->set("new_certificate_no", $_POST['merge_to_certificate_no'][$i]);
							$this->db->where(array("id" => $query[$k]["id"]));
							$this->db->update("certificate");

							$this->db->set("merge", 1);
							$this->db->set("cert_status", 2);
							$this->db->where(array("transaction_id" => $query[$k]["transaction_id"]));
							$this->db->where(array("officer_id" => $query[$k]["officer_id"]));
							$this->db->where(array("field_type" => $query[$k]["field_type"]));
							$this->db->update("member_shares");

							$this->db->set("merge", 1);
							$this->db->set("cert_status", 1);
							$this->db->where(array("transaction_id" => $previous_member_share_info[0]["transaction_id"]));
							$this->db->update("member_shares");

							$merge_certificate["company_code"] = $query[$k]['company_code'];
							$merge_certificate["merge_date"] = date('d-m-Y',now());
							//$certificate["transaction_date"] = $_POST['date'];
							$merge_certificate["client_member_share_capital_id"] = $query[$k]['client_member_share_capital_id'];
							$merge_certificate["officer_id"] = $query[$k]['officer_id'];
							$merge_certificate["field_type"] = $query[$k]['field_type'];
							$merge_certificate["transaction_id"] = $transaction_id;
							$merge_certificate["number_of_share"] = $query[$k]["number_of_share"];
							$merge_certificate["amount_share"] = $query[$k]["amount_share"];
							$merge_certificate["no_of_share_paid"] = $query[$k]["no_of_share_paid"];
							$merge_certificate["amount_paid"] = $query[$k]["amount_paid"];

							$merge_certificate["certificate_no"] = $query[$k]["certificate_no"];
							$merge_certificate["new_certificate_no"] = $_POST['merge_to_certificate_no'][$i];

							$this->db->insert("certificate_merge",$merge_certificate);
						}

						$merge_certificate["company_code"] = $_POST['company_code'];
						$merge_certificate["merge_date"] = date('d-m-Y',now());
						//$certificate["transaction_date"] = $_POST['date'];
						$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
						$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
						$merge_certificate["field_type"] = $_POST['field_type'][$i];
						$merge_certificate["transaction_id"] = $previous_member_share_info[0]["transaction_id"];
						$merge_certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$merge_certificate["amount_share"] = $merge_certificate["number_of_share"] * $per_share;
						$merge_certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$merge_certificate["amount_paid"] = $merge_certificate["no_of_share_paid"] * $per_share;


						$merge_certificate["certificate_no"] = "";
						$merge_certificate["new_certificate_no"] = $_POST['merge_to_certificate_no'][$i];

						$this->db->insert("certificate_merge",$merge_certificate);
					}
					else if($_POST['latest_merge_cert_no'][$i] != null && $_POST['previous_merge_cert_num'][$i] != $_POST['latest_merge_cert_no'][$i])
					{
						$this->db->set("certificate_no", $_POST['latest_merge_cert_no'][$i]);
						$this->db->where(array("certificate_no" => $_POST['previous_merge_cert_num'][$i]));
						$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
						$this->db->update("certificate");

						$this->db->set("new_certificate_no", $_POST['latest_merge_cert_no'][$i]);
						$this->db->where(array("new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));
						$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
						$this->db->update("certificate");

						$this->db->set("certificate_no", $_POST['latest_merge_cert_no'][$i]);
						$this->db->where(array("certificate_no" => $_POST['previous_merge_cert_num'][$i]));
						$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
						$this->db->update("certificate_merge");

						$this->db->set("new_certificate_no", $_POST['latest_merge_cert_no'][$i]);
						$this->db->where(array("new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));
						$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
						$this->db->update("certificate_merge");
					}
					$company_code = $previous_member_share_info[0]["company_code"];
					$transaction_id = $previous_member_share_info[0]["transaction_id"];
					$officer_id = $previous_member_share_info[0]["officer_id"];
					$field_type = $previous_member_share_info[0]["field_type"];
					$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

					/*$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");*/


					$query_certificates = $this->db->query("select certificate.id, certificate.company_code, certificate.client_member_share_capital_id, certificate.officer_id, certificate.field_type, certificate.transaction_id, certificate.number_of_share, certificate.certificate_no, certificate.new_certificate_no, certificate.status, member_shares.cert_status from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate.officer_id = '".$officer_id."' AND certificate.company_code = '".$company_code."' AND certificate.transaction_id = '".$transaction_id."' AND certificate.field_type = '".$field_type."'");

					$query_certificates = $query_certificates->result_array();

					$certificate["transaction_id"] = $query_certificates[0]["transaction_id"];


					/*$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
					$certificate["certificate_no"] = $_POST['to_certificate_no'][$i];*/

					if($_POST['merge_to_certificate_no'][$i] != null && $_POST['to_certificate_no'][$i] == null)
					{
						$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['merge_to_number_of_share'][$i]);
						$certificate["amount_share"] = $certificate["number_of_share"] * $per_share;
						$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['merge_to_number_of_share'][$i]);
						$certificate["amount_paid"] = $certificate["no_of_share_paid"] * $per_share;
						$certificate["certificate_no"] = $_POST['merge_to_certificate_no'][$i];
						$certificate["new_certificate_no"] = $_POST['merge_to_certificate_no'][$i];
						
					}
					else
					{
						$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$certificate["amount_share"] = $certificate["number_of_share"] * $per_share;
						$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$certificate["amount_paid"] = $certificate["no_of_share_paid"] * $per_share;

						if($_POST['to_certificate_no'][$i] != null )
						{
							$certificate["certificate_no"] = $_POST['to_certificate_no'][$i];
							$certificate["new_certificate_no"] = $_POST['to_certificate_no'][$i];
						}
						else
						{
							$certificate["certificate_no"] = $query_certificates[0]["certificate_no"];
							$certificate["new_certificate_no"] = $query_certificates[0]["new_certificate_no"];
						}						
						
					}
				

				
					if($officer_id != $_POST['to_officer_id'][$i] || $field_type != $_POST['to_field_type'][$i])
					{
						$certificate["status"] = 1;
					}	
					else
					{
						$certificate["status"] = $query_certificates[0]["status"];
					}
				
					$this->db->insert("certificate",$certificate);

					$this->db->delete('certificate', array("id" => $query_certificates[0]["id"]));

					$this->db->set("cert_status", $query_certificates[0]["cert_status"]);
					$this->db->where(array("transaction_id" => $transaction_id));
					$this->db->update("member_shares");

					/*$this->db->set("certificate_no", $_POST['to_certificate_no'][$i]);
					$this->db->where(array("certificate_no" => $query_certificate[0]["certificate_no"]));
					$this->db->update("certificate_merge");*/

					if($_POST['merge_status'][$i] == "1")
					{
						$minus_the_number_of_share = (int)$previous_member_share_info[0]["number_of_share"] - (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$minus_the_amount_share = (float)$previous_member_share_info[0]["amount_share"] - ((int)str_replace(',', '', $_POST['number_of_share_to'][$i]) * $per_share);
						$minus_the_no_of_share_paid = (int)$previous_member_share_info[0]["no_of_share_paid"] - (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
						$minus_the_amount_paid = (float)$previous_member_share_info[0]["amount_paid"] - ((int)str_replace(',', '', $_POST['number_of_share_to'][$i]) * $per_share);

						//echo json_encode($minus_the_number_of_share);

						$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

						
						if ($query_certificate_merge->num_rows() > 0) 
						{
							
							$query_certificate_merge = $query_certificate_merge->result_array();
							//echo json_encode($query_certificate_merge);

							if($officer_id == $_POST['to_officer_id'][$i] && $field_type == $_POST['to_field_type'][$i])
							{
								$merge_certificate["company_code"] = $_POST['company_code'];
								$merge_certificate["merge_date"] = $query_certificate_merge[0]["merge_date"];
								//$certificate["transaction_date"] = $_POST['date'];
								$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
								$merge_certificate["officer_id"] = $_POST['to_officer_id'][$i];
								$merge_certificate["field_type"] = $_POST['to_field_type'][$i];
								$merge_certificate["transaction_id"] = $query_certificate_merge[0]["transaction_id"];
								$merge_certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
								$merge_certificate["amount_share"] = $merge_certificate["number_of_share"] * $per_share;
								$merge_certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
								$merge_certificate["amount_paid"] = $merge_certificate["no_of_share_paid"] * $per_share;
								$merge_certificate["certificate_no"] = $query_certificate_merge[0]["certificate_no"];

								$query_check_new_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_certificates[0]["certificate_no"]."'");

								if ($query_check_new_certificate_merge->num_rows() > 0) 
								{
									$query_check_new_certificate_merge = $query_check_new_certificate_merge->result_array();

									if($query_check_new_certificate_merge[0]["certificate_no"] == null)
									{
										/*$new_certificate_number = $_POST['to_certificate_no'][$i];*/

										if($_POST['to_certificate_no'][$i] != null)
										{
											$new_certificate_number = $_POST['to_certificate_no'][$i];
										}
										else
										{
											$new_certificate_number = $_POST['merge_to_certificate_no'][$i];
										}
										//echo json_encode($new_certificate_number);

										$merge_certificate["new_certificate_no"] = $_POST['to_certificate_no'][$i];

										$new_cert_num["new_certificate_no"] =  $_POST['to_certificate_no'][$i];

										$this->db->where(array("client_member_share_capital_id" => $query_check_new_certificate_merge[0]["client_member_share_capital_id"], "new_certificate_no" => $query_check_new_certificate_merge[0]["new_certificate_no"]));
										$this->db->update("certificate_merge",$new_cert_num);

										$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND certificate_no = '".$query_certificates[0]["certificate_no"]."'");

										if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
										{
											$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

											$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];

											/*$query_new_number_of_share_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;*/


											$query_new_number_of_share_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;
											$query_new_amount_share_in_cert_merge = (float)$query_check_cert_num_with_cert_num[0]["amount_share"] - (float)$minus_the_amount_share;
											$query_new_no_of_share_paid_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
											$query_new_amount_paid_in_cert_merge = (float)$query_check_cert_num_with_cert_num[0]["amount_paid"] - (float)$minus_the_amount_paid;
										

											$cert["certificate_no"] = $_POST['to_certificate_no'][$i];
											$cert["number_of_share"] = $query_new_number_of_share_in_cert_merge;
											$cert["amount_share"] = $query_new_amount_share_in_cert_merge;
											$cert["no_of_share_paid"] = $query_new_no_of_share_paid_in_cert_merge;
											$cert["amount_paid"] = $query_new_amount_paid_in_cert_merge;

											$this->db->where(array("id" => $query_check_cert_num_with_cert_num[0]["id"]));
											$this->db->update("certificate_merge",$cert);

											$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");

											if ($query_change_first_certificate->num_rows() > 0) 
											{
												$query_change_first_certificate = $query_change_first_certificate->result_array();

												/*$new_cert_number_of_share = (int)$query_change_first_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;*/

												$new_cert_number_of_share = (int)$query_change_first_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
												$new_cert_amount_share = (float)$query_change_first_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
												$new_cert_no_of_share_paid = (int)$query_change_first_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
												$new_cert_amount_paid = (float)$query_change_first_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

												$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
												$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
												$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
												$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;


												$this->db->where(array("id" => $query_change_first_certificate[0]["id"]));
												$this->db->update("certificate",$new_certs_number_of_share);
											}

											while($new_cert_no != null)
											{
												$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

												if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
												{
													$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

													$query_another_new_number_of_share_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;
													$query_another_new_amount_share_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_share"] - (float)$minus_the_amount_share;
													$query_another_new_no_of_share_paid_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
													$query_another_new_amount_paid_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_paid"] - (float)$minus_the_amount_paid;


													//$certs["certificate_no"] = $_POST['new_certificate_no'][$i];
													$certs["number_of_share"] = $query_another_new_number_of_share_in_cert_merge;
													$certs["amount_share"] = $query_another_new_amount_share_in_cert_merge;
													$certs["no_of_share_paid"] = $query_another_new_no_of_share_paid_in_cert_merge;
													$certs["amount_paid"] = $query_another_new_amount_paid_in_cert_merge;

													$this->db->where(array("id" => $query_check_another_cert_num_with_cert_num[0]["id"]));
													$this->db->update("certificate_merge",$certs);

													

													$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

													

													if ($query_change_certificate->num_rows() > 0) 
													{
														$query_change_certificate = $query_change_certificate->result_array();

														$new_cert_number_of_share = (int)$query_change_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
														$new_cert_amount_share = (float)$query_change_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
														$new_cert_no_of_share_paid = (int)$query_change_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
														$new_cert_amount_paid = (float)$query_change_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

														$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
														$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
														$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
														$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

														$this->db->where(array("id" => $query_change_certificate[0]["id"]));
														$this->db->update("certificate",$new_certs_number_of_share);
													}

													$new_cert_no = $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"];
												}
												else
												{
													$new_cert_no = null;
												}

											}

											
										}
									}
									else
									{
										$merge_certificate["new_certificate_no"] = $query_certificate_merge[0]["new_certificate_no"];
									}
								}
								else
								{
									$merge_certificate["new_certificate_no"] = $query_certificate_merge[0]["new_certificate_no"];
								}


								$this->db->insert("certificate_merge",$merge_certificate);
								$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));

								$query_recalculate_num_of_share_cert = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id = '".$query_certificate_merge[0]["client_member_share_capital_id"]."' AND new_certificate_no = '".$query_certificate_merge[0]["new_certificate_no"]."'");

								$query_recalculate_num_of_share_cert = $query_recalculate_num_of_share_cert->result_array();

								$new_number_of_share_cert["number_of_share"] = $query_recalculate_num_of_share_cert[0]["number_of_share"];
								$new_number_of_share_cert["amount_share"] = $query_recalculate_num_of_share_cert[0]["amount_share"];
								$new_number_of_share_cert["no_of_share_paid"] = $query_recalculate_num_of_share_cert[0]["no_of_share_paid"];
								$new_number_of_share_cert["amount_paid"] = $query_recalculate_num_of_share_cert[0]["amount_paid"];

								$this->db->where(array("client_member_share_capital_id" => $query_certificate_merge[0]["client_member_share_capital_id"], "certificate_no" => $query_certificate_merge[0]["new_certificate_no"]));
								$this->db->update("certificate",$new_number_of_share_cert);
							}
							else
							{
								$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));
							}
						}
					}
					else if($_POST['merge_status'][$i] == "0")
					{
						$query_previous_cert = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['to_officer_id'][$i]."' AND certificate.field_type='".$_POST['to_field_type'][$i]."' AND certificate.new_certificate_no = '".$_POST['previous_merge_cert_num'][$i]."' AND member_shares.cert_status = 2");

						$query_previous_cert = $query_previous_cert->result_array();

						for($t = 0; $t < count($query_previous_cert); $t++)
						{
							//$this->db->set("status", 1);
							$this->db->set("new_certificate_no", $query_previous_cert[$t]["certificate_no"]);
							$this->db->where(array("id" => $query_previous_cert[$t]["id"]));
							$this->db->update("certificate");

							$query_check_cert_num_with_cert_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_previous_cert[$t]["certificate_no"]."'");

							if ($query_check_cert_num_with_cert_merge->num_rows() > 0) 
							{
								$this->db->set("merge", 1);
							}
							else
							{
								$this->db->set("merge", 0);
							}
							
							$this->db->set("cert_status", 1);
							$this->db->where(array("transaction_id" => $query_previous_cert[$t]["transaction_id"]));
							$this->db->update("member_shares");

							$this->db->set("merge", 0);
							$this->db->set("cert_status", 1);
							$this->db->where(array("transaction_id" => $transaction_id));
							$this->db->update("member_shares");
						}

						$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $_POST["client_member_share_capital_id"], "new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));

						$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_certificates[0]["certificate_no"]."'");
						//echo json_encode($query_check_cert_num_with_cert_num->result_array());
						if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
						{
							$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

							$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];						

							$cert["certificate_no"] = $query_check_cert_num_with_cert_num[0]["certificate_no"];
							/*$cert["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
							$cert["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
							$cert["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
							$cert["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);*/

							$cert["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
							$cert["amount_share"] = (float)$cert["number_of_share"] * $per_share;
							$cert["no_of_share_paid"] = (int)str_replace(',', '', $_POST['number_of_share_to'][$i]);
							$cert["amount_paid"] = (float)$cert["no_of_share_paid"] * $per_share;

							$this->db->where(array("id" => $query_check_cert_num_with_cert_num[0]["id"]));
							$this->db->update("certificate_merge",$cert);

							$query_recalculate_num_of_shares = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where new_certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."' AND client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."'");

							$query_recalculate_num_of_shares = $query_recalculate_num_of_shares->result_array();

							$new_number_of_shares["number_of_share"] = $query_recalculate_num_of_shares[0]["number_of_share"];
							$new_number_of_shares["amount_share"] = $query_recalculate_num_of_shares[0]["amount_share"];
							$new_number_of_shares["no_of_share_paid"] = $query_recalculate_num_of_shares[0]["no_of_share_paid"];
							$new_number_of_shares["amount_paid"] = $query_recalculate_num_of_shares[0]["amount_paid"];
						
							$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "certificate_no" => $query_check_cert_num_with_cert_num[0]["new_certificate_no"]));
							$this->db->update("certificate",$new_number_of_shares);

							$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");


							if ($query_change_first_certificate->num_rows() > 0) 
							{
								$query_change_first_certificate = $query_change_first_certificate->result_array();

								$new_cert_number_of_share = (int)$query_change_first_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
								$new_cert_amount_share = (float)$query_change_first_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
								$new_cert_no_of_share_paid = (int)$query_change_first_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
								$new_cert_amount_paid = (float)$query_change_first_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

								$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
								$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
								$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
								$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

								$this->db->where(array("id" => $query_change_first_certificate[0]["id"]));
								$this->db->update("certificate",$new_certs_number_of_share);
							}

							while($new_cert_no != null)
							{
								$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

								if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
								{
									$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

									$query_another_new_number_of_share_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;
									$query_another_new_amount_share_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_share"] - (float)$minus_the_amount_share;
									$query_another_new_no_of_share_paid_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
									$query_another_new_amount_paid_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_paid"] - (float)$minus_the_amount_paid;


									//$certs["certificate_no"] = $_POST['new_certificate_no'][$i];
									$certs["number_of_share"] = $query_another_new_number_of_share_in_cert_merge;
									$certs["amount_share"] = $query_another_new_amount_share_in_cert_merge;
									$certs["no_of_share_paid"] = $query_another_new_no_of_share_paid_in_cert_merge;
									$certs["amount_paid"] = $query_another_new_amount_paid_in_cert_merge;

									$this->db->where(array("id" => $query_check_another_cert_num_with_cert_num[0]["id"]));
									$this->db->update("certificate_merge",$certs);

									

									$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

									if ($query_change_certificate->num_rows() > 0) 
									{
										$query_change_certificate = $query_change_certificate->result_array();

										$new_cert_number_of_share = (int)$query_change_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
										$new_cert_amount_share = (float)$query_change_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
										$new_cert_no_of_share_paid = (int)$query_change_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
										$new_cert_amount_paid = (float)$query_change_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

										$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
										$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
										$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
										$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

										$this->db->where(array("id" => $query_change_certificate[0]["id"]));
										$this->db->update("certificate",$new_certs_number_of_share);
									}

									$new_cert_no = $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"];
								}
								else
								{
									$new_cert_no = null;
								}

							}
						}
					}

					//add all the number of shares to active number of share

					$query_active_certificate = $this->db->query("select id, certificate_no from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND client_member_share_capital_id = '".$client_member_share_capital_id."' AND field_type = '".$field_type."' AND transaction_id = '".$transaction_id."' AND status = 1");

					$query_active_certificate = $query_active_certificate->result_array();

					if($new_certificate_number == null)
					{
						$query_new_certificate_no = $this->db->query("select new_certificate_no from certificate_merge where new_certificate_no = '".$query_active_certificate[0]["certificate_no"]."'");

						$query_new_certificate_no = $query_new_certificate_no->result_array();

						$new_certificate_number = $query_new_certificate_no[0]["new_certificate_no"];
					}

					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where new_certificate_no = '".$new_certificate_number."' AND client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."'");

					$query_recalculate_num_of_share = $query_recalculate_num_of_share->result_array();

					$new_number_of_share["number_of_share"] = $query_recalculate_num_of_share[0]["number_of_share"];
					$new_number_of_share["amount_share"] = $query_recalculate_num_of_share[0]["amount_share"];
					$new_number_of_share["no_of_share_paid"] = $query_recalculate_num_of_share[0]["no_of_share_paid"];
					$new_number_of_share["amount_paid"] = $query_recalculate_num_of_share[0]["amount_paid"];
				
					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "certificate_no" => $new_certificate_number));
					$this->db->update("certificate",$new_number_of_share);

					
				}
		}

		$get_client_information = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$_POST['company_code']."'");

		$get_client_information = $get_client_information->result_array();
		//if ($previous_member_shares_query->num_rows())
		//{
			$this->change_member_document_info("add_transfer_of_share", $_POST['client_member_share_capital_id'], $previous_member_shares_query_data[0]["transaction_date"], $get_client_information[0]["firm_id"], $_POST['company_code'], $previous_member_share_result, $get_client_information[0]["id"]);
		//}
		//else
		//{
			//$this->create_document("add_transfer_of_share", $_POST['company_code'], null, null, null, null, null, null, $_POST['client_member_share_capital_id'], null, $new_transfer_id);

		//Comment
		$this->create_invoice("share_allotment", $_POST["company_code"]);

		redirect("masterclient/view_transfer/".$_POST['company_code']."");

	}

	public function change_member_document_info($type, $client_member_share_capital_id, $old_member_date_result, $firm_id, $company_code, $previous_member_result = null, $client_id)
	{
		if($type == "add_allotment_of_share")
		{
			$document_master_result = $this->db->query("select * from document_master where triggered_by = 23 AND firm_id='".$firm_id."'");
		}
		elseif($type == "add_buyback_of_share")
		{
			$document_master_result = $this->db->query("select * from document_master where triggered_by = 24 AND firm_id='".$firm_id."'");
		}
		elseif($type == "add_transfer_of_share")
		{
			$document_master_result = $this->db->query("select * from document_master where triggered_by = 25 AND firm_id='".$firm_id."'");
		}


		

		if ($document_master_result->num_rows() > 0) 
		{
			$get_client = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$company_code."'");

			$get_client = $get_client->result_array();

			$history_client_info = $this->db->query("select * from history_client where company_code = '".$company_code."'");

			$history_client_info = $history_client_info->result_array();

			$document_master_result = $document_master_result->result_array();

			for($r = 0; $r < count($document_master_result); $r++)
			{
				$document_name = $document_master_result[$r]["document_name"]." - ".DATE("Y",now());

				$str = $document_master_result[$r]["document_content"];

				if($document_master_result[$r]["document_name"] == "Allotment-Share Application Form" || $document_master_result[$r]["document_name"] == "F24 - Return of allotment of shares" || $document_master_result[$r]["document_name"] == "Allotment-Share Cert")
					{
						$allotment_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                
	                	/*$this->db->select('member_shares.*')
	                	         ->order_by('member_shares.id');
						$this->db->where("company_code", $company_code);
						$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
						$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
						$this->db->where("member_shares.transaction_type = 'Allotment'");
						$this->db->where_not_in('id', $allotment_id);

						$previous_allotment_member_result = $this->db->get('member_shares');*/

						$allotment_member_result = $allotment_member_result->result_array();

	                	//$previous_allotment_member_result = $previous_allotment_member_result->result_array();

	                	$loop_document_content = "";
	                	$latest_allotment_id = array();
						for($g = 0; $g < count($allotment_member_result); $g++)
		                {
		                	$document_content_str = $document_master_result[$r]["document_content"];

		                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
		                	{
		                		if($allotment_member_result[$g]["name"] != '')
	                			{
	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["name"], $document_content_str);
	                				
	                			}
	                			elseif($allotment_member_result[$g]["company_name"] != '')
	                			{
	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["company_name"], $document_content_str);
	                			}
	                		}

	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
	                		{
	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($allotment_member_result[$g]["number_of_share"], 2), $document_content_str);
	                		}

	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
	                		{
	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', number_format($allotment_member_result[$g]["amount_share"], 2), $document_content_str);
	                		}

	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>') !== false)
	                		{
	                			$per_shared = $allotment_member_result[$g]["amount_share"] / $allotment_member_result[$g]["number_of_share"];

	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>', number_format($per_shared, 2), $document_content_str);
	                		}


	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
	                		{
	                			if($allotment_member_result[$g]["sharetype_id"] == '1')
	                			{
	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["sharetype_name"], $document_content_str);

	                			}
	                			elseif($allotment_member_result[$g]["sharetype_id"] == '2')
	                			{
	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["other_class"], $document_content_str);
	                			}
	                		}

	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
	                		{
	                			$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', $allotment_member_result[$g]["currency_name"], $document_content_str);
	                		}

	                		if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
	                		{
	                			if($allotment_member_result[$g]["new_certificate_no"] != '')
	                			{
	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["new_certificate_no"], $document_content_str);
	                			}
	                			else
	                			{
	                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["certificate_no"], $document_content_str);
	                			}
	                			
	                		}

		                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company type}}</span>') !== false)
							{
								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company type}}</span>', $get_client[0]["company_type_name"], $document_content_str);
							}
		                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
							{
								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $document_content_str);
							}
							if(strpos($str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
							{
								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $document_content_str);
							}
							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Address - new}}</span>') !== false)
							{
								if($get_client[0]["unit_no1"] != null || $get_client[0]["unit_no2"] != null)
								{
									$unit_no = '#'.$get_client[0]["unit_no1"].'-'.$get_client[0]["unit_no2"].'';
								}
								else
								{
									$unit_no = '';
								}

								$new_address = $get_client[0]["street_name"].',</br>'.$unit_no.' '.$get_client[0]["building_name"].', </br>Singapore '.$get_client[0]["postal_code"];

								$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Address - new}}</span>', $new_address, $document_content_str);
							}
							if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
			                {
			                	$director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$$old_member_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$$old_member_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$$old_member_date_result."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
			                	
			                	$director_name_result = $director_name_result->result_array();

			                	//echo json_encode($director_name_result);
			                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 
			                	

			                	if( $document_master_result[$r]["document_name"] == "Auditor-Notice of EGM" || $document_master_result[$r]["document_name"] == "Company Name-Notice of EGM" || $document_master_result[$r]["document_name"] == "Allotment-Authority to Allot")
			                	{
			                		$director_name = '';

			                		$director_name = $director_name.'<p>&nbsp;</p><p>&nbsp;</p><p>_______________________________<br />'.$director_name_result[0]["name"].'<br />Director</p>';

			                	}
			                	elseif($document_master_result[$r]["document_name"] == "Form 11" || $document_master_result[$r]["document_name"] == "Strike Off EGM")
			                	{

			                		$director_name = $director_name_result[0]["name"];

			                	}
			                	elseif($document_master_result[$r]["document_name"] == "Strike Off-Minutes Of EGM")
			                	{
			                		$director_name = '';
			                		for($h = 0; $h < count($director_name_result); $h++)
				                	{	
				                		if($h == 0)
				                		{
				                			$director_name = $director_name.'<p><strong>'.$director_name_result[$h]["name"].'<br /></strong>';
				                		}
				                		elseif($h == (count($director_name_result) - 1))
				                		{
				                			$director_name = $director_name.'<strong>'.$director_name_result[$h]["name"].'<br /></strong></p>';
				                		}
				                		else
				                		{
				                			$director_name = $director_name.'<strong>'.$director_name_result[$h]["name"].'<br /></strong>';
				                		}
			                			
			                		}
			                	}
			                	else
			                	{
			                		$director_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';
			                		for($j = 0; $j < count($director_name_result); $j++)
				                	{
				                		$director_name = $director_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$director_name_result[$j]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
				                	}
				                	$director_name = $director_name.'</tbody></table>';
			                	}
			                	


			                	$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $document_content_str);
			                }

			                if($client_member_share_capital_id != null)
			                {
			                	$client_member_share_capital_id_info = $this->db->query("select client_member_share_capital.*, member_shares.company_code, sum(member_shares.number_of_share) as number_of_shares, sum(member_shares.amount_share) as amount, sum(member_shares.no_of_share_paid) as number_of_shares_paid, sum(member_shares.amount_paid) as paid_up, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from client_member_share_capital left join member_shares on member_shares.client_member_share_capital_id = client_member_share_capital.id AND member_shares.company_code = client_member_share_capital.company_code left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where client_member_share_capital.company_code = '".$company_code."' group by client_member_share_capital.id");

			                	$client_member_share_capital_id_info = $client_member_share_capital_id_info->result_array();

			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Class of shares - all}}</span>') !== false)
			                	{
		                			if($client_member_share_capital_id_info[0]["sharetype_id"] == '1')
		                			{
		                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["sharetype_name"], $document_content_str);

		                			}
		                			elseif($client_member_share_capital_id_info[$g]["sharetype_id"] == '2')
		                			{
		                				$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["other_class"], $document_content_str);
		                			}
			                	}

			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>') !== false)
			                	{
			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>', $client_member_share_capital_id_info[0]["currency_name"], $document_content_str);
			                	}

			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>') !== false)
			                	{
			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares"], 2), $document_content_str);
			                	}

			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>') !== false)
			                	{
			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["amount"], 2), $document_content_str);
			                	}

			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>') !== false)
			                	{
			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares_paid"], 2), $document_content_str);
			                	}

			                	if(strpos($document_content_str, '<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>') !== false)
			                	{
			                		$document_content_str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["paid_up"], 2), $document_content_str);
			                	}
			                }
		                	

		                	$loop_document_content = $loop_document_content.$document_content_str;
		                }

	                	for($h = 0; $h < count($allotment_member_result); $h++)
		                {
		                	array_push($latest_allotment_id, (int)$allotment_member_result[$h]["id"]);
		                }

	                	$data_pending_document['allotment_id']=json_encode($latest_allotment_id);

						/*if(count($previous_allotment_member_result) != 0)
	                	{
	                		$allotment_id_data = array();
	                		for($f = 0; $f < count($previous_allotment_member_result); $f++)
		                	{
		                		array_push($allotment_id_data, (int)$previous_allotment_member_result[$f]["id"]);
		                	}
	                	}*/
	                	$data_pending_document['content'] = $loop_document_content;
					}
					else
					{

						if (strpos($str, '<span class="myclass mceNonEditable">{{Company old name}}</span>') !== false) {
						    $str = str_replace('<span class="myclass mceNonEditable">{{Company old name}}</span>', $history_client_info[0]["company_name"], $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Company new name}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{Company new name}}</span>', $get_client[0]["company_name"], $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Company current name}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{Company current name}}</span>', $get_client[0]["company_name"], $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{UEN}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{UEN}}</span>', $get_client[0]["registration_no"], $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Incorporation date}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{Incorporation date}}</span>', $get_client[0]["incorporation_date"], $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Company type}}</span>') !== false)
						{
							$str = str_replace('<span class="myclass mceNonEditable">{{Company type}}</span>', $get_client[0]["company_type_name"], $str);
						}
						if($document_master_result[$r]["triggered_by"] == 5)
						{
							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - old}}</span>') !== false)
							{
								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - old}}</span>', $history_client_info[0]["activity1"], $str);
							}

							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - new}}</span>') !== false)
							{
								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - new}}</span>', $get_client[0]["activity1"], $str);
							}
						}

						if($document_master_result[$r]["triggered_by"] == 6)
						{
							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - old}}</span>') !== false)
							{
								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - old}}</span>', $history_client_info[0]["activity2"], $str);
							}

							if(strpos($str, '<span class="myclass mceNonEditable">{{Principal activity - new}}</span>') !== false)
							{
								$str = str_replace('<span class="myclass mceNonEditable">{{Principal activity - new}}</span>', $get_client[0]["activity2"], $str);
							}
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Address - old}}</span>') !== false)
						{
							if($history_client_info[0]["unit_no1"] != '' || $history_client_info[0]["unit_no2"] != '')
							{
								$unit_no = '#'.$history_client_info[0]["unit_no1"].$history_client_info[0]["unit_no2"].'';
							}
							else
							{
								$unit_no = '';
							}

							$history_address = $history_client_info[0]["street_name"].' '.$unit_no.' '.$history_client_info[0]["building_name"].' Singapore '.$history_client_info[0]["postal_code"];

							$str = str_replace('<span class="myclass mceNonEditable">{{Address - old}}</span>', $history_address, $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Address - new}}</span>') !== false)
						{
							if($get_client[0]["unit_no1"] != '' || $get_client[0]["unit_no2"] != '')
							{
								$unit_no = '#'.$get_client[0]["unit_no1"].$get_client[0]["unit_no2"].'';
							}
							else
							{
								$unit_no = '';
							}

							$new_address = $get_client[0]["street_name"].' '.$unit_no.' '.$get_client[0]["building_name"].' Singapore '.$get_client[0]["postal_code"];

							$str = str_replace('<span class="myclass mceNonEditable">{{Address - new}}</span>', $new_address, $str);
						}
						if(strpos($str, '<span class="myclass mceNonEditable">{{Directors name - all}}</span>') !== false)
		                {
		                	$director_name_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");
		                	
		                	$director_name_result = $director_name_result->result_array();

		                	//echo json_encode($director_name_result);
		                	//((STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) OR (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') 

		                	if( $document_master_result[$r]["document_name"] == "Auditor-Notice of EGM" || $document_master_result[$r]["document_name"] == "Company Name-Notice of EGM" || $document_master_result[$r]["document_name"] == "Allotment-Authority to Allot")
		                	{
		                		$director_name = '';

		                		$director_name = $director_name.'<p>&nbsp;</p><p>&nbsp;</p><p>_______________________________<br />'.$director_name_result[0]["name"].'<br />Director</p>';

		                	}
		                	elseif($document_master_result[$r]["document_name"] == "Form 11")
		                	{

		                		$director_name = $director_name_result[0]["name"];

		                	}
		                	else
		                	{
		                		$director_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';
		                		for($g = 0; $g < count($director_name_result); $g++)
			                	{
			                		$director_name = $director_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$director_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
			                	}
			                	$director_name = $director_name.'</tbody></table>';
		                	}

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors name - all}}</span>', $director_name, $str);
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Directors ID - all}}</span>') !== false)
		                {
		                	$director_id_result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND ((STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y') AND client_officers.date_of_cessation = '') OR ((STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') > STR_TO_DATE(date_of_appointment,'%d/%m/%Y')) AND (STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y') > STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y')) AND client_officers.date_of_cessation != '')) GROUP BY officer.identification_no, officer.name");

		                	$director_id_result = $director_id_result->result_array();

		                	$director_id = "";

		                	for($g = 0; $g < count($director_id_result); $g++)
		                	{
		                		$director_id = $director_id.'<p>&nbsp;</p>'.$director_id_result[$g]["identification_no"].' ____________________________<br>';
		                	}

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Directors ID - all}}</span>', $director_id, $str);
		                }

		                if(strpos($str, '<span class="myclass mceNonEditable">{{Members name - all}}</span>') !== false)
		                {
		                	$member_name_result = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$company_code.'" GROUP BY member_shares.field_type, member_shares.officer_id,member_shares.client_member_share_capital_id HAVING sum(member_shares.number_of_share) != 0');
		                	
		                	$member_name_result = $member_name_result->result_array();


		                	$member_name = '<table style="width: 100%; border-collapse: collapse;"><tbody>';

		                	for($g = 0; $g < count($member_name_result); $g++)
		                	{
		                		if($member_name_result[$g]["name"] != null)
		                		{
		                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
		                		}
		                		elseif($member_name_result[$g]["company_name"] != null)
		                		{
		                			$member_name = $member_name.'<tr style="height: 89px;"><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p>'.$member_name_result[$g]["company_name"].'</p></td><td style="width: 50%; height: 89px;"><p>&nbsp;</p><p>&nbsp;</p><p> _______________________________</p></td></tr>';
		                		}
		                	}

		                	$member_name = $member_name.'</tbody></table>';

		                	$str = str_replace('<span class="myclass mceNonEditable">{{Members name - all}}</span>', $member_name, $str);
		                }

		                if($client_member_share_capital_id != null)
		                {
		                	$client_member_share_capital_id_info = $this->db->query("select client_member_share_capital.*, member_shares.company_code, sum(member_shares.number_of_share) as number_of_shares, sum(member_shares.amount_share) as amount, sum(member_shares.no_of_share_paid) as number_of_shares_paid, sum(member_shares.amount_paid) as paid_up, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from client_member_share_capital left join member_shares on member_shares.client_member_share_capital_id = client_member_share_capital.id AND member_shares.company_code = client_member_share_capital.company_code left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where client_member_share_capital.company_code = '".$company_code."' group by client_member_share_capital.id");

		                	$client_member_share_capital_id_info = $client_member_share_capital_id_info->result_array();

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Class of shares - all}}</span>') !== false)
		                	{
		            			if($client_member_share_capital_id_info[0]["sharetype_id"] == '1')
		            			{
		            				$str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["sharetype_name"], $str);

		            			}
		            			elseif($client_member_share_capital_id_info[$g]["sharetype_id"] == '2')
		            			{
		            				$str = str_replace('<span class="myclass mceNonEditable">{{Class of shares - all}}</span>', $client_member_share_capital_id_info[0]["other_class"], $str);
		            			}
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Currency of shares - all}}</span>', $client_member_share_capital_id_info[0]["currency_name"], $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{No of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares"], 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares issued - all}}</span>', number_format($client_member_share_capital_id_info[0]["amount"], 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{No of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["number_of_shares_paid"], 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Amount of shares paid up - all}}</span>', number_format($client_member_share_capital_id_info[0]["paid_up"], 2), $str);
		                	}
		                }

		                if($type == "add_allotment_of_share")
		                {
		                	$allotment_total_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.number_of_share) as total_number_of_share, sum(member_shares.amount_share) as total_amount_of_share, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

		                	$allotment_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

		                
		                	/*$this->db->select('member_shares.*')
		                	         ->order_by('member_shares.id');
							$this->db->where("company_code", $company_code);
							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
							$this->db->where("member_shares.transaction_type = 'Allotment'");
							$this->db->where_not_in('id', $allotment_id);*/

							//$previous_allotment_member_result = $this->db->get('member_shares');

							$allotment_total_of_share_all_result = $allotment_total_of_share_all_result->result_array();
		                	//echo json_encode($previous_director_name_appointment_result);
		                	$allotment_member_result = $allotment_member_result->result_array();

		                	//$previous_allotment_member_result = $previous_allotment_member_result->result_array();
		                	//echo json_encode($director_name_result);
		                	//if($transferor_member_result[])
		                	
		                	/*if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
				            {
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $get_client[0]["company_type_name"], $str);
		                	}*/
		                	
							//$final_message = str_replace($final_name,$html,$final_message);
		                	//echo json_encode($m[0][0]);
							//echo json_encode('<p><span class="myclass mceNonEditable">{{Allotment - members}}</span>'.$m[1].'</p>');
		                	/*$transferor_member = "";
		                	$transferee_member = "";*/
		                	$allotment_member = "";
		                	$allotment_string = "";
		                	$latest_allotment_id = array();
		                	$num_of_allotment_member = (int)(count($allotment_member_result)) - 1;

		                	if(strpos($str, '<tr class="loop"') !== false)
		                	{
		                		preg_match_all ('/<tr class="loop"(.+?)<\/tr>/s', $str, $m);
		                	
			                	for($g = 0; $g < count($allotment_member_result); $g++)
			                	{

		                			$allotment_string = $m[0][0];
		                			//echo json_encode($m);
			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
				                	{
				                		if($allotment_member_result[$g]["name"] != '')
			                			{
			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["name"], $allotment_string);
			                				
			                			}
			                			elseif($allotment_member_result[$g]["company_name"] != '')
			                			{
			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["company_name"], $allotment_string);
			                			}
			                		}

			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
			                		{
			                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($allotment_member_result[$g]["number_of_share"], 2), $allotment_string);
			                		}

			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
			                		{
			                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', number_format($allotment_member_result[$g]["amount_share"], 2), $allotment_string);
			                		}

			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
			                		{
			                			if($allotment_member_result[$g]["sharetype_id"] == '1')
			                			{
			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["sharetype_name"], $allotment_string);

			                			}
			                			elseif($allotment_member_result[$g]["sharetype_id"] == '2')
			                			{
			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["other_class"], $allotment_string);
			                			}
			                		}

			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
			                		{
			                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', $allotment_member_result[$g]["currency_name"], $allotment_string);
			                		}

			                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
			                		{
			                			if($allotment_member_result[$g]["new_certificate_no"] != '')
			                			{
			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["new_certificate_no"], $allotment_string);
			                			}
			                			else
			                			{
			                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["certificate_no"], $allotment_string);
			                			}
			                			
			                		}

			                		$allotment_member = $allotment_member.$allotment_string;
			                		
				            		
			                	}


		                		$str = str_replace($m[0][0], $allotment_member, $str);
			                }
			                
			               	
			               	for($g = 0; $g < count($allotment_member_result); $g++)
			                {

			                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
			                	{
			                		if($allotment_member_result[$g]["name"] != '')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["name"], $str);
		                				
		                			}
		                			elseif($allotment_member_result[$g]["company_name"] != '')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', $allotment_member_result[$g]["company_name"], $str);
		                			}
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
		                		{
		                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', number_format($allotment_member_result[$g]["number_of_share"], 2), $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
		                		{
		                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', number_format($allotment_member_result[$g]["amount_share"], 2), $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>') !== false)
		                		{
		                			$per_shared = $allotment_member_result[$g]["amount_share"] / $allotment_member_result[$g]["number_of_share"];

		                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - per shared}}</span>', number_format($per_shared, 2), $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
		                		{
		                			if($allotment_member_result[$g]["sharetype_id"] == '1')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["sharetype_name"], $str);

		                			}
		                			elseif($allotment_member_result[$g]["sharetype_id"] == '2')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', $allotment_member_result[$g]["other_class"], $str);
		                			}
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
		                		{
		                			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', $allotment_member_result[$g]["currency_name"], $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
		                		{
		                			if($allotment_member_result[$g]["new_certificate_no"] != '')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["new_certificate_no"], $str);
		                			}
		                			else
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $allotment_member_result[$g]["certificate_no"], $str);
		                			}
		                			
		                		}

			                		
			                	
			                }

			                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - number of shares all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares all}}</span>', number_format($allotment_total_of_share_all_result[0]["total_number_of_share"], 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares all}}</span>', number_format($allotment_total_of_share_all_result[0]["total_amount_of_share"], 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>') !== false)
		                	{
		                		if($allotment_total_of_share_all_result[0]["sharetype_id"] == '1')
		            			{
		            				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>', $allotment_total_of_share_all_result[0]["sharetype_name"], $str);

		            			}
		            			elseif($allotment_total_of_share_all_result[0]["sharetype_id"] == '2')
		            			{
		            				$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>', $allotment_total_of_share_all_result[0]["other_class"], $str);
		            			}
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - currency all}}</span>') !== false)
		            		{
		            			$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency all}}</span>', $allotment_total_of_share_all_result[0]["currency_name"], $str);
		            		}
			                

			                for($h = 0; $h < count($allotment_member_result); $h++)
			                {
			                	array_push($latest_member_id, (int)$allotment_member_result[$h]["id"]);
			                }

		                	$data_pending_document['allotment_id']=json_encode($latest_member_id);

		                	
		                	//$str = str_replace($r[0][0], $transferee_member, $str);

		                	/*if(count($previous_allotment_member_result) != 0)
		                	{
		                		$allotment_id_data = array();
		                		for($f = 0; $f < count($previous_allotment_member_result); $f++)
			                	{
			                		array_push($allotment_id_data, (int)$previous_allotment_member_result[$f]["id"]);
			                	}
		                	}*/
		                }

		                if($type == "add_buyback_of_share")
		                {
		                	$buyback_total_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.number_of_share) as total_number_of_share, sum(member_shares.amount_share) as total_amount_of_share, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

		                	$buyback_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

		                
		/*                	$this->db->select('member_shares.*')
		                	         ->order_by('member_shares.id');
							$this->db->where("company_code", $company_code);
							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
							$this->db->where("member_shares.transaction_type = 'Buyback'");
							$this->db->where_in('id', $buyback_id);

							$previous_buyback_member_result = $this->db->get('member_shares');*/

							$buyback_total_of_share_all_result = $buyback_total_of_share_all_result->result_array();
		                	//echo json_encode($previous_director_name_appointment_result);
		                	$buyback_member_result = $buyback_member_result->result_array();

		                	//$previous_buyback_member_result = $previous_buyback_member_result->result_array();

		                	$buyback_member = "";
		                	$buyback_string = "";
		                	$latest_buyback_id = array();
		                	$num_of_buyback_member = (int)(count($buyback_member_result)) - 1;

		                	if(strpos($str, '<tr class="loop"') !== false)
		                	{
		                		preg_match_all ('/<tr class="loop"(.+?)<\/tr>/s', $str, $m);
		                	
			                	for($g = 0; $g < count($buyback_member_result); $g++)
			                	{

		                			$buyback_string = $m[0][0];
		                			//echo json_encode($m);
			                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
				                	{
				                		if($buyback_member_result[$g]["name"] != '')
			                			{
			                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["name"], $buyback_string);
			                				
			                			}
			                			elseif($buyback_member_result[$g]["company_name"] != '')
			                			{
			                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["company_name"], $buyback_string);
			                			}
			                		}

			                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>') !== false)
			                		{
			                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>', number_format(-($buyback_member_result[$g]["number_of_share"]), 2), $buyback_string);
			                		}

			                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>') !== false)
			                		{
			                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>', number_format(-($buyback_member_result[$g]["amount_share"]), 2), $buyback_string);
			                		}

			                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>') !== false)
			                		{
			                			if($buyback_member_result[$g]["sharetype_id"] == '1')
			                			{
			                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["sharetype_name"], $buyback_string);

			                			}
			                			elseif($buyback_member_result[$g]["sharetype_id"] == '2')
			                			{
			                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["other_class"], $buyback_string);
			                			}
			                		}

			                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - currency}}</span>') !== false)
			                		{
			                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency}}</span>', $buyback_member_result[$g]["currency_name"], $buyback_string);
			                		}

			                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>') !== false)
			                		{
			                			if($buyback_member_result[$g]["new_certificate_no"] != '')
			                			{
			                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["new_certificate_no"], $buyback_string);
			                			}
			                			else
			                			{
			                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["certificate_no"], $buyback_string);
			                			}
			                			
			                		}

			                		$buyback_member = $buyback_member.$buyback_string;
				            	
			                	}
			                	

		                		$str = str_replace($m[0][0], $buyback_member, $str);
			                }
			                
			               	
			               	for($g = 0; $g < count($buyback_member_result); $g++)
			                {

			                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
			                	{
			                		if($buyback_member_result[$g]["name"] != '')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["name"], $str);
		                				
		                			}
		                			elseif($buyback_member_result[$g]["company_name"] != '')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', $buyback_member_result[$g]["company_name"], $str);
		                			}
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>') !== false)
		                		{
		                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>', number_format(-($buyback_member_result[$g]["number_of_share"]), 2), $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>') !== false)
		                		{
		                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>', number_format(-($buyback_member_result[$g]["amount_share"]), 2), $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>') !== false)
		                		{
		                			if($buyback_member_result[$g]["sharetype_id"] == '1')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["sharetype_name"], $str);

		                			}
		                			elseif($buyback_member_result[$g]["sharetype_id"] == '2')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', $buyback_member_result[$g]["other_class"], $str);
		                			}
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - currency}}</span>') !== false)
		                		{
		                			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency}}</span>', $buyback_member_result[$g]["currency_name"], $str);
		                		}

		                		if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>') !== false)
		                		{
		                			if($buyback_member_result[$g]["new_certificate_no"] != '')
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["new_certificate_no"], $str);
		                			}
		                			else
		                			{
		                				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $buyback_member_result[$g]["certificate_no"], $str);
		                			}
		                			
		                		}

			                }

			                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - number of shares all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares all}}</span>', number_format(-($buyback_total_of_share_all_result[0]["total_number_of_share"]), 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - amount of shares all}}</span>') !== false)
		                	{
		                		$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares all}}</span>', number_format(-($buyback_total_of_share_all_result[0]["total_amount_of_share"]), 2), $str);
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>') !== false)
		                	{
		                		if($buyback_total_of_share_all_result[0]["sharetype_id"] == '1')
		            			{
		            				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>', $buyback_total_of_share_all_result[0]["sharetype_name"], $str);

		            			}
		            			elseif($buyback_total_of_share_all_result[0]["sharetype_id"] == '2')
		            			{
		            				$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>', $buyback_total_of_share_all_result[0]["other_class"], $str);
		            			}
		                	}

		                	if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - currency all}}</span>') !== false)
		            		{
		            			$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency all}}</span>', $buyback_total_of_share_all_result[0]["currency_name"], $str);
		            		}
			                

			                for($h = 0; $h < count($buyback_member_result); $h++)
			                {
			                	array_push($latest_member_id, (int)$buyback_member_result[$h]["id"]);
			                }

		                	$data_pending_document['buyback_id']=json_encode($latest_member_id);
		                }

						if($type == "add_transfer_of_share")
		                {
		                	$transfer_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name, certificate.certificate_no, certificate.new_certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and certificate.client_member_share_capital_id = member_shares.client_member_share_capital_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Transfer' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_member_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

		                

		                	/*$this->db->select('member_shares.*')
		                	         ->order_by('member_shares.id');
							$this->db->where("company_code", $company_code);
							$this->db->where("STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$data['transaction_date']."','%d/%m/%Y')");
							$this->db->where("member_shares.client_member_share_capital_id", $client_member_share_capital_id);
							$this->db->where("member_shares.transaction_type = 'Transfer'");
							$this->db->where_in('id', $transfer_id);
							$previous_transfer_member_result = $this->db->get('member_shares');*/

		                	$transfer_member_result = $transfer_member_result->result_array();

		                	//$previous_transfer_member_result = $previous_transfer_member_result->result_array();

		                	$transferor_member = "";
		                	$transferor_string = "";
		                	$latest_member_id = array();
		                	$num_of_transferor_member = (int)(count($transfer_member_result)) - 1;

		                	if(strpos($str, '<tr class="loop"') !== false)
		                	{
		                		preg_match_all ('/<tr class="loop"(.+?)<\/tr>/s', $str, $m);
		                	
			                	for($g = 0; $g < count($transfer_member_result); $g++)
			                	{
			                		if($g%2==0)
								    {
								     	$transferor_string = $transferor_string.$m[0][0];
								    }
								   	else
								   	{
								   		$transferor_string = $transferor_string;
								   	}
			                		/*if ($g % 2 === 0) 
			                		{*/
				                		//$transferor_string = $m[0][0];
				                	if(0 > $transfer_member_result[$g]["number_of_share"])
			                		{
				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
					                	{
					                		if($transfer_member_result[$g]["name"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["name"], $transferor_string);
				                				
				                			}
				                			elseif($transfer_member_result[$g]["company_name"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["company_name"], $transferor_string);
				                			}
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - ID}}</span>') !== false)
					                	{
					                		if($transfer_member_result[$g]["identification_no"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["identification_no"], $transferor_string);
				                				
				                			}
				                			elseif($transfer_member_result[$g]["register_no"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["register_no"], $transferor_string);
				                			}
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share number}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share number}}</span>', number_format(-($transfer_member_result[$g]["number_of_share"]), 2), $transferor_string);
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>', number_format(-($transfer_member_result[$g]["amount_share"]), 2), $transferor_string);
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share type}}</span>') !== false)
				                		{
				                			if($transfer_member_result[$g]["sharetype_id"] == '1')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $transferor_string);

				                			}
				                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["other_class"], $transferor_string);
				                			}
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - currency}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - currency}}</span>', $transfer_member_result[$g]["currency_name"], $transferor_string);
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>') !== false)
				                		{
				                			if($transfer_member_result[$g]["new_certificate_no"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $transferor_string);
				                			}
				                			else
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $transferor_string);
				                			}
				                			
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>', number_format($transfer_member_result[$g]["consideration"], 2), $transferor_string);
				                		}
				                	}
				                	elseif($transfer_member_result[$g]["number_of_share"] > 0)
				                	{
				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - name}}</span>') !== false)
					                	{
					                		if($transfer_member_result[$g]["name"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["name"], $transferor_string);
				                				
				                			}
				                			elseif($transfer_member_result[$g]["company_name"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["company_name"], $transferor_string);
				                			}
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - ID}}</span>') !== false)
					                	{
					                		if($transfer_member_result[$g]["identification_no"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["identification_no"], $transferor_string);
				                				
				                			}
				                			elseif($transfer_member_result[$g]["register_no"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["register_no"], $transferor_string);
				                			}
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share number}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share number}}</span>', number_format($transfer_member_result[$g]["number_of_share"],2), $transferor_string);
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>', number_format($transfer_member_result[$g]["amount_share"], 2), $transferor_string);
				                		}
				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share type}}</span>') !== false)
				                		{
				                			if($transfer_member_result[$g]["sharetype_id"] == '1')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $transferor_string);

				                			}
				                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["other_class"], $transferor_string);
				                			}
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - currency}}</span>') !== false)
				                		{
				                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - currency}}</span>', $transfer_member_result[$g]["currency_name"], $transferor_string);
				                		}

				                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>') !== false)
				                		{
				                			if($transfer_member_result[$g]["new_certificate_no"] != '')
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $transferor_string);
				                			}
				                			else
				                			{
				                				$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $transferor_string);
				                			}
				                			
				                		}
				                	}
			                		
				            
			                	}

			                	if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
					            {
					            	$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', '', $transferor_string);
		                		}

		            			if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - ID}}</span>') !== false)
			                	{
			                		$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share number}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share number}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - share type}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - currency}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - currency}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - name}}</span>') !== false)
			                	{
			                		$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - ID}}</span>') !== false)
			                	{
			                		$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share number}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share number}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>', '', $transferor_string);
		                		}
		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - share type}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - currency}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - currency}}</span>', '', $transferor_string);
		                		}

		                		if(strpos($transferor_string, '<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>') !== false)
		                		{
		                			$transferor_string = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', '', $transferor_string);
		                		}

		                		$str = str_replace($m[0][0], $transferor_string, $str);
			                }
			                
			               	
			               	for($g = 0; $g < count($transfer_member_result); $g++)
			                {
			                	if(0 > $transfer_member_result[$g]["number_of_share"])
			                	{
				                	if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - name}}</span>') !== false)
						            {

				                		if($transfer_member_result[$g]["name"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["name"], $str);
			                				
			                			}
			                			elseif($transfer_member_result[$g]["company_name"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - name}}</span>', $transfer_member_result[$g]["company_name"], $str);
			                			}
			                		}

		                			if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - ID}}</span>') !== false)
				                	{
				                		if($transfer_member_result[$g]["identification_no"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["identification_no"], $str);
			                				
			                			}
			                			elseif($transfer_member_result[$g]["register_no"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - ID}}</span>', $transfer_member_result[$g]["register_no"], $str);
			                			}
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - share number}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share number}}</span>', number_format(-($transfer_member_result[$g]["number_of_share"]), 2), $str);
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share amount}}</span>', number_format(-($transfer_member_result[$g]["amount_share"]), 2), $str);
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - share type}}</span>') !== false)
			                		{
			                			if($transfer_member_result[$g]["sharetype_id"] == '1')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $str);

			                			}
			                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - share type}}</span>', $transfer_member_result[$g]["other_class"], $str);
			                			}
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - currency}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - currency}}</span>', $transfer_member_result[$g]["currency_name"], $str);
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>') !== false)
			                		{
			                			if($transfer_member_result[$g]["new_certificate_no"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $str);
			                			}
			                			else
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $str);
			                			}
			                			
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferor - consideration}}</span>', number_format($transfer_member_result[$g]["consideration"], 2), $str);
			                		}
			                	}
			                	elseif($transfer_member_result[$g]["number_of_share"] > 0)
			                	{
			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - name}}</span>') !== false)
				                	{
				                		if($transfer_member_result[$g]["name"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["name"], $str);
			                				
			                			}
			                			elseif($transfer_member_result[$g]["company_name"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - name}}</span>', $transfer_member_result[$g]["company_name"], $str);
			                			}
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - ID}}</span>') !== false)
				                	{
				                		if($transfer_member_result[$g]["identification_no"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["identification_no"], $str);
			                				
			                			}
			                			elseif($transfer_member_result[$g]["register_no"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - ID}}</span>', $transfer_member_result[$g]["register_no"], $str);
			                			}
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - share number}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share number}}</span>', number_format($transfer_member_result[$g]["number_of_share"], 2), $str);
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share amount}}</span>', number_format($transfer_member_result[$g]["amount_share"], 2), $str);
			                		}
			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - share type}}</span>') !== false)
			                		{
			                			if($transfer_member_result[$g]["sharetype_id"] == '1')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["sharetype_name"], $str);

			                			}
			                			elseif($transfer_member_result[$g]["sharetype_id"] == '2')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - share type}}</span>', $transfer_member_result[$g]["other_class"], $str);
			                			}
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - currency}}</span>') !== false)
			                		{
			                			$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - currency}}</span>', $transfer_member_result[$g]["currency_name"], $str);
			                		}

			                		if(strpos($str, '<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>') !== false)
			                		{
			                			if($transfer_member_result[$g]["new_certificate_no"] != '')
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["new_certificate_no"], $str);
			                			}
			                			else
			                			{
			                				$str = str_replace('<span class="myclass mceNonEditable">{{Transferee - certificate}}</span>', $transfer_member_result[$g]["certificate_no"], $str);
			                			}
			                			
			                		}
			                	}
			                	
			                }
	                

			                for($h = 0; $h < count($transfer_member_result); $h++)
			                {
			                	array_push($latest_member_id, (int)$transfer_member_result[$h]["id"]);
			                }

		                	$data_pending_document['transfer_id']=json_encode($latest_member_id);

		                }

		                $data_pending_document['content'] = $str;
		            }

                if(count($previous_member_result) != 0 && $previous_member_result != null)
	        	{
	        		$member_id_data = array();
	        		for($f = 0; $f < count($previous_member_result); $f++)
	            	{
	            		array_push($member_id_data, (int)$previous_member_result[$f]["id"]);
	            	}
	        	}

	            
	            /*echo json_encode($member_id_data);
	            echo json_encode($type);*/
	            if($type == "add_allotment_of_share")
				{
		        	if(count($latest_member_id) == 0)
		        	{
		        		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
		        		$this->db->where('client_id', $client_id);
		        		$this->db->where('received_on', "");
		        		$this->db->where('allotment_id', json_encode($member_id_data));
		        		$this->db->where('transaction_date', $old_member_date_result);
		        		$this->db->where('document_name', $document_name);
						$this->db->delete('pending_documents');
		        	}
		        	else
		        	{

		        		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "allotment_id" => json_encode($member_id_data), "transaction_date" => $old_member_date_result, "document_name" => $document_name));  
		        	}
		        }
		        elseif($type == "add_buyback_of_share")
				{
		        	if(count($latest_member_id) == 0)
		        	{
		        		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
		        		$this->db->where('client_id', $client_id);
		        		$this->db->where('received_on', "");
		        		$this->db->where('buyback_id', json_encode($member_id_data));
		        		$this->db->where('transaction_date', $old_member_date_result);
		        		$this->db->where('document_name', $document_name);
						$this->db->delete('pending_documents');
		        	}
		        	else
		        	{

		        		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "buyback_id" => json_encode($member_id_data), "transaction_date" => $old_member_date_result, "document_name" => $document_name));  
		        	}
		        }
	            elseif($type == "add_transfer_of_share")
				{
					//echo json_encode($member_id_data);
		        	if(count($latest_member_id) == 0)
		        	{
		        		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
		        		$this->db->where('client_id', $client_id);
		        		$this->db->where('received_on', "");
		        		$this->db->where('transfer_id', json_encode($member_id_data));
		        		$this->db->where('transaction_date', $old_member_date_result);
		        		$this->db->where('document_name', $document_name);
						$this->db->delete('pending_documents');
		        	}
		        	else
		        	{

		        		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "transfer_id" => json_encode($member_id_data), "transaction_date" => $old_member_date_result, "document_name" => $document_name));  
		        	}
		        }
            }
        }
    }

	public function view_allotment ($company_code)
	{
        $bc = array(array('link' => '#', 'page' => lang('Allotment')));
        $meta = array('page_title' => lang('Allotment'), 'bc' => $bc, 'page_name' => 'Allotment');
        $search = ''; $type = '';
		
		if (isset($_POST['type'])) $type = $_POST['type'];
		if (isset($_POST['search'])) $search = $_POST['search'];

		if($type == null)
        {
            $type = "all";
        }
        else 
        {
            $type = $_POST['type'];
        }

        //$this->data['person'] = $this->master_model->get_all_person();
        $this->data['type'] = $type;

		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_company_share_type($company_code);
		//$this->data['client_share_capital'] = $this->master_model->get_all_client_share_capital($company_code);
		$this->data['allotment'] = $this->master_model->get_all_allotment_to_view($search,$type,$company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();
		$this->data["client_status"] = $r[0]["status"];

		$allotment_id = array();
        $this->session->set_userdata(array(
            'allotment_id'  =>  $allotment_id,
        ));
		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
        $this->page_construct('client/allotment_edit.php', $meta, $this->data);



		
        
		
		
	}
	
	public function allotment ($company_code)
	{
        $bc = array(array('link' => '#', 'page' => lang('Create Allotment')));
        $meta = array('page_title' => lang('Create Allotment'), 'bc' => $bc, 'page_name' => 'Create Allotment');
		// $this->data['page_name'] = 'Clients';
		//$this->data['unique_code'] = $unique_code;
		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_company_share_type($company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();

		$this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Allotment', base_url('masterclient/view_allotment/'.$company_code.''));
		$this->mybreadcrumb->add('Create Allotment - '.$r[0]["company_name"].'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data["client_status"] = $r[0]["status"];

		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
        $this->page_construct('client/allotment.php', $meta, $this->data);
		
	}

	public function edit_allotment ($transaction_id, $client_member_share_capital_id, $company_code) 
	{
		$bc = array(array('link' => '#', 'page' => lang('Edit Allotment')));
        $meta = array('page_title' => lang('Edit Allotment'), 'bc' => $bc, 'page_name' => 'Edit Allotment');
		// $this->data['page_name'] = 'Clients';
		//$this->data['unique_code'] = $unique_code;
		$this->data['company_code'] = $company_code;
		//$this->data['sharetype'] = $this->master_model->get_all_share_type($company_code);
		$this->data['company_class'] = $this->master_model->get_all_non_exist_company_share_type($client_member_share_capital_id,$company_code);
		$this->data['allotment'] = $this->master_model->get_edit_allotment_group($transaction_id, $company_code);

		$r = $this->db->query("select status, company_name from client where company_code = '".$company_code."'");
        $r = $r->result_array();

		$this->load->library('mybreadcrumb');
        $this->mybreadcrumb->add('Allotment', base_url('masterclient/view_allotment/'.$company_code.''));
		$this->mybreadcrumb->add('Edit Allotment - '.$r[0]["company_name"].'', base_url());
		$this->data['breadcrumbs'] = $this->mybreadcrumb->render();

		$this->data["client_status"] = $r[0]["status"];

		$allotment_id = array();
        $this->session->set_userdata(array(
            'allotment_id'  =>  $allotment_id,
        ));
		/*$this->data['service'] = $this->master_model->get_all_service();
		$this->data['currency'] = $this->master_model->get_all_currency();*/
        $this->page_construct('client/allotment.php', $meta, $this->data);
	}
	public function check_cert_no()
	{
		$certificate_no = $_POST["certificate_no"];
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$cert_id = $_POST["cert_id"];

		if($certificate_no != "NA")
		{
			if($cert_id == "")
			{
				$q = $this->db->query("select * from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

				if ($q->num_rows() > 0) {
		            echo json_encode(false);
		        }
		        else
		        {
		        	echo json_encode(true);
		        }
		    }
		    else
		    {
		    	$q = $this->db->query("select * from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."' AND id != '".$cert_id."'");

				if ($q->num_rows() > 0) {
		            echo json_encode(false);
		        }
		        else
		        {
		        	echo json_encode(true);
		        }
		    }
		}
		else
		{
			echo json_encode(true);
		}
	}
	public function get_allotment_certificate()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$officer_id = $_POST["officer_id"];
		$field_type = $_POST["field_type"];
		$transaction_type = $_POST["transaction_type"];
		$date = $_POST["date"];
		$id_member_share = $_POST["member_share_id"];

		if(isset($id_member_share))
		{
			$p = $this->db->query('select merge from member_shares where member_shares.id = "'.$id_member_share.'"');

			if ($p->num_rows() > 0) 
			{
	        	$p = $p->result_array();
	        	$merge_info = $p[0]["merge"];
	        }
	        else
	        {
	        	$merge_info = 0;
	        }
		}
        else
        {
        	$merge_info = 0;
        }

        if($merge_info == 1)
        {
			$q = $this->db->query("select certificate.*, member_shares.cert_status from certificate left join member_shares on certificate.officer_id = member_shares.officer_id and certificate.company_code = member_shares.company_code and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and member_shares.id = (
	           SELECT MAX(id) 
	           FROM member_shares as z 
	           WHERE z.officer_id = member_shares.officer_id and z.company_code = member_shares.company_code and z.field_type = member_shares.field_type and z.transaction_id = member_shares.transaction_id
	        ) where certificate.client_member_share_capital_id='".$client_member_share_capital_id."' AND certificate.company_code='".$company_code."' AND certificate.officer_id='".$officer_id."' AND certificate.field_type='".$field_type."'");
		}
		else if($merge_info == 0)
		{
			$q = $this->db->query("select certificate.*, member_shares.cert_status, member_shares.transaction_type from certificate left join member_shares on certificate.officer_id = member_shares.officer_id and certificate.company_code = member_shares.company_code and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and member_shares.id = (
	           SELECT MAX(id) 
	           FROM member_shares as z 
	           WHERE z.officer_id = member_shares.officer_id and z.company_code = member_shares.company_code and z.field_type = member_shares.field_type and z.transaction_id = member_shares.transaction_id
	        ) where certificate.client_member_share_capital_id='".$client_member_share_capital_id."' AND certificate.company_code='".$company_code."' AND certificate.officer_id='".$officer_id."' AND certificate.field_type='".$field_type."' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') < STR_TO_DATE('".$date. "','%d/%m/%Y') AND member_shares.id != '".$id_member_share."' AND member_shares.cert_status = 1 AND certificate.status = 1");
		}

        

        //echo json_encode($q->result());

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode(array("certificate_data" => $data, 'merge_status' => $merge_info));
        }
        else
        {
        	echo FALSE;
        }
        
	}
	public function get_transfer_certificate()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$officer_id = $_POST["officer_id"];
		$field_type = $_POST["field_type"];

		//echo json_encode($client_member_share_capital_id);
		
		$q = $this->db->query('select member_shares.*, sum(member_shares.number_of_share) as number_of_share, sum(member_shares.amount_share) as amount_share, sum(member_shares.no_of_share_paid) as no_of_share_paid, sum(member_shares.amount_paid) as amount_paid, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$company_code.'" AND member_shares.client_member_share_capital_id = "'.$client_member_share_capital_id.'" GROUP BY member_shares.field_type, member_shares.officer_id HAVING sum(member_shares.number_of_share) != 0');

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        echo (FALSE);
	}

	public function get_the_previous_certificate()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$officer_id = $_POST["officer_id"];
		$field_type = $_POST["field_type"];
		$transaction_type = $_POST["transaction_type"];

		$q = $this->db->query("select certificate.*, member_shares.cert_status from certificate left join member_shares on certificate.officer_id = member_shares.officer_id and certificate.company_code = member_shares.company_code and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and member_shares.id = (
	           SELECT MAX(id) 
	           FROM member_shares as z 
	           WHERE z.officer_id = member_shares.officer_id and z.company_code = member_shares.company_code and z.field_type = member_shares.field_type and z.transaction_id = member_shares.transaction_id
	        ) where certificate.client_member_share_capital_id='".$client_member_share_capital_id."' AND certificate.company_code='".$company_code."' AND certificate.officer_id='".$officer_id."' AND certificate.field_type='".$field_type."' AND certificate.status = 1");

        //echo json_encode($q->result());

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        else
        {
        	echo FALSE;
        }
        
	}

	public function get_the_previous_certificate_for_to()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$company_code = $_POST["company_code"];
		$officer_id = $_POST["officer_id"];
		$field_type = $_POST["field_type"];
		$transaction_type = $_POST["transaction_type"];
		$date = $_POST["date"];
		$id_member_share = $_POST["member_share_id"];

		if(isset($id_member_share))
		{
			$p = $this->db->query('select merge from member_shares where member_shares.id = "'.$id_member_share.'"');

			if ($p->num_rows() > 0) 
			{
	        	$p = $p->result_array();
	        	$merge_info = $p[0]["merge"];
	        }
	        else
	        {
	        	$merge_info = 0;
	        }
		}
        else
        {
        	$merge_info = 0;
        }

        if($merge_info == 1)
        {
			$q = $this->db->query("select certificate.*, member_shares.cert_status from certificate left join member_shares on certificate.officer_id = member_shares.officer_id and certificate.company_code = member_shares.company_code and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and member_shares.id = (
	           SELECT MAX(id) 
	           FROM member_shares as z 
	           WHERE z.officer_id = member_shares.officer_id and z.company_code = member_shares.company_code and z.field_type = member_shares.field_type and z.transaction_id = member_shares.transaction_id
	        ) where certificate.client_member_share_capital_id='".$client_member_share_capital_id."' AND certificate.company_code='".$company_code."' AND certificate.officer_id='".$officer_id."' AND certificate.field_type='".$field_type."'");
		}
		else if($merge_info == 0)
		{
			$q = $this->db->query("select certificate.*, member_shares.cert_status from certificate left join member_shares on certificate.officer_id = member_shares.officer_id and certificate.company_code = member_shares.company_code and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and member_shares.id = (
	           SELECT MAX(id) 
	           FROM member_shares as z 
	           WHERE z.officer_id = member_shares.officer_id and z.company_code = member_shares.company_code and z.field_type = member_shares.field_type and z.transaction_id = member_shares.transaction_id
	        ) where certificate.client_member_share_capital_id='".$client_member_share_capital_id."' AND certificate.company_code='".$company_code."' AND certificate.officer_id='".$officer_id."' AND certificate.field_type='".$field_type."' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') < STR_TO_DATE('".$date. "','%d/%m/%Y') AND member_shares.cert_status = 1 AND certificate.status = 1");
		}

        

        //echo json_encode($q->result());

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode(array("certificate_data" => $data, 'merge_status' => $merge_info));
        }
        else
        {
        	echo FALSE;
        }

		/*$q = $this->db->query("select certificate.*, member_shares.cert_status from certificate left join member_shares on certificate.officer_id = member_shares.officer_id and certificate.company_code = member_shares.company_code and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id and member_shares.id = (
	           SELECT MAX(id) 
	           FROM member_shares as z 
	           WHERE z.officer_id = member_shares.officer_id and z.company_code = member_shares.company_code and z.field_type = member_shares.field_type and z.transaction_id = member_shares.transaction_id
	        ) where certificate.client_member_share_capital_id='".$client_member_share_capital_id."' AND certificate.company_code='".$company_code."' AND certificate.officer_id='".$officer_id."' AND certificate.field_type='".$field_type."' AND certificate.status = 1");

        //echo json_encode($q->result());

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            echo json_encode($data);
        }
        else
        {
        	echo FALSE;
        }*/
        
	}

	public function save_buyback()
	{
		$_POST['buyback_id'] = array_values($_POST['buyback_id']);
		$_POST['officer_id'] = array_values($_POST['officer_id']);
		$_POST['field_type'] = array_values($_POST['field_type']);
		$_POST['member_name'] = array_values($_POST['member_name']);
		$_POST['current_number_of_share'] = array_values($_POST['current_number_of_share']);
		$_POST['current_amount_share'] = array_values($_POST['current_amount_share']);
		$_POST['share_buyback'] = array_values($_POST['share_buyback']);
		$_POST['new_number_of_share'] = array_values($_POST['new_number_of_share']);
		$_POST['hidden_certificate_no'] = array_values($_POST['hidden_certificate_no']);


		$transaction_id = "TR-".mt_rand(100000000, 999999999);

		$previous_member_shares_query = $this->db->get_where("member_shares", array("id" => $_POST['buyback_id'][0]));

		$previous_member_shares_query_data = $previous_member_shares_query->result_array();

		if ($previous_member_shares_query->num_rows())
		{
			$previous_member_share_result = $this->db->query("select member_shares.* from member_shares where company_code='".$_POST['company_code']."' AND member_shares.transaction_type = 'Buyback' AND member_shares.client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$previous_member_shares_query_data[0]["transaction_date"]."','%d/%m/%Y') ORDER BY member_shares.id");
						//echo json_encode($check_date);
			$previous_member_share_result = $previous_member_share_result->result_array();
		}

		//echo json_encode($_POST);
		$new_buyback_id = array();

		for($i = 0; $i < count($_POST['officer_id']); $i++ )
		{
			$temperary_cert = "TEMPORARY".mt_rand(100000000, 999999999);
			$create_new_cert = "NC".mt_rand(100000000, 999999999);
			/*$total_no_of_share = 0;
			$total_amount_share = 0;
			$per_share = 0;*/

			/*for($p = 0; $p < count($_POST['current_share']); $p++ )
			{
				$total_no_of_share += (int)$_POST['current_share'][$p];
			}

			for($q = 0; $q < count($_POST['amount_share']); $q++ )
			{
				$total_amount_share += (int)$_POST['amount_share'][$q];
			}*/

			$per_share = (float)$_POST['current_amount_share'][$i] / (int)$_POST['current_number_of_share'][$i];

			$buyback["company_code"] = $_POST['company_code'];
			$buyback["transaction_date"] = $_POST['date'];
			$buyback["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
			$buyback["officer_id"] = $_POST['officer_id'][$i];
			$buyback["field_type"] = $_POST['field_type'][$i];
			$buyback["transaction_type"] = $_POST['transaction_type'];
			$buyback["number_of_share"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
			$buyback["amount_share"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
			$buyback["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
			$buyback["amount_paid"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
			
			/*$allotment["certificate_no"] = $_POST['new_certificate_no'][$i];*/

			$q = $this->db->get_where("member_shares", array("id" => $_POST['buyback_id'][$i]));

			$previous_member_share_info = $q->result_array();

			if (!$q->num_rows())
			{				
				$buyback["transaction_id"] = $transaction_id;
				$buyback["cert_status"] = 1;
				$this->db->insert("member_shares",$buyback);
				$insert_buyback_id = $this->db->insert_id();
				array_push($new_buyback_id, $insert_buyback_id);
				
			} 
			else 
			{	
				
				$this->db->delete('member_shares', array("id" => $_POST['buyback_id'][$i]));

				$buyback["transaction_id"] = $previous_member_share_info[0]["transaction_id"];
				$buyback["cert_status"] = $previous_member_share_info[0]["cert_status"];
				$this->db->insert("member_shares",$buyback);
				$insert_buyback_id = $this->db->insert_id();

				array_push($new_buyback_id, $insert_buyback_id);
				
			}

			$certificate["company_code"] = $_POST['company_code'];
			//$certificate["transaction_date"] = $_POST['date'];
			$certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
			$certificate["officer_id"] = $_POST['officer_id'][$i];
			$certificate["field_type"] = $_POST['field_type'][$i];
			
			/*$certificate["transaction_type"] = $_POST['transaction_type'];*/

			if($_POST['buyback_id'][$i] == null)
			{
				$certificate["transaction_id"] = $transaction_id;

				
				$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id, member_shares.transaction_date from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['officer_id'][$i]."' AND certificate.field_type='".$_POST['field_type'][$i]."' AND UNIX_TIMESTAMP(STR_TO_DATE('".$_POST['date']."','%d/%m/%Y')) = UNIX_TIMESTAMP(STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y'))");
				 /*AND UNIX_TIMESTAMP(STR_TO_DATE("'.$transaction_date.'","%d/%m/%Y")) >= UNIX_TIMESTAMP(STR_TO_DATE(member_shares.transaction_date,"%d/%m/%Y"))*/
				 // AND certificate.status = 1
				$query = $query->result_array();

				for($k = 0; $k < count($query); $k++)
				{
					$this->db->set("status", 2);
					$this->db->where(array("id" => $query[$k]["id"]));
					$this->db->update("certificate");

					$merge_certificate["company_code"] = $query[$k]['company_code'];
					$merge_certificate["merge_date"] = date('d-m-Y',now());
					//$certificate["transaction_date"] = $_POST['date'];
					$merge_certificate["client_member_share_capital_id"] = $query[$k]['client_member_share_capital_id'];
					$merge_certificate["officer_id"] = $query[$k]['officer_id'];
					$merge_certificate["field_type"] = $query[$k]['field_type'];
					$merge_certificate["transaction_id"] = $transaction_id;
					$merge_certificate["number_of_share"] = $query[$k]["number_of_share"];
					$merge_certificate["amount_share"] = $query[$k]["amount_share"];
					$merge_certificate["no_of_share_paid"] = $query[$k]["no_of_share_paid"];
					$merge_certificate["amount_paid"] = $query[$k]["amount_paid"];
					$merge_certificate["certificate_no"] = $query[$k]["certificate_no"];

					if($_POST['hidden_certificate_no'][$i] != " ")
					{
						$merge_certificate["new_certificate_no"] = $_POST['hidden_certificate_no'][$i];
					}
					elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
					{
						$merge_certificate["new_certificate_no"] = $create_new_cert;
					}
					else
					{
						$merge_certificate["new_certificate_no"] = $temperary_cert;
					}

					$this->db->insert("certificate_merge",$merge_certificate);
				}

				$merge_certificate["company_code"] = $_POST['company_code'];
				$merge_certificate["merge_date"] = date('d-m-Y',now());
				//$certificate["transaction_date"] = $_POST['date'];
				$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
				$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
				$merge_certificate["field_type"] = $_POST['field_type'][$i];
				$merge_certificate["transaction_id"] = $transaction_id;
				$merge_certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
				$merge_certificate["amount_share"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
				$merge_certificate["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
				$merge_certificate["amount_paid"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
				$merge_certificate["certificate_no"] = "";

				if($_POST['hidden_certificate_no'][$i] != " ")
				{
					$merge_certificate["new_certificate_no"] = $_POST['hidden_certificate_no'][$i];
				}
				elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
				{
					$merge_certificate["new_certificate_no"] = $create_new_cert;
				}
				else
				{
					$merge_certificate["new_certificate_no"] = $temperary_cert;
				}
				

				$this->db->insert("certificate_merge",$merge_certificate);

				$certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
				if($_POST['hidden_certificate_no'][$i] != " ")
				{
					$certificate["certificate_no"] = $_POST['hidden_certificate_no'][$i];
				}
				elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
				{
					$certificate["certificate_no"] = $create_new_cert;
				}
				else
				{
					$certificate["certificate_no"] = $temperary_cert;
				}
				$certificate["status"] = 1;	

				$this->db->insert("certificate",$certificate);

				if($_POST['hidden_certificate_no'][$i] != " ")
				{
					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND company_code='".$_POST['company_code']."' AND officer_id='".$_POST['officer_id'][$i]."' AND field_type='".$_POST['field_type'][$i]."' AND new_certificate_no = '".$_POST['hidden_certificate_no'][$i]."'");

					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "company_code" => $_POST['company_code'], "officer_id" =>$_POST['officer_id'][$i], "field_type" => $_POST['field_type'][$i], "certificate_no" => $_POST['hidden_certificate_no'][$i]));
				}
				elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
				{
					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND company_code='".$_POST['company_code']."' AND officer_id='".$_POST['officer_id'][$i]."' AND field_type='".$_POST['field_type'][$i]."' AND new_certificate_no = '".$create_new_cert."'");

					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "company_code" => $_POST['company_code'], "officer_id" =>$_POST['officer_id'][$i], "field_type" => $_POST['field_type'][$i], "certificate_no" => $create_new_cert));
				}
				else
				{
					$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND company_code='".$_POST['company_code']."' AND officer_id='".$_POST['officer_id'][$i]."' AND field_type='".$_POST['field_type'][$i]."' AND new_certificate_no = '".$temperary_cert."'");

					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "company_code" => $_POST['company_code'], "officer_id" =>$_POST['officer_id'][$i], "field_type" => $_POST['field_type'][$i], "certificate_no" => $temperary_cert));
				}

				$query_recalculate_num_of_share = $query_recalculate_num_of_share->result_array();

				$new_number_of_share["number_of_share"] = $query_recalculate_num_of_share[0]["number_of_share"];
				$new_number_of_share["amount_share"] = $query_recalculate_num_of_share[0]["amount_share"];
				$new_number_of_share["no_of_share_paid"] = $query_recalculate_num_of_share[0]["no_of_share_paid"];
				$new_number_of_share["amount_paid"] = $query_recalculate_num_of_share[0]["amount_paid"];
				
				$this->db->update("certificate",$new_number_of_share);

			}
			elseif($_POST['buyback_id'][$i] != null)
			{
				$company_code = $previous_member_share_info[0]["company_code"];
				$transaction_id = $previous_member_share_info[0]["transaction_id"];
				$officer_id = $previous_member_share_info[0]["officer_id"];
				$field_type = $previous_member_share_info[0]["field_type"];
				$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

				$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

				$query_certificate = $query_certificate->result_array();

				$certificate["transaction_id"] = $query_certificate[0]["transaction_id"];
				$certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
				$certificate["amount_share"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
				$certificate["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
				$certificate["amount_paid"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
				//$certificate["certificate_no"] = $_POST['new_certificate_no'][$i];

				if($_POST['hidden_certificate_no'][$i] != " ")
				{
					$certificate["certificate_no"] = $_POST['hidden_certificate_no'][$i];
				}
				elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
				{
					$certificate["certificate_no"] = $create_new_cert;
				}
				else
				{
					$certificate["certificate_no"] = $temperary_cert;
				}

				$certificate["status"] = $query_certificate[0]["status"];
			
				$this->db->insert("certificate",$certificate);

				$this->db->delete('certificate', array("id" => $query_certificate[0]["id"]));

				$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND certificate_no = ''");

				
				if ($query_certificate_merge->num_rows() > 0) 
				{
					
					$query_certificate_merge = $query_certificate_merge->result_array();
					//echo json_encode($query_certificate_merge);

					if($officer_id == $_POST['officer_id'][$i] && $field_type == $_POST['field_type'][$i])
					{
						$merge_certificate["company_code"] = $_POST['company_code'];
						$merge_certificate["merge_date"] = $query_certificate_merge[0]["merge_date"];
						//$certificate["transaction_date"] = $_POST['date'];
						$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
						$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
						$merge_certificate["field_type"] = $_POST['field_type'][$i];
						$merge_certificate["transaction_id"] = $query_certificate_merge[0]["transaction_id"];
						$merge_certificate["number_of_share"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
						$merge_certificate["amount_share"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
						$merge_certificate["no_of_share_paid"] = -((int)str_replace(',', '', $_POST['share_buyback'][$i]));
						$merge_certificate["amount_paid"] = -((float)str_replace(',', '', $_POST['share_buyback'][$i]) * $per_share);
						$merge_certificate["certificate_no"] = $query_certificate_merge[0]["certificate_no"];



						$query_check_new_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, sum(number_of_share) as total_number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_certificate[0]["certificate_no"]."' AND certificate_no = ''");

						if ($query_check_new_certificate_merge->num_rows() > 0) 
						{
							$query_check_new_certificate_merge = $query_check_new_certificate_merge->result_array();

							if($query_check_new_certificate_merge[0]["certificate_no"] == null)
							{
								if($_POST['hidden_certificate_no'][$i] != " ")
								{
									$new_certificate_number = $_POST['hidden_certificate_no'][$i];
									//$certificate["certificate_no"] = $_POST['hidden_certificate_no'][$i];
									$new_cert_num["new_certificate_no"] =  $_POST['hidden_certificate_no'][$i];
								}
								elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
								{
									$new_certificate_number = $create_new_cert;
									//$certificate["certificate_no"] = $create_new_cert;
									$new_cert_num["new_certificate_no"] =  $create_new_cert;
								}
								else
								{
									$new_certificate_number = $temperary_cert;
									//$certificate["certificate_no"] = $temperary_cert;
									$new_cert_num["new_certificate_no"] =  $temperary_cert;
								}
								/*echo json_encode($total_sum_number_of_share);*/
								$this->db->where(array("new_certificate_no" => $query_check_new_certificate_merge[0]["new_certificate_no"]));
								$this->db->update("certificate_merge",$new_cert_num);

								if($_POST['hidden_certificate_no'][$i] != " ")
								{
									$merge_certificate["new_certificate_no"] =  $_POST['hidden_certificate_no'][$i];
								}
								elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
								{
									$merge_certificate["new_certificate_no"] =  $create_new_cert;
								}
								else
								{
									$merge_certificate["new_certificate_no"] =  $temperary_cert;
								}

								$this->db->insert("certificate_merge",$merge_certificate);
								$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));

								$total_sum_number_of_share = $this->db->query("select sum(number_of_share) as total_number_of_share, sum(amount_share) as total_amount_share, sum(no_of_share_paid) as total_no_of_share_paid, sum(amount_paid) as total_amount_paid from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND transaction_id = '".$transaction_id."' AND new_certificate_no = '".$query_certificate[0]["certificate_no"]."'");

								if($total_sum_number_of_share->num_rows() > 0)
								{
									$total_sum_number_of_share = $total_sum_number_of_share->result_array();
									

									$total_number_of_share = $total_sum_number_of_share[0]["total_number_of_share"];
									$total_amount_share = $total_sum_number_of_share[0]["total_amount_share"];
									$total_no_of_share_paid = $total_sum_number_of_share[0]["total_no_of_share_paid"];
									$total_amount_paid = $total_sum_number_of_share[0]["total_amount_paid"];
								}
							
								

								$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_certificate[0]["certificate_no"]."'");

								if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
								{
									$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();
									//echo json_encode((int)$total_number_of_share);
									$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];

									if((int)$total_number_of_share != (int)$query_check_cert_num_with_cert_num[0]["number_of_share"])
									{
										/*$query_new_number_of_share_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["number_of_share"] - (int)str_replace(',', '', $_POST['share_buyback'][$i]);*/
										$query_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
										$query_new_amount_share_in_cert_merge = (int)$total_amount_share;
										$query_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
										$query_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
									}
									else
									{
										$query_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
										$query_new_amount_share_in_cert_merge = (int)$total_amount_share;
										$query_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
										$query_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
									}
									
								
									if($_POST['hidden_certificate_no'][$i] != " ")
									{
										$cert["certificate_no"] = $_POST['hidden_certificate_no'][$i];
									}
									elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
									{
										$cert["certificate_no"] = $create_new_cert;
									}
									else
									{
										$cert["certificate_no"] = $temperary_cert;
									}

									$cert["number_of_share"] = $query_new_number_of_share_in_cert_merge;
									$cert["amount_share"] = $query_new_amount_share_in_cert_merge;
									$cert["no_of_share_paid"] = $query_new_no_of_share_paid_in_cert_merge;
									$cert["amount_paid"] = $query_new_amount_paid_in_cert_merge;

									$this->db->where(array("id" => $query_check_cert_num_with_cert_num[0]["id"]));
									$this->db->update("certificate_merge",$cert);

									$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");

									if ($query_change_first_certificate->num_rows() > 0) 
									{
										$query_change_first_certificate = $query_change_first_certificate->result_array();


										$total_cert_sum_number_of_share = $this->db->query("select sum(number_of_share) as total_number_of_share, sum(amount_share) as total_amount_share, sum(no_of_share_paid) as total_no_of_share_paid, sum(amount_paid) as total_amount_paid from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");

										if($total_cert_sum_number_of_share->num_rows() > 0)
										{
											$total_cert_sum_number_of_share = $total_cert_sum_number_of_share->result_array();
											

											$new_cert_number_of_share = $total_cert_sum_number_of_share[0]["total_number_of_share"];
											$new_cert_amount_share = $total_cert_sum_number_of_share[0]["total_amount_share"];
											$new_cert_no_of_share_paid = $total_cert_sum_number_of_share[0]["total_no_of_share_paid"];
											$new_cert_amount_paid = $total_cert_sum_number_of_share[0]["total_amount_paid"];
										}

										$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
										$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
										$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
										$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

										$this->db->where(array("id" => $query_change_first_certificate[0]["id"]));
										$this->db->update("certificate",$new_certs_number_of_share);
									}

									while($new_cert_no != null)
									{
										$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

										if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
										{
											$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

											/*$query_another_new_number_of_share_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["number_of_share"] - (int)str_replace(',', '', $_POST['share_buyback'][$i]);*/

											if((int)$total_number_of_share != (int)$query_another_new_number_of_share_in_cert_merge[0]["number_of_share"])
											{
												/*$query_another_new_number_of_share_in_cert_merge = (int)$query_another_new_number_of_share_in_cert_merge[0]["number_of_share"] - (int)str_replace(',', '', $_POST['share_buyback'][$i]);*/
												$query_another_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
												$query_another_new_amount_share_in_cert_merge = (int)$total_amount_share;
												$query_another_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
												$query_another_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
											}
											else
											{
												$query_another_new_number_of_share_in_cert_merge = (int)$total_number_of_share;
												$query_another_new_amount_share_in_cert_merge = (int)$total_amount_share;
												$query_another_new_no_of_share_paid_in_cert_merge = (int)$total_no_of_share_paid;
												$query_another_new_amount_paid_in_cert_merge = (int)$total_amount_paid;
											}


											//$certs["certificate_no"] = $_POST['new_certificate_no'][$i];
											$certs["number_of_share"] = $query_another_new_number_of_share_in_cert_merge;
											$certs["amount_share"] = $query_another_new_amount_share_in_cert_merge;
											$certs["no_of_share_paid"] = $query_another_new_no_of_share_paid_in_cert_merge;
											$certs["amount_paid"] = $query_another_new_amount_paid_in_cert_merge;

											$this->db->where(array("id" => $query_check_another_cert_num_with_cert_num[0]["id"]));
											$this->db->update("certificate_merge",$certs);

											

											$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

											//echo json_encode($query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]);

											if ($query_change_certificate->num_rows() > 0) 
											{
												$query_change_certificate = $query_change_certificate->result_array();

												/*$new_cert_number_of_share = (int)$query_change_certificate[0]["number_of_share"] - (int)str_replace(',', '', $_POST['share_buyback'][$i]);
*/
												$total_cert_sum_number_of_share = $this->db->query("select sum(number_of_share) as total_number_of_share, sum(amount_share) as total_amount_share, sum(no_of_share_paid) as total_no_of_share_paid, sum(amount_paid) as total_amount_paid from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

												if($total_cert_sum_number_of_share->num_rows() > 0)
												{
													$total_cert_sum_number_of_share = $total_cert_sum_number_of_share->result_array();
													

													$new_cert_number_of_share = $total_cert_sum_number_of_share[0]["total_number_of_share"];
													$new_cert_amount_share = $total_cert_sum_number_of_share[0]["total_amount_share"];
													$new_cert_no_of_share_paid = $total_cert_sum_number_of_share[0]["total_no_of_share_paid"];
													$new_cert_amount_paid = $total_cert_sum_number_of_share[0]["total_amount_paid"];
												}

												$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
												$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
												$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
												$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

												$this->db->where(array("id" => $query_change_certificate[0]["id"]));
												$this->db->update("certificate",$new_certs_number_of_share);
											}

											$new_cert_no = $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"];
										}
										else
										{
											$new_cert_no = null;
										}

									}

									
								}

								


								
							}
							else
							{

								if($_POST['hidden_certificate_no'][$i] != " ")
								{
									$merge_certificate["new_certificate_no"] =  $_POST['hidden_certificate_no'][$i];
								}
								elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
								{
									$merge_certificate["new_certificate_no"] =  $create_new_cert;
								}
								else
								{
									$merge_certificate["new_certificate_no"] =  $temperary_cert;
								}

								$this->db->insert("certificate_merge",$merge_certificate);
								$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));
								
							}
						}
						else
						{
							if($_POST['hidden_certificate_no'][$i] != " ")
							{
								$merge_certificate["new_certificate_no"] =  $_POST['hidden_certificate_no'][$i];
							}
							elseif((int)str_replace(',', '', $_POST['share_buyback'][$i]) == 0)
							{
								$merge_certificate["new_certificate_no"] =  $create_new_cert;
							}
							else
							{
								$merge_certificate["new_certificate_no"] =  $temperary_cert;
							}

							$this->db->insert("certificate_merge",$merge_certificate);
							$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));
						}

						
					}
				}

				$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where new_certificate_no = '".$new_certificate_number."' AND client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."'");

				$query_recalculate_num_of_share = $query_recalculate_num_of_share->result_array();

				$new_number_of_share["number_of_share"] = $query_recalculate_num_of_share[0]["number_of_share"];
				$new_number_of_share["amount_share"] = $query_recalculate_num_of_share[0]["amount_share"];
				$new_number_of_share["no_of_share_paid"] = $query_recalculate_num_of_share[0]["no_of_share_paid"];
				$new_number_of_share["amount_paid"] = $query_recalculate_num_of_share[0]["amount_paid"];

				$this->db->where(array("client_member_share_capital_id" =>$_POST['client_member_share_capital_id'], "certificate_no" => $new_certificate_number));
				$this->db->update("certificate",$new_number_of_share);

			}
			/*$query_active_certificate = $this->db->query("select id, certificate_no from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND client_member_share_capital_id = '".$client_member_share_capital_id."' AND field_type = '".$field_type."' AND transaction_id = '".$transaction_id."' AND status = 1");

			$query_active_certificate = $query_active_certificate->result_array();

			if($new_certificate_number == null)
			{
				$query_new_certificate_no = $this->db->query("select new_certificate_no from certificate_merge where certificate_no = '".$query_active_certificate[0]["certificate_no"]."'");

				$query_new_certificate_no = $query_new_certificate_no->result_array();

				$new_certificate_number = $query_new_certificate_no[0]["new_certificate_no"];
			}*/

			
		}

		$get_client_information = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$_POST['company_code']."'");

		$get_client_information = $get_client_information->result_array();

		//if ($previous_member_shares_query->num_rows())
		//{
			/*$this->change_buyback_info($_POST['client_member_share_capital_id'], $previous_member_shares_query_data[0]["transaction_date"], $get_client_information[0]["firm_id"], $_POST['company_code'], $previous_member_share_result, $get_client_information[0]["id"]);*/
			$this->change_member_document_info("add_buyback_of_share", $_POST['client_member_share_capital_id'], $previous_member_shares_query_data[0]["transaction_date"], $get_client_information[0]["firm_id"], $_POST['company_code'], $previous_member_share_result, $get_client_information[0]["id"]);
		//}
		//else
		//{
			//$this->create_document("add_buyback_of_share", $_POST['company_code'], null, null, null, null, null, null, $_POST['client_member_share_capital_id'], $new_buyback_id);

		$this->create_invoice("share_buyback", $_POST["company_code"]);
		//echo json_encode($buyback);
		
		redirect("masterclient/view_buyback/".$_POST['company_code']."");
		

		
	}

	/*public function change_buyback_info($client_member_share_capital_id, $old_buyback_date_result, $firm_id, $company_code, $previous_buyback_result = null, $client_id)
	{

		$document_master_result = $this->db->query("select * from document_master where triggered_by = 24 AND firm_id='".$firm_id."'");

		if ($document_master_result->num_rows() > 0) 
		{
			$document_master_result = $document_master_result->result_array();

			for($r = 0; $r < count($document_master_result); $r++)
			{
				$str = $document_master_result[$r]["document_content"];

				if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
                {
                	$change_buyback_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	$change_buyback_member_result = $change_buyback_member_result->result_array();

	                	//echo json_encode($director_name_result);
                	if(strpos($str, '<p>- <span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
                	{
                		preg_match_all('~\<p>- <span class="myclass mceNonEditable">{{Buyback - members}}</span>(.*?)\<\/p\>~',$str,$m);
                	}
                	elseif(strpos($str, '<p>-<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
                	{
                		preg_match_all('~\<p>-<span class="myclass mceNonEditable">{{Buyback - members}}</span>(.*?)\<\/p\>~',$str,$m);
                	}
                	elseif(strpos($str, '<p><span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
                	{
                		preg_match_all('~\<p><span class="myclass mceNonEditable">{{Buyback - members}}</span>(.*?)\<\/p\>~',$str,$m);
                	}

                	$buyback_member = "";

                	$latest_buyback_id = array();
                	$num_of_buyback_member = (int)(count($change_buyback_member_result)) - 1;
                	for($g = 0; $g < count($change_buyback_member_result); $g++)
                	{
                		$buyback_string = $m[0][0];
                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - members}}</span>') !== false)
	                	{
	                		if($change_buyback_member_result[$g]["name"] != '')
                			{
                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', '<strong>'.$change_buyback_member_result[$g]["name"].'</strong>', $buyback_string);
                				
                			}
                			elseif($change_buyback_member_result[$g]["company_name"] != '')
                			{
                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - members}}</span>', '<strong>'.$change_buyback_member_result[$g]["company_name"].'</strong>', $buyback_string);
                			}
                		}

                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>') !== false)
                		{
                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares}}</span>', '<strong>'.$change_buyback_member_result[$g]["number_of_share"].'</strong>', $buyback_string);
                		}

                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>') !== false)
                		{
                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares}}</span>', '<strong>'.$change_buyback_member_result[$g]["amount_share"].'</strong>', $buyback_string);
                		}

                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>') !== false)
                		{
                			if($change_buyback_member_result[$g]["sharetype_id"] == '1')
                			{
                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', '<strong>'.$change_buyback_member_result[$g]["sharetype_name"].'</strong>', $buyback_string);

                			}
                			elseif($change_buyback_member_result[$g]["sharetype_id"] == '2')
                			{
                				$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares}}</span>', '<strong>'.$change_buyback_member_result[$g]["other_class"].'</strong>', $buyback_string);
                			}
                		}

                		if(strpos($buyback_string, '<span class="myclass mceNonEditable">{{Buyback - currency}}</span>') !== false)
                		{
                			$buyback_string = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency}}</span>', '<strong>'.$change_buyback_member_result[$g]["currency_name"].'</strong>', $buyback_string);
                		}

                		$buyback_member = $buyback_member.$buyback_string;
                		array_push($latest_buyback_id, (int)$change_buyback_member_result[$g]["id"]);
                	}
                	$data_pending_document['buyback_id']=json_encode($latest_buyback_id);

                	$str = str_replace($m[0][0], $buyback_member, $str);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - number of shares all}}</span>') !== false)
                {
                	$change_buyback_total_number_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.number_of_share) as total_number_of_share from member_shares where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	$change_buyback_number_of_share_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	$change_buyback_total_number_of_share_all_result = $change_buyback_total_number_of_share_all_result->result_array();
                	$change_buyback_number_of_share_all_result = $change_buyback_number_of_share_all_result->result_array();

                	//echo json_encode($director_name_result);

                	$change_buyback_number_of_share_all = "";

                	$latest_buyback_id = array();
                	$num_of_buyback_number_of_share_all = (int)(count($change_buyback_number_of_share_all_result)) - 1;

                	for($g = 0; $g < count($change_buyback_number_of_share_all_result); $g++)
                	{
                		
                		array_push($latest_buyback_id, (int)$change_buyback_number_of_share_all_result[$g]["id"]);
                	}

                	$change_buyback_number_of_share_all = $change_buyback_number_of_share_all.'<strong>'.$change_buyback_total_number_of_share_all_result[0]["total_number_of_share"].'</strong>';

                	$data['buyback_id']=json_encode($latest_buyback_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - number of shares all}}</span>', $change_buyback_number_of_share_all, $str);
                
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - amount of shares all}}</span>') !== false)
                {
                	$change_buyback_total_amount_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.amount_share) as total_number_of_share from member_shares where company_code='".$company_code." AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	$change_buyback_amount_of_share_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	//echo json_encode($previous_director_name_appointment_result);
                	$change_buyback_total_amount_of_share_all_result = $change_buyback_total_amount_of_share_all_result->result_array();
                	$change_buyback_amount_of_share_all_result = $change_buyback_amount_of_share_all_result->result_array();

                	//echo json_encode($director_name_result);

                	$buyback_amount_of_share_all = "";

                	$latest_buyback_id = array();
                	$num_of_buyback_amount_of_share_all = (int)(count($change_buyback_amount_of_share_all_result)) - 1;

                	for($g = 0; $g < count($change_buyback_amount_of_share_all_result); $g++)
                	{
                		
                		array_push($latest_buyback_id, (int)$change_buyback_amount_of_share_all_result[$g]["id"]);
                	}

                	$buyback_amount_of_share_all = $buyback_amount_of_share_all.'<strong>'.$change_buyback_total_amount_of_share_all_result[0]["total_number_of_share"].'</strong>';

                	$data['buyback_id']=json_encode($latest_buyback_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - amount of shares all}}</span>', $buyback_amount_of_share_all, $str);

                
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>') !== false)
                {
                	$change_buyback_type_of_share_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	//echo json_encode($previous_director_name_appointment_result);
                	$change_buyback_type_of_share_all_result = $change_buyback_type_of_share_all_result->result_array();

                	//echo json_encode($director_name_result);

                	$change_buyback_type_of_share_all = "";

                	$latest_buyback_id = array();
                	$num_of_buyback_type_of_share_all = (int)(count($change_buyback_type_of_share_all_result)) - 1;

                	for($g = 0; $g < count($change_buyback_type_of_share_all_result); $g++)
                	{
                		if($g == 0)
                		{
                			if($change_buyback_type_of_share_all_result[$g]["sharetype_id"] == '1')
                			{
                				$change_buyback_type_of_share_all = $change_buyback_type_of_share_all.'<strong>'.$change_buyback_type_of_share_all_result[$g]["sharetype_name"].'</strong>';
                			}
                			elseif($change_buyback_type_of_share_all_result[$g]["sharetype_id"] == '2')
                			{
                				$change_buyback_type_of_share_all = $change_buyback_type_of_share_all.'<strong>'.$change_buyback_type_of_share_all_result[$g]["other_class"].'</strong>';
                			}
                			

                		}
                		elseif($g == (int)$num_of_buyback_type_of_share_all)
                		{
                			if($change_buyback_type_of_share_all_result[$g]["sharetype_id"] == '1')
                			{
                				$change_buyback_type_of_share_all = $change_buyback_type_of_share_all.' and <strong>'.$change_buyback_type_of_share_all_result[$g]["sharetype_name"].'</strong>';
                			}
                			elseif($change_buyback_type_of_share_all_result[$g]["sharetype_id"] == '2')
                			{
                				$change_buyback_type_of_share_all = $change_buyback_type_of_share_all.' and <strong>'.$change_buyback_type_of_share_all_result[$g]["other_class"].'</strong>';
                			}

                			
                		}
                		else
                		{
                			if($change_buyback_type_of_share_all_result[$g]["sharetype_id"] == '1')
                			{
                				$change_buyback_type_of_share_all = $change_buyback_type_of_share_all.', <strong>'.$change_buyback_type_of_share_all_result[$g]["sharetype_name"].'</strong>';
                			}
                			elseif($change_buyback_type_of_share_all_result[$g]["sharetype_id"] == '2')
                			{
                				$change_buyback_type_of_share_all = $change_buyback_type_of_share_all.', <strong>'.$change_buyback_type_of_share_all_result[$g]["other_class"].'</strong>';
                			}
                			
                			
                		}
                		
                		array_push($latest_buyback_id, (int)$change_buyback_type_of_share_all_result[$g]["id"]);
                	}

                	$data['buyback_id']=json_encode($latest_buyback_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - type of shares all}}</span>', $change_buyback_type_of_share_all, $str);
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - currency all}}</span>') !== false)
                {
                	$change_buyback_currency_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	//echo json_encode($previous_director_name_appointment_result);
                	$change_buyback_currency_all_result = $change_buyback_currency_all_result->result_array();

                	//echo json_encode($director_name_result);

                	$change_buyback_currency_all = "";

                	$latest_buyback_id = array();
                	$num_of_buyback_currency_all = (int)(count($change_buyback_currency_all_result)) - 1;

                	for($g = 0; $g < count($change_buyback_currency_all_result); $g++)
                	{
                		if($g == 0)
                		{
                			
                			$change_buyback_currency_all = $change_buyback_currency_all.'<strong>'.$change_buyback_currency_all_result[$g]["currency_name"].'</strong>';
                		}
                		elseif($g == (int)$num_of_buyback_currency_all)
                		{
                			$change_buyback_currency_all = $change_buyback_currency_all.' and <strong>'.$change_buyback_currency_all_result[$g]["currency_name"].'</strong>';
                			
                		}
                		else
                		{
                			$change_buyback_currency_all = $change_buyback_currency_all.', <strong>'.$change_buyback_currency_all_result[$g]["currency_name"].'</strong>';
                			
                		}
                		
                		array_push($latest_buyback_id, (int)$change_buyback_currency_all_result[$g]["id"]);
                	}

                	$data['buyback_id']=json_encode($latest_buyback_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - currency all}}</span>', $change_buyback_currency_all, $str);

                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>') !== false)
                {
                	$change_buyback_certificate_result = $this->db->query("select member_shares.*, member_shares.number_of_share as number_of_share, member_shares.amount_share as amount_share, member_shares.no_of_share_paid as no_of_share_paid, member_shares.amount_paid as amount_paid, member_shares.transaction_type, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency, certificate.certificate_no, certificate.status from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Buyback' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_buyback_date_result."','%d/%m/%Y') ORDER BY member_shares.id");


                	//echo json_encode($previous_director_name_appointment_result);
                	$change_buyback_certificate_result = $change_buyback_certificate_result->result_array();

                	//echo json_encode($director_name_result);

                	$change_buyback_certificate = "";

                	$latest_buyback_id = array();
                	$num_of_allotment_certificate = (int)(count($change_buyback_certificate_result)) - 1;

                	for($g = 0; $g < count($change_buyback_certificate_result); $g++)
                	{
                		if($g == 0)
                		{
                			
                			$change_buyback_certificate = $change_buyback_certificate.'<strong>'.$change_buyback_certificate_result[$g]["certificate_no"].'</strong>';
                		}
                		elseif($g == (int)$num_of_allotment_certificate)
                		{
                			$change_buyback_certificate = $change_buyback_certificate.' and <strong>'.$change_buyback_certificate_result[$g]["certificate_no"].'</strong>';
                			
                		}
                		else
                		{
                			$change_buyback_certificate = $change_buyback_certificate.', <strong>'.$change_buyback_certificate_result[$g]["certificate_no"].'</strong>';
                			
                		}
                		
                		array_push($latest_buyback_id, (int)$change_buyback_certificate_result[$g]["id"]);
                	}

                	$data['buyback_id']=json_encode($latest_buyback_id);

                	$str = str_replace('<span class="myclass mceNonEditable">{{Buyback - certificate}}</span>', $change_buyback_certificate, $str);

                }
                if(count($previous_buyback_result) != 0 && $previous_buyback_result != null)
	        	{
	        		$buyback_id_data = array();
	        		for($f = 0; $f < count($previous_buyback_result); $f++)
	            	{
	            		array_push($buyback_id_data, (int)$previous_buyback_result[$f]["id"]);
	            	}
	        	}
	        	
	            $data_pending_document['content'] = $str;

	        	if(count($latest_buyback_id) == 0)
	        	{
	        		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
	        		$this->db->where('client_id', $client_id);
	        		$this->db->where('received_on', "");
	        		$this->db->where('buyback_id', json_encode($buyback_id_data));
	        		$this->db->where('transaction_date', $old_buyback_date_result);
					$this->db->delete('pending_documents');
	        	}
	        	else
	        	{

	        		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "buyback_id" => json_encode($buyback_id_data), "transaction_date" => $old_buyback_date_result));  
	        	}
            }

            
        }
    }*/

	public function save_allotment(){

		$client_member_share_capital['number_of_shares'] = 0;
		$client_member_share_capital['amount'] = 0;
		//$client_member_share_capital['no_of_share_paid'] = 0;
		$client_member_share_capital['paid_up'] = 0;

		$new_certificate_number = null;

		$_POST['officer_id'] = array_values($_POST['officer_id']);
		$_POST['number_of_share'] = array_values($_POST['number_of_share']);
		$_POST['amount_share'] = array_values($_POST['amount_share']);
		$_POST['amount_paid'] = array_values($_POST['amount_paid']);
		$_POST['field_type'] = array_values($_POST['field_type']);
		$_POST['no_of_share_paid'] = array_values($_POST['no_of_share_paid']);
		$_POST['new_certificate_no'] = array_values($_POST['new_certificate_no']);
		$_POST['merge_certificate_no'] = array_values($_POST['merge_certificate_no']);
		$_POST['merge_number_of_share'] = array_values($_POST['merge_number_of_share']);
		$_POST['merge_amount_share'] = array_values($_POST['merge_amount_share']);
		$_POST['merge_no_of_share_paid'] = array_values($_POST['merge_no_of_share_paid']);
		$_POST['merge_amount_paid'] = array_values($_POST['merge_amount_paid']);
		$_POST['member_share_id'] = array_values($_POST['member_share_id']);
		$_POST['merge_status'] = array_values($_POST['merge_status']);
		$_POST['previous_merge_cert_num'] = array_values($_POST['previous_merge_cert_num']);
		$_POST['latest_merge_cert_no'] = array_values($_POST['latest_merge_cert_no']);
	
		$transaction_id = "TR-".mt_rand(100000000, 999999999);

		$previous_member_shares_query = $this->db->get_where("member_shares", array("id" => $_POST['member_share_id'][0]));

		$previous_member_shares_query_data = $previous_member_shares_query->result_array();

		if ($previous_member_shares_query->num_rows())
		{
			$previous_member_share_result = $this->db->query("select member_shares.* from member_shares where company_code='".$_POST['company_code']."' AND member_shares.transaction_type = 'Allotment' AND member_shares.client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$previous_member_shares_query_data[0]["transaction_date"]."','%d/%m/%Y') ORDER BY member_shares.id");
						//echo json_encode($check_date);
			$previous_member_share_result = $previous_member_share_result->result_array();
		}

		if(count($this->session->userdata('allotment_id')) > 0)
		{
			$this->delete_allot();
		}

		//echo json_encode($_POST);
		//$previous_allotment_id = array();
		

		
		$new_allotment_id = array();

		for($i = 0; $i < count($_POST['officer_id']); $i++ )
		{
			$allotment["company_code"] = $_POST['company_code'];
			$allotment["transaction_date"] = $_POST['date'];
			$allotment["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
			$allotment["officer_id"] = $_POST['officer_id'][$i];
			$allotment["field_type"] = $_POST['field_type'][$i];
			$allotment["transaction_type"] = $_POST['transaction_type'];
			$allotment["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
			$allotment["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
			$allotment["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
			$allotment["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);


			$q = $this->db->get_where("member_shares", array("id" => $_POST['member_share_id'][$i]));

			$previous_member_share_info = $q->result_array();

			if (!$q->num_rows())
			{				
				$allotment["transaction_id"] = $transaction_id;
				$allotment["cert_status"] = 1;
				$this->db->insert("member_shares",$allotment);
				$insert_allotmant_id = $this->db->insert_id();
				array_push($new_allotment_id, $insert_allotmant_id);
				
			} 
			else 
			{	

				$this->db->delete('member_shares', array("id" => $_POST['member_share_id'][$i]));

				//array_push($previous_allotment_id,(int)$_POST['member_share_id'][$i]);

				$allotment["cert_status"] = $previous_member_share_info[0]["cert_status"];
				$allotment["transaction_id"] = $previous_member_share_info[0]["transaction_id"];
				$allotment["merge"] = $previous_member_share_info[0]["merge"];

				$this->db->insert("member_shares",$allotment);
				$insert_allotmant_id = $this->db->insert_id();
				array_push($new_allotment_id, $insert_allotmant_id);

			}

			$certificate["company_code"] = $_POST['company_code'];
			//$certificate["transaction_date"] = $_POST['date'];
			$certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
			$certificate["officer_id"] = $_POST['officer_id'][$i];
			$certificate["field_type"] = $_POST['field_type'][$i];

			if($_POST['member_share_id'][$i] == null)
			{
				$certificate["transaction_id"] = $transaction_id;

				if($_POST['merge_certificate_no'][$i] != null && $_POST['new_certificate_no'][$i] == null)
				{
					$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['officer_id'][$i]."' AND certificate.field_type='".$_POST['field_type'][$i]."' AND status = 1");

					$query = $query->result_array();

					for($k = 0; $k < count($query); $k++)
					{
						$this->db->set("status", 2);
						$this->db->set("new_certificate_no", $_POST['merge_certificate_no'][$i]);
						$this->db->where(array("id" => $query[$k]["id"]));
						$this->db->update("certificate");

						$this->db->set("merge", 1);
						$this->db->set("cert_status", 2);
						$this->db->where(array("transaction_id" => $query[$k]["transaction_id"]));
						$this->db->update("member_shares");

						$this->db->set("merge", 1);
						$this->db->set("cert_status", 1);
						$this->db->where(array("transaction_id" => $transaction_id));
						$this->db->update("member_shares");

						$merge_certificate["company_code"] = $query[$k]['company_code'];
						$merge_certificate["merge_date"] = date('d-m-Y',now());
						//$certificate["transaction_date"] = $_POST['date'];
						$merge_certificate["client_member_share_capital_id"] = $query[$k]['client_member_share_capital_id'];
						$merge_certificate["officer_id"] = $query[$k]['officer_id'];
						$merge_certificate["field_type"] = $query[$k]['field_type'];
						$merge_certificate["transaction_id"] = $transaction_id;
						$merge_certificate["number_of_share"] = $query[$k]["number_of_share"];
						$merge_certificate["amount_share"] = $query[$k]["amount_share"];
						$merge_certificate["no_of_share_paid"] = $query[$k]["no_of_share_paid"];
						$merge_certificate["amount_paid"] = $query[$k]["amount_paid"];

						$merge_certificate["certificate_no"] = $query[$k]["certificate_no"];
						$merge_certificate["new_certificate_no"] = $_POST['merge_certificate_no'][$i];

						$this->db->insert("certificate_merge",$merge_certificate);
					}

					$merge_certificate["company_code"] = $_POST['company_code'];
					$merge_certificate["merge_date"] = date('d-m-Y',now());
					//$certificate["transaction_date"] = $_POST['date'];
					$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
					$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
					$merge_certificate["field_type"] = $_POST['field_type'][$i];
					$merge_certificate["transaction_id"] = $transaction_id;
					$merge_certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
					$merge_certificate["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
					$merge_certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
					$merge_certificate["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);
					$merge_certificate["certificate_no"] = "";
					$merge_certificate["new_certificate_no"] = $_POST['merge_certificate_no'][$i];

					$this->db->insert("certificate_merge",$merge_certificate);

					$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['merge_number_of_share'][$i]);
					$certificate["amount_share"] = (float)str_replace(',', '', $_POST['merge_amount_share'][$i]);
					$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['merge_no_of_share_paid'][$i]);
					$certificate["amount_paid"] = (float)str_replace(',', '', $_POST['merge_amount_paid'][$i]);

					$certificate["certificate_no"] = $_POST['merge_certificate_no'][$i];
					$certificate["new_certificate_no"] = $_POST['merge_certificate_no'][$i];
					$certificate["status"] = 1;	

				}
				elseif($_POST['merge_certificate_no'][$i] == null && $_POST['new_certificate_no'][$i] != null)
				{
					$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
					$certificate["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
					$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
					$certificate["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);
					$certificate["certificate_no"] = $_POST['new_certificate_no'][$i];	
					$certificate["new_certificate_no"] = $_POST['new_certificate_no'][$i];	
					$certificate["status"] = 1;	
				}

				$this->db->insert("certificate",$certificate);
			}
			else if($_POST['member_share_id'][$i] != null)
			{
				if($_POST['merge_certificate_no'][$i] != null && $_POST['new_certificate_no'][$i] == null)
				{
					if($_POST['previous_merge_cert_num'][$i] != "")
					{
						$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['officer_id'][$i]."' AND certificate.field_type='".$_POST['field_type'][$i]."' AND member_shares.cert_status = 2 AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') < STR_TO_DATE('".$_POST['date']. "','%d/%m/%Y')");

						$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));
					}
					else
					{
						$query = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['officer_id'][$i]."' AND certificate.field_type='".$_POST['field_type'][$i]."' AND member_shares.cert_status = 1 AND certificate.status = 1 AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') < STR_TO_DATE('".$_POST['date']. "','%d/%m/%Y')");
					}

					$query = $query->result_array();

					//echo json_encode($query);

					for($k = 0; $k < count($query); $k++)
					{
						$this->db->set("status", 2);
						$this->db->set("new_certificate_no", $_POST['merge_certificate_no'][$i]);
						$this->db->where(array("id" => $query[$k]["id"]));
						$this->db->update("certificate");

						$this->db->set("merge", 1);
						$this->db->set("cert_status", 2);
						$this->db->where(array("transaction_id" => $query[$k]["transaction_id"]));
						$this->db->where(array("officer_id" => $query[$k]["officer_id"]));
						$this->db->where(array("field_type" => $query[$k]["field_type"]));
						$this->db->update("member_shares");

						$this->db->set("merge", 1);
						$this->db->set("cert_status", 1);
						$this->db->where(array("transaction_id" => $previous_member_share_info[0]["transaction_id"]));
						$this->db->update("member_shares");

						$merge_certificate["company_code"] = $query[$k]['company_code'];
						$merge_certificate["merge_date"] = date('d-m-Y',now());
						//$certificate["transaction_date"] = $_POST['date'];
						$merge_certificate["client_member_share_capital_id"] = $query[$k]['client_member_share_capital_id'];
						$merge_certificate["officer_id"] = $query[$k]['officer_id'];
						$merge_certificate["field_type"] = $query[$k]['field_type'];
						$merge_certificate["transaction_id"] = $transaction_id;
						$merge_certificate["number_of_share"] = $query[$k]["number_of_share"];
						$merge_certificate["amount_share"] = $query[$k]["amount_share"];
						$merge_certificate["no_of_share_paid"] = $query[$k]["no_of_share_paid"];
						$merge_certificate["amount_paid"] = $query[$k]["amount_paid"];

						$merge_certificate["certificate_no"] = $query[$k]["certificate_no"];
						$merge_certificate["new_certificate_no"] = $_POST['merge_certificate_no'][$i];

						$this->db->insert("certificate_merge",$merge_certificate);
					}

					$merge_certificate["company_code"] = $_POST['company_code'];
					$merge_certificate["merge_date"] = date('d-m-Y',now());
					//$certificate["transaction_date"] = $_POST['date'];
					$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
					$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
					$merge_certificate["field_type"] = $_POST['field_type'][$i];
					$merge_certificate["transaction_id"] = $previous_member_share_info[0]["transaction_id"];
					$merge_certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
					$merge_certificate["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
					$merge_certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
					$merge_certificate["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);
					$merge_certificate["certificate_no"] = "";
					$merge_certificate["new_certificate_no"] = $_POST['merge_certificate_no'][$i];

					$this->db->insert("certificate_merge",$merge_certificate);
				}
				else if($_POST['latest_merge_cert_no'][$i] != null && $_POST['previous_merge_cert_num'][$i] != $_POST['latest_merge_cert_no'][$i])
				{
					$this->db->set("certificate_no", $_POST['latest_merge_cert_no'][$i]);
					$this->db->where(array("certificate_no" => $_POST['previous_merge_cert_num'][$i]));
					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
					$this->db->update("certificate");

					$this->db->set("new_certificate_no", $_POST['latest_merge_cert_no'][$i]);
					$this->db->where(array("new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));
					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
					$this->db->update("certificate");

					$this->db->set("certificate_no", $_POST['latest_merge_cert_no'][$i]);
					$this->db->where(array("certificate_no" => $_POST['previous_merge_cert_num'][$i]));
					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
					$this->db->update("certificate_merge");

					$this->db->set("new_certificate_no", $_POST['latest_merge_cert_no'][$i]);
					$this->db->where(array("new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));
					$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id']));
					$this->db->update("certificate_merge");
				}

				$company_code = $previous_member_share_info[0]["company_code"];
				$transaction_id = $previous_member_share_info[0]["transaction_id"];
				$officer_id = $previous_member_share_info[0]["officer_id"];
				$field_type = $previous_member_share_info[0]["field_type"];
				$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

				$query_certificate = $this->db->query("select certificate.id, certificate.company_code, certificate.client_member_share_capital_id, certificate.officer_id, certificate.field_type, certificate.transaction_id, certificate.number_of_share, certificate.certificate_no, certificate.new_certificate_no, certificate.status, member_shares.cert_status from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate.officer_id = '".$officer_id."' AND certificate.company_code = '".$company_code."' AND certificate.transaction_id = '".$transaction_id."' AND certificate.field_type = '".$field_type."'");

				$query_certificate = $query_certificate->result_array();

				if(count($query_certificate == 0))
				{
					$certificate["transaction_id"] = $transaction_id;
				}
				else
				{
					$certificate["transaction_id"] = $query_certificate[0]["transaction_id"];
				}

				if($_POST['merge_certificate_no'][$i] != null && $_POST['new_certificate_no'][$i] == null)
				{
					$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['merge_number_of_share'][$i]);
					$certificate["amount_share"] = (float)str_replace(',', '', $_POST['merge_amount_share'][$i]);
					$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['merge_no_of_share_paid'][$i]);
					$certificate["amount_paid"] = (float)str_replace(',', '', $_POST['merge_amount_paid'][$i]);
					$certificate["certificate_no"] = $_POST['merge_certificate_no'][$i];
					$certificate["new_certificate_no"] = $_POST['merge_certificate_no'][$i];
					
				}
				else
				{
					$certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
					$certificate["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
					$certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
					$certificate["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);
					if($_POST['new_certificate_no'][$i] != null )
					{
						$certificate["certificate_no"] = $_POST['new_certificate_no'][$i];
						$certificate["new_certificate_no"] = $_POST['new_certificate_no'][$i];
					}
					else
					{
						$certificate["certificate_no"] = $query_certificate[0]["certificate_no"];
						$certificate["new_certificate_no"] = $query_certificate[0]["new_certificate_no"];
					}
					
					
				}
				
			
				if($officer_id != $_POST['officer_id'][$i] || $field_type != $_POST['field_type'][$i])
				{
					$certificate["status"] = 1;
				}	
				else
				{
					if(count($query_certificate == 0))
					{
						$query_check_the_date_after_trans = $this->db->query("select member_shares.id from member_shares where company_code = '".$company_code."' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') > STR_TO_DATE('".$_POST['date']. "','%d/%m/%Y') AND (transaction_type = 'Transfer' OR transaction_type = 'Buyback')");

						if (!$query_check_the_date_after_trans->num_rows())
						{
							$certificate["status"] = 1;
						}
						else
						{
							$certificate["status"] = 2;
						}
					}
					else
					{
						$certificate["status"] = $query_certificate[0]["status"];
					}
					
				}
				//echo json_encode($certificate);
				$this->db->insert("certificate",$certificate);

				$this->db->delete('certificate', array("id" => $query_certificate[0]["id"]));

				$this->db->set("cert_status", $query_certificate[0]["cert_status"]);
				$this->db->where(array("transaction_id" => $transaction_id));
				$this->db->update("member_shares");

				/*$this->db->set("certificate_no", $_POST['new_certificate_no'][$i]);
				$this->db->where(array("certificate_no" => $query_certificate[0]["certificate_no"]));
				$this->db->update("certificate_merge");*/


				if($_POST['merge_status'][$i] == "1")
				{
					$minus_the_number_of_share = (int)$previous_member_share_info[0]["number_of_share"] - (int)str_replace(',', '', $_POST['number_of_share'][$i]);
					$minus_the_amount_share = (float)$previous_member_share_info[0]["amount_share"] - (float)str_replace(',', '', $_POST['amount_share'][$i]);
					$minus_the_no_of_share_paid = (int)$previous_member_share_info[0]["no_of_share_paid"] - (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
					$minus_the_amount_paid = (float)$previous_member_share_info[0]["amount_paid"] - (float)str_replace(',', '', $_POST['amount_paid'][$i]);

					//echo json_encode($minus_the_number_of_share);

					$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

					
					if ($query_certificate_merge->num_rows() > 0) 
					{
						
						$query_certificate_merge = $query_certificate_merge->result_array();
						//echo json_encode($query_certificate_merge);

						if($officer_id == $_POST['officer_id'][$i] && $field_type == $_POST['field_type'][$i])
						{
							$merge_certificate["company_code"] = $_POST['company_code'];
							$merge_certificate["merge_date"] = $query_certificate_merge[0]["merge_date"];
							//$certificate["transaction_date"] = $_POST['date'];
							$merge_certificate["client_member_share_capital_id"] = $_POST['client_member_share_capital_id'];
							$merge_certificate["officer_id"] = $_POST['officer_id'][$i];
							$merge_certificate["field_type"] = $_POST['field_type'][$i];
							$merge_certificate["transaction_id"] = $query_certificate_merge[0]["transaction_id"];
							$merge_certificate["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
							$merge_certificate["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
							$merge_certificate["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
							$merge_certificate["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);
							$merge_certificate["certificate_no"] = $query_certificate_merge[0]["certificate_no"];

							$query_check_new_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_certificate[0]["certificate_no"]."'");

							if ($query_check_new_certificate_merge->num_rows() > 0) 
							{
								$query_check_new_certificate_merge = $query_check_new_certificate_merge->result_array();

								if($query_check_new_certificate_merge[0]["certificate_no"] == null)
								{
									if($_POST['new_certificate_no'][$i] != null)
									{
										$new_certificate_number = $_POST['new_certificate_no'][$i];
									}
									else
									{
										$new_certificate_number = $_POST['merge_certificate_no'][$i];
									}


									$merge_certificate["new_certificate_no"] = $new_certificate_number;

									$new_cert_num["new_certificate_no"] =  $new_certificate_number;

									$this->db->where(array("client_member_share_capital_id" => $query_check_new_certificate_merge[0]["client_member_share_capital_id"], "new_certificate_no" => $query_check_new_certificate_merge[0]["new_certificate_no"]));
									$this->db->update("certificate_merge",$new_cert_num);

									$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_certificate[0]["certificate_no"]."'");

									if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
									{
										$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

										$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];

										$query_new_number_of_share_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;
										$query_new_amount_share_in_cert_merge = (float)$query_check_cert_num_with_cert_num[0]["amount_share"] - (float)$minus_the_amount_share;
										$query_new_no_of_share_paid_in_cert_merge = (int)$query_check_cert_num_with_cert_num[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
										$query_new_amount_paid_in_cert_merge = (float)$query_check_cert_num_with_cert_num[0]["amount_paid"] - (float)$minus_the_amount_paid;
									

										$cert["certificate_no"] = $new_certificate_number;
										$cert["number_of_share"] = $query_new_number_of_share_in_cert_merge;
										$cert["amount_share"] = $query_new_amount_share_in_cert_merge;
										$cert["no_of_share_paid"] = $query_new_no_of_share_paid_in_cert_merge;
										$cert["amount_paid"] = $query_new_amount_paid_in_cert_merge;

										$this->db->where(array("id" => $query_check_cert_num_with_cert_num[0]["id"]));
										$this->db->update("certificate_merge",$cert);

										$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");

										if ($query_change_first_certificate->num_rows() > 0) 
										{
											$query_change_first_certificate = $query_change_first_certificate->result_array();

											$new_cert_number_of_share = (int)$query_change_first_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
											$new_cert_amount_share = (float)$query_change_first_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
											$new_cert_no_of_share_paid = (int)$query_change_first_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
											$new_cert_amount_paid = (float)$query_change_first_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

											$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
											$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
											$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
											$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

											$this->db->where(array("id" => $query_change_first_certificate[0]["id"]));
											$this->db->update("certificate",$new_certs_number_of_share);
										}

										while($new_cert_no != null)
										{
											$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

											if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
											{
												$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

												$query_another_new_number_of_share_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;
												$query_another_new_amount_share_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_share"] - (float)$minus_the_amount_share;
												$query_another_new_no_of_share_paid_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
												$query_another_new_amount_paid_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_paid"] - (float)$minus_the_amount_paid;


												//$certs["certificate_no"] = $_POST['new_certificate_no'][$i];
												$certs["number_of_share"] = $query_another_new_number_of_share_in_cert_merge;
												$certs["amount_share"] = $query_another_new_amount_share_in_cert_merge;
												$certs["no_of_share_paid"] = $query_another_new_no_of_share_paid_in_cert_merge;
												$certs["amount_paid"] = $query_another_new_amount_paid_in_cert_merge;

												$this->db->where(array("id" => $query_check_another_cert_num_with_cert_num[0]["id"]));
												$this->db->update("certificate_merge",$certs);

												

												$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

												if ($query_change_certificate->num_rows() > 0) 
												{
													$query_change_certificate = $query_change_certificate->result_array();

													$new_cert_number_of_share = (int)$query_change_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
													$new_cert_amount_share = (float)$query_change_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
													$new_cert_no_of_share_paid = (int)$query_change_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
													$new_cert_amount_paid = (float)$query_change_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

													$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
													$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
													$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
													$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

													$this->db->where(array("id" => $query_change_certificate[0]["id"]));
													$this->db->update("certificate",$new_certs_number_of_share);
												}

												$new_cert_no = $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"];
											}
											else
											{
												$new_cert_no = null;
											}

										}

										
									}
									
								}
								else
								{
									$merge_certificate["new_certificate_no"] = $query_certificate_merge[0]["new_certificate_no"];
								}
							}
							else
							{
								$merge_certificate["new_certificate_no"] = $query_certificate_merge[0]["new_certificate_no"];
							}


							$this->db->insert("certificate_merge",$merge_certificate);
							$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));

							$query_recalculate_num_of_share_cert = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where client_member_share_capital_id = '".$query_certificate_merge[0]["client_member_share_capital"]."' AND new_certificate_no = '".$query_certificate_merge[0]["new_certificate_no"]."'");

							$query_recalculate_num_of_share_cert = $query_recalculate_num_of_share_cert->result_array();

							$new_number_of_share_cert["number_of_share"] = $query_recalculate_num_of_share_cert[0]["number_of_share"];
							$new_number_of_share_cert["amount_share"] = $query_recalculate_num_of_share_cert[0]["amount_share"];
							$new_number_of_share_cert["no_of_share_paid"] = $query_recalculate_num_of_share_cert[0]["no_of_share_paid"];
							$new_number_of_share_cert["amount_paid"] = $query_recalculate_num_of_share_cert[0]["amount_paid"];

							$this->db->where(array("client_member_share_capital_id" => $query_certificate_merge[0]["client_member_share_capital_id"], "certificate_no" => $query_certificate_merge[0]["new_certificate_no"]));
							$this->db->update("certificate",$new_number_of_share_cert);
						}
						else
						{
							$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[0]["id"]));
						}
					}
				}
				else if($_POST['merge_status'][$i] == "0")
				{
					$query_previous_cert = $this->db->query("select certificate.*, member_shares.company_code, member_shares.client_member_share_capital_id, member_shares.officer_id, member_shares.field_type, member_shares.transaction_id from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.client_member_share_capital_id='".$_POST['client_member_share_capital_id']."' AND certificate.company_code='".$_POST['company_code']."' AND certificate.officer_id='".$_POST['officer_id'][$i]."' AND certificate.field_type='".$_POST['field_type'][$i]."' AND certificate.new_certificate_no = '".$_POST['previous_merge_cert_num'][$i]."' AND member_shares.cert_status = 2");

					$query_previous_cert = $query_previous_cert->result_array();

					for($t = 0; $t < count($query_previous_cert); $t++)
					{
						//$this->db->set("status", 1);
						$this->db->set("new_certificate_no", $query_previous_cert[$t]["certificate_no"]);
						$this->db->set("status", 1);
						$this->db->where(array("id" => $query_previous_cert[$t]["id"]));
						$this->db->update("certificate");

						$query_check_cert_num_with_cert_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$query_previous_cert[$t]["certificate_no"]."'");

						if ($query_check_cert_num_with_cert_merge->num_rows() > 0) 
						{
							$this->db->set("merge", 1);
						}
						else
						{
							$this->db->set("merge", 0);
						}

						
						$this->db->set("cert_status", 1);
						$this->db->where(array("transaction_id" => $query_previous_cert[$t]["transaction_id"]));
						$this->db->update("member_shares");

						
					}

					$this->db->set("merge", 0);
					$this->db->set("cert_status", 1);
					$this->db->where(array("transaction_id" => $transaction_id));
					$this->db->update("member_shares");

					$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $_POST["client_member_share_capital_id"], "new_certificate_no" => $_POST['previous_merge_cert_num'][$i]));

					$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_certificate[0]["certificate_no"]."'");
					//echo json_encode($query_check_cert_num_with_cert_num->result_array());
					if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
					{
						$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

						$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];						

						$cert["certificate_no"] = $_POST['new_certificate_no'][$i];
						$cert["number_of_share"] = (int)str_replace(',', '', $_POST['number_of_share'][$i]);
						$cert["amount_share"] = (float)str_replace(',', '', $_POST['amount_share'][$i]);
						$cert["no_of_share_paid"] = (int)str_replace(',', '', $_POST['no_of_share_paid'][$i]);
						$cert["amount_paid"] = (float)str_replace(',', '', $_POST['amount_paid'][$i]);

						$this->db->where(array("id" => $query_check_cert_num_with_cert_num[0]["id"]));
						$this->db->update("certificate_merge",$cert);

						$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["new_certificate_no"]."'");


						if ($query_change_first_certificate->num_rows() > 0) 
						{
							$query_change_first_certificate = $query_change_first_certificate->result_array();

							$new_cert_number_of_share = (int)$query_change_first_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
							$new_cert_amount_share = (float)$query_change_first_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
							$new_cert_no_of_share_paid = (int)$query_change_first_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
							$new_cert_amount_paid = (float)$query_change_first_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

							$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
							$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
							$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
							$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;

							$this->db->where(array("id" => $query_change_first_certificate[0]["id"]));
							$this->db->update("certificate",$new_certs_number_of_share);
						}

						while($new_cert_no != null)
						{
							$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

							if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
							{
								$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

								$query_another_new_number_of_share_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["number_of_share"] - (int)$minus_the_number_of_share;
								$query_another_new_amount_share_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_share"] - (float)$minus_the_amount_share;
								$query_another_new_no_of_share_paid_in_cert_merge = (int)$query_check_another_cert_num_with_cert_num[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
								$query_another_new_amount_paid_in_cert_merge = (float)$query_check_another_cert_num_with_cert_num[0]["amount_paid"] - (float)$minus_the_amount_paid;


								//$certs["certificate_no"] = $_POST['new_certificate_no'][$i];
								$certs["number_of_share"] = $query_another_new_number_of_share_in_cert_merge;
								$certs["amount_share"] = $query_another_new_amount_share_in_cert_merge;
								$certs["no_of_share_paid"] = $query_another_new_no_of_share_paid_in_cert_merge;
								$certs["amount_paid"] = $query_another_new_amount_paid_in_cert_merge;

								$this->db->where(array("id" => $query_check_another_cert_num_with_cert_num[0]["id"]));
								$this->db->update("certificate_merge",$certs);

								

								$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where officer_id = '".$officer_id."' AND client_member_share_capital_id = '".$client_member_share_capital_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

								if ($query_change_certificate->num_rows() > 0) 
								{
									$query_change_certificate = $query_change_certificate->result_array();

									$new_cert_number_of_share = (int)$query_change_certificate[0]["number_of_share"] - (int)$minus_the_number_of_share;
									$new_cert_amount_share = (float)$query_change_certificate[0]["amount_share"] - (float)$minus_the_amount_share;
									$new_cert_no_of_share_paid = (int)$query_change_certificate[0]["no_of_share_paid"] - (int)$minus_the_no_of_share_paid;
									$new_cert_amount_paid = (float)$query_change_certificate[0]["amount_paid"] - (float)$minus_the_amount_paid;

									$new_certs_number_of_share["number_of_share"] = $new_cert_number_of_share;
									$new_certs_number_of_share["amount_share"] = $new_cert_amount_share;
									$new_certs_number_of_share["no_of_share_paid"] = $new_cert_no_of_share_paid;
									$new_certs_number_of_share["amount_paid"] = $new_cert_amount_paid;
									//echo json_encode($new_certs_number_of_share);
									$this->db->where(array("id" => $query_change_certificate[0]["id"]));
									$this->db->update("certificate",$new_certs_number_of_share);
								}

								$new_cert_no = $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"];
							}
							else
							{
								$new_cert_no = null;
							}

						}
					}

				}

				$query_active_certificate = $this->db->query("select certificate.id, certificate.certificate_no from certificate left join member_shares on certificate.company_code = member_shares.company_code and certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id where certificate.officer_id = '".$officer_id."' AND certificate.company_code = '".$company_code."' AND certificate.client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate.field_type = '".$field_type."' AND certificate.transaction_id = '".$previous_member_share_info[0]["transaction_id"]."' AND member_shares.cert_status = 1");

				$query_active_certificate = $query_active_certificate->result_array();

				//echo json_encode($query_active_certificate);

				if($new_certificate_number == null)
				{
					$query_new_certificate_no = $this->db->query("select new_certificate_no from certificate_merge where new_certificate_no = '".$query_active_certificate[0]["certificate_no"]."' and transaction_id = '".$previous_member_share_info[0]["transaction_id"]."'");

					$query_new_certificate_no = $query_new_certificate_no->result_array();

					$new_certificate_number = $query_new_certificate_no[0]["new_certificate_no"];
				}
				//echo json_encode($new_certificate_number);
				$query_recalculate_num_of_share = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from certificate_merge where new_certificate_no = '".$new_certificate_number."' AND client_member_share_capital_id = '".$_POST['client_member_share_capital_id']."'");

				$query_recalculate_num_of_share = $query_recalculate_num_of_share->result_array();

				$new_number_of_share["number_of_share"] = $query_recalculate_num_of_share[0]["number_of_share"];
				$new_number_of_share["amount_share"] = $query_recalculate_num_of_share[0]["amount_share"];
				$new_number_of_share["no_of_share_paid"] = $query_recalculate_num_of_share[0]["no_of_share_paid"];
				$new_number_of_share["amount_paid"] = $query_recalculate_num_of_share[0]["amount_paid"];

				$this->db->where(array("client_member_share_capital_id" => $_POST['client_member_share_capital_id'], "certificate_no" => $new_certificate_number));
				$this->db->update("certificate",$new_number_of_share);

				
			}
		}

		

		$get_client_information = $this->db->query("select client.*, company_type.company_type as company_type_name from client left join company_type on client.company_type = company_type.id where company_code='".$_POST['company_code']."'");

		$get_client_information = $get_client_information->result_array();

		//if ($previous_member_shares_query->num_rows())
		//{
			/*$this->change_allotment_info($_POST['client_member_share_capital_id'], $previous_member_shares_query_data[0]["transaction_date"], $get_client_information[0]["firm_id"], $_POST['company_code'], $previous_member_share_result, $get_client_information[0]["id"]);*/
			$this->change_member_document_info("add_allotment_of_share", $_POST['client_member_share_capital_id'], $previous_member_shares_query_data[0]["transaction_date"], $get_client_information[0]["firm_id"], $_POST['company_code'], $previous_member_share_result, $get_client_information[0]["id"]);
		//}
		//else
		//{
			//$this->create_document("add_allotment_of_share", $_POST['company_code'], null, null, null, null, null, $new_allotment_id, $_POST['client_member_share_capital_id']);
			//}

		//echo json_encode($previous_member_share_result);
		/*if(count($previous_allotment_id) != 0)
		{
			$this->db->delete('pending_documents', array("allotment_id" => json_encode($previous_allotment_id)));
		}*/
		$this->create_invoice("share_allotment", $_POST["company_code"]);
		
		redirect("masterclient/view_allotment/".$_POST['company_code']."");
		/*redirect("masterclient/edit/".$this->session->userdata('client_id')."");*/
	}

	/*public function change_allotment_info($client_member_share_capital_id, $old_allotment_date_result, $firm_id, $company_code, $previous_allotment_result = null, $client_id)
	{

		$document_master_result = $this->db->query("select * from document_master where triggered_by = 23 AND firm_id='".$firm_id."'");

		if ($document_master_result->num_rows() > 0) 
		{
			$document_master_result = $document_master_result->result_array();

			for($r = 0; $r < count($document_master_result); $r++)
			{
				$str = $document_master_result[$r]["document_content"];

				if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
                {
                	$change_allotment_member_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

                	$change_allotment_member_result = $change_allotment_member_result->result_array();

	                	//echo json_encode($director_name_result);
                	if(strpos($str, '<p>- <span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
                	{
                		preg_match_all('~\<p>- <span class="myclass mceNonEditable">{{Allotment - members}}</span>(.*?)\<\/p\>~',$str,$m);
                	}
                	elseif(strpos($str, '<p>-<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
                	{
                		preg_match_all('~\<p>-<span class="myclass mceNonEditable">{{Allotment - members}}</span>(.*?)\<\/p\>~',$str,$m);
                	}
                	elseif(strpos($str, '<p><span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
                	{
                		preg_match_all('~\<p><span class="myclass mceNonEditable">{{Allotment - members}}</span>(.*?)\<\/p\>~',$str,$m);
                	}

                	$allotment_member = "";

                	$latest_allotment_id = array();
                	$num_of_allotment_member = (int)(count($change_allotment_member_result)) - 1;
                	for($g = 0; $g < count($change_allotment_member_result); $g++)
                	{
                		$allotment_string = $m[0][0];
                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - members}}</span>') !== false)
	                	{
	                		if($change_allotment_member_result[$g]["name"] != '')
                			{
                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', '<strong>'.$change_allotment_member_result[$g]["name"].'</strong>', $allotment_string);
                				
                			}
                			elseif($change_allotment_member_result[$g]["company_name"] != '')
                			{
                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - members}}</span>', '<strong>'.$change_allotment_member_result[$g]["company_name"].'</strong>', $allotment_string);
                			}
                		}

                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>') !== false)
                		{
                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares}}</span>', '<strong>'.$change_allotment_member_result[$g]["number_of_share"].'</strong>', $allotment_string);
                		}

                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>') !== false)
                		{
                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares}}</span>', '<strong>'.$change_allotment_member_result[$g]["amount_share"].'</strong>', $allotment_string);
                		}

                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>') !== false)
                		{
                			if($change_allotment_member_result[$g]["sharetype_id"] == '1')
                			{
                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', '<strong>'.$change_allotment_member_result[$g]["sharetype_name"].'</strong>', $allotment_string);

                			}
                			elseif($change_allotment_member_result[$g]["sharetype_id"] == '2')
                			{
                				$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares}}</span>', '<strong>'.$change_allotment_member_result[$g]["other_class"].'</strong>', $allotment_string);
                			}
                		}

                		if(strpos($allotment_string, '<span class="myclass mceNonEditable">{{Allotment - currency}}</span>') !== false)
                		{
                			$allotment_string = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency}}</span>', '<strong>'.$change_allotment_member_result[$g]["currency_name"].'</strong>', $allotment_string);
                		}

                		$allotment_member = $allotment_member.$allotment_string;
                		array_push($latest_allotment_id, (int)$change_allotment_member_result[$g]["id"]);
                	}
                	$data_pending_document['allotment_id']=json_encode($latest_allotment_id);

                	$str = str_replace($m[0][0], $allotment_member, $str);
                	
                }

                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - number of shares all}}</span>') !== false)
	                {
	                	$change_allotment_total_number_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.number_of_share) as total_number_of_share from member_shares where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                	$change_allotment_number_of_share_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                	$change_allotment_total_number_of_share_all_result = $change_allotment_total_number_of_share_all_result->result_array();
	                	$change_allotment_number_of_share_all_result = $change_allotment_number_of_share_all_result->result_array();

	                	//echo json_encode($director_name_result);

	                	$change_allotment_number_of_share_all = "";

	                	$latest_allotment_id = array();
	                	$num_of_allotment_number_of_share_all = (int)(count($change_allotment_number_of_share_all_result)) - 1;

	                	for($g = 0; $g < count($change_allotment_number_of_share_all_result); $g++)
	                	{
	                		
	                		array_push($latest_allotment_id, (int)$change_allotment_number_of_share_all_result[$g]["id"]);
	                	}

	                	$change_allotment_number_of_share_all = $change_allotment_number_of_share_all.'<strong>'.$change_allotment_total_number_of_share_all_result[0]["total_number_of_share"].'</strong>';

	                	$data['allotment_id']=json_encode($latest_allotment_id);

	                	$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - number of shares all}}</span>', $change_allotment_number_of_share_all, $str);
	                
	                }

	                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - amount of shares all}}</span>') !== false)
	                {
	                	$change_allotment_total_amount_of_share_all_result = $this->db->query("select member_shares.*, sum(member_shares.amount_share) as total_number_of_share from member_shares where company_code='".$company_code." AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                	$change_allotment_amount_of_share_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type = 'Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                	//echo json_encode($previous_director_name_appointment_result);
	                	$change_allotment_total_amount_of_share_all_result = $change_allotment_total_amount_of_share_all_result->result_array();
	                	$change_allotment_amount_of_share_all_result = $change_allotment_amount_of_share_all_result->result_array();

	                	//echo json_encode($director_name_result);

	                	$allotment_amount_of_share_all = "";

	                	$latest_allotment_id = array();
	                	$num_of_allotment_amount_of_share_all = (int)(count($change_allotment_amount_of_share_all_result)) - 1;

	                	for($g = 0; $g < count($change_allotment_amount_of_share_all_result); $g++)
	                	{
	                		
	                		array_push($latest_allotment_id, (int)$change_allotment_amount_of_share_all_result[$g]["id"]);
	                	}

	                	$allotment_amount_of_share_all = $allotment_amount_of_share_all.'<strong>'.$change_allotment_total_amount_of_share_all_result[0]["total_number_of_share"].'</strong>';

	                	$data['allotment_id']=json_encode($latest_allotment_id);

	                	$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - amount of shares all}}</span>', $allotment_amount_of_share_all, $str);

	                
	                }

	                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>') !== false)
	                {
	                	$change_allotment_type_of_share_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                	//echo json_encode($previous_director_name_appointment_result);
	                	$change_allotment_type_of_share_all_result = $change_allotment_type_of_share_all_result->result_array();

	                	//echo json_encode($director_name_result);

	                	$change_allotment_type_of_share_all = "";

	                	$latest_allotment_id = array();
	                	$num_of_allotment_type_of_share_all = (int)(count($change_allotment_type_of_share_all_result)) - 1;

	                	for($g = 0; $g < count($change_allotment_type_of_share_all_result); $g++)
	                	{
	                		if($g == 0)
	                		{
	                			if($change_allotment_type_of_share_all_result[$g]["sharetype_id"] == '1')
	                			{
	                				$change_allotment_type_of_share_all = $change_allotment_type_of_share_all.'<strong>'.$change_allotment_type_of_share_all_result[$g]["sharetype_name"].'</strong>';
	                			}
	                			elseif($change_allotment_type_of_share_all_result[$g]["sharetype_id"] == '2')
	                			{
	                				$change_allotment_type_of_share_all = $change_allotment_type_of_share_all.'<strong>'.$change_allotment_type_of_share_all_result[$g]["other_class"].'</strong>';
	                			}
	                			

	                		}
	                		elseif($g == (int)$num_of_allotment_type_of_share_all)
	                		{
	                			if($change_allotment_type_of_share_all_result[$g]["sharetype_id"] == '1')
	                			{
	                				$change_allotment_type_of_share_all = $change_allotment_type_of_share_all.' and <strong>'.$change_allotment_type_of_share_all_result[$g]["sharetype_name"].'</strong>';
	                			}
	                			elseif($change_allotment_type_of_share_all_result[$g]["sharetype_id"] == '2')
	                			{
	                				$change_allotment_type_of_share_all = $change_allotment_type_of_share_all.' and <strong>'.$change_allotment_type_of_share_all_result[$g]["other_class"].'</strong>';
	                			}

	                			
	                		}
	                		else
	                		{
	                			if($change_allotment_type_of_share_all_result[$g]["sharetype_id"] == '1')
	                			{
	                				$change_allotment_type_of_share_all = $change_allotment_type_of_share_all.', <strong>'.$change_allotment_type_of_share_all_result[$g]["sharetype_name"].'</strong>';
	                			}
	                			elseif($change_allotment_type_of_share_all_result[$g]["sharetype_id"] == '2')
	                			{
	                				$change_allotment_type_of_share_all = $change_allotment_type_of_share_all.', <strong>'.$change_allotment_type_of_share_all_result[$g]["other_class"].'</strong>';
	                			}
	                			
	                			
	                		}
	                		
	                		array_push($latest_allotment_id, (int)$change_allotment_type_of_share_all_result[$g]["id"]);
	                	}

	                	$data['allotment_id']=json_encode($latest_allotment_id);

	                	$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - type of shares all}}</span>', $change_allotment_type_of_share_all, $str);
	                }

	                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - currency all}}</span>') !== false)
	                {
	                	$change_allotment_currency_all_result = $this->db->query("select member_shares.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, client_member_share_capital.other_class, sharetype.id as sharetype_id, sharetype.sharetype as sharetype_name, currency.currency as currency_name from member_shares left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital on client_member_share_capital.id = member_shares.client_member_share_capital_id left join sharetype on sharetype.id = client_member_share_capital.class_id left join currency on currency.id = client_member_share_capital.currency_id where company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");

	                	//echo json_encode($previous_director_name_appointment_result);
	                	$change_allotment_currency_all_result = $change_allotment_currency_all_result->result_array();

	                	//echo json_encode($director_name_result);

	                	$change_allotment_currency_all = "";

	                	$latest_allotment_id = array();
	                	$num_of_allotment_currency_all = (int)(count($change_allotment_currency_all_result)) - 1;

	                	for($g = 0; $g < count($change_allotment_currency_all_result); $g++)
	                	{
	                		if($g == 0)
	                		{
	                			
	                			$change_allotment_currency_all = $change_allotment_currency_all.'<strong>'.$change_allotment_currency_all_result[$g]["currency_name"].'</strong>';
	                		}
	                		elseif($g == (int)$num_of_allotment_currency_all)
	                		{
	                			$change_allotment_currency_all = $change_allotment_currency_all.' and <strong>'.$change_allotment_currency_all_result[$g]["currency_name"].'</strong>';
	                			
	                		}
	                		else
	                		{
	                			$change_allotment_currency_all = $change_allotment_currency_all.', <strong>'.$change_allotment_currency_all_result[$g]["currency_name"].'</strong>';
	                			
	                		}
	                		
	                		array_push($latest_allotment_id, (int)$change_allotment_currency_all_result[$g]["id"]);
	                	}

	                	$data['allotment_id']=json_encode($latest_allotment_id);

	                	$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - currency all}}</span>', $change_allotment_currency_all, $str);

	                }

	                if(strpos($str, '<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>') !== false)
	                {
	                	$change_allotment_certificate_result = $this->db->query("select member_shares.*, member_shares.number_of_share as number_of_share, member_shares.amount_share as amount_share, member_shares.no_of_share_paid as no_of_share_paid, member_shares.amount_paid as amount_paid, member_shares.transaction_type, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency, certificate.certificate_no, certificate.status from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code='".$company_code."' AND member_shares.client_member_share_capital_id='".$client_member_share_capital_id."' AND member_shares.transaction_type='Allotment' AND STR_TO_DATE(member_shares.transaction_date,'%d/%m/%Y') = STR_TO_DATE('".$old_allotment_date_result."','%d/%m/%Y') ORDER BY member_shares.id");


	                	//echo json_encode($previous_director_name_appointment_result);
	                	$change_allotment_certificate_result = $change_allotment_certificate_result->result_array();

	                	//echo json_encode($director_name_result);

	                	$change_allotment_certificate = "";

	                	$latest_allotment_id = array();
	                	$num_of_allotment_certificate = (int)(count($change_allotment_certificate_result)) - 1;

	                	for($g = 0; $g < count($change_allotment_certificate_result); $g++)
	                	{
	                		if($g == 0)
	                		{
	                			
	                			$change_allotment_certificate = $change_allotment_certificate.'<strong>'.$change_allotment_certificate_result[$g]["certificate_no"].'</strong>';
	                		}
	                		elseif($g == (int)$num_of_allotment_certificate)
	                		{
	                			$change_allotment_certificate = $change_allotment_certificate.' and <strong>'.$change_allotment_certificate_result[$g]["certificate_no"].'</strong>';
	                			
	                		}
	                		else
	                		{
	                			$change_allotment_certificate = $change_allotment_certificate.', <strong>'.$change_allotment_certificate_result[$g]["certificate_no"].'</strong>';
	                			
	                		}
	                		
	                		array_push($latest_allotment_id, (int)$change_allotment_certificate_result[$g]["id"]);
	                	}

	                	$data['allotment_id']=json_encode($latest_allotment_id);

	                	$str = str_replace('<span class="myclass mceNonEditable">{{Allotment - certificate}}</span>', $change_allotment_certificate, $str);

	                }
                if(count($previous_allotment_result) != 0 && $previous_allotment_result != null)
	        	{
	        		$allotment_id_data = array();
	        		for($f = 0; $f < count($previous_allotment_result); $f++)
	            	{
	            		array_push($allotment_id_data, (int)$previous_allotment_result[$f]["id"]);
	            	}
	        	}
	        	
	        	//echo json_encode($allotment_id_data);
	            $data_pending_document['content'] = $str;

	        	if(count($latest_allotment_id) == 0)
	        	{
	        		$this->db->where('triggered_by', $document_master_result[$r]["triggered_by"]);
	        		$this->db->where('client_id', $client_id);
	        		$this->db->where('received_on', "");
	        		$this->db->where('allotment_id', json_encode($allotment_id_data));
	        		$this->db->where('transaction_date', $old_allotment_date_result);
					$this->db->delete('pending_documents');
	        	}
	        	else
	        	{

	        		$this->db->update("pending_documents",$data_pending_document,array("triggered_by" => $document_master_result[$r]["triggered_by"], "client_id" => $client_id, "received_on" => "", "allotment_id" => json_encode($allotment_id_data), "transaction_date" => $old_allotment_date_result));  
	        	}
            }

            
        }
    }*/

	public function check_share($company_code, $client_member_share_capital_id, $officer_id, $field_type, $certificate_no, $transaction_type, $each_transfer = null)
	{
		$bc = array(array('link' => '#', 'page' => "Member"));
        $meta = array('page_title' => "Member", 'bc' => $bc, 'page_name' =>  "Member");

		$query = $this->db->query('select member_shares.*, member_shares.number_of_share as number_of_share, member_shares.amount_share as amount_share, member_shares.no_of_share_paid as no_of_share_paid, member_shares.amount_paid as amount_paid, member_shares.transaction_type, DATE_FORMAT(STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y"), "%d/%m/%Y") as transaction_date, STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y") as trans_date, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency, certificate.certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$company_code.'" AND member_shares.client_member_share_capital_id="'.$client_member_share_capital_id.'" AND member_shares.officer_id="'.$officer_id.'" AND member_shares.field_type="'.$field_type.'" ORDER BY STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y")');

		if ($query->num_rows() > 0) {
            foreach (($query->result()) as $row) {
                $data[] = $row;
            }
            $this->data['member'] = $data;
            //return $this->data;
        }
        $this->data['certificate_no'] = $certificate_no;
        $this->data['company_code'] = $company_code;
        $this->data['client_member_share_capital_id'] = $client_member_share_capital_id;
        $this->data['officer_id'] = $officer_id;
        $this->data['field_type'] = $field_type;
        $this->data['transaction_type'] = $transaction_type;
        $this->data['each_transfer'] = $each_transfer;

        $this->page_construct('client/check_share.php', $meta, $this->data);
		//echo json_encode($company_code);
	}

	public function check_transfer_share()
	{
		$bc = array(array('link' => '#', 'page' => "Member"));
        $meta = array('page_title' => "Member", 'bc' => $bc, 'page_name' =>  "Member");

		$this->session->set_userdata(array(
			'transfer_cert_data'  =>  array(),
            'transfer_cert_info'  =>  array(),
            'transfer_cert'  =>  array(),
        ));

		$cert_info = $_POST["cert_info"];
		//echo json_encode($cert_info);
		for($t = 0; $t < count($cert_info); $t++)
		{
			$query = $this->db->query('select member_shares.*, member_shares.number_of_share as number_of_share, member_shares.amount_share as amount_share, member_shares.no_of_share_paid as no_of_share_paid, member_shares.amount_paid as amount_paid, member_shares.transaction_type, DATE_FORMAT(STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y"), "%d/%m/%Y") as transaction_date, STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y") as trans_date, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency, certificate.certificate_no from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id where member_shares.company_code="'.$cert_info[$t]["company_code"].'" AND member_shares.client_member_share_capital_id="'.$cert_info[$t]["client_member_share_capital_id"].'" AND member_shares.officer_id="'.$cert_info[$t]["officer_id"].'" AND member_shares.field_type="'.$cert_info[$t]["field_type"].'" ORDER BY STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y")');

			if ($query->num_rows() > 0) {
	            foreach (($query->result()) as $row) {
	                $data[] = $row;
	            }
	            //$this->data['member'] = $data;
	            //return $this->data;
	        }

	        $certificate[] = $cert_info[$t]["certificate_no"];
		}


		$this->session->set_userdata(array(
			'transfer_cert_data'  =>  $cert_info,
            'transfer_cert_info'  =>  $data,
            'transfer_cert'  =>  $certificate,
        ));
		

		//$this->page_construct('client/check_share.php', $meta, $this->data);
	}

	public function open_transfer_share()
	{
		$bc = array(array('link' => '#', 'page' => "Member"));
        $meta = array('page_title' => "Member", 'bc' => $bc, 'page_name' =>  "Member");

        $this->data['cert_data'] = $this->session->userdata("transfer_cert_data");
		$this->data['member'] = $this->session->userdata("transfer_cert_info");
		$this->data['certificate_no'] = $this->session->userdata("transfer_cert");

		$this->page_construct('client/check_transfer_share.php', $meta, $this->data);
	}


	public function delete_subsequent_allotment()
	{
		$certificate_no = $_POST["certificate_no"];
		$company_code = $_POST["company_code"];
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$officer_id = $_POST["officer_id"];
		$field_type = $_POST["field_type"];
		$transaction_type = $_POST["transaction_type"];
		$each_transfer = $_POST["each_transfer"];

		if($transaction_type == "Transfer" || $transaction_type == "Buyback")
		{
			$query_check_previous_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$certificate_no."'");

			if ($query_check_previous_cert_num_with_cert_num->num_rows() > 0) 
			{
				$query_check_previous_cert_num_with_cert_num = $query_check_previous_cert_num_with_cert_num->result_array();

				if($query_check_previous_cert_num_with_cert_num[0]["certificate_no"] != null)
				{
					$this->db->set("status", 1);
					$this->db->where(array("certificate_no" => $query_check_previous_cert_num_with_cert_num[0]["certificate_no"]));
					$this->db->update("certificate");
				}

				$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $query_check_previous_cert_num_with_cert_num[0]["client_member_share_capital_id"], "new_certificate_no" => $query_check_previous_cert_num_with_cert_num[0]["new_certificate_no"]));
			}
		}

		$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$certificate_no."'");
		//echo json_encode($query_check_cert_num_with_cert_num->result_array());
		if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
		{
			$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

			$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];	

			if($each_transfer == null)
			{
				$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["certificate_no"]."'");

				$query_change_first_certificate = $query_change_first_certificate->result_array();

				//$this->db->delete('certificate', array("transaction_id" => $query_change_first_certificate[0]['transaction_id']));

				//$this->db->delete('member_shares', array("transaction_id" => $query_change_first_certificate[0]['transaction_id']));

				 $this->db->delete('certificate', array("company_code" => $company_code, "client_member_share_capital_id" => $query_check_cert_num_with_cert_num[0]["client_member_share_capital_id"], "certificate_no" => $query_check_cert_num_with_cert_num[0]["certificate_no"]));

				 $this->db->delete('member_shares', array("client_member_share_capital_id" => $client_member_share_capital_id, "officer_id" => $officer_id, "field_type" => $field_type, "transaction_id" => $query_change_first_certificate[0]['transaction_id']));
			}
			 if($transaction_type != "Transfer")
			 {
			 	$this->db->query("
			 						DELETE t1, t2
			 						FROM member_shares t1 JOIN certificate t2
			 						ON t1.transaction_id = t2.transaction_id
			 						WHERE t1.transaction_type = 'Transfer' AND t1.transaction_id = '".$query_change_first_certificate[0]['transaction_id']."'");
			 }

			while($new_cert_no != null)
			{
				$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$new_cert_no."'");

				if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
				{
					$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

					$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $query_check_another_cert_num_with_cert_num[0]["client_member_share_capital_id"], "new_certificate_no" => $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]));

					$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where officer_id = '".$officer_id."' AND client_member_share_capital_id = '".$client_member_share_capital_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

					$query_change_certificate = $query_change_certificate->result_array();

					
					 $this->db->delete('certificate', array("client_member_share_capital_id" => $query_check_another_cert_num_with_cert_num[0]["client_member_share_capital_id"], "certificate_no" => $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]));

					 $this->db->delete('member_shares', array("company_code" => $company_code, "client_member_share_capital_id" => $client_member_share_capital_id, "officer_id" => $officer_id, "field_type" => $field_type, "transaction_id" => $query_change_certificate[0]['transaction_id']));

					// $this->db->delete('certificate', array("transaction_id" => $query_change_certificate[0]['transaction_id']));

					// $this->db->delete('member_shares', array("transaction_id" => $query_change_certificate[0]['transaction_id']));
					if($transaction_type != "Transfer")
			 		{
						$this->db->query("
							DELETE t1, t2
							FROM member_shares t1 JOIN certificate t2
							ON t1.transaction_id = t2.transaction_id
							WHERE t1.transaction_type = 'Transfer' AND t1.transaction_id = '".$query_change_certificate[0]['transaction_id']."'");
					}

					$next_cert = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

					$next_cert = $next_cert->result_array();
					
					$new_cert_no = $next_cert[0]["new_certificate_no"];
				}
				else
				{
					$new_cert_no = null;
				}

			}
		}

		echo json_encode(array('message' => 'Information Updated', 'title' => 'Updated'));
	}

	public function check_negative_number_of_share()
	{
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];
		$number_of_share = $_POST["number_of_share"];
		$certificate_no = $_POST["certificate_no"];
		$company_code = $_POST["company_code"];
		$officer_id = $_POST["to_officer_id"];
		$field_type = $_POST["to_field_type"];
		$id = $_POST["id"];


		$query_check_cert_num_with_cert_num = $this->db->query("select sum(number_of_share) as number_of_share, sum(amount_share) as amount_share, sum(no_of_share_paid) as no_of_share_paid, sum(amount_paid) as amount_paid from member_shares where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND (
			   select STR_TO_DATE(member_shares.transaction_date, '%d/%m/%Y')
			   from member_shares 
			   where id= '".$id."'
			 ) < STR_TO_DATE(member_shares.transaction_date, '%d/%m/%Y') GROUP BY member_shares.field_type, member_shares.officer_id");


		if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
		{
			$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

			$total_no_of_share = (int)$query_check_cert_num_with_cert_num[0]["number_of_share"] + (int)$number_of_share;
		}
		else
		{
			$total_no_of_share = 0 + (int)$number_of_share;
		}

		if( 0 > $total_no_of_share)
		{
			echo json_encode(array('popup' => 1));
		}
		else
		{
			echo json_encode(array('popup' => 2));
		}
		//echo json_encode($query_check_cert_num_with_cert_num->result_array());
		


	}

	public function delete_subsequent_transfer()
	{
		$cert_data = $_POST["cert_data"];

		for($g = 0; $g < count($cert_data); $g++)
		{
			$certificate_no = $cert_data[$g]["certificate_no"];
			$company_code = $cert_data[$g]["company_code"];
			$client_member_share_capital_id = $cert_data[$g]["client_member_share_capital_id"];
			$officer_id = $cert_data[$g]["officer_id"];
			$field_type = $cert_data[$g]["field_type"];

			$query_check_previous_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$certificate_no."' order by id");

			if ($query_check_previous_cert_num_with_cert_num->num_rows() > 0) 
			{
				$query_check_previous_cert_num_with_cert_num = $query_check_previous_cert_num_with_cert_num->result_array();

				if($query_check_previous_cert_num_with_cert_num[0]["certificate_no"] != null)
				{
					$this->db->set("status", 1);
					$this->db->where(array("certificate_no" => $query_check_previous_cert_num_with_cert_num[0]["certificate_no"], "client_member_share_capital_id" => $query_check_previous_cert_num_with_cert_num[0]["client_member_share_capital_id"]));
					$this->db->update("certificate");
				}

				$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $query_check_previous_cert_num_with_cert_num[0]["client_member_share_capital_id"], "new_certificate_no" => $query_check_previous_cert_num_with_cert_num[0]["new_certificate_no"]));
			}

			$query_check_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$certificate_no."'");
			//echo json_encode($query_check_cert_num_with_cert_num->result_array());
			if ($query_check_cert_num_with_cert_num->num_rows() > 0) 
			{
				$query_check_cert_num_with_cert_num = $query_check_cert_num_with_cert_num->result_array();

				$new_cert_no = $query_check_cert_num_with_cert_num[0]["new_certificate_no"];	

				$query_change_first_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_cert_num_with_cert_num[0]["certificate_no"]."'");

				$query_change_first_certificate = $query_change_first_certificate->result_array();

				//$this->db->delete('certificate', array("transaction_id" => $query_change_first_certificate[0]['transaction_id']));

				//$this->db->delete('member_shares', array("transaction_id" => $query_change_first_certificate[0]['transaction_id']));

				 $this->db->delete('certificate', array("company_code" => $company_code, "client_member_share_capital_id" => $query_check_cert_num_with_cert_num[0]["client_member_share_capital_id"], "certificate_no" => $query_check_cert_num_with_cert_num[0]["certificate_no"]));

				 $this->db->delete('member_shares', array("client_member_share_capital_id" => $client_member_share_capital_id, "officer_id" => $officer_id, "field_type" => $field_type, "transaction_id" => $query_change_first_certificate[0]['transaction_id']));

				 $this->db->query("
							DELETE t1, t2
							FROM member_shares t1 JOIN certificate t2
							ON t1.transaction_id = t2.transaction_id
							WHERE t1.transaction_type = 'Transfer' AND t1.transaction_id = '".$query_change_first_certificate[0]['transaction_id']."'");

				while($new_cert_no != null)
				{
					$query_check_another_cert_num_with_cert_num = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND new_certificate_no = '".$new_cert_no."'");

					if ($query_check_another_cert_num_with_cert_num->num_rows() > 0) 
					{
						$query_check_another_cert_num_with_cert_num = $query_check_another_cert_num_with_cert_num->result_array();

						$this->db->delete('certificate_merge', array("client_member_share_capital_id" => $query_check_another_cert_num_with_cert_num[0]["client_member_share_capital_id"], "new_certificate_no" => $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]));

						$query_change_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, status from certificate where officer_id = '".$officer_id."' AND client_member_share_capital_id = '".$client_member_share_capital_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]."'");

						$query_change_certificate = $query_change_certificate->result_array();

						
						 $this->db->delete('certificate', array("client_member_share_capital_id" => $query_check_another_cert_num_with_cert_num[0]["client_member_share_capital_id"], "certificate_no" => $query_check_another_cert_num_with_cert_num[0]["new_certificate_no"]));

						 $this->db->delete('member_shares', array("company_code" => $company_code, "client_member_share_capital_id" => $client_member_share_capital_id, "officer_id" => $officer_id, "field_type" => $field_type, "transaction_id" => $query_change_certificate[0]['transaction_id']));

						// $this->db->delete('certificate', array("transaction_id" => $query_change_certificate[0]['transaction_id']));

						// $this->db->delete('member_shares', array("transaction_id" => $query_change_certificate[0]['transaction_id']));

						$this->db->query("
							DELETE t1, t2
							FROM member_shares t1 JOIN certificate t2
							ON t1.transaction_id = t2.transaction_id
							WHERE t1.transaction_type = 'Transfer' AND t1.transaction_id = '".$query_change_certificate[0]['transaction_id']."'");

						$next_cert = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, amount_share, no_of_share_paid, amount_paid, certificate_no, new_certificate_no from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND field_type = '".$field_type."' AND certificate_no = '".$new_cert_no."'");

						$next_cert = $next_cert->result_array();
						
						$new_cert_no = $next_cert[0]["new_certificate_no"];
					}
					else
					{
						$new_cert_no = null;
					}

				}
			}


		}

		echo json_encode(array('message' => 'Information Updated', 'title' => 'Updated'));
	}

	public function delete_allot_follow_by_cert()
	{
		$certificate_no = $_POST["certificate_no"];
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];

		//echo json_encode($_POST);

		$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

		if ($query_certificate_merge->num_rows() > 0) 
		{
			$query_certificate_merge = $query_certificate_merge->result_array();

			echo json_encode(array('status' => '1', 'client_member_share_capital_id' => $query_certificate_merge[0]["client_member_share_capital_id"], 'officer_id' => $query_certificate_merge[0]["officer_id"], 'field_type' => $query_certificate_merge[0]["field_type"])); //ask_confirm_delete

			/*for($t = 0; $t < count($query_certificate_merge); $t++)
			{
				if($t == 0)
				{
					$this->db->set("status", 1);
					$this->db->where(array("certificate_no" => $query_certificate_merge[$t]["certificate_no"]));
					$this->db->update("certificate");
				}

				$this->db->delete('member_shares', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
				$this->db->delete('certificate', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
				$this->db->delete('certificate_merge', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
			}*/
		}
		else
		{
			$query_certificate = $this->db->query("select certificate.*, member_shares.id as member_shares_id from certificate left join member_shares on member_shares.transaction_id = certificate.transaction_id where certificate.client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate.certificate_no = '".$certificate_no."' order by id");

			if ($query_certificate->num_rows() > 0) 
			{
				$query_certificate = $query_certificate->result_array();

				$member_shares_id = array();
				for($t = 0; $t < count($query_certificate); $t++)
				{
					array_push($member_shares_id, (int)$query_certificate[$t]["member_shares_id"]);
				}
				//echo json_encode($member_shares_id);
				$this->db->delete('member_shares', array("transaction_id" => $query_certificate[0]['transaction_id']));
				$this->db->delete('certificate', array("transaction_id" => $query_certificate[0]['transaction_id']));
				$this->db->delete('pending_documents', array("allotment_id" => json_encode($member_shares_id)));
			}

			echo json_encode(array('status' => '2', 'message' => 'Information Updated', 'title' => 'Updated'));
		}

		//echo json_encode(array('message' => 'Information Updated', 'title' => 'Updated'));
	}

	public function delete_buyback_follow_by_cert()
	{
		$transaction_id = $_POST["transaction_id"];
		$certificate_no = $_POST["certificate_no"];
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];

		$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

		if ($query_certificate_merge->num_rows() > 0) 
		{
			$query_certificate_merge = $query_certificate_merge->result_array();

			echo json_encode(array('status' => '1', 'client_member_share_capital_id' => $query_certificate_merge[0]["client_member_share_capital_id"], 'officer_id' => $query_certificate_merge[0]["officer_id"], 'field_type' => $query_certificate_merge[0]["field_type"]));
		}
		else
		{

			$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND transaction_id = '".$transaction_id."'");

			//echo json_encode($query_certificate_merge->result_array());
			if ($query_certificate_merge->num_rows() > 0) 
			{
				$query_certificate_merge = $query_certificate_merge->result_array();
				//echo json_encode($query_certificate_merge);

				for($t = 0; $t < count($query_certificate_merge); $t++)
				{
					if($query_certificate_merge[$t]["certificate_no"] != null)
					{
						$this->db->set("status", 1);
						$this->db->where(array("certificate_no" => $query_certificate_merge[$t]["certificate_no"], "client_member_share_capital_id" => $query_certificate_merge[$t]["client_member_share_capital_id"]));
						$this->db->update("certificate");
					}

					$this->db->delete('member_shares', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
					$this->db->delete('certificate', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
					$this->db->delete('certificate_merge', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
				}
			}
			else
			{
				$query_certificate = $this->db->query("select * from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

				if ($query_certificate->num_rows() > 0) 
				{
					$query_certificate = $query_certificate->result_array();

					$this->db->delete('member_shares', array("transaction_id" => $query_certificate[0]['transaction_id']));
					$this->db->delete('certificate', array("transaction_id" => $query_certificate[0]['transaction_id']));
				}
			}

			echo json_encode(array('status' => '2', 'message' => 'Information Updated', 'title' => 'Updated'));
		}
	}

	public function delete_transfer_follow_by_cert()
	{
		$transaction_id = $_POST["transaction_id"];
		$client_member_share_capital_id = $_POST["client_member_share_capital_id"];

		$query_certificate = $this->db->query("select * from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND transaction_id = '".$transaction_id."'");

		if ($query_certificate->num_rows() > 0) 
		{
			$query_certificate = $query_certificate->result_array();

			$cert_array = array();
			for($r = 0; $r < count($query_certificate); $r++)
			{
				
				array_push($cert_array,$query_certificate[$r]["certificate_no"]);
			}

			// create sql part for IN condition by imploding comma after each id
			//$in = '[' . implode(',', $cert_array) .']';
			//for($r = 0; $r < count($query_certificate); $r++)
			//{
				/*$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no IN ".$cert_array."");*/
				$this->db->where('client_member_share_capital_id', $client_member_share_capital_id);
				$this->db->where_in('certificate_no', $cert_array);
				$query_certificate_merge = $this->db->get('certificate_merge');

				if ($query_certificate_merge->num_rows() > 0) 
				{
					$query_certificate_merge = $query_certificate_merge->result_array();

					// echo json_encode(array('status' => '1', 'client_member_share_capital_id' => $query_certificate_merge[0]["client_member_share_capital_id"], 'officer_id' => $query_certificate_merge[0]["officer_id"], 'field_type' => $query_certificate_merge[0]["field_type"]));
					echo json_encode(array('status' => '1', 'query_certificate_merge' => $query_certificate_merge));

					//break;
				}
				else
				{

					$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND transaction_id = '".$transaction_id."'");

					//echo json_encode($query_certificate_merge->result_array());
					if ($query_certificate_merge->num_rows() > 0) 
					{
						$query_certificate_merge = $query_certificate_merge->result_array();
						//echo json_encode($query_certificate_merge);

						for($t = 0; $t < count($query_certificate_merge); $t++)
						{
							if($query_certificate_merge[$t]["certificate_no"] != null)
							{
								$this->db->set("status", 1);
								$this->db->where(array("certificate_no" => $query_certificate_merge[$t]["certificate_no"], "client_member_share_capital_id" => $query_certificate_merge[$t]["client_member_share_capital_id"]));
								$this->db->update("certificate");
							}

							$this->db->delete('member_shares', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
							$this->db->delete('certificate', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
							$this->db->delete('certificate_merge', array("transaction_id" => $query_certificate_merge[$t]['transaction_id']));
						}
					}
					else
					{
						$query_certificate = $this->db->query("select * from certificate where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$query_certificate[$r]["certificate_no"]."'");

						if ($query_certificate->num_rows() > 0) 
						{
							$query_certificate = $query_certificate->result_array();

							$this->db->delete('member_shares', array("transaction_id" => $query_certificate[0]['transaction_id']));
							$this->db->delete('certificate', array("transaction_id" => $query_certificate[0]['transaction_id']));
						}
					}

					echo json_encode(array('status' => '2', 'message' => 'Information Updated', 'title' => 'Updated'));
					
				}

			//}

			//echo json_encode(array('status' => '2', 'message' => 'Information Updated', 'title' => 'Updated'));
		}
	}

	public function delete_allot()
	{
		$member_share_id = $this->session->userdata('allotment_id');

		for($i = 0; $i < count($member_share_id); $i++ )
		{
			$q = $this->db->get_where("member_shares", array("id" => $member_share_id[$i]));

			$this->db->delete('member_shares', array("id" => $member_share_id[$i]));

			$previous_member_share_info = $q->result_array();

			$company_code = $previous_member_share_info[0]["company_code"];
			$transaction_id = $previous_member_share_info[0]["transaction_id"];
			$officer_id = $previous_member_share_info[0]["officer_id"];
			$field_type = $previous_member_share_info[0]["field_type"];
			$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

			$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

			$query_certificate = $query_certificate->result_array();

			$this->db->delete('certificate', array("id" => $query_certificate[0]["id"]));

			$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

			if ($query_certificate_merge->num_rows() > 0) 
			{
				$query_certificate_merge = $query_certificate_merge->result_array();

				for($i = 0; $i < count($query_certificate_merge); $i++)
				{
					$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[$i]["id"]));
				}
			}
		}

		$this->session->set_userdata(array(
            'allotment_id'  =>  array(),
        ));
	}

	public function delete_transfer_from()
	{
		$member_share_id = $this->session->userdata('transfer_id');

		for($i = 0; $i < count($member_share_id); $i++ )
		{
			$q = $this->db->get_where("member_shares", array("id" => $member_share_id[$i]));

			$this->db->delete('member_shares', array("id" => $member_share_id[$i]));

			$previous_member_share_info = $q->result_array();

			$company_code = $previous_member_share_info[0]["company_code"];
			$transaction_id = $previous_member_share_info[0]["transaction_id"];
			$officer_id = $previous_member_share_info[0]["officer_id"];
			$field_type = $previous_member_share_info[0]["field_type"];
			$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

			$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

			$query_certificate = $query_certificate->result_array();

			$this->db->delete('certificate', array("id" => $query_certificate[0]["id"]));

			//$this->db->delete('certificate_merge', array("new_certificate_no" => $query_certificate[0]["certificate_no"]));

			$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

			if ($query_certificate_merge->num_rows() > 0) 
			{
				$query_certificate_merge = $query_certificate_merge->result_array();

				for($i = 0; $i < count($query_certificate_merge); $i++)
				{
					if($i == 0)
					{
						$this->db->set("status", 1);
						$this->db->where(array("certificate_no" => $query_certificate_merge[$i]["certificate_no"], "client_member_share_capital_id" => $query_certificate_merge[$i]["client_member_share_capital_id"]));
						$this->db->update("certificate");
					}
					$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[$i]["id"]));
				}

				
			}
		}

		$this->session->set_userdata(array(
            'transfer_id'  =>  array(),
        ));
	}

	public function delete_transfer_to()
	{
		$member_share_id = $this->session->userdata('to_id');

		for($i = 0; $i < count($member_share_id); $i++ )
		{
			$q = $this->db->get_where("member_shares", array("id" => $member_share_id[$i]));

			$this->db->delete('member_shares', array("id" => $member_share_id[$i]));

			$previous_member_share_info = $q->result_array();

			$company_code = $previous_member_share_info[0]["company_code"];
			$transaction_id = $previous_member_share_info[0]["transaction_id"];
			$officer_id = $previous_member_share_info[0]["officer_id"];
			$field_type = $previous_member_share_info[0]["field_type"];
			$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];

			$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

			$query_certificate = $query_certificate->result_array();

			$this->db->delete('certificate', array("id" => $query_certificate[0]["id"]));

			$query_certificate_merge = $this->db->query("select id, company_code, merge_date, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, new_certificate_no from certificate_merge where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

			if ($query_certificate_merge->num_rows() > 0) 
			{
				$query_certificate_merge = $query_certificate_merge->result_array();

				for($i = 0; $i < count($query_certificate_merge); $i++)
				{
					$this->db->delete('certificate_merge', array("id" => $query_certificate_merge[$i]["id"]));
				}
			}
		}

		$this->session->set_userdata(array(
            'to_id'  =>  array(),
        ));
	}
	
	public function delete_allotment()
    {
    	//$this->session->unset_userdata('allotment_id');
    	$allotment_delete_id = $_POST["allotment_id"];
    	//echo($allotment_delete_id);

    	$q = $this->db->get_where("member_shares", array("id" => $allotment_delete_id));
		$previous_member_share_info = $q->result_array();

		$company_code = $previous_member_share_info[0]["company_code"];
		$transaction_id = $previous_member_share_info[0]["transaction_id"];
		$officer_id = $previous_member_share_info[0]["officer_id"];
		$field_type = $previous_member_share_info[0]["field_type"];
		$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];
		$transaction_type = $previous_member_share_info[0]["transaction_type"];

		$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

		$previous_query_certificate = $query_certificate->result_array();

		$certificate_no = $previous_query_certificate[0]["certificate_no"];

		//echo json_encode($previous_member_share_info);

		$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

		if ($query_certificate_merge->num_rows() > 0) 
		{
			$query_certificate_merge = $query_certificate_merge->result_array();

			echo json_encode(array('status' => 2, 'company_code' => $company_code, 'client_member_share_capital_id' => $query_certificate_merge[0]["client_member_share_capital_id"], 'officer_id' => $query_certificate_merge[0]["officer_id"], 'field_type' => $query_certificate_merge[0]["field_type"], 'certificate_no' => $certificate_no, 'transaction_type' => $transaction_type));
		}
		else
		{
			$allotment_id = $this->session->userdata('allotment_id');

	        if($allotment_delete_id != null)
	        {
	        	array_push($allotment_id, $allotment_delete_id);
		        //echo ($allotment_id);
		        $this->session->set_userdata(array(
		            'allotment_id'  =>  $allotment_id,
		        ));
	        }
	        echo json_encode(array('status' => 1));
		}
        

        //echo json_encode($this->session->userdata('allotment_id'));
    }

    public function delete_transfer()
    {
    	
    	$transfer_delete_id = $_POST["transfer_id"];
    	

    	$q = $this->db->get_where("member_shares", array("id" => $transfer_delete_id));
		$previous_member_share_info = $q->result_array();

		$company_code = $previous_member_share_info[0]["company_code"];
		$transaction_id = $previous_member_share_info[0]["transaction_id"];
		$officer_id = $previous_member_share_info[0]["officer_id"];
		$field_type = $previous_member_share_info[0]["field_type"];
		$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];
		$transaction_type = $previous_member_share_info[0]["transaction_type"];

		$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

		$previous_query_certificate = $query_certificate->result_array();

		$certificate_no = $previous_query_certificate[0]["certificate_no"];

		//echo json_encode($previous_member_share_info);

		$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

		if ($query_certificate_merge->num_rows() > 0) 
		{
			$query_certificate_merge = $query_certificate_merge->result_array();

			echo json_encode(array('status' => 2, 'company_code' => $company_code, 'client_member_share_capital_id' => $query_certificate_merge[0]["client_member_share_capital_id"], 'officer_id' => $query_certificate_merge[0]["officer_id"], 'field_type' => $query_certificate_merge[0]["field_type"], 'certificate_no' => $certificate_no, 'transaction_type' => $transaction_type));
		}
		else
		{
			$transfer_id = $this->session->userdata('transfer_id');

	        if($transfer_delete_id != null)
	        {
	        	array_push($transfer_id, $transfer_delete_id);
		        //echo ($allotment_id);
		        $this->session->set_userdata(array(
		            'transfer_id'  =>  $transfer_id,
		        ));
	        }
	        echo json_encode(array('status' => 1));
		}
        

        //echo json_encode($this->session->userdata('allotment_id'));
    }

    public function delete_to()
    {
    	//$this->session->unset_userdata('allotment_id');
    	$to_delete_id = $_POST["to_id"];
    	//echo($allotment_delete_id);

    	$q = $this->db->get_where("member_shares", array("id" => $to_delete_id));
		$previous_member_share_info = $q->result_array();

		$company_code = $previous_member_share_info[0]["company_code"];
		$transaction_id = $previous_member_share_info[0]["transaction_id"];
		$officer_id = $previous_member_share_info[0]["officer_id"];
		$field_type = $previous_member_share_info[0]["field_type"];
		$client_member_share_capital_id = $previous_member_share_info[0]["client_member_share_capital_id"];
		$transaction_type = $previous_member_share_info[0]["transaction_type"];

		$query_certificate = $this->db->query("select id, company_code, client_member_share_capital_id, officer_id, field_type, transaction_id, number_of_share, certificate_no, status from certificate where officer_id = '".$officer_id."' AND company_code = '".$company_code."' AND transaction_id = '".$transaction_id."' AND field_type = '".$field_type."'");

		$previous_query_certificate = $query_certificate->result_array();

		$certificate_no = $previous_query_certificate[0]["certificate_no"];

		//echo json_encode($previous_member_share_info);

		$query_certificate_merge = $this->db->query("select * from certificate_merge where client_member_share_capital_id = '".$client_member_share_capital_id."' AND certificate_no = '".$certificate_no."'");

		if ($query_certificate_merge->num_rows() > 0) 
		{
			$query_certificate_merge = $query_certificate_merge->result_array();

			echo json_encode(array('status' => 2, 'company_code' => $company_code, 'client_member_share_capital_id' => $query_certificate_merge[0]["client_member_share_capital_id"], 'officer_id' => $query_certificate_merge[0]["officer_id"], 'field_type' => $query_certificate_merge[0]["field_type"], 'certificate_no' => $certificate_no, 'transaction_type' => $transaction_type));
		}
		else
		{	        

	        $to_id = $this->session->userdata('to_id');

	        if($to_delete_id != null)
	        {
	        	array_push($to_id, $to_delete_id);
		        //echo ($allotment_id);
		        $this->session->set_userdata(array(
		            'to_id'  =>  $to_id,
		        ));
	        }
	        echo json_encode(array('status' => 1));
		}

        //echo json_encode($this->session->userdata('allotment_id'));
    }

    public function delete_billing_service()
    {
    	//$this->session->unset_userdata('allotment_id');
    	$delete_billing_service_id = $_POST["billing_service_id"];
    	//echo($allotment_delete_id);
        $billing_service_id = $this->session->userdata('billing_service_id');

        if($delete_billing_service_id != null)
        {
        	array_push($billing_service_id, $delete_billing_service_id);
	        //echo ($allotment_id);
	        $this->session->set_userdata(array(
	            'billing_service_id'  =>  $billing_service_id,
	        ));
        }
        echo "success";

        //echo json_encode($this->session->userdata('allotment_id'));
    }

    public function delete_client_billing_info()
    {
    	//$this->session->unset_userdata('allotment_id');
    	$client_billing_info_id = $_POST["client_billing_info_id"];
    	$company_code = $_POST["company_code"];
       	// $this->db->delete('client_billing_info',array('id'=>$client_billing_info_id));
        // echo "success";

        $check_billing_service_id = $this->db->get_where("client_billing_info", array("client_billing_info_id" => $client_billing_info_id, "company_code" => $company_code, "deleted"=> 0));
        //echo json_encode(!$check_billing_service_id->num_rows());
        if ($check_billing_service_id->num_rows())
        {	
        	$check_billing_service_id = $check_billing_service_id->result_array();
        	//echo json_encode($check_billing_service_id[0]["id"]);
	        $check_billing_service_info = $this->db->get_where("billing_service", array("service" => $check_billing_service_id[0]["id"]));

	        if (!$check_billing_service_info->num_rows())
	        {
	        	$check_recur_billing_service_info = $this->db->get_where("recurring_billing_service", array("service" => $check_billing_service_id[0]["id"]));

	        	if (!$check_recur_billing_service_info->num_rows())
	        	{
	        		echo json_encode(array("Status" => 1));
	        	}
	        	else
	        	{
	        		echo json_encode(array("Status" => 2));
	        	}
			}
	        else
	        {
	            echo json_encode(array("Status" => 2));
	        }
	    }
	    else
	    {
	    	echo json_encode(array("Status" => 1));
	    }
    }

	public function hapus_allotment($id){
		$this->db->delete('allotment',array('id'=>$id));
		$this->db->delete('allotment_member',array('id_allotment'=>$id));
	}
	
	public function read_buyback($unique_code,$sharetype,$currency)
	{
		$a = $this->master_model->get_all_allot_members($unique_code,$sharetype,$currency);
		$i=1;
		foreach($a as $b)
		{
			echo '<div class="hidden">';
			echo '<input type="text" name="id[]" value="'.$b->id.'"/>';
			echo '<input type="text" name="gid[]" value="'.$b->gid.'"/>';
			echo '<input type="text" name="nama[]" value="'.$b->nama.'"/>';
			echo '</div>';
			echo '<tr><td>'.$i.'</td>
			<td>'.$b->nama.'</td>
			<td>'.$b->gid.'</td>
			<td><input type="text" id="shareori_bb2" class=" form-control  number text-right" name="share_allotment[]" value="'.$b->share_allotment.'" readonly></div></td>
			<td><input type="text" id="amountori_bb2" class=" form-control  number text-right" name="amount_allotment[]" value="'.$b->amount_allotment.'" readonly></td>
			<td><input type="text" class="share_bb form-control  number text-right" name="sharebb_allotment[]" data-id="'.$i.'" data-gid="'.$b->gid.'" data-nama="'.$b->nama.'" data-shareori="'.$b->share_allotment.'" value="" ></td>
			<td><input type="text" id="" class="amount_bb form-control number text-right"  name="amountbb_allotment[]" data-amountori="'.$b->amount_allotment.'"  data-id="'.$i.'" value="" ></td>
			<td><input type="text" class="certificate_bb form-control" value="" name="certificate_allotment[]" data-id="'.$i.'" ></td>
			</tr>';
			$i++;
		}
	}
	
	public function read_buybackplain($unique_code,$sharetype,$currency)
	{
		$a = $this->master_model->get_all_allot_members($unique_code,$sharetype,$currency);
		$i=1;
		foreach($a as $b)
		{
			echo '<tr><td>'.$i.'</td>
			<td>'.$b->nama.'</td>
			<td>'.$b->gid.'</td>
			<td>'.$b->share_allotment.'</td>
			<td>'.$b->amount_allotment.'</td>
			<td id="share_bb'.$i.'"></td>
			<td id="amount_bb'.$i.'"></td>
			<td id="total_share_left'.$i.'"></td>
			<td id="total_amount_left'.$i.'"></td>
			<td id="certificate'.$i.'"></td>
			</tr>';
			$i++;
		}
	}
	
	public function search_member($type,$term)
	{
		// echo $type;
		if ($type=='nama')
		{
			$a = $this->master_model->get_all_person($term);
		} else {
			$a = $this->master_model->get_all_person('','',$term);
		}
		foreach($a as $b)
		{
			echo "<tr><td>".$b->gid."<td>".$b->nama."</td><td><a class=\"add_director btn-default btn\" style=\"padding:2px 3px;\" data-gid='".$b->gid."' data-nama='".$b->nama."'>Add</a></td></tr>";
		}
		
	}
	
	public function get_certificate($unique_code)
	{
		$a = $this->master_model->get_all_certificate($unique_code);
		$i = 1;
		foreach($a as $b)
		{
			echo '<tr>
				<td>'.$i.'</td>
				<td>'.$this->sma->fed($b->tgl).'</td>
				<td>'.$b->nama.'<br/>'.$b->gid.'</td>
				<td>'.$b->share_allotment.'</td>
				<td><a>'.$b->certificate_allotment.'</a></td>
			</tr>';
			$i++;
		}
	}
	
	public function unpaid_invoice ()
	{
        $bc = array(array('link' => '#', 'page' => lang('Unpaid Invoice')));
        $meta = array('page_title' => lang('Unpaid Invoice'), 'bc' => $bc, 'page_name' => 'Unpaid Invoice');
		// $this->data['page_name'] = 'Clients';
        $this->page_construct('client/unpaid.php', $meta, $this->data);
		
	}
	
	public function unreceived_doc ()
	{
        $bc = array(array('link' => '#', 'page' => lang('Unreceived Document')));
        $meta = array('page_title' => lang('Unreceived Document'), 'bc' => $bc, 'page_name' => 'Unreceived Document');
		// $this->data['page_name'] = 'Clients';
        $this->page_construct('client/unreceived.php', $meta, $this->data);
		
	}
	
	public function setting_filing ()
	{
        $bc = array(array('link' => '#', 'page' => lang('Filing')));
        $meta = array('page_title' => lang('Filing'), 'bc' => $bc, 'page_name' => 'Filing');
		// $this->data['page_name'] = 'Clients';
        $this->page_construct('client/setting_filing.php', $meta, $this->data);
		
	}
	
	public function modal_next ()
	{
		print_r($_POST);
        $bc = array(array('link' => '#', 'page' => lang('Confirm Changes Clients')));
        $meta = array('page_title' => lang('Confirm Changes  Clients'), 'bc' => $bc, 'page_name' => 'Confirm Changes  Clients');
		// $this->data['page_name'] = 'Clients';
        $this->page_construct('client/confirm_changes.php', $meta, $this->data);
		
	}

	/*public function save_buyback()
	{
		$this->sma->print_arrays($_POST);
	}*/
	public function get_director_appointment_date()
	{
		$client_officers_id = $_POST['client_officers_id'];

		$result = $this->db->query("select date_of_appointment from client_officers where id = '".$client_officers_id."'");

		$result = $result->result_array();

		echo json_encode($result);
	}

	public function get_director()
	{
		// echo "A";
		$company_code = $_POST['company_code'];
		$date_of_appointment = $_POST['date_of_appointment'];
		$alternate_of = $_POST['alternate_of'];
		//$position = $_POST['position'];

		$result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND (date_of_cessation = '' OR from_unixtime(UNIX_TIMESTAMP(STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y')),'%Y-%m-%d') >= CURDATE() ) AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = (SELECT MAX(STR_TO_DATE(T.date_of_appointment,'%d/%m/%Y')) from client_officers as T where T.officer_id = client_officers.officer_id AND T.field_type = client_officers.field_type AND  T.position = '1' AND T.company_code='".$company_code."') AND UNIX_TIMESTAMP(STR_TO_DATE('".$date_of_appointment."','%d/%m/%Y')) > UNIX_TIMESTAMP(STR_TO_DATE(date_of_appointment,'%d/%m/%Y'))");

		/*$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*//*GROUP BY client_officers.officer_id and client_officers.field_type HAVING MAX(STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y'))*/

		$result = $result->result_array();
		//echo json_encode($result);
		/*if(!$result) {
			throw new exception("Director not found.");
		}*/
		$res = array();
		foreach($result as $row) {
			if($row['name'] != null)
			{
				$res[$row['id']] = $row['name'];
			}
			else if ($row['company_name'] != null)
			{
				$res[$row['id']] = $row['company_name'];
			}
			
		}
		
		/*$ci =& get_instance();*/
		if ($alternate_of != "")
		{
			$selected_director = $alternate_of;
		}
		else
		{
			$selected_director = null;
		}
       	

		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Director fetched successfully.", 'result'=>$res, 'selected_director'=>$selected_director);

	    echo json_encode($data);
		/*	//echo json_encode($q);
		if ($q->num_rows() > 0) {
			echo json_encode($q->result()[0]);
            // foreach (($q->result()) as $row) {
                // $data[] = $row;
            // }
            // return $data;
        } else echo 0;*/

		
		
		// echo $gid;
		// $this->sma->print_arrays($_POST);
	}

	public function register_get_director()
	{
		// echo "A";
		$company_code = $_POST['company_code'];
		$alternate_of = $_POST['alternate_of'];
		//$position = $_POST['position'];

		$result = $this->db->query("select client_officers.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type where position = '1' AND company_code='".$company_code."' AND (date_of_cessation = '' OR from_unixtime(UNIX_TIMESTAMP(STR_TO_DATE(client_officers.date_of_cessation,'%d/%m/%Y')),'%Y-%m-%d') >= CURDATE() ) AND STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y') = (SELECT MAX(STR_TO_DATE(T.date_of_appointment,'%d/%m/%Y')) from client_officers as T where T.officer_id = client_officers.officer_id AND T.field_type = client_officers.field_type AND  T.position = '1' AND T.company_code='".$company_code."')");

		/*$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*//*GROUP BY client_officers.officer_id and client_officers.field_type HAVING MAX(STR_TO_DATE(client_officers.date_of_appointment,'%d/%m/%Y'))*/

		$result = $result->result_array();
		//echo json_encode($result);
		/*if(!$result) {
			throw new exception("Director not found.");
		}*/
		$res = array();
		foreach($result as $row) {
			if($row['name'] != null)
			{
				$res[$row['id']] = $row['name'];
			}
			else if ($row['company_name'] != null)
			{
				$res[$row['id']] = $row['company_name'];
			}
			
		}
		
		/*$ci =& get_instance();*/
		if ($alternate_of != "")
		{
			$selected_director = $alternate_of;
		}
		else
		{
			$selected_director = null;
		}
       	

		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Director fetched successfully.", 'result'=>$res, 'selected_director'=>$selected_director);

	    echo json_encode($data);
		/*	//echo json_encode($q);
		if ($q->num_rows() > 0) {
			echo json_encode($q->result()[0]);
            // foreach (($q->result()) as $row) {
                // $data[] = $row;
            // }
            // return $data;
        } else echo 0;*/

		
		
		// echo $gid;
		// $this->sma->print_arrays($_POST);
	}


	public function get_client_officers_position()
	{
		$position = $_POST['position'];

		$result = $this->db->query("select * from client_officers_position");

		/*$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*/

		$result = $result->result_array();
		//echo json_encode($result);
		if(!$result) {
			throw new exception("Client officers position not found.");
		}
		$res = array();
		foreach($result as $row) {
			$res[$row['id']] = $row['position'];
		}
		
		/*$ci =& get_instance();*/
		if ($position != "")
		{
			$selected_client_officers_position = $position;
		}
		else
		{
			$selected_client_officers_position = null;
		}
       	

		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Client officers position fetched successfully.", 'result'=>$res, 'selected_client_officers_position'=>$selected_client_officers_position);

	    echo json_encode($data);
	}

	public function get_financial_year_period()
	{
		//$position = $_POST['position'];

		$result = $this->db->query("select * from financial_year_period");

		/*$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*/

		$result = $result->result_array();
		//echo json_encode($result);
		if(!$result) {
			throw new exception("Financial Year Period not found.");
		}
		$res = array();
		foreach($result as $row) {
			$res[$row['id']] = $row['period'];
		}
		
		/*$ci =& get_instance();*/
		// if ($position != "")
		// {
		// 	$selected_client_officers_position = $position;
		// }
		// else
		// {
		// 	$selected_client_officers_position = null;
		// }
       	

		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Financial Year Period fetched successfully.", 'result'=>$res);

	    echo json_encode($data);
	}

	public function get_sharetype()
	{
		$class = $_POST['class'];

		$result = $this->db->query("select * from sharetype");

		$result = $result->result_array();
		//echo json_encode($result);
		if(!$result) {
			throw new exception("Class not found.");
		}
		$res = array();
		foreach($result as $row) {
			$res[$row['id']] = $row['sharetype'];
		}
		
		/*$ci =& get_instance();*/
		if ($class != "")
		{
			$selected_class = $class;
		}
		else
		{
			$selected_class = null;
		}
       	

		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Class fetched successfully.", 'result'=>$res, 'selected_class'=>$selected_class);

	    echo json_encode($data);
		
	}
	public function get_nationality()
	{
		$nationality = $_POST['nationality'];

		$result_nationality = $this->db->query("select * from nationality");

		/*$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*/

		$result = $result_nationality->result_array();
		//echo json_encode($result);
		if(!$result_nationality) {
			throw new exception("Nationality not found.");
		}
		$res = array();
		/*foreach($result as $row) {
			$res[$row['id']] = $row['currency'];
		}*/
		/*usort($result, function($a, $b)
		{
		    return strcmp($a->currency, $b->currency);
		});
		echo json_encode($result);*/
		for($j = 0; $j < count($result); $j++)
		{
			$res[$result[$j]['id']] = $result[$j]['nationality'];
		}
		
		/*$ci =& get_instance();*/
		if ($nationality != "")
		{
			$selected_nationality = $nationality;
		}
		else
		{
			$selected_nationality = null;
		}
       	
		//$res = usort($res, "cmp");
		/*usort($res, function($a, $b)
		{
		    return strcmp($a, $b);
		});*/
		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Nationality fetched successfully.", 'result'=>$res, 'selected_nationality'=>$selected_nationality);

	    echo json_encode($data);
	}

	public function get_currency()
	{
		// echo "A";
		//$company_code = $_POST['company_code'];
		//$alternate_of = $_POST['alternate_of'];
		//$position = $_POST['position'];
		$currency = $_POST['currency'];

		$result_currency = $this->db->query("select * from currency order by currency");

		/*$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*/

		$result = $result_currency->result_array();
		//echo json_encode($result);
		if(!$result_currency) {
			throw new exception("Currency not found.");
		}
		$res = array();
		/*foreach($result as $row) {
			$res[$row['id']] = $row['currency'];
		}*/
		/*usort($result, function($a, $b)
		{
		    return strcmp($a->currency, $b->currency);
		});
		echo json_encode($result);*/
		for($j = 0; $j < count($result); $j++)
		{
			$res[$result[$j]['id']] = $result[$j]['currency'];
		}
		
		/*$ci =& get_instance();*/
		if ($currency != "")
		{
			$selected_currency = $currency;
		}
		else
		{
			$selected_currency = null;
		}
       	
		//$res = usort($res, "cmp");
		/*usort($res, function($a, $b)
		{
		    return strcmp($a, $b);
		});*/
		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Currency fetched successfully.", 'result'=>$res, 'selected_currency'=>$selected_currency);

	    echo json_encode($data);
		/*	//echo json_encode($q);
		if ($q->num_rows() > 0) {
			echo json_encode($q->result()[0]);
            // foreach (($q->result()) as $row) {
                // $data[] = $row;
            // }
            // return $data;
        } else echo 0;*/

		
		
		// echo $gid;
		// $this->sma->print_arrays($_POST);
	}
	public function get_guarantee_officer()
	{
		$identification_register_no = $_POST['identification_register_no'];

		$p = $this->db->query("select * from client where registration_no='".$identification_register_no."' AND firm_id = '".$this->session->userdata("firm_id")."'");

		$q = $this->db->query("select * from officer_company where register_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");

		$r = $this->db->query("select officer.*, nationality.nationality as nationality_name from officer left join nationality on nationality.id = officer.nationality where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");

		$officer_info = $r->result_array();
        $officer_company_info = $q->result_array();
        $client_info = $p->result_array();

        $all = array_merge($officer_info, $officer_company_info, $client_info);
		if (count($all) > 0) {
            echo json_encode($all[0]);
        }
        else echo 0;
	}

	public function get_officer()
	{
		// echo "A";
		$officer_id = $_POST['officer_id'];
		$identification_register_no = $_POST['identification_register_no'];
		$position = $_POST['position'];
		$company_code = $_POST['company_code'];

		//echo($position);
		if ($position == "5")
		{
			$q = $this->db->query("select * from officer_company where register_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."' ");
			//echo json_encode($q);
			if ($q->num_rows() > 0) {

				$check_member_share = $q->result_array();

				$chk_member = $this->db->query("select * from member_shares where officer_id='".$check_member_share[0]["id"]."' AND field_type = '".$check_member_share[0]["field_type"]."' AND company_code = '".$company_code."'");

				if ($chk_member->num_rows() > 0) {
					echo json_encode(array("status" => 5, "message" => "This person is a member for this company.", "title" => "Error"));
				}
				else
				{
					echo json_encode(array("status" => 1, "info" => $q->result()[0]));
				}

				
	        } 
	        else 
	        {
	        	$q = $this->db->query("select * from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");
				
				if ($q->num_rows() > 0) {
					echo json_encode(array("status" => 4, "message" => "This person should be a company.", "title" => "Error"));
					//echo json_encode($q->result()[0]);
		            // foreach (($q->result()) as $row) {
		                // $data[] = $row;
		            // }
		            // return $data;
		        } else echo json_encode(array("status" => 3));
	        }
		}
		else
		{
			//$q = $this->db->query("select * from officer where identification_no='".$identification_register_no."'");
			if($officer_id == null)
			{
				$q = $this->db->query("select * from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");
				
				if ($q->num_rows() > 0) {
					echo json_encode(array("status" => 1, "info" => $q->result()[0]));
					//echo json_encode($q->result()[0]);
		            // foreach (($q->result()) as $row) {
		                // $data[] = $row;
		            // }
		            // return $data;
		        } 
		        else 
		        {
		        	$q = $this->db->query("select * from officer_company where register_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");
					//echo json_encode($q);
					if ($q->num_rows() > 0) {
						echo json_encode(array("status" => 4, "message" => "This person should be an individual.", "title" => "Error"));
						//echo json_encode($q->result()[0]);
			            // foreach (($q->result()) as $row) {
			                // $data[] = $row;
			            // }
			            // return $data;
			        } 
			        else echo json_encode(array("status" => 3));
		        }
			}
			else
			{
				$result = $this->db->query("select * from client_officers where id = '".$officer_id."'");

				$result = $result->result_array();

				$q = $this->db->query("select * from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");

				$officer_result = $q->result_array();

				if($result[0]["officer_id"] == $officer_result[0]["id"])
				{
					echo json_encode(array("status" => 2, "message" => "He/She can not be the alternate for his/her own.", "title" => "Error"));
				}
				else
				{
					if ($q->num_rows() > 0) {
						echo json_encode(array("status" => 1, "info" => $q->result()[0]));
						//echo json_encode($q->result()[0]);
			            // foreach (($q->result()) as $row) {
			                // $data[] = $row;
			            // }
			            // return $data;
			        } 
			        else 
			        {
			        	$q = $this->db->query("select * from officer_company where register_no='".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."'");
						//echo json_encode($q);
						if ($q->num_rows() > 0) {
							echo json_encode(array("status" => 4, "message" => "This person should be an individual.", "title" => "Error"));
							//echo json_encode($q->result()[0]);
				            // foreach (($q->result()) as $row) {
				                // $data[] = $row;
				            // }
				            // return $data;
				        } 
				        else echo json_encode(array("status" => 3));
			        }
				}
			}
			

			//echo json_encode($q->result()[0]);
			
		}
		
		// echo $gid;
		// $this->sma->print_arrays($_POST);
	}

	public function get_person()
	{
		// echo "A";
		$identification_register_no = $_POST['identification_register_no'];
		$company_code = $_POST['company_code'];

		/*$query = "(select id, field_type, identification_no, name from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no LIKE '%".$identification_register_no."%') 
		           UNION
		           (select id, field_type, company_name, register_no from officer_company where register_no LIKE '%".$identification_register_no."%')";*/

		$query = "(select id, field_type, identification_no, name from officer where YEAR(CURDATE()) - YEAR(date_of_birth) - IF(STR_TO_DATE(CONCAT(YEAR(CURDATE()), '-', MONTH(date_of_birth), '-', DAY(date_of_birth)) ,'%Y-%c-%e') > CURDATE(), 1, 0) > 18 AND identification_no = '".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."') 
		           UNION
		           (select officer_company.id, officer_company.field_type, officer_company.register_no, officer_company.company_name from officer_company where register_no = '".$identification_register_no."' AND user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."')
		           	UNION
		           	(select id, 'client' AS field_type, registration_no, company_name from client where registration_no = '".$identification_register_no."' AND client.firm_id = '".$this->session->userdata("firm_id")."')";

		$q = $this->db->query($query);
			//echo json_encode($q->result_array());
		if ($q->num_rows() > 0) {

			$y = $q->result_array();

			if($y[0]["field_type"] == "company")
			{
				$t = $this->db->query("select * from client_officers where officer_id = '".$y[0]["id"]."' AND field_type = '".$y[0]["field_type"]."' AND company_code = '".$company_code."'");

				if ($t->num_rows() > 0) 
				{
					echo json_encode(array("status" => 2));
				}
				else
				{
					echo json_encode(array("status" => 1, "info" => $q->result()[0]));
				}

			}
			else
			{
				echo json_encode(array("status" => 1, "info" => $q->result()[0]));
			}
			
            // foreach (($q->result()) as $row) {
                // $data[] = $row;
            // }
            // return $data;
        } else echo json_encode(array("status" => 1, "info" => $q->result()[0]));

		
		
		// echo $gid;
		// $this->sma->print_arrays($_POST);
	}

	public function check_first_due_date_175()
	{
		$company_code = $_POST["company_code"];
		$filing_id = $_POST["filing_id"];

		$query = "select * from filing where company_code = '".$company_code."' and id < '".$filing_id."' ORDER BY id DESC LIMIT 2";

		$query = $this->db->query($query);

		if ($query->num_rows() > 0) {
			//$q->result()[0];
			//$filing_length = count($query->result()) - 1;

			//echo $filing_length;
			$previous_agm = $query->result()[0]->agm;
			//echo json_encode($query->result_array()[0]['175_extended_to']);
			//echo json_encode($query->result_array());
			// if($query->result()[0]->175_extended_to != '0')
			// {
			// 	$previous_agm = $query->result()[0]->175_extended_to;
			// }
			// else
			// {
			// 	$previous_agm = $query->result()[0]->due_date_175;
			// }

			if($previous_agm != null && $previous_agm != 'dispensed')
			{
				$previous_agm = date("Y-m-d", strtotime($previous_agm));
				echo json_encode(array("way" => 2, "date" => $previous_agm, "date_after_fifteen_month" => $this->MonthShifter(new DateTime($previous_agm),15)->format(('Y-m-d'))));
			}
			elseif($previous_agm == 'dispensed')
			{
				echo json_encode(array("way" => 4, "date" => "Not Applicable"));
			}
			else
			{
				$q = "select * from client where company_code = '".$company_code."'";
	        	$q = $this->db->query($q);

	        	if ($q->num_rows() > 0) {

	        		$array = explode('/',$q->result()[0]->incorporation_date);
					$tmp = $array[0];
					$array[0] = $array[1];
					$array[1] = $tmp;
					unset($tmp);
					$date_2 = implode('/', $array);
					$time = strtotime($date_2);
					$newformat = date('Y-m-d',$time);

	        		//$newDate = date("d-m-Y", strtotime($newformat));
					echo json_encode(array("way" => 3, "date" => $this->MonthShifter(new DateTime($newformat),15)->format(('Y-m-d'))));
		        } else echo 0;
			}


        } 
        else
        {
        	$q = "select * from client where company_code = '".$company_code."'";
        	$q = $this->db->query($q);

        	if ($q->num_rows() > 0) {

        		$array = explode('/',$q->result()[0]->incorporation_date);
				$tmp = $array[0];
				$array[0] = $array[1];
				$array[1] = $tmp;
				unset($tmp);
				$date_2 = implode('/', $array);
				$time = strtotime($date_2);
				$newformat = date('Y-m-d',$time);

        		//$newDate = date("d-m-Y", strtotime($newformat));
				echo json_encode(array("way" => 1, "date" => $this->MonthShifter(new DateTime($newformat),15)->format(('Y-m-d'))));
	        } else echo 0;
        }

	}

	public function delete_client ()
	{
		$id = $_POST["client_id"];

		$get_client_data = $this->db->query("select * from client where id='".$id."'");

		$get_client_data = $get_client_data->result_array();

		$company_code = $get_client_data[0]["company_code"];


        $this->db->delete("client_officers",array('company_code'=>$company_code));

        $this->db->delete("client_charges",array('company_code'=>$company_code));

        $this->db->delete("client_member_share_capital",array('company_code'=>$company_code));

        $this->db->delete("member_shares",array('company_code'=>$company_code));

        $this->db->delete("certificate",array('company_code'=>$company_code));

        $this->db->delete("certificate_merge",array('company_code'=>$company_code));

        $this->db->delete("filing",array('company_code'=>$company_code));

		$this->db->delete("client_signing_info",array('company_code'=>$company_code));

		$this->db->delete("client_contact_info",array('company_code'=>$company_code));

		$this->db->delete("client_billing_info",array('company_code'=>$company_code));

		$this->db->delete("record_billing_recurring",array('company_code'=>$company_code));

		$this->db->set("deleted", 1);
		$this->db->where('company_code', $company_code);
		$this->db->update("client");

		/*$get_billing_data = $this->db->query("select * from billing where company_code='".$company_code."'");

		if ($get_billing_data->num_rows())
		{
			$get_billing_data = $get_billing_data->result_array();

			for($r = 0; $r < count($get_billing_data); $r++)
			{
				$this->db->delete('billing', array("id" => $get_billing_data[$r]["id"]));
		        $this->db->delete('billing_service', array("billing_id" => $get_billing_data[$r]["id"]));

		        $q = $this->db->query('select * from billing_receipt_record where billing_id ="'.$get_billing_data[$r]["id"].'"');

		        if ($q->num_rows())
				{
			        $q = $q->result_array();

			        for($j = 0; $j <count($q); $j++)
			        {
			            $this->db->delete('receipt', array("id" => $q[$j]["receipt_id"]));
			        }
			    }

		        $this->db->delete('billing_receipt_record', array("billing_id" => $get_billing_data[$r]["id"]));
			}

		}*/
		$this->recalculate();
    	echo json_encode(array('message' => 'Information Updated', 'title' => 'Updated'));
	}

	public function check_filing_data()
	{
		$check_year_end = [];

		$check_year_end[0]['year_end'] = $_POST['year_end'];

		$query = $this->db->get_where("history_filing", array("company_code" => $_POST['company_code'], "id" => $_POST['filing_id']));

		if (!$query->num_rows())//if don't have anythings
		{
			echo false;
		}
		else
		{
			$query = $query->result_array();

			$old_filing_result = $this->db->query("select year_end from filing where id='".$_POST['filing_id']."' AND company_code = '".$_POST['company_code']."'");

			$old_filing_result = $old_filing_result->result_array();

			$get_client_info = $this->db->query("select * from client where company_code='".$_POST['company_code']."'");

			$get_client_info = $get_client_info->result_array();

			if(!($old_filing_result == $check_year_end))
			{
				$pending_documents_query = $this->db->get_where("pending_documents", array("client_id" => $get_client_info[0]["id"], "filing_id" => $_POST['filing_id'], "received_on" => "", "triggered_by" => "19"));
				if($pending_documents_query->num_rows())
				{
					echo true;
				}
				else
				{
					echo false;
				}
			}
			else
			{
				echo false;
			}

		}
	}
	public function check_latest_fye_for_tax()
	{
		$company_code = $_POST["company_code"];

		$latest_fye = $this->db->query('select * FROM filing WHERE company_code = "'.$company_code.'" ORDER BY ID DESC LIMIT 1');

		$latest_fye = $latest_fye->result_array();

		$latest_year_end = new DateTime($latest_fye[0]['year_end']);

		if($latest_fye[0]['year_end'] != null)
		{
			// We extract the day of the month as $start_day
		    $latest_year_end = $this->MonthShifter($latest_year_end,12)->format(('Y-m-d'));

		    $array = explode('-',$latest_year_end);
			$year = $array[0];
			$month = $array[1];
			$day = $array[2];

			$tax_filing_period = "YA".$year;
		    $tax_filing_due_date = date('d F Y', strtotime((int)$year.'-11-30'));
		}
		else
		{
			$tax_filing_period = null;
			$tax_filing_due_date = null;
		}

		echo json_encode(array('latest_fye' => $latest_fye[0]['year_end'], 'tax_filing_period' => $tax_filing_period, 'tax_filing_due_date' => $tax_filing_due_date));
	}

	public function check_latest_fye()
	{
		$company_code = $_POST["company_code"];

		$latest_fye = $this->db->query('select * FROM filing WHERE company_code = "'.$company_code.'" ORDER BY ID DESC LIMIT 1');

		$latest_fye = $latest_fye->result_array();

		$next_eci_filing_due_date = new DateTime($latest_fye[0]['year_end']);

		if($latest_fye[0]['year_end'] != null)
		{
			// We extract the day of the month as $start_day
		    $next_eci_filing_due_date = $this->MonthShifter($next_eci_filing_due_date,3)->format(('Y-m-d'));

		    $array = explode('-',$next_eci_filing_due_date);
			$year = $array[0];
			$month = $array[1];
			$day = $array[2];

		    $new_format_for_next_eci_due_date = date('d F Y', strtotime((int)$year.'-'.(int)$month.'-26'));
		}
		else
		{
			$new_format_for_next_eci_due_date = null;
		}

		echo json_encode(array('latest_fye' => $latest_fye[0]['year_end'], 'next_eci_filing_due_date' => $new_format_for_next_eci_due_date));
	}

	public function get_tax_period_due_date()
	{
		$company_code = $_POST["company_code"];
		$coporate_tax_period = $_POST["coporate_tax_period"];

		$coporate_tax_period = new DateTime($coporate_tax_period);
		// We extract the day of the month as $start_day
	    $coporate_tax_period = $this->MonthShifter($coporate_tax_period,12)->format(('Y-m-d'));

	    $array = explode('-',$coporate_tax_period);
		$year = $array[0];
		$month = $array[1];
		$day = $array[2];

	    $tax_filing_period = "YA".$year;
		$tax_filing_due_date = date('d F Y', strtotime((int)$year.'-11-30'));

		echo json_encode(array('tax_filing_period' => $tax_filing_period, 'tax_filing_due_date' => $tax_filing_due_date));
	}

	public function get_next_eci_filing_due_date()
	{
		$company_code = $_POST["company_code"];
		$eci_tax_period = $_POST["eci_tax_period"];

		$next_eci_filing_due_date = new DateTime($eci_tax_period);
		// We extract the day of the month as $start_day
	    $next_eci_filing_due_date = $this->MonthShifter($next_eci_filing_due_date,3)->format(('Y-m-d'));

	    $array = explode('-',$next_eci_filing_due_date);
		$year = $array[0];
		$month = $array[1];
		$day = $array[2];

	    $new_format_for_next_eci_due_date = date('d F Y', strtotime((int)$year.'-'.(int)$month.'-26'));

		echo json_encode(array('next_eci_filing_due_date' => $new_format_for_next_eci_due_date));
	}

	public function add_tax_filing_info()
	{
		$this->form_validation->set_rules('coporate_tax_period', 'Coporate Tax Period', 'required');

		if ($this->form_validation->run() == FALSE)
        {
        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

        	$error = array(
				'coporate_tax_period' => strip_tags(form_error('coporate_tax_period')),
            );

            echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error));
        }
        else
        {
        	$tax_filing['company_code'] = $_POST['company_code'];
			$tax_filing['coporate_tax_period'] = $_POST['coporate_tax_period'];
			$tax_filing['tax_filing_period'] = $_POST['tax_filing_period'];
			$tax_filing['filing_date'] = $_POST['tax_filing_date'];
			$tax_filing['tax_filing_due_date'] = $_POST['tax_filing_due_date'];

			$q = $this->db->get_where("tax_filing", array("company_code" => $_POST['company_code'], "id" => $_POST['tax_id']));

			if (!$q->num_rows())
			{	
				$this->db->insert("tax_filing",$tax_filing);
			} 
			else 
			{	

				$this->db->where(array("company_code" => $_POST['company_code'], "id" => $_POST['tax_id']));
				$this->db->update("tax_filing",$tax_filing);
			}

			$latest_tax_filing_id = $this->db->query("select * from tax_filing where company_code='".$_POST['company_code']."' ORDER BY id DESC LIMIT 1");

			if($_POST['tax_filing_date'] != null)
			{
				$new_tax_filing['company_code'] = $_POST['company_code'];
				$new_tax_filing['coporate_tax_period'] = date('d F Y', strtotime('+1 year', strtotime($_POST['coporate_tax_period'])));
				$new_tax_filing['filing_date'] = "";

				$coporate_tax_period = new DateTime($new_tax_filing['coporate_tax_period']);
				// We extract the day of the month as $start_day
			    $coporate_tax_period = $this->MonthShifter($coporate_tax_period,12)->format(('Y-m-d'));

			    $array = explode('-',$coporate_tax_period);
				$year = $array[0];
				$month = $array[1];
				$day = $array[2];

			    $new_tax_filing['tax_filing_period'] = "YA".$year;
				$new_tax_filing['tax_filing_due_date'] = date('d F Y', strtotime((int)$year.'-11-30'));

				if($latest_tax_filing_id->result()[0]->id != $_POST['tax_id'] && $_POST['tax_id'] != "")
				{
					$this->db->where(array("id" => $latest_tax_filing_id->result()[0]->id));
					$this->db->update("tax_filing",$new_tax_filing);
				}
				else
				{
					$this->db->insert("tax_filing",$new_tax_filing);
				}
			}

			$this->data['tax_filing_data'] = $this->master_model->get_all_tax_filing_data($_POST['company_code']);

        	echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "tax_filing_data" => $this->data));
        }
	}

	public function add_eci_filing_info()
	{
		$this->form_validation->set_rules('eci_tax_period', 'ECI Tax Period', 'required');

		if ($this->form_validation->run() == FALSE)
        {
        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

        	$error = array(
				'eci_tax_period' => strip_tags(form_error('eci_tax_period')),
            );

            echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error));
        }
        else
        {
        	$eci_filing['company_code'] = $_POST['company_code'];
			$eci_filing['eci_tax_period'] = $_POST['eci_tax_period'];
			$eci_filing['eci_filing_date'] = $_POST['eci_filing_date'];
			$eci_filing['next_eci_filing_due_date'] = $_POST['next_eci_filing_due_date'];

			$q = $this->db->get_where("eci_filing", array("company_code" => $_POST['company_code'], "id" => $_POST['eci_id']));

			if (!$q->num_rows())
			{	
				$this->db->insert("eci_filing",$eci_filing);
			} 
			else 
			{	

				$this->db->where(array("company_code" => $_POST['company_code'], "id" => $_POST['eci_id']));
				$this->db->update("eci_filing",$eci_filing);
			}

			$latest_eci_filing_id = $this->db->query("select * from eci_filing where company_code='".$_POST['company_code']."' ORDER BY id DESC LIMIT 1");

			if($_POST['eci_filing_date'] != null)
			{
				$new_eci_filing['company_code'] = $_POST['company_code'];
				$new_eci_filing['eci_tax_period'] = date('d F Y', strtotime('+1 year', strtotime($_POST['eci_tax_period'])));
				$new_eci_filing['eci_filing_date'] = "";

				$next_eci_filing_due_date = new DateTime($new_eci_filing['eci_tax_period']);
				// We extract the day of the month as $start_day
			    $next_eci_filing_due_date = $this->MonthShifter($next_eci_filing_due_date,3)->format(('Y-m-d'));

			    $array = explode('-',$next_eci_filing_due_date);
				$year = $array[0];
				$month = $array[1];
				$day = $array[2];

			    $new_eci_filing['next_eci_filing_due_date'] = date('d F Y', strtotime((int)$year.'-'.(int)$month.'-26'));

				if($latest_eci_filing_id->result()[0]->id != $_POST['eci_id'] && $_POST['eci_id'] != "")
				{
					$this->db->where(array("id" => $latest_eci_filing_id->result()[0]->id));
					$this->db->update("eci_filing",$new_eci_filing);
				}
				else
				{
					$this->db->insert("eci_filing",$new_eci_filing);
				}
			}

			$this->data['eci_filing_data'] = $this->master_model->get_all_eci_filing_data($_POST['company_code']);

        	echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "eci_filing_data" => $this->data));
        }
	}


	public function add_filing_info()
	{
		$this->form_validation->set_rules('year_end', 'Year End', 'required');

		if ($this->form_validation->run() == FALSE)
        {
        	$this->data['error'] = (validation_errors() ? validation_errors() : $this->session->flashdata('error'));

        	$error = array(
				'year_end' => strip_tags(form_error('year_end')),
            );

            echo json_encode(array("Status" => 0, 'message' => 'Please complete all required field', 'title' => 'Error', "error" => $error));
        }
        else
        {
        	$filing['company_code'] = $_POST['company_code'];
			$filing['year_end'] = $_POST['year_end'];
			$filing['agm'] = $_POST['agm'];
			$filing['ar_filing_date'] = $_POST['ar_filing_date'];
			$filing['financial_year_period_id'] = $_POST['financial_year_period'];
			$filing['due_date_175'] = $_POST['due_date_175'];
			$filing['175_extended_to'] = $_POST['extended_to_175'];
			$filing['due_date_201'] = $_POST['due_date_201'];
			$filing["201_extended_to"] = $_POST['extended_to_201'];
			$filing['due_date_197'] = $_POST['due_date_197'];
			$filing["197_extended_to"] = $_POST['extended_to_197'];
			/*if($_POST['extended_to_175'] != 0)
			{
				$filing['due_date_175'] = $_POST['extended_to_175'];
			}

			if($_POST['extended_to_201'] != 0)
			{
				$filing['due_date_201'] = $_POST['extended_to_201'];
			}*/

			$q = $this->db->get_where("filing", array("company_code" => $_POST['company_code'], "id" => $_POST['filing_id']));

			if (!$q->num_rows())
			{	
				if($_POST["agm"] != "" && $_POST['agm'] != "dispensed")
				{
					//$this->create_document("agm_held", $_POST['company_code'], null, null, null, null);
				}

				if($_POST["agm"] != "" && $_POST['agm'] == "dispensed")
				{
					//$this->create_document("dispense_agm", $_POST['company_code'], null, null, null, null);
				}			

				$this->db->insert("filing",$filing);
				//$insert_share_capital_id = $this->db->insert_id();
			} 
			else 
			{	
				$check_year_end = [];
				$check_agm = [];

				$check_year_end[0]['year_end'] = $_POST['year_end'];
				$check_agm[0]['agm'] = $_POST['agm'];

				$old_filing_result = $this->db->query("select year_end from filing where id='".$_POST['filing_id']."' AND company_code = '".$_POST['company_code']."'");

				$old_filing_result = $old_filing_result->result_array();

				$old_agm_result = $this->db->query("select agm from filing where id='".$_POST['filing_id']."' AND company_code = '".$_POST['company_code']."'");

				$old_agm_result = $old_agm_result->result_array();

				$this->db->where(array("company_code" => $_POST['company_code'], "id" => $_POST['filing_id']));
				$this->db->update("filing",$filing);

				$check_history_filing = $this->db->get_where("history_filing", array("company_code" => $_POST['company_code'], "id" => $_POST['filing_id']));

				if(!($old_filing_result == $check_year_end))
				{
					if (!$check_history_filing->num_rows())
					{
						$w = $q->result();

						foreach($w as $r) {
					        $this->db->insert("history_filing",$r);
					    }
					} 
					else 
					{
						$x = $q->result_array();

						$data_history['year_end'] = $x[0]["year_end"];

					    $this->db->update("history_filing",$data_history,array("company_code" => $_POST['company_code'], "id" => $_POST['filing_id']));
						
					}

					//$this->create_document("change_of_year_end", $_POST['company_code'], null, null, null, $_POST['filing_id']);
				}

				if(!($old_agm_result == $check_agm) && $_POST["agm"] != "" && $_POST['agm'] != "dispensed")
				{
					//$this->create_document("agm_held", $_POST['company_code'], null, null, null, null);
				}

				if(!($old_agm_result == $check_agm) && $_POST["agm"] != "" && $_POST['agm'] == "dispensed")
				{
					//$this->create_document("dispense_agm", $_POST['company_code'], null, null, null, null);
				}

				$next_filing_id = (int)$_POST['filing_id'] + 1;

				$check_due_date_175_not_empty = $this->db->get_where("filing", array("company_code" => $_POST['company_code'], "id" => $next_filing_id));

				if ($check_due_date_175_not_empty->num_rows())
				{				
					if($check_due_date_175_not_empty->result()[0]->due_date_175 == "")
					{
						$latest_two_digit_year_previous_agm = date('y', strtotime($_POST['agm']));
						$latest_two_digit_year_latest_agm = date('y', strtotime('+15 month', strtotime($_POST['agm'])));

						// if(((int)$latest_two_digit_year_latest_agm - (int)$latest_two_digit_year_previous_agm) > 1)
						// {
						// 	$new_due_date_175['due_date_175'] = date('d F Y', strtotime('31 December '.((int)$latest_two_digit_year_previous_agm + 1)));
						// }
						// else
						// {
							$new_due_date_175['due_date_175'] = date('d F Y', strtotime('+15 month', strtotime($_POST['agm'])));
						//}
						$latest_agm = date('Y-m-d', strtotime($_POST['agm']));

						$agm_date = new DateTime($latest_agm);
						// We extract the day of the month as $start_day
					    $agm_date = $this->MonthShifter($agm_date,15)->format(('Y-m-d'));
						$new_due_date_175['due_date_175'] = date('d F Y', strtotime($agm_date));


						$this->db->where(array("company_code" => $_POST['company_code'], "id" => $next_filing_id));
						$this->db->update("filing",$new_due_date_175);
					}
				} 
			}

			$latest_id = $this->db->query("select * from filing where company_code='".$_POST['company_code']."' ORDER BY id DESC LIMIT 1");

			//echo json_encode($latest_id->result()[0]->id);

			
				if($_POST['agm'] != null && $_POST['agm'] != "dispensed")
				{
					$new_filing['company_code'] = $_POST['company_code'];
					//$futureDate=date('d-m-Y', strtotime('+1 year', strtotime($_POST['year_end'])) );
					$new_filing['year_end'] = date('d F Y', strtotime('+1 year', strtotime($_POST['year_end'])));
					$new_filing['ar_filing_date'] = "";
					$new_filing['financial_year_period_id'] = 1;
					$new_filing['175_extended_to'] = 0;
					$new_filing["201_extended_to"] = 0;
					$new_filing["197_extended_to"] = 0;

					$latest_year_end = date('Y-m-d', strtotime($new_filing['year_end']));

					$year_end_date = new DateTime($latest_year_end);

					//$latest_due_date_197 = date('Y-m-d', strtotime($new_filing['year_end']));

					//$date2 = new DateTime($latest_due_date_197);
					// We extract the day of the month as $start_day
				    //$date2 = $this->MonthShifter($date2,7)->format(('Y-m-d'));
					if(date('Y-m-d', strtotime("8/31/2018")) > date('Y-m-d', strtotime('+1 year', strtotime($_POST['year_end'])))) 
					{
						$two_digit_year_previous_agm = date('y', strtotime($_POST['agm']));
						$two_digit_year_latest_agm = date('y', strtotime('+15 month', strtotime($_POST['agm'])));
						$new_filing['agm'] = "";

						// if(((int)$two_digit_year_latest_agm - (int)$two_digit_year_previous_agm) > 1)
						// {
						// 	/*echo json_encode($two_digit_year_latest_agm);*/
						// 	$new_filing['due_date_175'] = date('d F Y', strtotime('31 December '.((int)$two_digit_year_previous_agm + 1)));

						// 	$new_format_due_date_175 = new DateTime($new_filing['due_date_175']);
						// }
						// else
						// {
							$latest_agm = date('Y-m-d', strtotime($_POST['agm']));

							$agm_date = new DateTime($latest_agm);
							// We extract the day of the month as $start_day
						    $agm_date = $this->MonthShifter($agm_date,15)->format(('Y-m-d'));
							$new_filing['due_date_175'] = date('d F Y', strtotime($agm_date));

							$new_format_due_date_175 = new DateTime($new_filing['due_date_175']);
						//}
						//$filing['extended_to_175'] = $_POST['extended_to_175'];
						/*$latest_due_date_201 = date('t F Y', strtotime('+6 months', strtotime($new_filing['year_end'])));
						$new_filing['due_date_201'] = date("t F Y", strtotime($latest_due_date_201));*/

						
						// We extract the day of the month as $start_day
					    $date_201 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

						$new_filing['due_date_201'] =  date("t F Y", strtotime($date_201));

						$new_format_due_date_201 = new DateTime($new_filing['due_date_201']);

						// $date_197 = $this->MonthShifter($year_end_date,7)->format(('Y-m-d'));

						// $new_filing['due_date_197'] =  date("t F Y", strtotime($date_197));

						if($new_format_due_date_175 >= $new_format_due_date_201)
						{
							$date_197 = $this->MonthShifter($new_format_due_date_201,1)->format(('Y-m-d'));

							$new_filing['due_date_197'] =  date("t F Y", strtotime($date_197));
						}
						else if($new_format_due_date_201 > $new_format_due_date_175)
						{
							$date_197 = $this->MonthShifter($new_format_due_date_175,1)->format(('Y-m-d'));

							$new_filing['due_date_197'] =  date("t F Y", strtotime($date_197));
						}
						
						//$new_filing['due_date_197'] = date('d F Y', strtotime('+30 days', strtotime($new_filing['due_date_175'])));
					}
					else
					{
						$new_filing['agm'] = "";

						$date_175 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

						$new_filing['due_date_175'] = date('d F Y', strtotime($date_175));

						$date_201 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

						$new_filing['due_date_201'] = date('d F Y', strtotime($date_201));

						$date_197 = $this->MonthShifter($year_end_date,7)->format(('Y-m-d'));

						$new_filing['due_date_197'] =  date("t F Y", strtotime($date_197));
					}
					
					//echo json_encode($latest_id->result()[0]);
					//$latest_id->result()[0]->agm == null
					if($latest_id->result()[0]->id != $_POST['filing_id'] && $_POST['filing_id'] != "")
					{
						$this->db->where(array("id" => $latest_id->result()[0]->id));
						$this->db->update("filing",$new_filing);
					}
					else
					{
						$this->db->insert("filing",$new_filing);
					}
				}
				elseif($_POST['agm'] != null && $_POST['agm'] == "dispensed")
				{
					$new_filing['company_code'] = $_POST['company_code'];
					//$futureDate=date('d-m-Y', strtotime('+1 year', strtotime($_POST['year_end'])) );
					$new_filing['year_end'] = date('d F Y', strtotime('+1 year', strtotime($_POST['year_end'])));
					$new_filing['ar_filing_date'] = "";
					$new_filing['financial_year_period_id'] = 1;
					$new_filing['175_extended_to'] = 0;
					$new_filing["201_extended_to"] = 0;
					$new_filing["197_extended_to"] = 0;
					$new_filing['due_date_175'] = "Not Applicable";

					$latest_year_end = date('Y-m-d', strtotime($new_filing['year_end']));

					$year_end_date = new DateTime($latest_year_end);
					/*$two_digit_year_previous_agm = date('y', strtotime($_POST['agm']));
					$two_digit_year_latest_agm = date('y', strtotime('+15 month', strtotime($_POST['agm'])));

					if(((int)$two_digit_year_latest_agm - (int)$two_digit_year_previous_agm) > 1)
					{
						
						$new_filing['due_date_175'] = date('d F Y', strtotime('31 December '.((int)$two_digit_year_previous_agm + 1)));
					}
					else
					{
						$latest_agm = date('Y-m-d', strtotime($_POST['agm']));

						$agm_date = new DateTime($latest_agm);
						// We extract the day of the month as $start_day
					    $agm_date = $this->MonthShifter($agm_date,15)->format(('Y-m-d'));
						$new_filing['due_date_175'] = date('d F Y', strtotime($agm_date));
					}*/
					//$filing['extended_to_175'] = $_POST['extended_to_175'];
					/*$latest_due_date_201 = date('t F Y', strtotime('+6 months', strtotime($new_filing['year_end'])));
					$new_filing['due_date_201'] = date("t F Y", strtotime($latest_due_date_201));*/

					

					//$latest_due_date_197 = date('Y-m-d', strtotime($new_filing['year_end']));

					//$date2 = new DateTime($latest_due_date_197);
					// We extract the day of the month as $start_day
				    //$date2 = $this->MonthShifter($date2,7)->format(('Y-m-d'));

					if(date('Y-m-d', strtotime("8/31/2018")) > date('Y-m-d', strtotime('+1 year', strtotime($_POST['year_end'])))) 
					{
						$new_filing['agm'] = "";

						$latest_due_date_201 = date('Y-m-d', strtotime($new_filing['year_end']));

						$date1 = new DateTime($latest_due_date_201);
						// We extract the day of the month as $start_day
					    $date1 = $this->MonthShifter($date1,6)->format(('Y-m-d'));

						$new_filing['due_date_201'] =  date("t F Y", strtotime($date1));

						if($new_filing['due_date_175'] == "Not Applicable")
						{
							$new_filing['due_date_197'] = "Not Applicable";
						}
						//$new_filing['due_date_197'] = date('d F Y', strtotime('+30 days', strtotime($new_filing['year_end'])));
					}
					else
					{
						$new_filing['agm'] = "";

						$date_175 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

						$new_filing['due_date_175'] = date('d F Y', strtotime($date_175));

						$date_201 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

						$new_filing['due_date_201'] = date('d F Y', strtotime($date_201));

						$date_197 = $this->MonthShifter($year_end_date,7)->format(('Y-m-d'));

						$new_filing['due_date_197'] =  date("t F Y", strtotime($date_197));
					}

					

					// echo json_encode($latest_id->result()[0]->id);
					// echo json_encode($_POST['filing_id']);
					//$latest_id->result()[0]->agm == null
					if($latest_id->result()[0]->id != $_POST['filing_id'] && $_POST['filing_id'] != "")
					{
						$this->db->where(array("id" => $latest_id->result()[0]->id));
						$this->db->update("filing",$new_filing);
					}
					else
					{
						$this->db->insert("filing",$new_filing);
					}
				}
			

			$get_all_filing_data = $this->db->query("select filing.*, financial_year_period.period from filing left join financial_year_period on financial_year_period.id = filing.financial_year_period_id where company_code='".$_POST['company_code']."' order by id");

	        //echo json_encode($q->result());

	        if ($get_all_filing_data->num_rows() > 0) {
	            foreach (($get_all_filing_data->result()) as $row) {
	                $data[] = $row;
	            }
	        }

	        $get_all_eci_filing_data = $this->db->query("select eci_filing.* from eci_filing where company_code='".$_POST['company_code']."' order by id");

	        $get_all_eci_filing_data = $get_all_eci_filing_data->result_array();

	        if(count($get_all_eci_filing_data) > 0)
	        {
	        	$have_eci = false;
	        }
	        else
	        {
	        	$have_eci = true;
	        }

	        $get_all_tax_filing_data = $this->db->query("select tax_filing.* from tax_filing where company_code='".$_POST['company_code']."' order by id");

	        $get_all_tax_filing_data = $get_all_tax_filing_data->result_array();

	        if(count($get_all_tax_filing_data) > 0)
	        {
	        	$have_tax = false;
	        }
	        else
	        {
	        	$have_tax = true;
	        }

        	echo json_encode(array("Status" => 1, 'message' => 'Information Updated', 'title' => 'Updated', "filing_data" => $data, 'have_eci' => $have_eci, 'have_tax' => $have_tax));
        }
	}

	public function MonthShifter (DateTime $aDate,$months){
        $dateA = clone($aDate);
        $dateB = clone($aDate);
        $plusMonths = clone($dateA->modify($months . ' Month'));
        //check whether reversing the month addition gives us the original day back
        if($dateB != $dateA->modify($months*-1 . ' Month')){ 
            $result = $plusMonths->modify('last day of last month');
        } elseif($aDate == $dateB->modify('last day of this month')){
            $result =  $plusMonths->modify('last day of this month');
        } else {
            $result = $plusMonths;
        }
        return $result;
    }

	public function delete_filing ()
	{
		$id = $_POST["filing_id"];
		$this->db->delete("filing",array('id'=>$id));

		$get_all_filing_data = $this->db->query("select filing.*, financial_year_period.period from filing left join financial_year_period on financial_year_period.id = filing.financial_year_period_id where company_code='".$_POST['company_code']."' order by id");

        //echo json_encode($q->result());

        if ($get_all_filing_data->num_rows() > 0) {
            foreach (($get_all_filing_data->result()) as $row) {
                $data[] = $row;
            }
        }

        $get_all_eci_filing_data = $this->db->query("select eci_filing.* from eci_filing where company_code='".$_POST['company_code']."' order by id");

        $get_all_eci_filing_data = $get_all_eci_filing_data->result_array();

        if(count($get_all_eci_filing_data) > 0)
        {
        	$have_eci = false;
        }
        else
        {
        	$have_eci = true;
        }

        $get_all_tax_filing_data = $this->db->query("select tax_filing.* from tax_filing where company_code='".$_POST['company_code']."' order by id");

        $get_all_tax_filing_data = $get_all_tax_filing_data->result_array();

        if(count($get_all_tax_filing_data) > 0)
        {
        	$have_tax = false;
        }
        else
        {
        	$have_tax = true;
        }

    	echo json_encode(array("filing_data" => $data, 'have_eci' => $have_eci, 'have_tax' => $have_tax));
	}

	public function delete_tax_filing()
	{
		$id = $_POST["tax_filing_id"];
		$this->db->delete("tax_filing",array('id'=>$id));

		$this->data['tax_filing_data'] = $this->master_model->get_all_tax_filing_data($_POST['company_code']);

    	echo json_encode(array("tax_filing_data" => $this->data));
	}

	public function delete_eci_filing()
	{
		$id = $_POST["eci_filing_id"];
		$this->db->delete("eci_filing",array('id'=>$id));

		$this->data['eci_filing_data'] = $this->master_model->get_all_eci_filing_data($_POST['company_code']);

    	echo json_encode(array("eci_filing_data" => $this->data));
	}

	public function get_billing_info_service_category()
	{
		$ci =& get_instance();
		$query = "select * from billing_info_service_category";

		$result = $ci->db->query($query);
		$result = $result->result_array();

		$res = array();
		foreach($result as $row) {
            $res[$row['id']] = $row['category_description'];
        }

        $data = array('status'=>'success', 'tp'=>1,'result'=>$res);

        echo json_encode($data);
	}

	public function get_service_proposal_letter_required()
	{
		$ci =& get_instance();
		$query = "select * from service_proposal_letter_required";

		$result = $ci->db->query($query);
		$result = $result->result_array();

		$res = array();
		foreach($result as $row) {
            $res[$row['id']] = $row['sp_required'];
        }

        $data = array('status'=>'success', 'tp'=>1,'result'=>$res);

        echo json_encode($data);
	}

	public function get_engagement_letter_required()
	{
		$ci =& get_instance();
		$query = "select * from engagement_letter_required";

		$result = $ci->db->query($query);
		$result = $result->result_array();

		$res = array();
		foreach($result as $row) {
            $res[$row['id']] = $row['el_required'];
        }

        $data = array('status'=>'success', 'tp'=>1,'result'=>$res);

        echo json_encode($data);
	}

	public function get_display_in_engagement_letter_list()
	{
		$ci =& get_instance();
		$query = "select * from engagement_letter_list";

		$result = $ci->db->query($query);
		$result = $result->result_array();

		$res = array();
		foreach($result as $row) {
            $res[$row['id']] = $row['engagement_letter_list_name'];
        }

        $data = array('status'=>'success', 'tp'=>1,'result'=>$res);

        echo json_encode($data);
	}

	public function get_display_in_service_engagement()
	{
		$ci =& get_instance();
		$query = "select * from display_in_service_engagement";

		$result = $ci->db->query($query);
		$result = $result->result_array();

		$res = array();
		foreach($result as $row) {
            $res[$row['id']] = $row['display_in_se'];
        }

        $data = array('status'=>'success', 'tp'=>1,'result'=>$res);

        echo json_encode($data);
	}

	public function get_unit_pricing()
	{
		$ci =& get_instance();
		$query = "select * from unit_pricing";

		$result = $ci->db->query($query);
		$result = $result->result_array();

		$res = array();
		foreach($result as $row) {
            $res[$row['id']] = $row['unit_pricing_name'];
        }

        $data = array('status'=>'success', 'tp'=>1,'result'=>$res);

        echo json_encode($data);
	}

	public function get_billing_service()
	{
/*		$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*/

		$service = $_POST['service'];
		$firm_id = $this->session->userdata("firm_id");

		$ci =& get_instance();

		$query = "select billing_info_service.*, billing_info_service_category.category_description from billing_info_service left join billing_info_service_category on billing_info_service_category.category_code = billing_info_service.category_code order by billing_info_service.id";

		$selected_query = "select A.id from billing_info_service AS A WHERE EXISTS (SELECT service from billing_template AS B WHERE firm_id = '".$firm_id."' AND A.id = B.service)";

		$result = $ci->db->query($query);
		$selected_result = $ci->db->query($selected_query);
		
        //echo json_encode($result->result_array());
        $result = $result->result_array();
        $selected_result = $selected_result->result_array();

        // if (count($selected_result) == 0) {
        //     $selected_querys = "select A.id from billing_info_service AS A WHERE EXISTS (SELECT service from billing_template AS B WHERE A.id = B.service)";

        //     $selected_result = $ci->db->query($selected_querys);

        //     $selected_result = $selected_result->result_array();
        // }

        if(!$result) {
          throw new exception("Service not found.");
        }

        // $res = array();
        // foreach($result as $row) {
        //     $res[$row['id']] = $row['service'];
        // }

        $selected_res = array();
        foreach($selected_result as $key => $row) {
            $selected_res[$key] = $row['id'];
        }

        //$ci =& get_instance();
        if($service != "")
        {
        	$select_service = $service;
        }
        else
        {
        	$select_service = null;
        }
        

        $data = array('status'=>'success', 'tp'=>1, 'msg'=>"All Service fetched successfully.", 'result'=>$result, 'selected_service'=>$select_service, 'selected_query'=> $selected_res);

        echo json_encode($data);
	}

	public function get_billing_info_service()
	{
/*		$result = $this->db->query("select * from client_officers AS A where position = 'Director' AND company_code='".$company_code."' AND NOT EXISTS (SELECT alternate_of from client_officers AS B where A.id = B.alternate_of)");*/

		$service = $_POST['service'];
		$company_code = $_POST['company_code'];
		$is_template = $_POST['is_template'];

		$ci =& get_instance();

		$query = "select our_service_info.*, billing_info_service_category.category_description from our_service_info left join billing_info_service_category on billing_info_service_category.id = our_service_info.service_type where our_service_info.user_admin_code_id = '".$this->session->userdata("user_admin_code_id")."' order by our_service_info.id";

		if($is_template == "true")
		{
			$selected_query = "select A.id from our_service_info AS A";
		}
		else
		{
			$selected_query = "select A.id from our_service_info AS A WHERE EXISTS (SELECT service from client_billing_info AS B WHERE company_code = '".$company_code."' AND A.id = B.service)";
		}

		$selected_billing_info_service_category = "select billing_info_service_category.* from billing_info_service_category";

		$result = $ci->db->query($query);
		$selected_result = $ci->db->query($selected_query);
		$selected_billing_info_service_category = $ci->db->query($selected_billing_info_service_category);
		
        //echo json_encode($result->result_array());
        $result = $result->result_array();
        $selected_result = $selected_result->result_array();
        $selected_billing_info_service_category = $selected_billing_info_service_category->result_array();

        if (count($selected_result) == 0) {
            $selected_querys = "select A.id from our_service_info AS A WHERE EXISTS (SELECT service from billing_template AS B WHERE A.id = B.service)";

            $selected_result = $ci->db->query($selected_querys);

            $selected_result = $selected_result->result_array();
        }

        // if(!$result) {
        //   throw new exception("Service not found.");
        // }

        // $res = array();
        // foreach($result as $row) {
        //     $res[$row['id']] = $row['service'];
        // }

        $selected_res = array();
        foreach($selected_result as $key => $row) {
            $selected_res[$key] = $row['id'];
        }

        //$ci =& get_instance();
        if($service != "")
        {
        	$select_service = $service;
        }
        else
        {
        	$select_service = null;
        }
        

        $data = array('status'=>'success', 'tp'=>1, 'msg'=>"All Service fetched successfully.", 'result'=>$result, 'selected_service'=>$select_service, 'selected_query'=> $selected_res, 'selected_billing_info_service_category' => $selected_billing_info_service_category, 'firm_id'=>$this->session->userdata("firm_id"));

        echo json_encode($data);
	}

	public function get_billing_info_frequency()
	{
		//$frequency = $_POST['frequency'];

		$ci =& get_instance();

		$query = "select * from billing_info_frequency";

		$result = $ci->db->query($query);
        //echo json_encode($result->result_array());
        $result = $result->result_array();

        if(!$result) {
          throw new exception("Frequency not found.");
        }

        $res = array();
        foreach($result as $row) {
            $res[$row['id']] = $row['frequency'];
        }

        //$ci =& get_instance();
        // if($frequency != "")
        // {
        // 	$selected_frequency = $frequency;
        // }
        // else
        // {
        // 	$selected_frequency = null;
        // }

        $ci =& get_instance();
        $selected_frequency = $ci->session->userdata('billing_period');
        $ci->session->unset_userdata('billing_period');
        

        $data = array('status'=>'success', 'tp'=>1, 'msg'=>"All Frequency fetched successfully.", 'result'=>$res, 'selected_frequency'=>$selected_frequency);

        echo json_encode($data);
	}

	public function get_type_of_day()
	{
		$type_of_day = $_POST['type_of_day'];

		$ci =& get_instance();

		$query = "select * from type_of_day";

		$result = $ci->db->query($query);
        //echo json_encode($result->result_array());
        $result = $result->result_array();

        if(!$result) {
          throw new exception("Type of Day not found.");
        }

        $res = array();
        foreach($result as $row) {
            $res[$row['id']] = $row['type_of_day'];
        }

        //$ci =& get_instance();
        if($type_of_day != "")
        {
        	$selected_type_of_day = $type_of_day;
        }
        else
        {
        	$selected_type_of_day = null;
        }
        

        $data = array('status'=>'success', 'tp'=>1, 'msg'=>"All Type of Day fetched successfully.", 'result'=>$res, 'selected_type_of_day'=>$selected_type_of_day);

        echo json_encode($data);
	}

	public function search_register()
	{

		$company_code = $_POST['company_code'];
		$register = $_POST['register'];

		$from = $_POST['from'];
		$to = $_POST['to'];

		/*if($from != null)
		{
			$array = explode('/', $_POST['from']);
			$tmp = $array[0];
			$array[0] = $array[1];
			$array[1] = $tmp;
			unset($tmp);
			$from = implode('/', $array);
			$time = strtotime($from);
			$from = date('d/m/Y',$time);
		}
		
		if($to != null)
		{
			$array = explode('/', $_POST['to']);
			$tmp = $array[0];
			$array[0] = $array[1];
			$array[1] = $tmp;
			unset($tmp);
			$to = implode('/', $array);
			$time = strtotime($to);
			$to = date('d/m/Y',$time);
		}*/

		//echo json_encode($from);
		$client_guarantee_query = $this->db->query('select * from client where company_code = "'.$company_code.'"');

		if ($client_guarantee_query->num_rows() > 0) {

			$client_guarantee_query = $client_guarantee_query->result_array();

			if($client_guarantee_query[0]["company_type"] == "4" || $client_guarantee_query[0]["company_type"] == "5" || $client_guarantee_query[0]["company_type"] == "6")
			{
				$check_member_state = "guarantee";
			}
			else
			{
				$check_member_state = "non-guarantee";
			}
		}

		if($register == "all")
		{
			echo json_encode(array("client_name" => $client_guarantee_query[0]["company_name"], "check_member_state" => $check_member_state, "register" => $register, $this->search_register_profile($company_code), $this->search_register_officer($company_code, $from, $to), $this->search_register_member($company_code, $from, $to), $this->search_register_charges($company_code, $from, $to), $this->search_register_filing($company_code, $from, $to), $this->search_register_controller($company_code, $from, $to)));
		}
		else if($register == "profile")
		{
			echo json_encode(array("register" => $register, $this->search_register_profile($company_code)));
		}
		else if($register == "member")
		{
			echo json_encode(array("client_name" => $client_guarantee_query[0]["company_name"], "check_member_state" => $check_member_state, "register" => $register, $this->search_register_member($company_code, $from, $to)));
		}
		else if($register == "filing")
		{
			echo json_encode(array("register" => $register, $this->search_register_filing($company_code, $from, $to)));
		}
		else if($register == "officer")
		{
            echo json_encode(array("register" => $register, $this->search_register_officer($company_code, $from, $to)));
		}
		else if($register == "charges")
		{
			
	        echo json_encode(array("register" => $register, $this->search_register_charges($company_code, $from, $to)));
		}
		else if($register == "controller")
		{
			
	        echo json_encode(array("register" => $register, $this->search_register_controller($company_code, $from, $to)));
		}
		else
		{
			echo json_encode(array("register" => null));
		}
	}

	public function search_register_profile($company_code)
	{
		$this->db->select('client.*, acquried_by.acquried_by as acquried_by_name, company_type.company_type as company_type_name, status.status as status_name');
		$this->db->from('client');
		$this->db->join('acquried_by', 'acquried_by.id = client.acquried_by', 'left');
		$this->db->join('company_type', 'company_type.id = client.company_type', 'left');
		$this->db->join('status', 'status.id = client.status', 'left');
		$this->db->where('company_code', $company_code);
		$query = $this->db->get(); 

		if ($query->num_rows() > 0) {
            foreach (($query->result()) as $row) {
                $data[] = $row;
            }
            $this->data['profile'] = $data;
            return $this->data;
        }
		
	}

	public function search_register_member($company_code, $from, $to)
	{
		$client_query = $this->db->query('select * from client where company_code = "'.$company_code.'"');

		if ($client_query->num_rows() > 0) {

			$client_query = $client_query->result_array();

			if($client_query[0]["company_type"] == "4" || $client_query[0]["company_type"] == "5" || $client_query[0]["company_type"] == "6")
			{
				$where = "";
				if($from == null && $to == null)
				{
					$where = "";
				}
				if($from != null && $to == null)
				{
					$where = 'STR_TO_DATE(client_guarantee.guarantee_start_date,"%d/%m/%Y") >= STR_TO_DATE("'. $from. '","%d/%m/%Y") AND';
				}
				else if($from != null && $to != null)
				{
					$where = 'STR_TO_DATE(client_guarantee.guarantee_start_date,"%d/%m/%Y") BETWEEN  STR_TO_DATE("'. $from. '","%d/%m/%Y") and STR_TO_DATE("'. $to.'","%d/%m/%Y") AND';
				}

				$query = $this->db->query('select client_guarantee.*, DATE_FORMAT(STR_TO_DATE(client_guarantee.guarantee_start_date, "%d/%m/%Y"), "%d/%m/%Y") as transaction_date, STR_TO_DATE(client_guarantee.guarantee_start_date, "%d/%m/%Y") as trans_date, officer.field_type as officer_field_type, officer.identification_no, officer.name, officer.address_type as officer_address_type, officer.postal_code1, officer.street_name1, officer.building_name1, officer.unit_no1, officer.unit_no2, officer.foreign_address1, officer.foreign_address2, officer.foreign_address3, officer_company.field_type as officer_company_field_type, officer_company.register_no, officer_company.company_name, officer_company.address_type as officer_company_address_type, officer_company.company_postal_code, officer_company.company_street_name, officer_company.company_building_name, officer_company.company_unit_no1, officer_company.company_unit_no2, officer_company.company_foreign_address1, officer_company.company_foreign_address2, officer_company.company_foreign_address3, currency.currency as currency_name from client_guarantee left join officer on client_guarantee.officer_id = officer.id and client_guarantee.field_type = officer.field_type left join officer_company on client_guarantee.officer_id = officer_company.id and client_guarantee.field_type = officer_company.field_type left join currency on currency.id = client_guarantee.currency_id where '.$where.' company_code ="'.$company_code.'" ORDER BY officer_company.company_name, officer.name, trans_date');

				if ($query->num_rows() > 0) {
		            foreach (($query->result()) as $row) {
		                $data[] = $row;
		            }
		            $this->data['guarantee_member'] = $data;
		            return $this->data;
		        }
			}
			else
			{
				$where = "";
				if($from == null && $to == null)
				{
					$where = "";
				}
				if($from != null && $to == null)
				{
					$where = 'STR_TO_DATE(member_shares.transaction_date,"%d/%m/%Y") >= STR_TO_DATE("'. $from. '","%d/%m/%Y") AND';
				}
				else if($from != null && $to != null)
				{
					$where = 'STR_TO_DATE(member_shares.transaction_date,"%d/%m/%Y") BETWEEN STR_TO_DATE("'. $from. '","%d/%m/%Y") and STR_TO_DATE("'. $to.'","%d/%m/%Y") AND';
				}

				$query = $this->db->query('select member_shares.*, member_shares.number_of_share as number_of_share, member_shares.amount_share as amount_share, member_shares.no_of_share_paid as no_of_share_paid, member_shares.amount_paid as amount_paid, member_shares.transaction_type, DATE_FORMAT(STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y"), "%d/%m/%Y") as transaction_date, STR_TO_DATE(member_shares.transaction_date, "%d/%m/%Y") as trans_date, officer.field_type as officer_field_type, officer.identification_no, officer.name, officer.address_type as officer_address_type, officer.postal_code1, officer.street_name1, officer.building_name1, officer.unit_no1, officer.unit_no2, officer.foreign_address1, officer.foreign_address2, officer.foreign_address3, officer_company.field_type as officer_company_field_type, officer_company.register_no, officer_company.company_name, officer_company.address_type as officer_company_address_type, officer_company.company_postal_code, officer_company.company_street_name, officer_company.company_building_name, officer_company.company_unit_no1, officer_company.company_unit_no2, officer_company.company_foreign_address1, officer_company.company_foreign_address2, officer_company.company_foreign_address3, officer_company.country_of_incorporation, client.registration_no, "client" as client_field_type, client.company_name as client_company_name, client.postal_code as client_postal_code, client.street_name as client_street_name, client.building_name as client_building_name, client.unit_no1 as client_unit_no1, client.unit_no2 as client_unit_no2, share_capital.id as share_capital_id, share_capital.class_id, share_capital.other_class, share_capital.currency_id, class.sharetype, currencies.currency, certificate.certificate_no, certificate.status, nationality.nationality as nationality_name from member_shares left join certificate on certificate.officer_id = member_shares.officer_id and certificate.field_type = member_shares.field_type and certificate.transaction_id = member_shares.transaction_id left join officer on member_shares.officer_id = officer.id and member_shares.field_type = officer.field_type left join officer_company on member_shares.officer_id = officer_company.id and member_shares.field_type = officer_company.field_type left join client on client.id = member_shares.officer_id and member_shares.field_type = "client" left join client_member_share_capital as share_capital on member_shares.client_member_share_capital_id = share_capital.id left join sharetype as class on class.id = share_capital.class_id left join currency as currencies on currencies.id = share_capital.currency_id left join nationality on nationality.id = officer.nationality where '.$where.' member_shares.company_code="'.$company_code.'" ORDER BY officer_company.company_name, officer.name, trans_date');

				if ($query->num_rows() > 0) {
		            foreach (($query->result()) as $row) {
		                $data[] = $row;
		            }
		            $this->data['member'] = $data;
		            return $this->data;
		        }
			}

		}
		
		
	}

	public function search_register_filing($company_code, $from, $to)
	{
		//$this->data['filing_data'] = $this->master_model->get_all_filing_data($company_code);

		//$get_all_filing_data = $this->db->query("select * from filing where company_code='".$company_code."' order by id");
		if($from == null && $to == null)
		{
			$get_all_filing_data = $this->db->query("select * from filing where company_code='".$company_code."' AND ar_filing_date != '' order by id");
		}
		else if($from != null && $to == null)
		{
			$get_all_filing_data = $this->db->query('select * from filing where STR_TO_DATE(year_end,"%d %M %Y") >= STR_TO_DATE("'.$from.'","%d/%m/%Y") AND company_code="'.$company_code.'" AND ar_filing_date != "" order by id');
		}
		else if($from != null && $to != null)
		{
			$get_all_filing_data = $this->db->query('select * from filing where STR_TO_DATE(year_end,"%d %M %Y") BETWEEN  STR_TO_DATE("'.$from.'","%d/%m/%Y") and STR_TO_DATE("'.$to.'","%d/%m/%Y") AND company_code="'.$company_code.'" AND ar_filing_date != "" order by id');
		}

        if ($get_all_filing_data->num_rows() > 0) {
            foreach (($get_all_filing_data->result()) as $row) {
                $data[] = $row;
            }
            //return $data;
            $this->data['filing_data'] = $data;
            
        }
        else
        {
        	$this->data['filing_data'] = [];
        }
		return $this->data;
	}

	public function search_register_officer($company_code, $from, $to)
	{
		if($from == null && $to == null)
		{
			$q = $this->db->query('select client_officers.*, officer.field_type as officer_field_type, officer.identification_no, officer.name, officer.address_type as officer_address_type, officer.postal_code1, officer.street_name1, officer.building_name1, officer.unit_no1, officer.unit_no2, officer.foreign_address1, officer.foreign_address2, officer.foreign_address3, officer_company.field_type as officer_company_field_type, officer_company.register_no, officer_company.company_name, officer_company.address_type as officer_company_address_type, officer_company.company_postal_code, officer_company.company_street_name, officer_company.company_building_name, officer_company.company_unit_no1, officer_company.company_unit_no2, officer_company.company_foreign_address1, officer_company.company_foreign_address2, officer_company.company_foreign_address3, client_officers_position.position as position_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type left join client_officers_position on client_officers.position = client_officers_position.id where company_code ="'.$company_code.'" ORDER BY position_name');
		}
		else if($from != null && $to == null)
		{
			$q = $this->db->query('select client_officers.*, client_officers.date_of_appointment, officer.field_type as officer_field_type, officer.identification_no, officer.name, officer.address_type as officer_address_type, officer.postal_code1, officer.street_name1, officer.building_name1, officer.unit_no1, officer.unit_no2, officer.foreign_address1, officer.foreign_address2, officer.foreign_address3, officer_company.field_type as officer_company_field_type, officer_company.register_no, officer_company.company_name, officer_company.address_type as officer_company_address_type, officer_company.company_postal_code, officer_company.company_street_name, officer_company.company_building_name, officer_company.company_unit_no1, officer_company.company_unit_no2, officer_company.company_foreign_address1, officer_company.company_foreign_address2, officer_company.company_foreign_address3, client_officers_position.position as position_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type left join client_officers_position on client_officers.position = client_officers_position.id where STR_TO_DATE(client_officers.date_of_appointment,"%d/%m/%Y") >= STR_TO_DATE("'. $from. '","%d/%m/%Y") AND client_officers.company_code ="'.$company_code.'" ORDER BY position_name');
		}
		else if($from != null && $to != null)
		{
			$q = $this->db->query('select client_officers.*, client_officers.date_of_appointment, officer.field_type as officer_field_type, officer.identification_no, officer.name, officer.address_type as officer_address_type, officer.postal_code1, officer.street_name1, officer.building_name1, officer.unit_no1, officer.unit_no2, officer.foreign_address1, officer.foreign_address2, officer.foreign_address3, officer_company.field_type as officer_company_field_type, officer_company.register_no, officer_company.company_name, officer_company.address_type as officer_company_address_type, officer_company.company_postal_code, officer_company.company_street_name, officer_company.company_building_name, officer_company.company_unit_no1, officer_company.company_unit_no2, officer_company.company_foreign_address1, officer_company.company_foreign_address2, officer_company.company_foreign_address3, client_officers_position.position as position_name from client_officers left join officer on client_officers.officer_id = officer.id and client_officers.field_type = officer.field_type left join officer_company on client_officers.officer_id = officer_company.id and client_officers.field_type = officer_company.field_type left join client_officers_position on client_officers.position = client_officers_position.id where STR_TO_DATE(client_officers.date_of_appointment,"%d/%m/%Y") BETWEEN STR_TO_DATE("'. $from. '","%d/%m/%Y") and STR_TO_DATE("'. $to.'","%d/%m/%Y") AND client_officers.company_code ="'.$company_code.'" ORDER BY client_officers.date_of_appointment, position_name');
		}

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            //return $data;
            $this->data['client_officers'] = $data;
            
        }
        else
        {
        	$this->data['client_officers'] = [];
        }
		return $this->data;
	}

	public function search_register_controller($company_code, $from, $to)
	{
		if($from == null && $to == null)
		{
			$q = $this->db->query('select client_controller.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_controller left join officer on client_controller.officer_id = officer.id and client_controller.field_type = officer.field_type left join officer_company on client_controller.officer_id = officer_company.id and client_controller.field_type = officer_company.field_type where company_code ="'.$company_code.'"');
		}
		else if($from != null && $to == null)
		{
			$q = $this->db->query('select client_controller.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_controller left join officer on client_controller.officer_id = officer.id and client_controller.field_type = officer.field_type left join officer_company on client_controller.officer_id = officer_company.id and client_controller.field_type = officer_company.field_type where STR_TO_DATE(client_controller.date_of_registration,"%d/%m/%Y") >= STR_TO_DATE("'. $from. '","%d/%m/%Y") AND client_controller.company_code ="'.$company_code.'"');
		}
		else if($from != null && $to != null)
		{
			$q = $this->db->query('select client_controller.*, officer.identification_no, officer.name, officer_company.register_no, officer_company.company_name from client_controller left join officer on client_controller.officer_id = officer.id and client_controller.field_type = officer.field_type left join officer_company on client_controller.officer_id = officer_company.id and client_controller.field_type = officer_company.field_type where STR_TO_DATE(client_controller.date_of_registration,"%d/%m/%Y") BETWEEN  STR_TO_DATE("'. $from. '","%d/%m/%Y") and STR_TO_DATE("'. $to.'","%d/%m/%Y") AND company_code ="'.$company_code.'"');
		}

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            //return $data;
            $this->data['client_controller'] = $data;
            
        }
        else
        {
        	$this->data['client_controller'] = [];
        }
		return $this->data;
	}

	public function search_register_charges($company_code, $from, $to)
	{
		$this->db->select('client_charges.*, currency.currency as currency_name');
		$this->db->from('client_charges');
		$this->db->join('currency', 'currency.id = client_charges.currency', 'left');
		$this->db->where('company_code', $company_code);

		if($from == null && $to == null)
		{	
			$q = $this->db->get(); 
		}
		else if($from != null && $to == null)
		{
			/*$this->db->select('client_charges.*, currency.currency as currency_name');
			$this->db->from('client_charges');
			$this->db->join('currency', 'currency.id = client_charges.currency', 'left');
			$this->db->where('company_code', $company_code);*/
			$this->db->where('STR_TO_DATE(client_charges.date_registration,"%d/%m/%Y") >= STR_TO_DATE("'.$from. '","%d/%m/%Y")');
			$q = $this->db->get(); 
		}
		else if($from != null && $to != null)
		{
			/*$this->db->select('client_charges.*, currency.currency as currency_name');
			$this->db->from('client_charges');
			$this->db->join('currency', 'currency.id = client_charges.currency', 'left');
			$this->db->where('company_code', $company_code);*/

			$this->db->where('STR_TO_DATE(client_charges.date_registration,"%d/%m/%Y") BETWEEN STR_TO_DATE("'.$from. '","%d/%m/%Y") and STR_TO_DATE("'.$to.'","%d/%m/%Y")');
			$q = $this->db->get(); 
		}

        if ($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $data[] = $row;
            }
            $this->data['charges'] = $data;
        }
        else
        {
        	$this->data['charges'] = [];
        }
		return $this->data;
	}

	public function calculate_new_filing_date()
	{	
		$latest_year_end = $_POST["latest_year_end"];

		$year_end_date = new DateTime($latest_year_end);

		$date_175 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

		$new_filing['due_date_175'] =  date("t F Y", strtotime($date_175));

		$date_201 = $this->MonthShifter($year_end_date,6)->format(('Y-m-d'));

		$new_filing['due_date_201'] =  date("t F Y", strtotime($date_201));

		$date_197 = $this->MonthShifter($year_end_date,7)->format(('Y-m-d'));

		$new_filing['due_date_197'] =  date("t F Y", strtotime($date_197));

		$data = array('status'=>'success', 'tp'=>1, 'msg'=>"Year End fetched successfully.", 'result'=>$new_filing);

		echo json_encode($data);
	    //echo ($year_end_date);
	}
}
